{"meta":{"title":"Ino's Blog - ç­±å†‰çš„æ¸©é¦¨å°çª","subtitle":"","description":"Ino - åšå®¢ç½‘æ˜¯ä¸€ä¸ªä¸“æ³¨äºå­¦ä¹ åˆ†äº«ä¸æ•™ç¨‹çš„ä¸€ä¸ªç½‘ç«™!","author":"Ino","url":"https://aqu.iyunmc.cn","root":"/"},"pages":[{"title":"","date":"2023-05-30T06:15:56.462Z","updated":"2023-05-30T06:15:56.462Z","comments":true,"path":"404.html","permalink":"https://aqu.iyunmc.cn/404","excerpt":"","text":"404 å¾ˆæŠ±æ­‰ï¼Œæ‚¨è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨ å¯èƒ½æ˜¯è¾“å…¥åœ°å€æœ‰è¯¯æˆ–è¯¥åœ°å€å·²è¢«åˆ é™¤"},{"title":"æ–‡ç« åˆ†ç±»","date":"2023-05-30T06:35:53.694Z","updated":"2023-05-30T06:35:53.694Z","comments":true,"path":"categories/index.html","permalink":"https://aqu.iyunmc.cn/categories/","excerpt":"","text":""},{"title":"","date":"2023-06-05T03:18:48.233Z","updated":"2023-06-05T03:18:48.233Z","comments":true,"path":"friends/index.html","permalink":"https://aqu.iyunmc.cn/friends/","excerpt":"","text":"æˆ‘ çš„ æœ‹ å‹ ä»¬"},{"title":"","date":"2023-06-05T07:00:53.562Z","updated":"2023-06-05T07:00:53.562Z","comments":true,"path":"about/index.html","permalink":"https://aqu.iyunmc.cn/about/","excerpt":"","text":"å…³ äº æˆ‘ å…³äºæˆ‘ é¦–å…ˆæ¬¢è¿æ‚¨çš„åˆ°æ¥ï¼ æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢ï¼æˆ‘æ˜¯ä¸€ä¸ªçƒ­çˆ±ç¼–ç¨‹å’ŒæŠ€æœ¯çš„äººï¼Œå–œæ¬¢åˆ†äº«è‡ªå·±çš„çŸ¥è¯†å’Œç»éªŒã€‚åœ¨è¿™ä¸ªåšå®¢ä¸Šï¼Œæˆ‘ä¼šåˆ†äº«ä¸€äº›æœ‰è¶£çš„ç¨‹åºã€å¹²è´§ã€æŠ€å·§ã€å¼€å‘æ•™ç¨‹ã€å¿ƒæƒ…å’Œå­¦ä¹ è®°å½•ç­‰ç­‰ï¼åœ¨æˆ‘ä»ä¸€å¼€å§‹å­¦ä¹ ç¼–ç¨‹åˆ°ç°åœ¨ï¼Œåœ¨ä¸æ–­çš„æŸ¥èµ„æ–™ä¸­ï¼Œæˆ‘å‘ç°å¾ˆå¤šäººéƒ½ä¼šæŠŠä¸€äº›é‡è¦çš„ä¸œè¥¿è®°å½•ä¸‹æ¥ï¼Œæ–¹ä¾¿ä»¥åæŸ¥çœ‹ã€‚åœ¨ç°åœ¨è¿™ä¸ªäº’è”ç½‘æ—¶ä»£ï¼Œå¿«é€Ÿçš„å­¦ä¹ è¿‡ç¨‹ï¼Œç”šè‡³æ²¡æœ‰æ—¶é—´æ‰“å¼€ç¬”å¢¨ï¼Œåšå®¢ç¡®å®æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚æ—¢èƒ½å†™ä¸€å¹´åè¿˜èƒ½çœ‹å¾—æ‡‚åšå®¢ï¼Œåˆèƒ½æŠŠç»éªŒå˜æˆä¸å¯æ›¿ä»£æ€§å¯è§çš„ä¸œè¥¿ã€‚åœ¨æé«˜è‡ªå·±æ€»ç»“æ€§èƒ½åŠ›çš„åŒæ—¶ï¼Œä¹Ÿè®©åšå®¢æˆä¸ºäº†è‡ªå·±ä¸€ä»½ç‹¬ç‰¹çš„åç‰‡ã€‚ æœ€åå¼•ç”¨äº’è”ç½‘ä¸Šçœ‹åˆ°çš„ä¸€å¥è¯ï¼šâ€œå±Œä¸ç¨‹åºå‘˜çš„é€†è¢­ä¸€èˆ¬åˆ†ä¸¤æ­¥ï¼šè®©è‡ªå·±å˜å¾—ç‰›é€¼ï¼Œè®©åˆ«äººçŸ¥é“ä½ ç‰›é€¼ã€‚â€å¦‚æœæ‚¨å¯¹æˆ‘çš„åšå®¢æœ‰ä»»ä½•å»ºè®®æˆ–è€…æƒ³æ³•ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€ï¼Œæˆ‘ä¼šå°½å¿«å›å¤ï¼æˆ‘çš„èƒ½åŠ›æˆ‘æ˜¯ä¸€åæ‹¥æœ‰å¤šå¹´ç¼–ç¨‹ç»éªŒçš„å¼€å‘è€…ï¼Œç†Ÿç»ƒæŒæ¡ä»¥ä¸‹æŠ€èƒ½ï¼š ç¼–ç¨‹è¯­è¨€ï¼š Javaã€ Pythonã€ JavaScriptã€ C++ç­‰ï¼› å¼€å‘æ¡†æ¶ï¼š Springã€ Flaskã€ Reactã€ Vueç­‰ï¼› æ•°æ®åº“ï¼š MySQLã€ Oracleã€ Redisç­‰; å·¥å…·ï¼š Gitã€ Dockerç­‰ã€‚ ç‰ˆæƒå£°æ˜åšå®¢å†…çš„æ‰€æœ‰åŸåˆ›å†…å®¹ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºæ–‡ç« ã€å›¾åƒç­‰ï¼‰é™¤ç‰¹åˆ«å£°æ˜å¤–å‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®ï¼Œä»»ä½•äººéƒ½å¯ä»¥è‡ªç”±ä¼ æ’­ï¼Œä½†ä¸å¾—ç”¨äºå•†ç”¨ä¸”å¿…é¡»ç½²åå¹¶ä»¥ç›¸åŒæ–¹å¼åˆ†äº«ã€‚ éšç§åŸåˆ™æœ¬ç«™å†…ç›®å‰æ¶‰åŠåˆ°æµè§ˆè€…éšç§çš„åªæœ‰ä¸€ä¸ªåœ°æ–¹ï¼Œå°±æ˜¯ç•™è¨€åŒºï¼ˆæ–‡ç« è¯„è®ºï¼‰ã€‚å½“ä½ ç•™è¨€æ—¶ï¼Œä½ çš„ç”µå­é‚®ç®±ã€Cookiesä¿¡æ¯å’ŒIPv4/IPv6åœ°å€éƒ½ä¼šè¢«è®°å½•ã€‚è¿™äº›ä¿¡æ¯ä»…ä¸ºäº†æ”¹è¿›æˆ‘ä»¬çš„ç½‘ç«™è´¨é‡å’Œå¯èƒ½çš„äº¤æµæ²Ÿé€šã€‚æˆ‘ä»¬ä¸ä¼šå°†è¿™äº›ä¿¡æ¯è¿›è¡Œå±•ç¤ºã€å‡ºç§Ÿæˆ–å‡ºå”®ç»™ä»»ä½•äººã€‚ä½†ä»¥ä¸‹æƒ…å†µé™¤å¤–ï¼š åªæœ‰é€éœ²æ‚¨çš„ä¸ªäººèµ„æ–™ï¼Œæ‰èƒ½æä¾›æ‚¨æ‰€è¦æ±‚çš„äº§å“å’ŒæœåŠ¡ï¼› æˆ‘ä»¬éœ€è¦å¬ä»æ³•åº­ä¼ ç¥¨ã€æ³•å¾‹å‘½ä»¤æˆ–éµå¾ªæ³•å¾‹ç¨‹åºï¼› æˆ‘ä»¬å‘ç°æ‚¨è¿åäº†æœ¬ç«™å·²å‘å¸ƒçš„æ¡æ¬¾æˆ–å£°æ˜ã€‚"},{"title":"é¸£è°¢é¡¹ç›®å’Œç¤¾åŒºè´¡çŒ®è€…","date":"2023-05-30T06:35:51.728Z","updated":"2023-05-30T06:35:51.728Z","comments":true,"path":"contributors/index.html","permalink":"https://aqu.iyunmc.cn/contributors/","excerpt":"Volantis ç¤¾åŒºçš„å‘å±•ç¦»ä¸å¼€å›¢é˜Ÿå¤§ä½¬ä»¬çš„æ— ç§å¥‰çŒ®å’Œç¤¾åŒºå°ä¼™ä¼´ä»¬çš„çƒ­æƒ…äº’åŠ©ã€‚æ¯ä¸€ä¸ªå¿ƒæ€€æ¢¦æƒ³ã€æœ‰ç€ç‹¬ç‰¹è§è§£çš„æœ‹å‹éƒ½å¯ä»¥æˆä¸ºå›¢é˜Ÿçš„ä¸€å‘˜ã€‚ç›®å‰ Volantis ç¤¾åŒºæ­£å¤„äºå»ºè®¾åˆæœŸï¼Œæˆ‘ä»¬ç¼ºå°‘å„æ–¹é¢çš„äººæ‰ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ä¸»é¢˜è‡³å°‘ä¸€ä¸ªæœˆä¸”é•¿æœŸæ´»è·ƒäºç¤¾åŒºï¼Œä¾‹å¦‚ï¼š è§£ç­” issues &#x2F; discussions æäº¤æœ‰æ•ˆçš„å»ºè®® å®˜ç½‘æ–‡æ¡£è¡¥å…¨&#x2F;çº é”™ å‘ç°å¹¶æ”¶å½•æœ‰æ„æ€çš„æ–‡ç« ï¼ˆæ­å»ºåšå®¢æ–¹é¢ï¼‰åˆ°å®˜ç½‘ æˆ‘ä»¬éå¸¸æ¬¢è¿æ‚¨çš„åŠ å…¥ï¼Œè¯·åœ¨è®ºå›å‘å¸–å‘Šè¯‰æˆ‘ä»¬ã€‚","text":"Volantis ç¤¾åŒºçš„å‘å±•ç¦»ä¸å¼€å›¢é˜Ÿå¤§ä½¬ä»¬çš„æ— ç§å¥‰çŒ®å’Œç¤¾åŒºå°ä¼™ä¼´ä»¬çš„çƒ­æƒ…äº’åŠ©ã€‚æ¯ä¸€ä¸ªå¿ƒæ€€æ¢¦æƒ³ã€æœ‰ç€ç‹¬ç‰¹è§è§£çš„æœ‹å‹éƒ½å¯ä»¥æˆä¸ºå›¢é˜Ÿçš„ä¸€å‘˜ã€‚ç›®å‰ Volantis ç¤¾åŒºæ­£å¤„äºå»ºè®¾åˆæœŸï¼Œæˆ‘ä»¬ç¼ºå°‘å„æ–¹é¢çš„äººæ‰ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ä¸»é¢˜è‡³å°‘ä¸€ä¸ªæœˆä¸”é•¿æœŸæ´»è·ƒäºç¤¾åŒºï¼Œä¾‹å¦‚ï¼š è§£ç­” issues &#x2F; discussions æäº¤æœ‰æ•ˆçš„å»ºè®® å®˜ç½‘æ–‡æ¡£è¡¥å…¨&#x2F;çº é”™ å‘ç°å¹¶æ”¶å½•æœ‰æ„æ€çš„æ–‡ç« ï¼ˆæ­å»ºåšå®¢æ–¹é¢ï¼‰åˆ°å®˜ç½‘ æˆ‘ä»¬éå¸¸æ¬¢è¿æ‚¨çš„åŠ å…¥ï¼Œè¯·åœ¨è®ºå›å‘å¸–å‘Šè¯‰æˆ‘ä»¬ã€‚ æ„Ÿè°¢å¼€å‘è€… æ„Ÿè°¢ç¤¾åŒºå»ºè®¾è€… å¦‚ä½•å‚ä¸ç¤¾åŒºå»ºè®¾ç¤¾åŒºå»ºè®¾ä¸»è¦åŒ…æ‹¬ Issues Discussions(è®ºå›) å®˜ç½‘åšå®¢æ”¶å½• å®˜ç½‘æ–‡æ¡£ç»´æŠ¤ å‡ ä¸ªæ–¹é¢ã€‚ å¦‚ä½•ç»´æŠ¤æ–‡æ¡£ç›®å‰ Volantis å·²æ˜¯å·²çŸ¥çš„ Hexo ä¸»é¢˜ä¸­æ–‡æ¡£æœ€å…¨é¢çš„ï¼Œä½†ä»æœ‰éƒ¨åˆ†åŠŸèƒ½ç¼ºå°‘æ˜ç¡®çš„æ–‡æ¡£ã€éƒ¨åˆ†æ–‡æ¡£å·²ç»è¿‡æ—¶ï¼Œå¦‚æœæ‚¨å‘ç°äº†é—æ¼æˆ–è€…é”™è¯¯ä¹‹å¤„ï¼Œæˆ‘ä»¬éå¸¸å¸Œæœ›æ‚¨èƒ½å¤Ÿå¸®å¿™å®Œå–„ä¸€ä¸‹ã€‚ Volantis å®˜ç½‘æ”¯æŒ CI ï¼Œæ‚¨å¯ä»¥ç›´æ¥åœ¨çº¿ç¼–è¾‘æºç ï¼š åœ¨çº¿ç¼–è¾‘æ–‡æ¡£https://github.com/volantis-x/community/tree/main/source å‘å¸ƒä¸åˆ†äº«æ–‡ç« æ¯ä½ç”¨æˆ·åœ¨ä½¿ç”¨æˆ–æ›´æ–°ä¸»é¢˜çš„æ—¶å€™éƒ½éœ€è¦é˜…è¯»å®˜ç½‘çš„æ–‡æ¡£ï¼Œæ”¶å½•çš„ç›¸å…³å†…å®¹èƒ½å¸®åŠ©ç”¨æˆ·æ›´é«˜æ•ˆåœ°ä¸Šæ‰‹ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿæé«˜è¢«æ”¶å½•çš„æ–‡ç« çš„æ›å…‰ç‡ã€‚å¦‚æœåœ¨å®˜ç½‘èƒ½çœ‹åˆ°æ›´å¤šçš„æœ‰ä»·å€¼çš„æ–‡ç« ï¼Œå°±ä¼šæœ‰æ›´å¤š Volantis ç”¨æˆ·æˆ–è€…é Volantis ç”¨æˆ·æ¥è®¿é—®ã€‚ å¦‚æœæ‚¨æœ‰æˆ–è€…å‘ç°äº†ä¸ Hexo åšå®¢æ­å»ºç›¸å…³çš„æ–‡ç« ï¼Œå¯ä»¥è½¬è½½å¤–é“¾åˆ° Volantis å®˜ç½‘ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š _posts/blogs/2020-05-17-pjax.md---title: Volantis ä¸»é¢˜éƒ¨ç½² Pjaxdate: 2020-05-17updated: 2020-08-07categories: [å¼€å‘å¿ƒå¾—]author: inksslink: https://inkss.cn/blog/76993423/description: æœ¬ç¯‡æ–‡ç« è®°å½•äº†æˆ‘å¯¹ Volantis ä¸»é¢˜åš Pjax å…¼å®¹çš„ç§ç§ï¼Œå¤§æŠµç®—æ˜¯ç§è®°å½•å§~headimg: # å¯ä»¥è®¾ç½®æ–‡ç« å¤´å›¾backup: https://web.archive.org/web/xxxxxxxxxx # å°†é¡µé¢å­˜æ¡£åˆ°äº’è”ç½‘æ¡£æ¡ˆé¦† archive.org çš„å­˜æ¡£é“¾æ¥ https://web.archive.org/save--- å¦‚æœè¿™ç¯‡æ–‡ç« çš„ä½œè€…æ˜¯ç¬¬ä¸€æ¬¡å‡ºç°åœ¨å®˜ç½‘ï¼Œè¿˜éœ€è¦åœ¨ _data/author.yml æ–‡ä»¶ä¸­æ·»åŠ ä½œè€…ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š _data/author.yml...inkss: name: æ‹æŸšæ¢“ avatar: https://cdn.jsdelivr.net/gh/inkss/common@1.4.2/hexo/img/static/avatar.jpg url: https://inkss.cn æ³¨æ„äº‹é¡¹æ–‡ç« å­˜æ”¾åœ¨ _posts/blogs/ ç›®å½•ä¸­ï¼Œä¸”æ–‡ä»¶åæ ¼å¼ä¸ºã€Œå¹´-æœˆ-æ—¥-æ–‡ç« è¯é¢˜ã€ã€‚é¼“åŠ±åŸåˆ›æ–‡ç« ï¼Œæ‘˜è¦éƒ¨åˆ†300å­—ç¬¦ä»¥å†…ã€‚å¦‚æœæƒ³ä¸å‡ºæ‘˜è¦å¯ä»¥ä¸å†™ï¼Œä¸è¦åœ¨æ‘˜è¦é‡Œé‡å¤ä¸€éæ–‡ç« æ ‡é¢˜ã€‚æœ€å¥½é€‰æ‹©ä¸€ä¸ªæ–‡ç« åˆ†ç±»ï¼Œå¦‚æœç°æœ‰çš„åˆ†ç±»ä¸­æ²¡æœ‰åˆé€‚çš„ï¼Œå¯ä»¥è‡ªå·±æ–°å¢ã€‚å¦‚æœæœ‰æ–‡ç« å¤´å›¾ï¼Œè¯·ç¡®ä¿å›¾ç‰‡å†…æœ€å¤šåªæœ‰ä¸€ä¸ªå•è¯æˆ–çŸ­è¯­ï¼Œå›¾ç‰‡ä¸æ¸…æ™°æˆ–è€…ä¸æ–‡ç« æ— å…³çš„è¯ä¸å»ºè®®ä½¿ç”¨ã€‚ä¸ä»…é™äºè‡ªå·±çš„æ–‡ç« ï¼Œå¯ä»¥åœ¨å¾å¾—æ–‡ç« ä½œè€…åŒæ„çš„æƒ…å†µä¸‹å°†å…¶é“¾æ¥æ”¶å½•åˆ°å®˜ç½‘ã€‚ åœ¨çº¿ç¼–è¾‘æ–‡æ¡£https://github.com/volantis-x/community/tree/main/source/_posts/blogs"},{"title":"æ‰€æœ‰æ ‡ç­¾","date":"2023-05-30T06:35:33.205Z","updated":"2023-05-30T06:35:33.205Z","comments":true,"path":"tags/index.html","permalink":"https://aqu.iyunmc.cn/tags/","excerpt":"","text":""},{"title":"","date":"2023-05-30T06:16:09.584Z","updated":"2023-05-30T06:16:09.584Z","comments":true,"path":"examples/index.html","permalink":"https://aqu.iyunmc.cn/examples/","excerpt":"ç¤º ä¾‹ åš å®¢ ç¤¾åŒºç»´æŠ¤å›¢é˜Ÿçš„åšå®¢xaoxuuå¼€å‘è€…MHuiGåˆ’æ°´Colsrchå¼€å‘è€…inkssæ‘¸é±¼volantis-x.js.orgTest Site For Development ä½¿ç”¨ Volantis çš„åšå®¢ç¤ºä¾‹","text":"ç¤º ä¾‹ åš å®¢ ç¤¾åŒºç»´æŠ¤å›¢é˜Ÿçš„åšå®¢xaoxuuå¼€å‘è€…MHuiGåˆ’æ°´Colsrchå¼€å‘è€…inkssæ‘¸é±¼volantis-x.js.orgTest Site For Development ä½¿ç”¨ Volantis çš„åšå®¢ç¤ºä¾‹ å¦‚ä½•æ·»åŠ è‡ªå·±çš„åšå®¢é“¾æ¥ ç¬¬ä¸€æ­¥ï¼šæ–°å»º Issue æŒ‰ç…§æ ¼å¼å¡«å†™å¹¶æäº¤ &#123; &quot;title&quot;: &quot;&quot;, &quot;description&quot;: &quot;&quot;, &quot;screenshot&quot;: &quot;&quot;, &quot;url&quot;: &quot;&quot;, &quot;avatar&quot;: &quot;&quot;, &quot;version&quot;: &quot;ç‰ˆæœ¬ï¼š^4.0&quot;&#125;ä¸ºäº†æé«˜å›¾ç‰‡åŠ è½½é€Ÿåº¦ï¼Œå»ºè®®ä¼˜åŒ–å›¾ç‰‡å°ºå¯¸ï¼šæ‰“å¼€ å‹ç¼©å›¾ ä¸Šä¼ è‡ªå·±çš„æˆªå›¾ï¼Œå°†å›¾ç‰‡çš„é«˜åº¦è°ƒæ•´åˆ° 360px åä¸‹è½½ã€‚å°†å‹ç¼©åçš„å›¾ç‰‡ä¸Šä¼ åˆ° ImgURLå…è´¹å›¾åºŠ æˆ– å»ä¸å›¾åºŠ å¹¶ä½¿ç”¨æ­¤å›¾ç‰‡é“¾æ¥ä½œä¸ºæˆªå›¾é“¾æ¥ã€‚ ç¬¬äºŒæ­¥ï¼šåˆ·æ–° å›æ¥åˆ·æ–°å³å¯ç”Ÿæ•ˆã€‚ å¦‚ä½•æ›´æ–°è‡ªå·±çš„åšå®¢é“¾æ¥ å¦‚æœæ˜¯è‡ªå·±åˆ›å»ºçš„ issue ï¼Œå¯ä»¥è‡ªå·±ä¿®æ”¹ã€‚ å¦‚æœæ˜¯ç®¡ç†å‘˜åˆ›å»ºçš„ï¼Œè¯·è‡ªå·±é‡æ–°åˆ›å»ºä¸€ä»½ï¼Œç„¶åè®©ç®¡ç†å‘˜åˆ æ‰æ—§çš„ã€‚"},{"title":"","date":"2023-06-05T07:16:52.715Z","updated":"2023-06-05T07:16:52.715Z","comments":false,"path":"history/index.html","permalink":"https://aqu.iyunmc.cn/history/","excerpt":"","text":"æ—¶ é—´ è½´ 2021-2-3 æ·»åŠ è‡ªåŠ¨å¤œé—´æ¨¡å¼çš„åŠŸèƒ½ 2021-1-23 åšå®¢å°æˆ åŸºäºHexoä¸‹çš„Volantisä¸»é¢˜å»ºè®¾ 2020-12-27 å…¨ç«™å®Œå…¨è‡ªå†™html ä½¿ç”¨Valineè¯„è®ºç³»ç»Ÿ"},{"title":"","date":"2023-06-05T07:22:08.334Z","updated":"2023-06-05T07:22:08.334Z","comments":true,"path":"messages/index.html","permalink":"https://aqu.iyunmc.cn/messages/","excerpt":"","text":"ğŸ­æ¬¢è¿ä½ çš„æ¥è®¿ï¼Œè¯·éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„ï¼Œæ–‡æ˜çŒæ°´ï¼Œè°¢è°¢åˆä½œ~"},{"title":"","date":"2023-06-04T12:03:48.385Z","updated":"2023-06-04T12:03:48.385Z","comments":true,"path":"notes/Docker.html","permalink":"https://aqu.iyunmc.cn/notes/Docker","excerpt":"","text":"DockerDockeræ˜¯ä¸€ä¸ªå¿«é€Ÿäº¤ä»˜åº”ç”¨ã€è¿è¡Œåº”ç”¨çš„æŠ€æœ¯ å¯ä»¥å°†ç¨‹åºæœºå™¨ä¾èµ–ã€è¿è¡Œç¯å¢ƒä¸€èµ·æ‰“åŒ…ä¸ºä¸€ä¸ªé•œåƒï¼Œå¯ä»¥è¿ç§»åˆ°ä»»æ„Linuxæ“ä½œç³»ç»Ÿ è¿è¡Œæ—¶åˆ©ç”¨æ²™ç®±æœºåˆ¶å½¢æˆéš”ç¦»å®¹å™¨ï¼Œå„ä¸ªåº”ç”¨äº’ä¸å¹²æ‰° å¯åŠ¨ã€ç§»é™¤éƒ½å¯ä»¥é€šè¿‡ä¸€è¡Œå‘½ä»¤å®Œæˆï¼Œæ–¹ä¾¿å¿«æ· é•œåƒï¼šå°†åº”ç”¨åŠå…¶ä¾èµ–ã€ç¯å¢ƒã€é…ç½®æ‰“åŒ…åœ¨ä¸€èµ· å®¹å™¨ï¼šé•œåƒè¿è¡Œèµ·æ¥å°±æ˜¯å®¹å™¨ï¼Œä¸€ä¸ªé•œåƒå¯ä»¥è¿è¡Œå¤šä¸ªå®¹å™¨ Dockerç»“æ„ï¼šæœåŠ¡ç«¯ï¼šæ¥å—å‘½ä»¤æˆ–è¿œç¨‹è¯·æ±‚ï¼Œæ“ä½œé•œåƒæˆ–å®¹å™¨ å®¢æˆ·ç«¯ï¼šå‘é€å‘½ä»¤æˆ–è€…è¯·æ±‚åˆ°DockeræœåŠ¡ç«¯ DockeråŸºæœ¬æ“ä½œ-é•œåƒ1.åŸºæœ¬æ“ä½œdocker images æŸ¥çœ‹é•œåƒ docker rmi åˆ é™¤æŒ‡å®šé•œåƒ docker pull æ‹‰å–é•œåƒ docker push æ¨é€é•œåƒ docker save ä¿å­˜é•œåƒtar docker load åŠ è½½taré•œåƒ docker ps æŸ¥çœ‹æ‰€æœ‰è¿è¡Œçš„å®¹å™¨åŠçŠ¶æ€ docker rm åˆ é™¤å®¹å™¨ï¼ˆä¸èƒ½åˆ é™¤è¿è¡Œä¸­çš„å®¹å™¨ï¼Œé™¤éæ·»åŠ  -f å‚æ•°ï¼‰ docker logs æŸ¥çœ‹å®¹å™¨è¿è¡Œæ—¥å¿— docker exec -it [å®¹å™¨å] [è¦æ‰§è¡Œçš„å‘½ä»¤] è¿›å…¥å®¹å™¨æ‰§è¡Œå‘½ä»¤ 2.å®¹å™¨å‘½ä»¤â‘ .åˆ›å»ºè¿è¡Œä¸€ä¸ªNginxå®¹å™¨æ­¥éª¤ä¸€ï¼šå»docker hubæŸ¥çœ‹Nginxçš„å®¹å™¨è¿è¡Œå‘½ä»¤ docker run --name containerName -p 80:80 -d nginx å‘½ä»¤è§£è¯»ï¼š docker runï¼šåˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªå®¹å™¨ --nameï¼šç»™å®¹å™¨èµ·ä¸€ä¸ªåå­—ï¼Œæ¯”å¦‚å«åšng -pï¼šå°†å®¿ä¸»æœºç«¯å£ä¸å®¹å™¨ç«¯å£æ˜ å°„ï¼Œå†’å·å·¦ä¾§æ˜¯å®¿ä¸»æœºç«¯å£ï¼Œå³ä¾§æ˜¯å®¹å™¨ç«¯å£ -dï¼šåå°è¿è¡Œå®¹å™¨ nginxï¼šé•œåƒåç§°ï¼Œä¾‹å¦‚nginx docker runå‘½ä»¤çš„å¸¸è§å‚æ•° --nameï¼šæŒ‡å®šå®¹å™¨åç§° -pï¼šæŒ‡å®šç«¯å£æ˜ å°„ -dï¼šè®©å®¹å™¨åå°è¿è¡Œ æŸ¥çœ‹å®¹å™¨æ—¥å¿—çš„å‘½ä»¤docker logs æ·»åŠ  -f å‚æ•°å¯ä»¥æŒç»­æŸ¥çœ‹æ—¥å¿— æŸ¥çœ‹å®¹å™¨çŠ¶æ€docker ps 2.1 è¿›å…¥Nginxå®¹å™¨ï¼Œä¿®æ”¹HTMLæ–‡ä»¶å†…å®¹ï¼Œæ·»åŠ â€œInoæ¬¢è¿ä½ â€æ­¥éª¤ä¸€ï¼šè¿›å…¥å®¹å™¨docker exec -it mn bash å‘½ä»¤è§£è¯»ï¼š docker execï¼šè¿›å…¥å®¹å™¨å†…éƒ¨ï¼Œæ‰§è¡Œä¸€ä¸ªå‘½ä»¤ -itï¼šç»™å½“å‰è¿›å…¥çš„å®¹å™¨åˆ›å»ºä¸€ä¸ªæ ‡å‡†è¾“å…¥ã€è¾“å‡ºç»ˆç«¯ï¼Œå…è®¸æˆ‘ä»¬ä¸å®¹å™¨äº¤äº’ mnï¼šè¦è¿›å…¥çš„å®¹å™¨çš„åç§° bashï¼šè¿›å…¥å®¹å™¨åæ‰§è¡Œçš„å‘½ä»¤ï¼Œbashæ˜¯ä¸€ä¸ªlinuxç»ˆç«¯äº¤äº’å‘½ä»¤ â‘¡.æ“ä½œæ•°æ®å·æ•°æ®å·çš„ä½œç”¨ï¼š å°†å®¹å™¨ä¸æ•°æ®åˆ†ç¦»ï¼Œè§£è€¦åˆï¼Œæ–¹ä¾¿æ“ä½œå®¹å™¨å†…æ•°æ®ï¼Œä¿è¯æ•°æ®å®‰å…¨ docker volume [COMMAND] docker volumeå‘½ä»¤æ˜¯æ•°æ®å·æ“ä½œï¼Œæ ¹æ®å‘½ä»¤åè·Ÿéšçš„commandæ¥ç¡®å®šä¸‹ä¸€æ­¥çš„æ“ä½œï¼š create åˆ›å»ºä¸€ä¸ªvolume inspect æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªvolumeçš„ä¿¡æ¯ ls åˆ—å‡ºæ‰€æœ‰çš„volume prune åˆ é™¤æœªä½¿ç”¨çš„volume rm åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šçš„volume åˆ›å»ºæ•°æ®å· docker volume craete html 2.æŸ¥çœ‹æ‰€æœ‰æ•°æ® docker volume ls 3.æŸ¥çœ‹æ•°æ®å·è¯¦ç»†ä¿¡æ¯å· docker volume inspect html 2.2 åˆ©ç”¨æ•°æ®å·æ“ä½œnginxå®¹å™¨â‘  åˆ›å»ºå®¹å™¨å¹¶æŒ‚è½½æ•°æ®å·åˆ°å®¹å™¨å†…çš„HTMLç›®å½• docker run --name mn -v html:/usr/share/nginx/html -p 80:80 -d nginx â‘¡ è¿›å…¥htmlæ•°æ®å·æ‰€åœ¨ä½ç½®ï¼Œå¹¶ä¿®æ”¹HTMLå†…å®¹ # æŸ¥çœ‹htmlæ•°æ®å·çš„ä½ç½®docker volume inspect html# è¿›å…¥è¯¥ç›®å½•cd /var/lib/docker/volumes/html/_data# ä¿®æ”¹æ–‡ä»¶vi index.html 2.3 åˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªMySQLå®¹å™¨ï¼Œå°†å®¿ä¸»æœºç›®å½•ç›´æ¥æŒ‚è½½åˆ°å®¹å™¨æç¤º:ç›®å½•æŒ‚è½½ä¸æ•°æ®å·æŒ‚è½½çš„è¯­æ³•æ˜¯ç±»ä¼¼çš„: -v[å®¿ä¸»æœºç›®å½•]:[å®¹å™¨å†…ç›®å½•] -v[å®¿ä¸»æœºæ–‡ä»¶]:[å®¹å™¨å†…æ–‡ä»¶] å®ç°æ€è·¯å¦‚ä¸‹: 1ï¼åœ¨å°†è¯¾å‰èµ„æ–™ä¸­çš„mysql.taræ–‡ä»¶ä¸Šä¼ åˆ°è™šæ‹Ÿæœºï¼Œé€šè¿‡loadå‘½ä»¤åŠ è½½ä¸ºé•œåƒ 2ï¼åˆ›å»ºç›®å½•&#x2F;tmp&#x2F;myql&#x2F;data 3ï¼åˆ›å»ºç›®å½•&#x2F;tmp&#x2F;myql&#x2F;confï¼Œå°†è¯¾å‰èµ„æ–™æä¾›çš„hmy.cnfæ–‡ä»¶ä¸Šä¼ åˆ°&#x2F;tmp&#x2F;myql&#x2F;conf 4ï¼å»DockerHubæŸ¥é˜…èµ„æ–™ï¼Œåˆ›å»ºå¹¶è¿è¡ŒMySQLå®¹å™¨ï¼Œè¦æ±‚: æŒ‚è½½&#x2F;tmp&#x2F;myql&#x2F;dataåˆ°mysqlå®¹å™¨å†…æ•°æ®å­˜å‚¨ç›®å½• æŒ‚è½½&#x2F;tmp&#x2F;myql&#x2F;conf&#x2F;hmy.cnfåˆ°mysqlå®¹å™¨çš„é…ç½®æ–‡ä»¶ è®¾ç½®MySQLå¯†ç  docker run --name mysql -e MYSQL_ROOT_PASSWORD=adg153 -p 3307:3306 -v /tmp/mysql/conf/hmy.cnf:/etc/mysql/conf.d/hmy.cnf -v /tmp/mysql/data:/var/lib/mysql -d mysql:5.7.25 è‡ªå®šä¹‰é•œåƒ - é•œåƒç»“æ„ç«Ÿåƒæ˜¯åˆ†å±‚ç»“æ„ï¼Œæ¯ä¸€å±‚æˆä¸ºä¸€ä¸ªLayerï¼ˆå±‚ï¼‰ BaseImageå±‚ï¼šåŒ…å«åŸºæœ¬çš„ç³»ç»Ÿå‡½æ•°åº“ã€ç¯å¢ƒå˜é‡ã€æ–‡ä»¶ç³»ç»Ÿ Entrypointï¼šå…¥å£ï¼Œæ˜¯é•œåƒä¸­åº”ç”¨å¯åŠ¨çš„å‘½ä»¤ï¼ˆsystemctl start mysql.serviceï¼‰ å…¶ä»–ï¼šåœ¨BaseImageåŸºç¡€ä¸Šæ·»åŠ ä¾èµ–ã€å®‰è£…ç¨‹åºã€å®Œæˆæ•´ä¸ªåº”ç”¨çš„å®‰è£…å’Œé…ç½® 2.CentOS7å®‰è£…DockerCompose2.1.ä¸‹è½½Linuxä¸‹éœ€è¦é€šè¿‡å‘½ä»¤ä¸‹è½½ï¼š # å®‰è£…curl -L https://github.com/docker/compose/releases/download/1.23.1/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose å¦‚æœä¸‹è½½é€Ÿåº¦è¾ƒæ…¢ï¼Œæˆ–è€…ä¸‹è½½å¤±è´¥ï¼Œå¯ä»¥ä½¿ç”¨è¯¾å‰èµ„æ–™æä¾›çš„docker-composeæ–‡ä»¶ï¼š ä¸Šä¼ åˆ°/usr/local/bin/ç›®å½•ä¹Ÿå¯ä»¥ã€‚ 2.2.ä¿®æ”¹æ–‡ä»¶æƒé™ä¿®æ”¹æ–‡ä»¶æƒé™ï¼š # ä¿®æ”¹æƒé™chmod +x /usr/local/bin/docker-compose 2.3.Baseè‡ªåŠ¨è¡¥å…¨å‘½ä»¤ï¼š# è¡¥å…¨å‘½ä»¤curl -L https://raw.githubusercontent.com/docker/compose/1.29.1/contrib/completion/bash/docker-compose &gt; /etc/bash_completion.d/docker-compose å¦‚æœè¿™é‡Œå‡ºç°é”™è¯¯ï¼Œéœ€è¦ä¿®æ”¹è‡ªå·±çš„hostsæ–‡ä»¶ï¼š echo &quot;199.232.68.133 raw.githubusercontent.com&quot; &gt;&gt; /etc/hosts 3.Dockeré•œåƒä»“åº“æ­å»ºé•œåƒä»“åº“å¯ä»¥åŸºäºDockerå®˜æ–¹æä¾›çš„DockerRegistryæ¥å®ç°ã€‚ å®˜ç½‘åœ°å€ï¼šhttps://hub.docker.com/_/registry 3.1.ç®€åŒ–ç‰ˆé•œåƒä»“åº“Dockerå®˜æ–¹çš„Docker Registryæ˜¯ä¸€ä¸ªåŸºç¡€ç‰ˆæœ¬çš„Dockeré•œåƒä»“åº“ï¼Œå…·å¤‡ä»“åº“ç®¡ç†çš„å®Œæ•´åŠŸèƒ½ï¼Œä½†æ˜¯æ²¡æœ‰å›¾å½¢åŒ–ç•Œé¢ã€‚ æ­å»ºæ–¹å¼æ¯”è¾ƒç®€å•ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š docker run -d \\ --restart=always \\ --name registry \\ -p 5000:5000 \\ -v registry-data:/var/lib/registry \\ registry å‘½ä»¤ä¸­æŒ‚è½½äº†ä¸€ä¸ªæ•°æ®å·registry-dataåˆ°å®¹å™¨å†…çš„&#x2F;var&#x2F;lib&#x2F;registry ç›®å½•ï¼Œè¿™æ˜¯ç§æœ‰é•œåƒåº“å­˜æ”¾æ•°æ®çš„ç›®å½•ã€‚ è®¿é—®http://YourIp:5000/v2/_catalog å¯ä»¥æŸ¥çœ‹å½“å‰ç§æœ‰é•œåƒæœåŠ¡ä¸­åŒ…å«çš„é•œåƒ 3.2.å¸¦æœ‰å›¾å½¢åŒ–ç•Œé¢ç‰ˆæœ¬ä½¿ç”¨DockerComposeéƒ¨ç½²å¸¦æœ‰å›¾è±¡ç•Œé¢çš„DockerRegistryï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š version: &#x27;3.0&#x27;services: registry: image: registry volumes: - ./registry-data:/var/lib/registry ui: image: joxit/docker-registry-ui:static ports: - 8080:80 environment: - REGISTRY_TITLE=ä¼ æ™ºæ•™è‚²ç§æœ‰ä»“åº“ - REGISTRY_URL=http://registry:5000 depends_on: - registry 3.3.é…ç½®Dockerä¿¡ä»»åœ°å€æˆ‘ä»¬çš„ç§æœé‡‡ç”¨çš„æ˜¯httpåè®®ï¼Œé»˜è®¤ä¸è¢«Dockerä¿¡ä»»ï¼Œæ‰€ä»¥éœ€è¦åšä¸€ä¸ªé…ç½®ï¼š # æ‰“å¼€è¦ä¿®æ”¹çš„æ–‡ä»¶vi /etc/docker/daemon.json# æ·»åŠ å†…å®¹ï¼š&quot;insecure-registries&quot;:[&quot;http://192.168.150.101:8080&quot;]# é‡åŠ è½½systemctl daemon-reload# é‡å¯dockersystemctl restart docker"},{"title":"","date":"2023-05-31T08:53:39.376Z","updated":"2023-05-31T08:53:39.376Z","comments":true,"path":"notes/Redis.html","permalink":"https://aqu.iyunmc.cn/notes/Redis","excerpt":"","text":"Redisè®¤è¯†NoSQLSQLï¼š ç»“æ„åŒ–ï¼ˆStructuredï¼‰ å…³è”çš„ï¼ˆRelationalï¼‰ SQLæŸ¥è¯¢ ACID Aï¼ˆAtomicityï¼‰ï¼šåŸå­æ€§ Cï¼ˆConsistencyï¼‰ï¼šä¸€è‡´æ€§ Iï¼ˆIsolationï¼‰ï¼šéš”ç¦»æ€§ Dï¼ˆDurabilityï¼‰ï¼šæŒä¹…æ€§ Atomicityï¼ˆåŸå­æ€§ï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡ï¼ˆtransactionï¼‰ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«æ¢å¤ï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚ Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ï¼šåœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä»¥åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åã€‚è¿™è¡¨ç¤ºå†™å…¥çš„èµ„æ–™å¿…é¡»å®Œå…¨ç¬¦åˆæ‰€æœ‰çš„é¢„è®¾è§„åˆ™ï¼Œè¿™åŒ…å«èµ„æ–™çš„ç²¾ç¡®åº¦ã€ä¸²è”æ€§ä»¥åŠåç»­æ•°æ®åº“å¯ä»¥è‡ªå‘æ€§åœ°å®Œæˆé¢„å®šçš„å·¥ä½œã€‚ Isolationï¼ˆéš”ç¦»æ€§ï¼‰ï¼šæ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹å…¶æ•°æ®è¿›è¡Œè¯»å†™å’Œä¿®æ”¹çš„èƒ½åŠ›ï¼Œéš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ç”±äºäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚äº‹åŠ¡éš”ç¦»åˆ†ä¸ºä¸åŒçº§åˆ«ï¼ŒåŒ…æ‹¬è¯»æœªæäº¤ï¼ˆRead uncommittedï¼‰ã€è¯»æäº¤ï¼ˆread committedï¼‰ã€å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰å’Œä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ã€‚ Durabilityï¼ˆæŒä¹…æ€§ï¼‰ï¼šäº‹åŠ¡å¤„ç†ç»“æŸåï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚ [1] NoSQLï¼š éç»“æ„åŒ– æ— å…³è”çš„ éSQL BASE ç¼“å­˜ç©¿é€ï¼šç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢ä¸€æ¡æ•°æ®åº“å’Œç¼“å­˜éƒ½æ²¡æœ‰çš„ä¸€æ¡æ•°æ®ï¼Œå°±ä¼š ä¸€ç›´æŸ¥è¯¢æ•°æ®åº“ï¼Œå¯¹æ•°æ®åº“çš„è®¿é—®å‹åŠ›å°±ä¼šå¢å¤§ã€‚ å¸¸è§çš„2ç§è§£å†³æ–¹æ¡ˆï¼š ç¼“å­˜ç©ºå¯¹è±¡ ä¼˜ç‚¹ï¼šç®€å•å®ç°ï¼Œç»´æŠ¤æ–¹ä¾¿ ç¼ºç‚¹ï¼š é¢å¤–çš„å†…å­˜æ¶ˆè€— å¯èƒ½é€ æˆçŸ­æœŸçš„ä¸ä¸€è‡´ å¸ƒéš†è¿‡æ»¤ ä¼˜ç‚¹ï¼šå†…å­˜å ç”¨è¾ƒå°‘ï¼Œæ²¡æœ‰å¤šä½™çš„key ç¼ºç‚¹ï¼š å®ç°å¤æ‚ å­˜åœ¨è¯¯åˆ¤å¯èƒ½ å¢å¼ºidçš„å¤æ‚åº¦ï¼Œé¿å…è¢«çŒœæµ‹idè§„å¾‹ åšå¥½æ•°æ®çš„åŸºç¡€æ ¼å¼æ ¡éªŒ åŠ å¼ºç”¨æˆ·æƒé™æ ¡éªŒ åšå¥½çƒ­ç‚¹å‚æ•°çš„é™æµ ç¼“å­˜ç©¿é€ï¼šç¼“å­˜é›ªå´©æ˜¯æŒ‡åœ¨åŒä¸€æ—¶æ®µå¤§é‡çš„ç¼“å­˜keyåŒæ—¶å¤±æ•ˆæˆ–è€…RedisæœåŠ¡å®•æœºï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚åˆ°è¾¾æ•°æ®åº“ï¼Œå¸¦æ¥å·¨å¤§å‹åŠ› è§£å†³æ–¹æ¡ˆï¼š ç»™ä¸åŒçš„Keyçš„TTLæ·»åŠ éšæœºå€¼ åˆ©ç”¨Redisé›†ç¾¤æé«˜æœåŠ¡çš„å¯ç”¨æ€§ ç»™ç¼“å­˜ä¸šåŠ¡æ·»åŠ é™çº§é™æµç­–ç•¥ ç»™ä¸šåŠ¡æ·»åŠ å¤šçº§ç¼“å­˜ ç¼“å­˜å‡»ç©¿ï¼šç¼“å­˜å‡»ç©¿é—®é¢˜ä¹Ÿå«çƒ­ç‚¹Keyé—®é¢˜ï¼Œå°±æ˜¯ä¸€ä¸ªè¢«é«˜å¹¶å‘è®¿é—®å¹¶ä¸”ç¼“å­˜é‡å»ºä¸šåŠ¡è¾ƒå¤æ‚çš„keyçªç„¶å¤±æ•ˆäº†ï¼Œæ— æ•°çš„è¯·æ±‚è®¿é—®ä¼šåœ¨ç¬é—´ç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§çš„å†²å‡» è§£å†³æ–¹æ¡ˆï¼š äº’æ–¥é” é€»è¾‘è¿‡æœŸ è§£å†³æ–¹æ¡ˆ ä¼˜ç‚¹ ç¼ºç‚¹ äº’æ–¥é” æ²¡æœ‰é¢å¤–çš„å†…å­˜æ¶ˆè€—ä¿è¯ä¸€è‡´æ€§å®ç°ç®€å• å¿åŸéœ€è¦ç­‰å¾…ï¼Œæ€§èƒ½å—å½±å“å¯èƒ½æœ‰æ­»é”é£é™© é€»è¾‘è¿‡æœŸ çº¿ç¨‹æ— éœ€ç­‰å¾…ï¼Œæ€§èƒ½è¾ƒå¥½ ä¸ä¿è¯ä¸€è‡´æ€§æœ‰é¢å¤–å†…å­˜æ¶ˆè€—å®ç°å¤æ‚ å…¨å±€å”¯ä¸€IDç”Ÿæˆç­–ç•¥ï¼š UUIDUUIDæ˜¯æŒ‡åœ¨ä¸€å°æœºå™¨åœ¨åŒä¸€æ—¶é—´ä¸­ç”Ÿæˆçš„æ•°å­—åœ¨æ‰€æœ‰æœºå™¨ä¸­éƒ½æ˜¯å”¯ä¸€çš„ã€‚æŒ‰ç…§å¼€æ”¾è½¯ä»¶åŸºé‡‘ä¼š(OSF)åˆ¶å®šçš„æ ‡å‡†è®¡ç®—ï¼Œç”¨åˆ°äº†ä»¥å¤ªç½‘å¡åœ°å€ã€çº³ç§’çº§æ—¶é—´ã€èŠ¯ç‰‡IDç å’Œè®¸å¤šå¯èƒ½çš„æ•°å­—ã€‚ xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx (8-4-4-4-12) ä¼˜ç‚¹ï¼š ç®€å•ï¼Œä»£ç æ–¹ä¾¿ ç”ŸæˆIDæ€§èƒ½éå¸¸å¥½ï¼ŒåŸºæœ¬ä¸ä¼šæœ‰æ€§èƒ½é—®é¢˜ï¼Œæœ¬åœ°ç”Ÿæˆï¼Œæ²¡æœ‰ç½‘ç»œæ¶ˆè€— å…¨çƒå”¯ä¸€ï¼Œåœ¨é‡è§æ•°æ®è¿ç§»ï¼Œç³»ç»Ÿæ•°æ®åˆå¹¶ï¼Œæˆ–è€…æ•°æ®åº“å˜æ›´ç­‰æƒ…å†µä¸‹ï¼Œå¯ä»¥ä»å®¹åº”å¯¹ ç¼ºç‚¹ï¼š æ²¡æœ‰æ’åºï¼Œæ— æ³•ä¿è¯è¶‹åŠ¿é€’å¢ UUIDå¾€å¾€æ˜¯ä½¿ç”¨å­—ç¬¦ä¸²å­˜å‚¨ï¼ŒæŸ¥è¯¢çš„æ•ˆç‡æ¯”è¾ƒä½ å­˜å‚¨ç©ºé—´æ¯”è¾ƒå¤§ï¼ŒUUIDå¤ªé•¿ï¼Œ16å­—èŠ‚128ä½ï¼Œé€šå¸¸ä»¥36é•¿åº¦çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå¾ˆå¤šåœºæ™¯ä¸é€‚ç”¨ï¼Œå¦‚æœæ˜¯æµ·é‡æ•°æ®åº“ï¼Œå°±éœ€è¦è€ƒè™‘å­˜å‚¨é‡çš„é—®é¢˜ ä¿¡æ¯ä¸å®‰å…¨ï¼ŒåŸºäºMACåœ°å€ç”ŸæˆUUIDçš„ç®—æ³•å¯èƒ½ä¼šé€ æˆMACåœ°å€æ³„éœ²ï¼Œè¿™ä¸ªæ¼æ´æ›¾è¢«ç”¨äºå¯»æ‰¾æ¢…ä¸½èç—…æ¯’çš„åˆ¶ä½œè€…ä½ç½® ä¼ è¾“æ•°æ®é‡å¤§ï¼Œå¹¶ä¸”ä¸å¯è¯» Redisè‡ªå¢ ä¼˜ç‚¹ï¼š ä¸ä¾èµ–äºæ•°æ®åº“ï¼Œçµæ´»æ–¹ä¾¿ï¼Œä¸”æ€§èƒ½ä¼˜äºæ•°æ®åº“ æ•°å­—IDå¤©ç„¶æ’åºï¼Œå¯¹åˆ†é¡µæˆ–è€…éœ€è¦æ’åºçš„ç»“æœå¾ˆæœ‰å¸®åŠ© ç¼ºç‚¹ï¼š å¦‚æœç³»ç»Ÿä¸­æ²¡æœ‰Redisï¼Œè¿˜éœ€è¦å¼•å…¥æ–°çš„ç»„ä»¶ï¼Œå¢åŠ ç³»ç»Ÿå¤æ‚åº¦ éœ€è¦ç¼–ç å’Œé…ç½®çš„å·¥ä½œé‡æ¯”è¾ƒå¤§ Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œè‹¥é€ æˆé˜»å¡ï¼Œåˆ™ä¼šå¼•å‘é«˜å¹¶å‘é—®é¢˜ï¼Œéœ€è¦å¤„ç†å¥½é›†ç¾¤ä¸ä¸»ä»å…³ç³» snowflakeç®—æ³•snowflakeæ˜¯Twitterå¼€æºçš„åˆ†å¸ƒå¼IDç”Ÿæˆç®—æ³•ï¼Œç»“æœæ˜¯ä¸€ä¸ªlongå‹çš„IDã€‚ç”Ÿæˆçš„æ˜¯ä¸€ä¸ª64ä½çš„äºŒè¿›åˆ¶æ­£æ•´æ•°ï¼Œç„¶åè½¬æ¢æˆ10è¿›åˆ¶çš„æ•°ã€‚64ä½äºŒè¿›åˆ¶æ•°ç”±å¦‚ä¸‹éƒ¨åˆ†ç»„æˆï¼š * SnowFlakeçš„ç»“æ„å¦‚ä¸‹(æ¯éƒ¨åˆ†ç”¨-åˆ†å¼€):* 0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000* (1-10-10-10-10-10-1-5-5-12) (1-41-10-12) ä¼˜ç‚¹ ç®€å•é«˜æ•ˆï¼Œç”Ÿæˆé€Ÿåº¦å¿« æ—¶é—´æˆ³åœ¨é«˜ä½ï¼Œè‡ªå¢åºåˆ—åœ¨ä½ä½ï¼Œæ•´ä¸ªIDæ˜¯è¶‹åŠ¿é€’å¢çš„ï¼ŒæŒ‰ç…§æ—¶é—´æœ‰åºé€’å¢ çµæ´»åº¦é«˜ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œè°ƒæ•´bitä½çš„åˆ’åˆ†ï¼Œæ»¡è¶³ä¸åŒçš„éœ€æ±‚ ç¼ºç‚¹ ä¾èµ–æœºå™¨çš„æ—¶é’Ÿï¼Œå¦‚æœæœåŠ¡å™¨æ—¶é’Ÿå›æ‹¨ï¼Œä¼šå¯¼è‡´é‡å¤IDç”Ÿæˆ åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸Šï¼Œæ¯ä¸ªæœåŠ¡å™¨çš„æ—¶é’Ÿä¸å¯èƒ½å®Œå…¨åŒæ­¥ï¼Œæœ‰æ—¶ä¼šå‡ºç°ä¸æ˜¯å…¨å±€é€’å¢çš„æƒ…å†µ æ•°æ®åº“è‡ªå¢ ä¼˜ç‚¹ï¼š ç®€å•ï¼Œä»£ç æ–¹ä¾¿ï¼Œæ€§èƒ½å¯ä»¥æ¥å— æ•°å­—IDå¤©ç„¶æ’åºï¼Œå¯¹åˆ†é¡µæˆ–è€…éœ€è¦æ’åºçš„ç»“æœå¾ˆæœ‰å¸®åŠ© ç¼ºç‚¹ï¼š ä¸åŒæ•°æ®åº“è¯­æ³•å’Œå®ç°ä¸åŒï¼Œæ•°æ®åº“è¿ç§»çš„æ—¶å€™æˆ–å¤šæ•°æ®åº“ç‰ˆæœ¬æ”¯æŒçš„æ—¶å€™éœ€è¦å¤„ç† åœ¨å•ä¸ªæ•°æ®åº“æˆ–è¯»å†™åˆ†ç¦»æˆ–ä¸€ä¸»å¤šä»çš„æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸€ä¸ªä¸»åº“å¯ä»¥ç”Ÿæˆã€‚æœ‰å•ç‚¹æ•…éšœçš„é£é™© åœ¨æ€§èƒ½è¾¾ä¸åˆ°è¦æ±‚çš„æƒ…å†µä¸‹ï¼Œæ¯”è¾ƒéš¾äºæ‰©å±• å¦‚æœé‡è§å¤šä¸ªç³»ç»Ÿéœ€è¦åˆå¹¶æˆ–è€…æ¶‰åŠåˆ°æ•°æ®è¿ç§»ä¼šç›¸å½“ç—›è‹¦ åˆ†è¡¨åˆ†åº“çš„æ—¶å€™ä¼šæœ‰éº»çƒ¦"},{"title":"","date":"2023-05-31T08:59:09.159Z","updated":"2023-05-31T08:59:09.159Z","comments":true,"path":"notes/SpringAMQP.html","permalink":"https://aqu.iyunmc.cn/notes/SpringAMQP","excerpt":"","text":"MQ1.åŒæ­¥è°ƒç”¨çš„ä¼˜ç‚¹ æ—¶æ•ˆæ€§è¾ƒå¼ºï¼Œå¯ä»¥ç«‹å³å¾—åˆ°ç»“æœ 2.åŒæ­¥è°ƒç”¨çš„é—®é¢˜ è€¦åˆåº¦é«˜ æ€§èƒ½å’Œååèƒ½åŠ›ä¸‹é™ æœ‰é¢å¤–çš„èµ„æºæ¶ˆè€— æœ‰çº§è”å¤±è´¥é—®é¢˜ 3.å¼‚æ­¥é€šä¿¡çš„ä¼˜ç‚¹ è€¦åˆåº¦ä½ ååé‡æå‡ æ•…éšœéš”ç¦» æµé‡å‰Šå³° 4.å¼‚æ­¥é€šä¿¡çš„ç¼ºç‚¹ ä¾èµ–äºBrokerçš„å¯é æ€§ã€å®‰å…¨æ€§ã€ååèƒ½åŠ› æ¶æ„å¤æ‚äº†ï¼Œä¸šåŠ¡æ²¡æœ‰æ˜æ˜¾çš„æµç¨‹çº¿ï¼Œä¸å¥½è¿½è¸ªç®¡ç† ä»€ä¹ˆæ˜¯MQMQï¼ˆMessageQueueï¼‰ï¼Œä¸­æ–‡æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå­—é¢æ¥çœ‹å°±æ˜¯å­˜æ”¾æ¶ˆæ¯çš„é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯äº‹ä»¶é©±åŠ¨æ¶æ„ä¸­çš„Broker RabbitMQå…¥é—¨RabbitMQä¸­çš„å‡ ä¸ªæ¦‚å¿µ channelï¼šæ“ä½œMQçš„å·¥å…· exchangeï¼šè·¯ç”±æ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­ queueï¼šç¼“å­˜æ¶ˆæ¯ virtual hostï¼šè™šæ‹Ÿä¸»æœºï¼Œæ˜¯å¯¹queueã€exchangeç­‰èµ„æºçš„é€»è¾‘åˆ†ç»„ HelloWorldæ¡ˆä¾‹å®˜æ–¹çš„HelloWorldæ˜¯åŸºäºæœ€åŸºç¡€çš„æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å‹æ¥å®ç°çš„ï¼ŒåªåŒ…æ‹¬ä¸‰ä¸ªè§’è‰²ï¼š publisherï¼šæ¶ˆæ¯å‘å¸ƒè¿™ï¼Œå°†æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—queue queueï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè´Ÿè´£æ¥æ”¶å¹¶ç¼“å­˜æ¶ˆæ¯ consumerï¼šè®¢é˜…é˜Ÿåˆ—ï¼Œå¤„ç†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ åŸºæœ¬æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯å‘é€æµç¨‹ å»ºç«‹connection åˆ›å»ºchannel åˆ©ç”¨channelå£°æ˜é˜Ÿåˆ— åˆ©ç”¨channelå‘é˜Ÿåˆ—å‘é€æ¶ˆæ¯ åŸºæœ¬æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯æ¥æ”¶æµç¨‹ å»ºç«‹connection åˆ›å»ºchannel åˆ©ç”¨channelå£°æ˜é˜Ÿåˆ— å®šä¹‰consumerçš„æ¶ˆè´¹è¡Œä¸ºhandleDelivery() åˆ©ç”¨channelå°†æ¶ˆè´¹è€…ä¸é˜Ÿåˆ—ç»‘å®š SpringAMQPä»€ä¹ˆæ˜¯SpringAMQPAMQPï¼ˆAdvanced Message Queuing Protocolï¼‰ æ˜¯ç”¨äºåœ¨åº”ç”¨ç¨‹åºæˆ–ä¹‹é—´ä¼ é€’ä¸šåŠ¡æ¶ˆæ¯çš„å¼€æ”¾æ ‡å‡† è¯¥åè®®ä¸è¯­è¨€å’Œå¹³å°æ— å…³ï¼Œæ›´ç¬¦åˆå¾®æœåŠ¡ä¸­ç‹¬ç«‹æ€§çš„è¦æ±‚ã€‚ SpringAMQPæ˜¯åŸºäºAMQPåè®®å®šä¹‰çš„ä¸€å¥—APIè§„èŒƒï¼Œæä¾›äº†æ¨¡æ¿æ¥å‘é€å’Œæ¥å—æ¶ˆæ¯ã€‚åŒ…å«ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­spring-amqpæ˜¯åŸºç¡€æŠ½è±¡ï¼Œspring-rabbitæ˜¯åº•å±‚çš„é»˜è®¤å®ç°ã€‚ SpringAMQPå¦‚ä½•æ¥æ”¶æ¶ˆæ¯ï¼Ÿ å¼•å…¥amqpçš„starterä¾èµ– é…ç½®RabbitMQåœ°å€ å®šä¹‰ç±»ï¼Œæ·»åŠ @Componentæ³¨è§£ ç±»ä¸­å£°æ˜æ–¹æ³•ï¼Œæ·»åŠ @RabbitListeneræ³¨è§£ï¼Œæ–¹æ³•å‚æ•°å°±æ˜¯æ¶ˆæ¯ æ³¨æ„ï¼šæ¶ˆæ¯ä¸€æ—¦æ¶ˆè´¹å°±ä¼šä»é˜Ÿåˆ—ä¸­åˆ é™¤ï¼ŒRabbitMQæ²¡æœ‰æ¶ˆæ¯å›æº¯åŠŸèƒ½ å‘å¸ƒï¼ˆPublishï¼‰ã€è®¢é˜…ï¼ˆSubscribeï¼‰å‘å¸ƒè®¢é˜…æ¨¡å¼ä¸ä¹‹å‰æ¡ˆä¾‹çš„åŒºåˆ«å°±æ˜¯å…è®¸å°†åŒæ„æ¶ˆæ¯å‘é€ç»™å¤šä¸ªæ¶ˆè´¹è€…ã€‚å®ç°æ–¹å¼æ˜¯åŠ å…¥äº†exchangeï¼ˆäº¤æ¢æœºï¼‰ å¸¸è§çš„exchangeç±»å‹åŒ…æ‹¬ï¼š Fanoutï¼šå¹¿æ’­ Directï¼šè·¯ç”± Topicï¼šè¯é¢˜ æ³¨æ„ï¼šexchangeè´Ÿè´£æ¶ˆæ¯è·¯ç”±ï¼Œè€Œä¸æ˜¯å­˜å‚¨ï¼Œè·¯ç”±å¤±è´¥åˆ™æ¶ˆæ¯ä¸¢å¤± SpringAMQP - FanoutExchangeFanoutExchangeäº¤æ¢æœºçš„ä½œç”¨ æ¥å—publisherå‘é€çš„æ¶ˆæ¯ å°†æ¶ˆæ¯æŒ‰ç…§è§„åˆ™è·¯ç”±åˆ°ç»‘å®šçš„é˜Ÿåˆ— ä¸èƒ½ç¼“å­˜æ¶ˆæ¯ï¼Œè·¯ç”±å¤±è´¥ï¼Œæ¶ˆæ¯ä¼šä¸¢å¤± FanoutExchangeçš„ä¼šå°†æ¶ˆæ¯è·¯ç”±åˆ°æ¯ä¸ªç»‘å®šçš„é˜Ÿåˆ— DirectExchangeDirectäº¤æ¢æœºä¸Fanoutäº¤æ¢æœºçš„å·®å¼‚ Fanoutäº¤æ¢æœºå°†æ¶ˆæ¯è·¯ç”±ç»™æ¯ä¸€ä¸ªä¸ä¹‹ç»‘å®šçš„é˜Ÿåˆ— Directäº¤æ¢æœºæ ¹æ®RoutingKeyåˆ¤æ–­è·¯ç”±ç»™å“ªä¸ªé˜Ÿåˆ— å¦‚æœå¤šä¸ªé˜Ÿåˆ—å…·æœ‰ç›¸åŒçš„RoutingKeyï¼Œåˆ™ä¸FanoutåŠŸèƒ½ç±»ä¼¼ åŸºäº@RabbitListeneræ³¨è§£å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºæœ‰å“ªäº›å¸¸è§æ³¨è§£ @Queue @Exchange SpringAMQP - æ¶ˆæ¯è½¬æ¢å™¨Springçš„å¯¹æ¶ˆæ¯å¯¹è±¡çš„å¤„ç†æ—¶ç”±org.springframework.amqp.support.converter.MessageConverteræ¥å¤„ç†çš„ã€‚è€Œé»˜è®¤å®ç°æ˜¯SimpleMessageConverterï¼ŒåŸºäºJDKçš„ObjectOutputStreamå®Œæˆåºåˆ—åŒ–ã€‚ å¦‚æœè¦ä¿®æ”¹åªéœ€è¦å®šä¹‰ä¸€ä¸ªMessageConverterç±»å‹çš„Beanå³å¯ã€‚æ¨èç”¨JSONæ–¹å¼åºåˆ—åŒ–ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š åœ¨publisheræœåŠ¡å¼•å…¥ä¾èµ– &lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.dataformat&lt;/groupId&gt; &lt;artifactId&gt;jackson-dataformat-xml&lt;/artifactId&gt; &lt;version&gt;2.9.10&gt; &lt;/dependency&gt; - åœ¨publisheræœåŠ¡å£°æ˜MessageConverterï¼š- ``` @Bean public MessageConverter jsonMessageConverter()&#123; return new Jackson2JsonMessageConverter(); &#125; SpringAMQPä¸­æ¶ˆæ¯çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–å¦‚ä½•å®ç° åˆ©ç”¨MessageConverterå®ç°çš„ï¼Œé»˜è®¤æ˜¯JDKçš„åºåˆ—åŒ– æ³¨æ„å‘é€æ–¹å’Œæ¥æ”¶æ–¹å¿…é¡»ä½¿ç”¨ç›¸åŒçš„MessageConverter"},{"title":"","date":"2023-05-31T08:58:46.347Z","updated":"2023-05-31T08:58:46.347Z","comments":true,"path":"notes/Ribbonè´Ÿè½½å‡è¡¡.html","permalink":"https://aqu.iyunmc.cn/notes/Ribbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1","excerpt":"","text":"Ribbonè´Ÿè½½å‡è¡¡1. Ribbonè´Ÿè½½å‡è¡¡è§„åˆ™ è§„åˆ™æ¥å£æ˜¯IRule é»˜è®¤å®ç°æ˜¯ZoneAvoidanceRuleï¼Œæ ¹æ®zoneé€‰æ‹©æœåŠ¡åˆ—è¡¨ï¼Œç„¶åè½®è¯¢ 2. è´Ÿè½½å‡è¡¡è‡ªå®šä¹‰æ–¹å¼ ä»£ç æ–¹å¼ï¼šé…ç½®çµæ´»ï¼Œä½†ä¿®æ”¹æ—¶éœ€è¦é‡æ–°æ‰“åŒ…å‘å¸ƒ é…ç½®æ–¹å¼ï¼šç›´è§‚ï¼Œæ–¹ä¾¿ï¼Œæ— éœ€é‡æ–°æ‰“åŒ…å‘å¸ƒï¼Œä½†æ˜¯æ— æ³•åšå…¨å±€é…ç½® 3. é¥¥é¥¿åŠ è½½ å¼€å¯é¥¥é¥¿åŠ è½½ æŒ‡å®šé¥¥é¥¿åŠ è½½çš„å¾®æœåŠ¡åç§° spring: cloud: nacos: server-addr: localhost:8848 # nacos æœåŠ¡åœ°å€ discovery: cluster-name: SH # é›†ç¾¤åç§° NacosæœåŠ¡åˆ†çº§æ¨¡å‹1. NacosæœåŠ¡åˆ†çº§å­˜å‚¨æ¨¡å‹ ä¸€çº§æ˜¯æœåŠ¡ï¼Œä¾‹å¦‚userservice äºŒçº§æ˜¯é›†ç¾¤ï¼Œä¾‹å¦‚æ­å·æˆ–ä¸Šæµ· ä¸‰çº§æ˜¯å®ä¾‹ï¼Œä¾‹å¦‚æ­å·æœºæˆ¿çš„æŸå°éƒ¨ç½²äº†userserviceçš„æœåŠ¡å™¨ 2. å¦‚ä½•è®¾ç½®å®ä¾‹çš„é›†ç¾¤å±æ€§ä¿®æ”¹application.ymlæ–‡ä»¶ï¼Œæ·»åŠ spring.cloud.nacos.discovery.cluster-nameå±æ€§å³å¯ Nacosè´Ÿè½½å‡è¡¡ç­–ç•¥1. NacosRuleè´Ÿè½½å‡è¡¡ç­–ç•¥ ä¼˜å…ˆé€‰æ‹©åŒé›†ç¾¤æœåŠ¡å®ä¾‹åˆ—è¡¨ æœ¬åœ°é›†ç¾¤æ‰¾ä¸åˆ°æä¾›è€…ï¼Œæ‰å»æ‰¾å…¶ä»–é›†ç¾¤å¯»æ‰¾ï¼Œå¹¶ä¸”ä¼šæŠ¥è­¦å‘Š ç¡®å®šäº†å¯ç”¨å®ä¾‹åˆ—è¡¨åï¼Œå†é‡‡ç”¨éšæœºè´Ÿè½½å‡è¡¡æŒ‘é€‰å®ä¾‹ Nacosæ³¨å†Œä¸­å¿ƒ - åŠ æƒè´Ÿè½½å‡è¡¡1. å®ä¾‹çš„æƒé‡æ§åˆ¶ Nacosæ§åˆ¶å°å¯ä»¥è®¾ç½®åŠ¿å®ä¾‹çš„æƒé‡å€¼ï¼Œ0~1 åŒé›†ç¾¤å†…çš„å¤šä¸ªå®ä¾‹ï¼Œæƒé‡è¶Šé«˜è¢«è®¿é—®çš„é¢‘ç‡è¶Šé«˜ æƒé‡è®¾ç½®ä¸º0åˆ™å®Œå…¨ä¸ä¼šè¢«è®¿é—®"},{"title":"","date":"2023-05-31T08:59:28.003Z","updated":"2023-05-31T08:59:28.003Z","comments":true,"path":"notes/SpringSecurityä»å…¥é—¨åˆ°ç²¾é€š.html","permalink":"https://aqu.iyunmc.cn/notes/SpringSecurity%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A","excerpt":"","text":"SpringSecurityä»å…¥é—¨åˆ°ç²¾é€šè¯¾ç¨‹ä»‹ç» 0. ç®€ä»‹â€‹ Spring Security æ˜¯ Spring å®¶æ—ä¸­çš„ä¸€ä¸ªå®‰å…¨ç®¡ç†æ¡†æ¶ã€‚ç›¸æ¯”ä¸å¦å¤–ä¸€ä¸ªå®‰å…¨æ¡†æ¶Shiroï¼Œå®ƒæä¾›äº†æ›´ä¸°å¯Œçš„åŠŸèƒ½ï¼Œç¤¾åŒºèµ„æºä¹Ÿæ¯”Shiroä¸°å¯Œã€‚ â€‹ ä¸€èˆ¬æ¥è¯´ä¸­å¤§å‹çš„é¡¹ç›®éƒ½æ˜¯ä½¿ç”¨SpringSecurity æ¥åšå®‰å…¨æ¡†æ¶ã€‚å°é¡¹ç›®æœ‰Shiroçš„æ¯”è¾ƒå¤šï¼Œå› ä¸ºç›¸æ¯”ä¸SpringSecurityï¼ŒShiroçš„ä¸Šæ‰‹æ›´åŠ çš„ç®€å•ã€‚ â€‹ ä¸€èˆ¬Webåº”ç”¨çš„éœ€è¦è¿›è¡Œè®¤è¯å’Œæˆæƒã€‚ â€‹ è®¤è¯ï¼šéªŒè¯å½“å‰è®¿é—®ç³»ç»Ÿçš„æ˜¯ä¸æ˜¯æœ¬ç³»ç»Ÿçš„ç”¨æˆ·ï¼Œå¹¶ä¸”è¦ç¡®è®¤å…·ä½“æ˜¯å“ªä¸ªç”¨æˆ· â€‹ æˆæƒï¼šç»è¿‡è®¤è¯ååˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è¿›è¡ŒæŸä¸ªæ“ä½œ â€‹ è€Œè®¤è¯å’Œæˆæƒä¹Ÿæ˜¯SpringSecurityä½œä¸ºå®‰å…¨æ¡†æ¶çš„æ ¸å¿ƒåŠŸèƒ½ã€‚ 1. å¿«é€Ÿå…¥é—¨1.1 å‡†å¤‡å·¥ä½œâ€‹ æˆ‘ä»¬å…ˆè¦æ­å»ºä¸€ä¸ªç®€å•çš„SpringBootå·¥ç¨‹ â‘  è®¾ç½®çˆ¶å·¥ç¨‹ æ·»åŠ ä¾èµ– &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.5.0&lt;/version&gt;&lt;/parent&gt;&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt;&lt;/dependencies&gt; â‘¡ åˆ›å»ºå¯åŠ¨ç±» @SpringBootApplicationpublic class SecurityApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SecurityApplication.class,args); &#125;&#125; â‘¢ åˆ›å»ºController import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;@RestControllerpublic class HelloController &#123; @RequestMapping(&quot;/hello&quot;) public String hello()&#123; return &quot;hello&quot;; &#125;&#125; 1.2 å¼•å…¥SpringSecurityâ€‹ åœ¨SpringBooté¡¹ç›®ä¸­ä½¿ç”¨SpringSecurityæˆ‘ä»¬åªéœ€è¦å¼•å…¥ä¾èµ–å³å¯å®ç°å…¥é—¨æ¡ˆä¾‹ã€‚ &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;&lt;/dependency&gt; â€‹ å¼•å…¥ä¾èµ–åæˆ‘ä»¬åœ¨å°è¯•å»è®¿é—®ä¹‹å‰çš„æ¥å£å°±ä¼šè‡ªåŠ¨è·³è½¬åˆ°ä¸€ä¸ªSpringSecurityçš„é»˜è®¤ç™»é™†é¡µé¢ï¼Œé»˜è®¤ç”¨æˆ·åæ˜¯user,å¯†ç ä¼šè¾“å‡ºåœ¨æ§åˆ¶å°ã€‚ â€‹ å¿…é¡»ç™»é™†ä¹‹åæ‰èƒ½å¯¹æ¥å£è¿›è¡Œè®¿é—®ã€‚ 2. è®¤è¯2.1 ç™»é™†æ ¡éªŒæµç¨‹ 2.2 åŸç†åˆæ¢â€‹ æƒ³è¦çŸ¥é“å¦‚ä½•å®ç°è‡ªå·±çš„ç™»é™†æµç¨‹å°±å¿…é¡»è¦å…ˆçŸ¥é“å…¥é—¨æ¡ˆä¾‹ä¸­SpringSecurityçš„æµç¨‹ã€‚ 2.2.1 SpringSecurityå®Œæ•´æµç¨‹â€‹ SpringSecurityçš„åŸç†å…¶å®å°±æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ï¼Œå†…éƒ¨åŒ…å«äº†æä¾›å„ç§åŠŸèƒ½çš„è¿‡æ»¤å™¨ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹å…¥é—¨æ¡ˆä¾‹ä¸­çš„è¿‡æ»¤å™¨ã€‚ â€‹ å›¾ä¸­åªå±•ç¤ºäº†æ ¸å¿ƒè¿‡æ»¤å™¨ï¼Œå…¶å®ƒçš„éæ ¸å¿ƒè¿‡æ»¤å™¨å¹¶æ²¡æœ‰åœ¨å›¾ä¸­å±•ç¤ºã€‚ UsernamePasswordAuthenticationFilter:è´Ÿè´£å¤„ç†æˆ‘ä»¬åœ¨ç™»é™†é¡µé¢å¡«å†™äº†ç”¨æˆ·åå¯†ç åçš„ç™»é™†è¯·æ±‚ã€‚å…¥é—¨æ¡ˆä¾‹çš„è®¤è¯å·¥ä½œä¸»è¦æœ‰å®ƒè´Ÿè´£ã€‚ ExceptionTranslationFilterï¼šå¤„ç†è¿‡æ»¤å™¨é“¾ä¸­æŠ›å‡ºçš„ä»»ä½•AccessDeniedExceptionå’ŒAuthenticationException ã€‚ FilterSecurityInterceptorï¼šè´Ÿè´£æƒé™æ ¡éªŒçš„è¿‡æ»¤å™¨ã€‚ â€‹ â€‹ æˆ‘ä»¬å¯ä»¥é€šè¿‡DebugæŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­SpringSecurityè¿‡æ»¤å™¨é“¾ä¸­æœ‰å“ªäº›è¿‡æ»¤å™¨åŠå®ƒä»¬çš„é¡ºåºã€‚ 2.2.2 è®¤è¯æµç¨‹è¯¦è§£ æ¦‚å¿µé€ŸæŸ¥: Authenticationæ¥å£: å®ƒçš„å®ç°ç±»ï¼Œè¡¨ç¤ºå½“å‰è®¿é—®ç³»ç»Ÿçš„ç”¨æˆ·ï¼Œå°è£…äº†ç”¨æˆ·ç›¸å…³ä¿¡æ¯ã€‚ AuthenticationManageræ¥å£ï¼šå®šä¹‰äº†è®¤è¯Authenticationçš„æ–¹æ³• UserDetailsServiceæ¥å£ï¼šåŠ è½½ç”¨æˆ·ç‰¹å®šæ•°æ®çš„æ ¸å¿ƒæ¥å£ã€‚é‡Œé¢å®šä¹‰äº†ä¸€ä¸ªæ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯çš„æ–¹æ³•ã€‚ UserDetailsæ¥å£ï¼šæä¾›æ ¸å¿ƒç”¨æˆ·ä¿¡æ¯ã€‚é€šè¿‡UserDetailsServiceæ ¹æ®ç”¨æˆ·åè·å–å¤„ç†çš„ç”¨æˆ·ä¿¡æ¯è¦å°è£…æˆUserDetailså¯¹è±¡è¿”å›ã€‚ç„¶åå°†è¿™äº›ä¿¡æ¯å°è£…åˆ°Authenticationå¯¹è±¡ä¸­ã€‚ 2.3 è§£å†³é—®é¢˜2.3.1 æ€è·¯åˆ†æç™»å½• â€‹ â‘ è‡ªå®šä¹‰ç™»å½•æ¥å£ â€‹ è°ƒç”¨ProviderManagerçš„æ–¹æ³•è¿›è¡Œè®¤è¯ å¦‚æœè®¤è¯é€šè¿‡ç”Ÿæˆjwt â€‹ æŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥redisä¸­ â€‹ â‘¡è‡ªå®šä¹‰UserDetailsService â€‹ åœ¨è¿™ä¸ªå®ç°ç±»ä¸­å»æŸ¥è¯¢æ•°æ®åº“ æ ¡éªŒï¼š â€‹ â‘ å®šä¹‰Jwtè®¤è¯è¿‡æ»¤å™¨ â€‹ è·å–token â€‹ è§£ætokenè·å–å…¶ä¸­çš„userid â€‹ ä»redisä¸­è·å–ç”¨æˆ·ä¿¡æ¯ â€‹ å­˜å…¥SecurityContextHolder 2.3.2 å‡†å¤‡å·¥ä½œâ‘ æ·»åŠ ä¾èµ– &lt;!--redisä¾èµ–--&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!--fastjsonä¾èµ–--&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.33&lt;/version&gt;&lt;/dependency&gt;&lt;!--jwtä¾èµ–--&gt;&lt;dependency&gt; &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt; &lt;artifactId&gt;jjwt&lt;/artifactId&gt; &lt;version&gt;0.9.0&lt;/version&gt;&lt;/dependency&gt; â‘¡ æ·»åŠ Redisç›¸å…³é…ç½® import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.serializer.SerializerFeature;import com.fasterxml.jackson.databind.JavaType;import com.fasterxml.jackson.databind.ObjectMapper;import com.fasterxml.jackson.databind.type.TypeFactory;import org.springframework.data.redis.serializer.RedisSerializer;import org.springframework.data.redis.serializer.SerializationException;import com.alibaba.fastjson.parser.ParserConfig;import org.springframework.util.Assert;import java.nio.charset.Charset;/** * Redisä½¿ç”¨FastJsonåºåˆ—åŒ– * * @author sg */public class FastJsonRedisSerializer&lt;T&gt; implements RedisSerializer&lt;T&gt;&#123; public static final Charset DEFAULT_CHARSET = Charset.forName(&quot;UTF-8&quot;); private Class&lt;T&gt; clazz; static &#123; ParserConfig.getGlobalInstance().setAutoTypeSupport(true); &#125; public FastJsonRedisSerializer(Class&lt;T&gt; clazz) &#123; super(); this.clazz = clazz; &#125; @Override public byte[] serialize(T t) throws SerializationException &#123; if (t == null) &#123; return new byte[0]; &#125; return JSON.toJSONString(t, SerializerFeature.WriteClassName).getBytes(DEFAULT_CHARSET); &#125; @Override public T deserialize(byte[] bytes) throws SerializationException &#123; if (bytes == null || bytes.length &lt;= 0) &#123; return null; &#125; String str = new String(bytes, DEFAULT_CHARSET); return JSON.parseObject(str, clazz); &#125; protected JavaType getJavaType(Class&lt;?&gt; clazz) &#123; return TypeFactory.defaultInstance().constructType(clazz); &#125;&#125; import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.data.redis.connection.RedisConnectionFactory;import org.springframework.data.redis.core.RedisTemplate;import org.springframework.data.redis.serializer.StringRedisSerializer;@Configurationpublic class RedisConfig &#123; @Bean @SuppressWarnings(value = &#123; &quot;unchecked&quot;, &quot;rawtypes&quot; &#125;) public RedisTemplate&lt;Object, Object&gt; redisTemplate(RedisConnectionFactory connectionFactory) &#123; RedisTemplate&lt;Object, Object&gt; template = new RedisTemplate&lt;&gt;(); template.setConnectionFactory(connectionFactory); FastJsonRedisSerializer serializer = new FastJsonRedisSerializer(Object.class); // ä½¿ç”¨StringRedisSerializeræ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–redisçš„keyå€¼ template.setKeySerializer(new StringRedisSerializer()); template.setValueSerializer(serializer); // Hashçš„keyä¹Ÿé‡‡ç”¨StringRedisSerializerçš„åºåˆ—åŒ–æ–¹å¼ template.setHashKeySerializer(new StringRedisSerializer()); template.setHashValueSerializer(serializer); template.afterPropertiesSet(); return template; &#125;&#125; â‘¢ å“åº”ç±» import com.fasterxml.jackson.annotation.JsonInclude;/** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@JsonInclude(JsonInclude.Include.NON_NULL)public class ResponseResult&lt;T&gt; &#123; /** * çŠ¶æ€ç  */ private Integer code; /** * æç¤ºä¿¡æ¯ï¼Œå¦‚æœæœ‰é”™è¯¯æ—¶ï¼Œå‰ç«¯å¯ä»¥è·å–è¯¥å­—æ®µè¿›è¡Œæç¤º */ private String msg; /** * æŸ¥è¯¢åˆ°çš„ç»“æœæ•°æ®ï¼Œ */ private T data; public ResponseResult(Integer code, String msg) &#123; this.code = code; this.msg = msg; &#125; public ResponseResult(Integer code, T data) &#123; this.code = code; this.data = data; &#125; public Integer getCode() &#123; return code; &#125; public void setCode(Integer code) &#123; this.code = code; &#125; public String getMsg() &#123; return msg; &#125; public void setMsg(String msg) &#123; this.msg = msg; &#125; public T getData() &#123; return data; &#125; public void setData(T data) &#123; this.data = data; &#125; public ResponseResult(Integer code, String msg, T data) &#123; this.code = code; this.msg = msg; this.data = data; &#125;&#125; â‘£å·¥å…·ç±» import io.jsonwebtoken.Claims;import io.jsonwebtoken.JwtBuilder;import io.jsonwebtoken.Jwts;import io.jsonwebtoken.SignatureAlgorithm;import javax.crypto.SecretKey;import javax.crypto.spec.SecretKeySpec;import java.util.Base64;import java.util.Date;import java.util.UUID;/** * JWTå·¥å…·ç±» */public class JwtUtil &#123; //æœ‰æ•ˆæœŸä¸º public static final Long JWT_TTL = 60 * 60 *1000L;// 60 * 60 *1000 ä¸€ä¸ªå°æ—¶ //è®¾ç½®ç§˜é’¥æ˜æ–‡ public static final String JWT_KEY = &quot;sangeng&quot;; public static String getUUID()&#123; String token = UUID.randomUUID().toString().replaceAll(&quot;-&quot;, &quot;&quot;); return token; &#125; /** * ç”Ÿæˆjtw * @param subject tokenä¸­è¦å­˜æ”¾çš„æ•°æ®ï¼ˆjsonæ ¼å¼ï¼‰ * @return */ public static String createJWT(String subject) &#123; JwtBuilder builder = getJwtBuilder(subject, null, getUUID());// è®¾ç½®è¿‡æœŸæ—¶é—´ return builder.compact(); &#125; /** * ç”Ÿæˆjtw * @param subject tokenä¸­è¦å­˜æ”¾çš„æ•°æ®ï¼ˆjsonæ ¼å¼ï¼‰ * @param ttlMillis tokenè¶…æ—¶æ—¶é—´ * @return */ public static String createJWT(String subject, Long ttlMillis) &#123; JwtBuilder builder = getJwtBuilder(subject, ttlMillis, getUUID());// è®¾ç½®è¿‡æœŸæ—¶é—´ return builder.compact(); &#125; private static JwtBuilder getJwtBuilder(String subject, Long ttlMillis, String uuid) &#123; SignatureAlgorithm signatureAlgorithm = SignatureAlgorithm.HS256; SecretKey secretKey = generalKey(); long nowMillis = System.currentTimeMillis(); Date now = new Date(nowMillis); if(ttlMillis==null)&#123; ttlMillis=JwtUtil.JWT_TTL; &#125; long expMillis = nowMillis + ttlMillis; Date expDate = new Date(expMillis); return Jwts.builder() .setId(uuid) //å”¯ä¸€çš„ID .setSubject(subject) // ä¸»é¢˜ å¯ä»¥æ˜¯JSONæ•°æ® .setIssuer(&quot;sg&quot;) // ç­¾å‘è€… .setIssuedAt(now) // ç­¾å‘æ—¶é—´ .signWith(signatureAlgorithm, secretKey) //ä½¿ç”¨HS256å¯¹ç§°åŠ å¯†ç®—æ³•ç­¾å, ç¬¬äºŒä¸ªå‚æ•°ä¸ºç§˜é’¥ .setExpiration(expDate); &#125; /** * åˆ›å»ºtoken * @param id * @param subject * @param ttlMillis * @return */ public static String createJWT(String id, String subject, Long ttlMillis) &#123; JwtBuilder builder = getJwtBuilder(subject, ttlMillis, id);// è®¾ç½®è¿‡æœŸæ—¶é—´ return builder.compact(); &#125; public static void main(String[] args) throws Exception &#123; String token = &quot;eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJjYWM2ZDVhZi1mNjVlLTQ0MDAtYjcxMi0zYWEwOGIyOTIwYjQiLCJzdWIiOiJzZyIsImlzcyI6InNnIiwiaWF0IjoxNjM4MTA2NzEyLCJleHAiOjE2MzgxMTAzMTJ9.JVsSbkP94wuczb4QryQbAke3ysBDIL5ou8fWsbt_ebg&quot;; Claims claims = parseJWT(token); System.out.println(claims); &#125; /** * ç”ŸæˆåŠ å¯†åçš„ç§˜é’¥ secretKey * @return */ public static SecretKey generalKey() &#123; byte[] encodedKey = Base64.getDecoder().decode(JwtUtil.JWT_KEY); SecretKey key = new SecretKeySpec(encodedKey, 0, encodedKey.length, &quot;AES&quot;); return key; &#125; /** * è§£æ * * @param jwt * @return * @throws Exception */ public static Claims parseJWT(String jwt) throws Exception &#123; SecretKey secretKey = generalKey(); return Jwts.parser() .setSigningKey(secretKey) .parseClaimsJws(jwt) .getBody(); &#125;&#125; import java.util.*;import java.util.concurrent.TimeUnit;@SuppressWarnings(value = &#123; &quot;unchecked&quot;, &quot;rawtypes&quot; &#125;)@Componentpublic class RedisCache&#123; @Autowired public RedisTemplate redisTemplate; /** * ç¼“å­˜åŸºæœ¬çš„å¯¹è±¡ï¼ŒIntegerã€Stringã€å®ä½“ç±»ç­‰ * * @param key ç¼“å­˜çš„é”®å€¼ * @param value ç¼“å­˜çš„å€¼ */ public &lt;T&gt; void setCacheObject(final String key, final T value) &#123; redisTemplate.opsForValue().set(key, value); &#125; /** * ç¼“å­˜åŸºæœ¬çš„å¯¹è±¡ï¼ŒIntegerã€Stringã€å®ä½“ç±»ç­‰ * * @param key ç¼“å­˜çš„é”®å€¼ * @param value ç¼“å­˜çš„å€¼ * @param timeout æ—¶é—´ * @param timeUnit æ—¶é—´é¢—ç²’åº¦ */ public &lt;T&gt; void setCacheObject(final String key, final T value, final Integer timeout, final TimeUnit timeUnit) &#123; redisTemplate.opsForValue().set(key, value, timeout, timeUnit); &#125; /** * è®¾ç½®æœ‰æ•ˆæ—¶é—´ * * @param key Redisé”® * @param timeout è¶…æ—¶æ—¶é—´ * @return true=è®¾ç½®æˆåŠŸï¼›false=è®¾ç½®å¤±è´¥ */ public boolean expire(final String key, final long timeout) &#123; return expire(key, timeout, TimeUnit.SECONDS); &#125; /** * è®¾ç½®æœ‰æ•ˆæ—¶é—´ * * @param key Redisé”® * @param timeout è¶…æ—¶æ—¶é—´ * @param unit æ—¶é—´å•ä½ * @return true=è®¾ç½®æˆåŠŸï¼›false=è®¾ç½®å¤±è´¥ */ public boolean expire(final String key, final long timeout, final TimeUnit unit) &#123; return redisTemplate.expire(key, timeout, unit); &#125; /** * è·å¾—ç¼“å­˜çš„åŸºæœ¬å¯¹è±¡ã€‚ * * @param key ç¼“å­˜é”®å€¼ * @return ç¼“å­˜é”®å€¼å¯¹åº”çš„æ•°æ® */ public &lt;T&gt; T getCacheObject(final String key) &#123; ValueOperations&lt;String, T&gt; operation = redisTemplate.opsForValue(); return operation.get(key); &#125; /** * åˆ é™¤å•ä¸ªå¯¹è±¡ * * @param key */ public boolean deleteObject(final String key) &#123; return redisTemplate.delete(key); &#125; /** * åˆ é™¤é›†åˆå¯¹è±¡ * * @param collection å¤šä¸ªå¯¹è±¡ * @return */ public long deleteObject(final Collection collection) &#123; return redisTemplate.delete(collection); &#125; /** * ç¼“å­˜Listæ•°æ® * * @param key ç¼“å­˜çš„é”®å€¼ * @param dataList å¾…ç¼“å­˜çš„Listæ•°æ® * @return ç¼“å­˜çš„å¯¹è±¡ */ public &lt;T&gt; long setCacheList(final String key, final List&lt;T&gt; dataList) &#123; Long count = redisTemplate.opsForList().rightPushAll(key, dataList); return count == null ? 0 : count; &#125; /** * è·å¾—ç¼“å­˜çš„listå¯¹è±¡ * * @param key ç¼“å­˜çš„é”®å€¼ * @return ç¼“å­˜é”®å€¼å¯¹åº”çš„æ•°æ® */ public &lt;T&gt; List&lt;T&gt; getCacheList(final String key) &#123; return redisTemplate.opsForList().range(key, 0, -1); &#125; /** * ç¼“å­˜Set * * @param key ç¼“å­˜é”®å€¼ * @param dataSet ç¼“å­˜çš„æ•°æ® * @return ç¼“å­˜æ•°æ®çš„å¯¹è±¡ */ public &lt;T&gt; BoundSetOperations&lt;String, T&gt; setCacheSet(final String key, final Set&lt;T&gt; dataSet) &#123; BoundSetOperations&lt;String, T&gt; setOperation = redisTemplate.boundSetOps(key); Iterator&lt;T&gt; it = dataSet.iterator(); while (it.hasNext()) &#123; setOperation.add(it.next()); &#125; return setOperation; &#125; /** * è·å¾—ç¼“å­˜çš„set * * @param key * @return */ public &lt;T&gt; Set&lt;T&gt; getCacheSet(final String key) &#123; return redisTemplate.opsForSet().members(key); &#125; /** * ç¼“å­˜Map * * @param key * @param dataMap */ public &lt;T&gt; void setCacheMap(final String key, final Map&lt;String, T&gt; dataMap) &#123; if (dataMap != null) &#123; redisTemplate.opsForHash().putAll(key, dataMap); &#125; &#125; /** * è·å¾—ç¼“å­˜çš„Map * * @param key * @return */ public &lt;T&gt; Map&lt;String, T&gt; getCacheMap(final String key) &#123; return redisTemplate.opsForHash().entries(key); &#125; /** * å¾€Hashä¸­å­˜å…¥æ•°æ® * * @param key Redisé”® * @param hKey Hashé”® * @param value å€¼ */ public &lt;T&gt; void setCacheMapValue(final String key, final String hKey, final T value) &#123; redisTemplate.opsForHash().put(key, hKey, value); &#125; /** * è·å–Hashä¸­çš„æ•°æ® * * @param key Redisé”® * @param hKey Hashé”® * @return Hashä¸­çš„å¯¹è±¡ */ public &lt;T&gt; T getCacheMapValue(final String key, final String hKey) &#123; HashOperations&lt;String, String, T&gt; opsForHash = redisTemplate.opsForHash(); return opsForHash.get(key, hKey); &#125; /** * åˆ é™¤Hashä¸­çš„æ•°æ® * * @param key * @param hkey */ public void delCacheMapValue(final String key, final String hkey) &#123; HashOperations hashOperations = redisTemplate.opsForHash(); hashOperations.delete(key, hkey); &#125; /** * è·å–å¤šä¸ªHashä¸­çš„æ•°æ® * * @param key Redisé”® * @param hKeys Hashé”®é›†åˆ * @return Hashå¯¹è±¡é›†åˆ */ public &lt;T&gt; List&lt;T&gt; getMultiCacheMapValue(final String key, final Collection&lt;Object&gt; hKeys) &#123; return redisTemplate.opsForHash().multiGet(key, hKeys); &#125; /** * è·å¾—ç¼“å­˜çš„åŸºæœ¬å¯¹è±¡åˆ—è¡¨ * * @param pattern å­—ç¬¦ä¸²å‰ç¼€ * @return å¯¹è±¡åˆ—è¡¨ */ public Collection&lt;String&gt; keys(final String pattern) &#123; return redisTemplate.keys(pattern); &#125;&#125; import javax.servlet.http.HttpServletResponse;import java.io.IOException;public class WebUtils&#123; /** * å°†å­—ç¬¦ä¸²æ¸²æŸ“åˆ°å®¢æˆ·ç«¯ * * @param response æ¸²æŸ“å¯¹è±¡ * @param string å¾…æ¸²æŸ“çš„å­—ç¬¦ä¸² * @return null */ public static String renderString(HttpServletResponse response, String string) &#123; try &#123; response.setStatus(200); response.setContentType(&quot;application/json&quot;); response.setCharacterEncoding(&quot;utf-8&quot;); response.getWriter().print(string); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; return null; &#125;&#125; â‘¤å®ä½“ç±» import java.io.Serializable;import java.util.Date;/** * ç”¨æˆ·è¡¨(User)å®ä½“ç±» * * @author ä¸‰æ›´ */@Data@AllArgsConstructor@NoArgsConstructorpublic class User implements Serializable &#123; private static final long serialVersionUID = -40356785423868312L; /** * ä¸»é”® */ private Long id; /** * ç”¨æˆ·å */ private String userName; /** * æ˜µç§° */ private String nickName; /** * å¯†ç  */ private String password; /** * è´¦å·çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰ */ private String status; /** * é‚®ç®± */ private String email; /** * æ‰‹æœºå· */ private String phonenumber; /** * ç”¨æˆ·æ€§åˆ«ï¼ˆ0ç”·ï¼Œ1å¥³ï¼Œ2æœªçŸ¥ï¼‰ */ private String sex; /** * å¤´åƒ */ private String avatar; /** * ç”¨æˆ·ç±»å‹ï¼ˆ0ç®¡ç†å‘˜ï¼Œ1æ™®é€šç”¨æˆ·ï¼‰ */ private String userType; /** * åˆ›å»ºäººçš„ç”¨æˆ·id */ private Long createBy; /** * åˆ›å»ºæ—¶é—´ */ private Date createTime; /** * æ›´æ–°äºº */ private Long updateBy; /** * æ›´æ–°æ—¶é—´ */ private Date updateTime; /** * åˆ é™¤æ ‡å¿—ï¼ˆ0ä»£è¡¨æœªåˆ é™¤ï¼Œ1ä»£è¡¨å·²åˆ é™¤ï¼‰ */ private Integer delFlag;&#125; 2.3.3 å®ç°2.3.3.1 æ•°æ®åº“æ ¡éªŒç”¨æˆ·â€‹ ä»ä¹‹å‰çš„åˆ†ææˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªUserDetailsService,è®©SpringSecurityä½¿ç”¨æˆ‘ä»¬çš„UserDetailsServiceã€‚æˆ‘ä»¬è‡ªå·±çš„UserDetailsServiceå¯ä»¥ä»æ•°æ®åº“ä¸­æŸ¥è¯¢ç”¨æˆ·åå’Œå¯†ç ã€‚ å‡†å¤‡å·¥ä½œâ€‹ æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªç”¨æˆ·è¡¨ï¼Œ å»ºè¡¨è¯­å¥å¦‚ä¸‹ï¼š CREATE TABLE `sys_user` ( `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT &#x27;ä¸»é”®&#x27;, `user_name` VARCHAR(64) NOT NULL DEFAULT &#x27;NULL&#x27; COMMENT &#x27;ç”¨æˆ·å&#x27;, `nick_name` VARCHAR(64) NOT NULL DEFAULT &#x27;NULL&#x27; COMMENT &#x27;æ˜µç§°&#x27;, `password` VARCHAR(64) NOT NULL DEFAULT &#x27;NULL&#x27; COMMENT &#x27;å¯†ç &#x27;, `status` CHAR(1) DEFAULT &#x27;0&#x27; COMMENT &#x27;è´¦å·çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰&#x27;, `email` VARCHAR(64) DEFAULT NULL COMMENT &#x27;é‚®ç®±&#x27;, `phonenumber` VARCHAR(32) DEFAULT NULL COMMENT &#x27;æ‰‹æœºå·&#x27;, `sex` CHAR(1) DEFAULT NULL COMMENT &#x27;ç”¨æˆ·æ€§åˆ«ï¼ˆ0ç”·ï¼Œ1å¥³ï¼Œ2æœªçŸ¥ï¼‰&#x27;, `avatar` VARCHAR(128) DEFAULT NULL COMMENT &#x27;å¤´åƒ&#x27;, `user_type` CHAR(1) NOT NULL DEFAULT &#x27;1&#x27; COMMENT &#x27;ç”¨æˆ·ç±»å‹ï¼ˆ0ç®¡ç†å‘˜ï¼Œ1æ™®é€šç”¨æˆ·ï¼‰&#x27;, `create_by` BIGINT(20) DEFAULT NULL COMMENT &#x27;åˆ›å»ºäººçš„ç”¨æˆ·id&#x27;, `create_time` DATETIME DEFAULT NULL COMMENT &#x27;åˆ›å»ºæ—¶é—´&#x27;, `update_by` BIGINT(20) DEFAULT NULL COMMENT &#x27;æ›´æ–°äºº&#x27;, `update_time` DATETIME DEFAULT NULL COMMENT &#x27;æ›´æ–°æ—¶é—´&#x27;, `del_flag` INT(11) DEFAULT &#x27;0&#x27; COMMENT &#x27;åˆ é™¤æ ‡å¿—ï¼ˆ0ä»£è¡¨æœªåˆ é™¤ï¼Œ1ä»£è¡¨å·²åˆ é™¤ï¼‰&#x27;, PRIMARY KEY (`id`)) ENGINE=INNODB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;ç”¨æˆ·è¡¨&#x27; â€‹ å¼•å…¥MybatisPulså’Œmysqlé©±åŠ¨çš„ä¾èµ– &lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.4.3&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;&lt;/dependency&gt; â€‹ é…ç½®æ•°æ®åº“ä¿¡æ¯ spring: datasource: url: jdbc:mysql://localhost:3306/sg_security?characterEncoding=utf-8&amp;serverTimezone=UTC username: root password: root driver-class-name: com.mysql.cj.jdbc.Driver â€‹ å®šä¹‰Mapperæ¥å£ public interface UserMapper extends BaseMapper&lt;User&gt; &#123;&#125; â€‹ ä¿®æ”¹Userå®ä½“ç±» ç±»åä¸ŠåŠ @TableName(value = &quot;sys_user&quot;) ,idå­—æ®µä¸ŠåŠ  @TableId â€‹ é…ç½®Mapperæ‰«æ @SpringBootApplication@MapperScan(&quot;com.sangeng.mapper&quot;)public class SimpleSecurityApplication &#123; public static void main(String[] args) &#123; ConfigurableApplicationContext run = SpringApplication.run(SimpleSecurityApplication.class); System.out.println(run); &#125;&#125; â€‹ æ·»åŠ junitä¾èµ– &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;&lt;/dependency&gt; â€‹ æµ‹è¯•MPæ˜¯å¦èƒ½æ­£å¸¸ä½¿ç”¨ /** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@SpringBootTestpublic class MapperTest &#123; @Autowired private UserMapper userMapper; @Test public void testUserMapper()&#123; List&lt;User&gt; users = userMapper.selectList(null); System.out.println(users); &#125;&#125; æ ¸å¿ƒä»£ç å®ç°åˆ›å»ºä¸€ä¸ªç±»å®ç°UserDetailsServiceæ¥å£ï¼Œé‡å†™å…¶ä¸­çš„æ–¹æ³•ã€‚æ›´åŠ ç”¨æˆ·åä»æ•°æ®åº“ä¸­æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ /** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@Servicepublic class UserDetailsServiceImpl implements UserDetailsService &#123; @Autowired private UserMapper userMapper; @Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException &#123; //æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ LambdaQueryWrapper&lt;User&gt; wrapper = new LambdaQueryWrapper&lt;&gt;(); wrapper.eq(User::getUserName,username); User user = userMapper.selectOne(wrapper); //å¦‚æœæŸ¥è¯¢ä¸åˆ°æ•°æ®å°±é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ¥ç»™å‡ºæç¤º if(Objects.isNull(user))&#123; throw new RuntimeException(&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;); &#125; //TODO æ ¹æ®ç”¨æˆ·æŸ¥è¯¢æƒé™ä¿¡æ¯ æ·»åŠ åˆ°LoginUserä¸­ //å°è£…æˆUserDetailså¯¹è±¡è¿”å› return new LoginUser(user); &#125;&#125; å› ä¸ºUserDetailsServiceæ–¹æ³•çš„è¿”å›å€¼æ˜¯UserDetailsç±»å‹ï¼Œæ‰€ä»¥éœ€è¦å®šä¹‰ä¸€ä¸ªç±»ï¼Œå®ç°è¯¥æ¥å£ï¼ŒæŠŠç”¨æˆ·ä¿¡æ¯å°è£…åœ¨å…¶ä¸­ã€‚ /** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@Data@NoArgsConstructor@AllArgsConstructorpublic class LoginUser implements UserDetails &#123; private User user; @Override public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123; return null; &#125; @Override public String getPassword() &#123; return user.getPassword(); &#125; @Override public String getUsername() &#123; return user.getUserName(); &#125; @Override public boolean isAccountNonExpired() &#123; return true; &#125; @Override public boolean isAccountNonLocked() &#123; return true; &#125; @Override public boolean isCredentialsNonExpired() &#123; return true; &#125; @Override public boolean isEnabled() &#123; return true; &#125;&#125; æ³¨æ„ï¼šå¦‚æœè¦æµ‹è¯•ï¼Œéœ€è¦å¾€ç”¨æˆ·è¡¨ä¸­å†™å…¥ç”¨æˆ·æ•°æ®ï¼Œå¹¶ä¸”å¦‚æœä½ æƒ³è®©ç”¨æˆ·çš„å¯†ç æ˜¯æ˜æ–‡å­˜å‚¨ï¼Œéœ€è¦åœ¨å¯†ç å‰åŠ {noop}ã€‚ä¾‹å¦‚ è¿™æ ·ç™»é™†çš„æ—¶å€™å°±å¯ä»¥ç”¨sgä½œä¸ºç”¨æˆ·åï¼Œ1234ä½œä¸ºå¯†ç æ¥ç™»é™†äº†ã€‚ 2.3.3.2 å¯†ç åŠ å¯†å­˜å‚¨â€‹ å®é™…é¡¹ç›®ä¸­æˆ‘ä»¬ä¸ä¼šæŠŠå¯†ç æ˜æ–‡å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚ â€‹ é»˜è®¤ä½¿ç”¨çš„PasswordEncoderè¦æ±‚æ•°æ®åº“ä¸­çš„å¯†ç æ ¼å¼ä¸ºï¼š{id}password ã€‚å®ƒä¼šæ ¹æ®idå»åˆ¤æ–­å¯†ç çš„åŠ å¯†æ–¹å¼ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šé‡‡ç”¨è¿™ç§æ–¹å¼ã€‚æ‰€ä»¥å°±éœ€è¦æ›¿æ¢PasswordEncoderã€‚ â€‹ æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨SpringSecurityä¸ºæˆ‘ä»¬æä¾›çš„BCryptPasswordEncoderã€‚ â€‹ æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨æŠŠBCryptPasswordEncoderå¯¹è±¡æ³¨å…¥Springå®¹å™¨ä¸­ï¼ŒSpringSecurityå°±ä¼šä½¿ç”¨è¯¥PasswordEncoderæ¥è¿›è¡Œå¯†ç æ ¡éªŒã€‚ â€‹ æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªSpringSecurityçš„é…ç½®ç±»ï¼ŒSpringSecurityè¦æ±‚è¿™ä¸ªé…ç½®ç±»è¦ç»§æ‰¿WebSecurityConfigurerAdapterã€‚ /** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@Configurationpublic class SecurityConfig extends WebSecurityConfigurerAdapter &#123; @Bean public PasswordEncoder passwordEncoder()&#123; return new BCryptPasswordEncoder(); &#125;&#125; 2.3.3.3 ç™»é™†æ¥å£â€‹ æ¥ä¸‹æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ç™»é™†æ¥å£ï¼Œç„¶åè®©SpringSecurityå¯¹è¿™ä¸ªæ¥å£æ”¾è¡Œ,è®©ç”¨æˆ·è®¿é—®è¿™ä¸ªæ¥å£çš„æ—¶å€™ä¸ç”¨ç™»å½•ä¹Ÿèƒ½è®¿é—®ã€‚ â€‹ åœ¨æ¥å£ä¸­æˆ‘ä»¬é€šè¿‡AuthenticationManagerçš„authenticateæ–¹æ³•æ¥è¿›è¡Œç”¨æˆ·è®¤è¯,æ‰€ä»¥éœ€è¦åœ¨SecurityConfigä¸­é…ç½®æŠŠAuthenticationManageræ³¨å…¥å®¹å™¨ã€‚ â€‹ è®¤è¯æˆåŠŸçš„è¯è¦ç”Ÿæˆä¸€ä¸ªjwtï¼Œæ”¾å…¥å“åº”ä¸­è¿”å›ã€‚å¹¶ä¸”ä¸ºäº†è®©ç”¨æˆ·ä¸‹å›è¯·æ±‚æ—¶èƒ½é€šè¿‡jwtè¯†åˆ«å‡ºå…·ä½“çš„æ˜¯å“ªä¸ªç”¨æˆ·ï¼Œæˆ‘ä»¬éœ€è¦æŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥redisï¼Œå¯ä»¥æŠŠç”¨æˆ·idä½œä¸ºkeyã€‚ @RestControllerpublic class LoginController &#123; @Autowired private LoginServcie loginServcie; @PostMapping(&quot;/user/login&quot;) public ResponseResult login(@RequestBody User user)&#123; return loginServcie.login(user); &#125;&#125; /** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@Configurationpublic class SecurityConfig extends WebSecurityConfigurerAdapter &#123; @Bean public PasswordEncoder passwordEncoder()&#123; return new BCryptPasswordEncoder(); &#125; @Override protected void configure(HttpSecurity http) throws Exception &#123; http //å…³é—­csrf .csrf().disable() //ä¸é€šè¿‡Sessionè·å–SecurityContext .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS) .and() .authorizeRequests() // å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—® .antMatchers(&quot;/user/login&quot;).anonymous() // é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯ .anyRequest().authenticated(); &#125; @Bean @Override public AuthenticationManager authenticationManagerBean() throws Exception &#123; return super.authenticationManagerBean(); &#125;&#125; â€‹ @Servicepublic class LoginServiceImpl implements LoginServcie &#123; @Autowired private AuthenticationManager authenticationManager; @Autowired private RedisCache redisCache; @Override public ResponseResult login(User user) &#123; UsernamePasswordAuthenticationToken authenticationToken = new UsernamePasswordAuthenticationToken(user.getUserName(),user.getPassword()); Authentication authenticate = authenticationManager.authenticate(authenticationToken); if(Objects.isNull(authenticate))&#123; throw new RuntimeException(&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;); &#125; //ä½¿ç”¨useridç”Ÿæˆtoken LoginUser loginUser = (LoginUser) authenticate.getPrincipal(); String userId = loginUser.getUser().getId().toString(); String jwt = JwtUtil.createJWT(userId); //authenticateå­˜å…¥redis redisCache.setCacheObject(&quot;login:&quot;+userId,loginUser); //æŠŠtokenå“åº”ç»™å‰ç«¯ HashMap&lt;String,String&gt; map = new HashMap&lt;&gt;(); map.put(&quot;token&quot;,jwt); return new ResponseResult(200,&quot;ç™»é™†æˆåŠŸ&quot;,map); &#125;&#125; 2.3.3.4 è®¤è¯è¿‡æ»¤å™¨â€‹ æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œè¿™ä¸ªè¿‡æ»¤å™¨ä¼šå»è·å–è¯·æ±‚å¤´ä¸­çš„tokenï¼Œå¯¹tokenè¿›è¡Œè§£æå–å‡ºå…¶ä¸­çš„useridã€‚ â€‹ ä½¿ç”¨useridå»redisä¸­è·å–å¯¹åº”çš„LoginUserå¯¹è±¡ã€‚ â€‹ ç„¶åå°è£…Authenticationå¯¹è±¡å­˜å…¥SecurityContextHolder @Componentpublic class JwtAuthenticationTokenFilter extends OncePerRequestFilter &#123; @Autowired private RedisCache redisCache; @Override protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException &#123; //è·å–token String token = request.getHeader(&quot;token&quot;); if (!StringUtils.hasText(token)) &#123; //æ”¾è¡Œ filterChain.doFilter(request, response); return; &#125; //è§£ætoken String userid; try &#123; Claims claims = JwtUtil.parseJWT(token); userid = claims.getSubject(); &#125; catch (Exception e) &#123; e.printStackTrace(); throw new RuntimeException(&quot;tokenéæ³•&quot;); &#125; //ä»redisä¸­è·å–ç”¨æˆ·ä¿¡æ¯ String redisKey = &quot;login:&quot; + userid; LoginUser loginUser = redisCache.getCacheObject(redisKey); if(Objects.isNull(loginUser))&#123; throw new RuntimeException(&quot;ç”¨æˆ·æœªç™»å½•&quot;); &#125; //å­˜å…¥SecurityContextHolder //TODO è·å–æƒé™ä¿¡æ¯å°è£…åˆ°Authenticationä¸­ UsernamePasswordAuthenticationToken authenticationToken = new UsernamePasswordAuthenticationToken(loginUser,null,null); SecurityContextHolder.getContext().setAuthentication(authenticationToken); //æ”¾è¡Œ filterChain.doFilter(request, response); &#125;&#125; /** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@Configurationpublic class SecurityConfig extends WebSecurityConfigurerAdapter &#123; @Bean public PasswordEncoder passwordEncoder()&#123; return new BCryptPasswordEncoder(); &#125; @Autowired JwtAuthenticationTokenFilter jwtAuthenticationTokenFilter; @Override protected void configure(HttpSecurity http) throws Exception &#123; http //å…³é—­csrf .csrf().disable() //ä¸é€šè¿‡Sessionè·å–SecurityContext .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS) .and() .authorizeRequests() // å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—® .antMatchers(&quot;/user/login&quot;).anonymous() // é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯ .anyRequest().authenticated(); //æŠŠtokenæ ¡éªŒè¿‡æ»¤å™¨æ·»åŠ åˆ°è¿‡æ»¤å™¨é“¾ä¸­ http.addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class); &#125; @Bean @Override public AuthenticationManager authenticationManagerBean() throws Exception &#123; return super.authenticationManagerBean(); &#125;&#125; 2.3.3.5 é€€å‡ºç™»é™†â€‹ æˆ‘ä»¬åªéœ€è¦å®šä¹‰ä¸€ä¸ªç™»é™†æ¥å£ï¼Œç„¶åè·å–SecurityContextHolderä¸­çš„è®¤è¯ä¿¡æ¯ï¼Œåˆ é™¤redisä¸­å¯¹åº”çš„æ•°æ®å³å¯ã€‚ /** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@Servicepublic class LoginServiceImpl implements LoginServcie &#123; @Autowired private AuthenticationManager authenticationManager; @Autowired private RedisCache redisCache; @Override public ResponseResult login(User user) &#123; UsernamePasswordAuthenticationToken authenticationToken = new UsernamePasswordAuthenticationToken(user.getUserName(),user.getPassword()); Authentication authenticate = authenticationManager.authenticate(authenticationToken); if(Objects.isNull(authenticate))&#123; throw new RuntimeException(&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;); &#125; //ä½¿ç”¨useridç”Ÿæˆtoken LoginUser loginUser = (LoginUser) authenticate.getPrincipal(); String userId = loginUser.getUser().getId().toString(); String jwt = JwtUtil.createJWT(userId); //authenticateå­˜å…¥redis redisCache.setCacheObject(&quot;login:&quot;+userId,loginUser); //æŠŠtokenå“åº”ç»™å‰ç«¯ HashMap&lt;String,String&gt; map = new HashMap&lt;&gt;(); map.put(&quot;token&quot;,jwt); return new ResponseResult(200,&quot;ç™»é™†æˆåŠŸ&quot;,map); &#125; @Override public ResponseResult logout() &#123; Authentication authentication = SecurityContextHolder.getContext().getAuthentication(); LoginUser loginUser = (LoginUser) authentication.getPrincipal(); Long userid = loginUser.getUser().getId(); redisCache.deleteObject(&quot;login:&quot;+userid); return new ResponseResult(200,&quot;é€€å‡ºæˆåŠŸ&quot;); &#125;&#125; 3. æˆæƒ3.0 æƒé™ç³»ç»Ÿçš„ä½œç”¨â€‹ ä¾‹å¦‚ä¸€ä¸ªå­¦æ ¡å›¾ä¹¦é¦†çš„ç®¡ç†ç³»ç»Ÿï¼Œå¦‚æœæ˜¯æ™®é€šå­¦ç”Ÿç™»å½•å°±èƒ½çœ‹åˆ°å€Ÿä¹¦è¿˜ä¹¦ç›¸å…³çš„åŠŸèƒ½ï¼Œä¸å¯èƒ½è®©ä»–çœ‹åˆ°å¹¶ä¸”å»ä½¿ç”¨æ·»åŠ ä¹¦ç±ä¿¡æ¯ï¼Œåˆ é™¤ä¹¦ç±ä¿¡æ¯ç­‰åŠŸèƒ½ã€‚ä½†æ˜¯å¦‚æœæ˜¯ä¸€ä¸ªå›¾ä¹¦é¦†ç®¡ç†å‘˜çš„è´¦å·ç™»å½•äº†ï¼Œåº”è¯¥å°±èƒ½çœ‹åˆ°å¹¶ä½¿ç”¨æ·»åŠ ä¹¦ç±ä¿¡æ¯ï¼Œåˆ é™¤ä¹¦ç±ä¿¡æ¯ç­‰åŠŸèƒ½ã€‚ â€‹ æ€»ç»“èµ·æ¥å°±æ˜¯ä¸åŒçš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨ä¸åŒçš„åŠŸèƒ½ã€‚è¿™å°±æ˜¯æƒé™ç³»ç»Ÿè¦å»å®ç°çš„æ•ˆæœã€‚ â€‹ æˆ‘ä»¬ä¸èƒ½åªä¾èµ–å‰ç«¯å»åˆ¤æ–­ç”¨æˆ·çš„æƒé™æ¥é€‰æ‹©æ˜¾ç¤ºå“ªäº›èœå•å“ªäº›æŒ‰é’®ã€‚å› ä¸ºå¦‚æœåªæ˜¯è¿™æ ·ï¼Œå¦‚æœæœ‰äººçŸ¥é“äº†å¯¹åº”åŠŸèƒ½çš„æ¥å£åœ°å€å°±å¯ä»¥ä¸é€šè¿‡å‰ç«¯ï¼Œç›´æ¥å»å‘é€è¯·æ±‚æ¥å®ç°ç›¸å…³åŠŸèƒ½æ“ä½œã€‚ â€‹ æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦åœ¨åå°è¿›è¡Œç”¨æˆ·æƒé™çš„åˆ¤æ–­ï¼Œåˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰ç›¸åº”çš„æƒé™ï¼Œå¿…é¡»å…·æœ‰æ‰€éœ€æƒé™æ‰èƒ½è¿›è¡Œç›¸åº”çš„æ“ä½œã€‚ â€‹ 3.1 æˆæƒåŸºæœ¬æµç¨‹â€‹ åœ¨SpringSecurityä¸­ï¼Œä¼šä½¿ç”¨é»˜è®¤çš„FilterSecurityInterceptoræ¥è¿›è¡Œæƒé™æ ¡éªŒã€‚åœ¨FilterSecurityInterceptorä¸­ä¼šä»SecurityContextHolderè·å–å…¶ä¸­çš„Authenticationï¼Œç„¶åè·å–å…¶ä¸­çš„æƒé™ä¿¡æ¯ã€‚å½“å‰ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰è®¿é—®å½“å‰èµ„æºæ‰€éœ€çš„æƒé™ã€‚ â€‹ æ‰€ä»¥æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­åªéœ€è¦æŠŠå½“å‰ç™»å½•ç”¨æˆ·çš„æƒé™ä¿¡æ¯ä¹Ÿå­˜å…¥Authenticationã€‚ â€‹ ç„¶åè®¾ç½®æˆ‘ä»¬çš„èµ„æºæ‰€éœ€è¦çš„æƒé™å³å¯ã€‚ 3.2 æˆæƒå®ç°3.2.1 é™åˆ¶è®¿é—®èµ„æºæ‰€éœ€æƒé™â€‹ SpringSecurityä¸ºæˆ‘ä»¬æä¾›äº†åŸºäºæ³¨è§£çš„æƒé™æ§åˆ¶æ–¹æ¡ˆï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬é¡¹ç›®ä¸­ä¸»è¦é‡‡ç”¨çš„æ–¹å¼ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ³¨è§£å»æŒ‡å®šè®¿é—®å¯¹åº”çš„èµ„æºæ‰€éœ€çš„æƒé™ã€‚ â€‹ ä½†æ˜¯è¦ä½¿ç”¨å®ƒæˆ‘ä»¬éœ€è¦å…ˆå¼€å¯ç›¸å…³é…ç½®ã€‚ @EnableGlobalMethodSecurity(prePostEnabled = true) â€‹ ç„¶åå°±å¯ä»¥ä½¿ç”¨å¯¹åº”çš„æ³¨è§£ã€‚@PreAuthorize @RestControllerpublic class HelloController &#123; @RequestMapping(&quot;/hello&quot;) @PreAuthorize(&quot;hasAuthority(&#x27;test&#x27;)&quot;) public String hello()&#123; return &quot;hello&quot;; &#125;&#125; 3.2.2 å°è£…æƒé™ä¿¡æ¯â€‹ æˆ‘ä»¬å‰é¢åœ¨å†™UserDetailsServiceImplçš„æ—¶å€™è¯´è¿‡ï¼Œåœ¨æŸ¥è¯¢å‡ºç”¨æˆ·åè¿˜è¦è·å–å¯¹åº”çš„æƒé™ä¿¡æ¯ï¼Œå°è£…åˆ°UserDetailsä¸­è¿”å›ã€‚ â€‹ æˆ‘ä»¬å…ˆç›´æ¥æŠŠæƒé™ä¿¡æ¯å†™æ­»å°è£…åˆ°UserDetailsä¸­è¿›è¡Œæµ‹è¯•ã€‚ â€‹ æˆ‘ä»¬ä¹‹å‰å®šä¹‰äº†UserDetailsçš„å®ç°ç±»LoginUserï¼Œæƒ³è¦è®©å…¶èƒ½å°è£…æƒé™ä¿¡æ¯å°±è¦å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚ package com.sangeng.domain;import com.alibaba.fastjson.annotation.JSONField;import lombok.AllArgsConstructor;import lombok.Data;import lombok.NoArgsConstructor;import org.springframework.security.core.GrantedAuthority;import org.springframework.security.core.authority.SimpleGrantedAuthority;import org.springframework.security.core.userdetails.UserDetails;import java.util.Collection;import java.util.List;import java.util.stream.Collectors;/** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@Data@NoArgsConstructorpublic class LoginUser implements UserDetails &#123; private User user; //å­˜å‚¨æƒé™ä¿¡æ¯ private List&lt;String&gt; permissions; public LoginUser(User user,List&lt;String&gt; permissions) &#123; this.user = user; this.permissions = permissions; &#125; //å­˜å‚¨SpringSecurityæ‰€éœ€è¦çš„æƒé™ä¿¡æ¯çš„é›†åˆ @JSONField(serialize = false) private List&lt;GrantedAuthority&gt; authorities; @Override public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123; if(authorities!=null)&#123; return authorities; &#125; //æŠŠpermissionsä¸­å­—ç¬¦ä¸²ç±»å‹çš„æƒé™ä¿¡æ¯è½¬æ¢æˆGrantedAuthorityå¯¹è±¡å­˜å…¥authoritiesä¸­ authorities = permissions.stream(). map(SimpleGrantedAuthority::new) .collect(Collectors.toList()); return authorities; &#125; @Override public String getPassword() &#123; return user.getPassword(); &#125; @Override public String getUsername() &#123; return user.getUserName(); &#125; @Override public boolean isAccountNonExpired() &#123; return true; &#125; @Override public boolean isAccountNonLocked() &#123; return true; &#125; @Override public boolean isCredentialsNonExpired() &#123; return true; &#125; @Override public boolean isEnabled() &#123; return true; &#125;&#125; â€‹ LoginUserä¿®æ”¹å®Œåæˆ‘ä»¬å°±å¯ä»¥åœ¨UserDetailsServiceImplä¸­å»æŠŠæƒé™ä¿¡æ¯å°è£…åˆ°LoginUserä¸­äº†ã€‚æˆ‘ä»¬å†™æ­»æƒé™è¿›è¡Œæµ‹è¯•ï¼Œåé¢æˆ‘ä»¬å†ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æƒé™ä¿¡æ¯ã€‚ package com.sangeng.service.impl;import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;import com.baomidou.mybatisplus.extension.conditions.query.LambdaQueryChainWrapper;import com.sangeng.domain.LoginUser;import com.sangeng.domain.User;import com.sangeng.mapper.UserMapper;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.security.core.userdetails.UserDetails;import org.springframework.security.core.userdetails.UserDetailsService;import org.springframework.security.core.userdetails.UsernameNotFoundException;import org.springframework.stereotype.Service;import java.util.ArrayList;import java.util.Arrays;import java.util.List;import java.util.Objects;/** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@Servicepublic class UserDetailsServiceImpl implements UserDetailsService &#123; @Autowired private UserMapper userMapper; @Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException &#123; LambdaQueryWrapper&lt;User&gt; wrapper = new LambdaQueryWrapper&lt;&gt;(); wrapper.eq(User::getUserName,username); User user = userMapper.selectOne(wrapper); if(Objects.isNull(user))&#123; throw new RuntimeException(&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;); &#125; //TODO æ ¹æ®ç”¨æˆ·æŸ¥è¯¢æƒé™ä¿¡æ¯ æ·»åŠ åˆ°LoginUserä¸­ List&lt;String&gt; list = new ArrayList&lt;&gt;(Arrays.asList(&quot;test&quot;)); return new LoginUser(user,list); &#125;&#125; 3.2.3 ä»æ•°æ®åº“æŸ¥è¯¢æƒé™ä¿¡æ¯3.2.3.1 RBACæƒé™æ¨¡å‹â€‹ RBACæƒé™æ¨¡å‹ï¼ˆRole-Based Access Controlï¼‰å³ï¼šåŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ã€‚è¿™æ˜¯ç›®å‰æœ€å¸¸è¢«å¼€å‘è€…ä½¿ç”¨ä¹Ÿæ˜¯ç›¸å¯¹æ˜“ç”¨ã€é€šç”¨æƒé™æ¨¡å‹ã€‚ â€‹ 3.2.3.2 å‡†å¤‡å·¥ä½œCREATE DATABASE /*!32312 IF NOT EXISTS*/`sg_security` /*!40100 DEFAULT CHARACTER SET utf8mb4 */;USE `sg_security`;/*Table structure for table `sys_menu` */DROP TABLE IF EXISTS `sys_menu`;CREATE TABLE `sys_menu` ( `id` bigint(20) NOT NULL AUTO_INCREMENT, `menu_name` varchar(64) NOT NULL DEFAULT &#x27;NULL&#x27; COMMENT &#x27;èœå•å&#x27;, `path` varchar(200) DEFAULT NULL COMMENT &#x27;è·¯ç”±åœ°å€&#x27;, `component` varchar(255) DEFAULT NULL COMMENT &#x27;ç»„ä»¶è·¯å¾„&#x27;, `visible` char(1) DEFAULT &#x27;0&#x27; COMMENT &#x27;èœå•çŠ¶æ€ï¼ˆ0æ˜¾ç¤º 1éšè—ï¼‰&#x27;, `status` char(1) DEFAULT &#x27;0&#x27; COMMENT &#x27;èœå•çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰&#x27;, `perms` varchar(100) DEFAULT NULL COMMENT &#x27;æƒé™æ ‡è¯†&#x27;, `icon` varchar(100) DEFAULT &#x27;#&#x27; COMMENT &#x27;èœå•å›¾æ ‡&#x27;, `create_by` bigint(20) DEFAULT NULL, `create_time` datetime DEFAULT NULL, `update_by` bigint(20) DEFAULT NULL, `update_time` datetime DEFAULT NULL, `del_flag` int(11) DEFAULT &#x27;0&#x27; COMMENT &#x27;æ˜¯å¦åˆ é™¤ï¼ˆ0æœªåˆ é™¤ 1å·²åˆ é™¤ï¼‰&#x27;, `remark` varchar(500) DEFAULT NULL COMMENT &#x27;å¤‡æ³¨&#x27;, PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;èœå•è¡¨&#x27;;/*Table structure for table `sys_role` */DROP TABLE IF EXISTS `sys_role`;CREATE TABLE `sys_role` ( `id` bigint(20) NOT NULL AUTO_INCREMENT, `name` varchar(128) DEFAULT NULL, `role_key` varchar(100) DEFAULT NULL COMMENT &#x27;è§’è‰²æƒé™å­—ç¬¦ä¸²&#x27;, `status` char(1) DEFAULT &#x27;0&#x27; COMMENT &#x27;è§’è‰²çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰&#x27;, `del_flag` int(1) DEFAULT &#x27;0&#x27; COMMENT &#x27;del_flag&#x27;, `create_by` bigint(200) DEFAULT NULL, `create_time` datetime DEFAULT NULL, `update_by` bigint(200) DEFAULT NULL, `update_time` datetime DEFAULT NULL, `remark` varchar(500) DEFAULT NULL COMMENT &#x27;å¤‡æ³¨&#x27;, PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;è§’è‰²è¡¨&#x27;;/*Table structure for table `sys_role_menu` */DROP TABLE IF EXISTS `sys_role_menu`;CREATE TABLE `sys_role_menu` ( `role_id` bigint(200) NOT NULL AUTO_INCREMENT COMMENT &#x27;è§’è‰²ID&#x27;, `menu_id` bigint(200) NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;èœå•id&#x27;, PRIMARY KEY (`role_id`,`menu_id`)) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4;/*Table structure for table `sys_user` */DROP TABLE IF EXISTS `sys_user`;CREATE TABLE `sys_user` ( `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#x27;ä¸»é”®&#x27;, `user_name` varchar(64) NOT NULL DEFAULT &#x27;NULL&#x27; COMMENT &#x27;ç”¨æˆ·å&#x27;, `nick_name` varchar(64) NOT NULL DEFAULT &#x27;NULL&#x27; COMMENT &#x27;æ˜µç§°&#x27;, `password` varchar(64) NOT NULL DEFAULT &#x27;NULL&#x27; COMMENT &#x27;å¯†ç &#x27;, `status` char(1) DEFAULT &#x27;0&#x27; COMMENT &#x27;è´¦å·çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰&#x27;, `email` varchar(64) DEFAULT NULL COMMENT &#x27;é‚®ç®±&#x27;, `phonenumber` varchar(32) DEFAULT NULL COMMENT &#x27;æ‰‹æœºå·&#x27;, `sex` char(1) DEFAULT NULL COMMENT &#x27;ç”¨æˆ·æ€§åˆ«ï¼ˆ0ç”·ï¼Œ1å¥³ï¼Œ2æœªçŸ¥ï¼‰&#x27;, `avatar` varchar(128) DEFAULT NULL COMMENT &#x27;å¤´åƒ&#x27;, `user_type` char(1) NOT NULL DEFAULT &#x27;1&#x27; COMMENT &#x27;ç”¨æˆ·ç±»å‹ï¼ˆ0ç®¡ç†å‘˜ï¼Œ1æ™®é€šç”¨æˆ·ï¼‰&#x27;, `create_by` bigint(20) DEFAULT NULL COMMENT &#x27;åˆ›å»ºäººçš„ç”¨æˆ·id&#x27;, `create_time` datetime DEFAULT NULL COMMENT &#x27;åˆ›å»ºæ—¶é—´&#x27;, `update_by` bigint(20) DEFAULT NULL COMMENT &#x27;æ›´æ–°äºº&#x27;, `update_time` datetime DEFAULT NULL COMMENT &#x27;æ›´æ–°æ—¶é—´&#x27;, `del_flag` int(11) DEFAULT &#x27;0&#x27; COMMENT &#x27;åˆ é™¤æ ‡å¿—ï¼ˆ0ä»£è¡¨æœªåˆ é™¤ï¼Œ1ä»£è¡¨å·²åˆ é™¤ï¼‰&#x27;, PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;ç”¨æˆ·è¡¨&#x27;;/*Table structure for table `sys_user_role` */DROP TABLE IF EXISTS `sys_user_role`;CREATE TABLE `sys_user_role` ( `user_id` bigint(200) NOT NULL AUTO_INCREMENT COMMENT &#x27;ç”¨æˆ·id&#x27;, `role_id` bigint(200) NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;è§’è‰²id&#x27;, PRIMARY KEY (`user_id`,`role_id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; SELECT DISTINCT m.`perms`FROM sys_user_role ur LEFT JOIN `sys_role` r ON ur.`role_id` = r.`id` LEFT JOIN `sys_role_menu` rm ON ur.`role_id` = rm.`role_id` LEFT JOIN `sys_menu` m ON m.`id` = rm.`menu_id`WHERE user_id = 2 AND r.`status` = 0 AND m.`status` = 0 package com.sangeng.domain;import com.baomidou.mybatisplus.annotation.TableId;import com.baomidou.mybatisplus.annotation.TableName;import com.fasterxml.jackson.annotation.JsonInclude;import lombok.AllArgsConstructor;import lombok.Data;import lombok.NoArgsConstructor;import java.io.Serializable;import java.util.Date;/** * èœå•è¡¨(Menu)å®ä½“ç±» * * @author makejava * @since 2021-11-24 15:30:08 */@TableName(value=&quot;sys_menu&quot;)@Data@AllArgsConstructor@NoArgsConstructor@JsonInclude(JsonInclude.Include.NON_NULL)public class Menu implements Serializable &#123; private static final long serialVersionUID = -54979041104113736L; @TableId private Long id; /** * èœå•å */ private String menuName; /** * è·¯ç”±åœ°å€ */ private String path; /** * ç»„ä»¶è·¯å¾„ */ private String component; /** * èœå•çŠ¶æ€ï¼ˆ0æ˜¾ç¤º 1éšè—ï¼‰ */ private String visible; /** * èœå•çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰ */ private String status; /** * æƒé™æ ‡è¯† */ private String perms; /** * èœå•å›¾æ ‡ */ private String icon; private Long createBy; private Date createTime; private Long updateBy; private Date updateTime; /** * æ˜¯å¦åˆ é™¤ï¼ˆ0æœªåˆ é™¤ 1å·²åˆ é™¤ï¼‰ */ private Integer delFlag; /** * å¤‡æ³¨ */ private String remark;&#125; 3.2.3.3 ä»£ç å®ç°â€‹ æˆ‘ä»¬åªéœ€è¦æ ¹æ®ç”¨æˆ·idå»æŸ¥è¯¢åˆ°å…¶æ‰€å¯¹åº”çš„æƒé™ä¿¡æ¯å³å¯ã€‚ â€‹ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆå®šä¹‰ä¸ªmapperï¼Œå…¶ä¸­æä¾›ä¸€ä¸ªæ–¹æ³•å¯ä»¥æ ¹æ®useridæŸ¥è¯¢æƒé™ä¿¡æ¯ã€‚ import com.baomidou.mybatisplus.core.mapper.BaseMapper;import com.sangeng.domain.Menu;import java.util.List;/** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */public interface MenuMapper extends BaseMapper&lt;Menu&gt; &#123; List&lt;String&gt; selectPermsByUserId(Long id);&#125; â€‹ å°¤å…¶æ˜¯è‡ªå®šä¹‰æ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦åˆ›å»ºå¯¹åº”çš„mapperæ–‡ä»¶ï¼Œå®šä¹‰å¯¹åº”çš„sqlè¯­å¥ &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot; &gt;&lt;mapper namespace=&quot;com.sangeng.mapper.MenuMapper&quot;&gt; &lt;select id=&quot;selectPermsByUserId&quot; resultType=&quot;java.lang.String&quot;&gt; SELECT DISTINCT m.`perms` FROM sys_user_role ur LEFT JOIN `sys_role` r ON ur.`role_id` = r.`id` LEFT JOIN `sys_role_menu` rm ON ur.`role_id` = rm.`role_id` LEFT JOIN `sys_menu` m ON m.`id` = rm.`menu_id` WHERE user_id = #&#123;userid&#125; AND r.`status` = 0 AND m.`status` = 0 &lt;/select&gt;&lt;/mapper&gt; â€‹ åœ¨application.ymlä¸­é…ç½®mapperXMLæ–‡ä»¶çš„ä½ç½® spring: datasource: url: jdbc:mysql://localhost:3306/sg_security?characterEncoding=utf-8&amp;serverTimezone=UTC username: root password: root driver-class-name: com.mysql.cj.jdbc.Driver redis: host: localhost port: 6379mybatis-plus: mapper-locations: classpath*:/mapper/**/*.xml â€‹ ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨UserDetailsServiceImplä¸­å»è°ƒç”¨è¯¥mapperçš„æ–¹æ³•æŸ¥è¯¢æƒé™ä¿¡æ¯å°è£…åˆ°LoginUserå¯¹è±¡ä¸­å³å¯ã€‚ /** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@Servicepublic class UserDetailsServiceImpl implements UserDetailsService &#123; @Autowired private UserMapper userMapper; @Autowired private MenuMapper menuMapper; @Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException &#123; LambdaQueryWrapper&lt;User&gt; wrapper = new LambdaQueryWrapper&lt;&gt;(); wrapper.eq(User::getUserName,username); User user = userMapper.selectOne(wrapper); if(Objects.isNull(user))&#123; throw new RuntimeException(&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;); &#125; List&lt;String&gt; permissionKeyList = menuMapper.selectPermsByUserId(user.getId());// //æµ‹è¯•å†™æ³•// List&lt;String&gt; list = new ArrayList&lt;&gt;(Arrays.asList(&quot;test&quot;)); return new LoginUser(user,permissionKeyList); &#125;&#125; 4. è‡ªå®šä¹‰å¤±è´¥å¤„ç†â€‹ æˆ‘ä»¬è¿˜å¸Œæœ›åœ¨è®¤è¯å¤±è´¥æˆ–è€…æ˜¯æˆæƒå¤±è´¥çš„æƒ…å†µä¸‹ä¹Ÿèƒ½å’Œæˆ‘ä»¬çš„æ¥å£ä¸€æ ·è¿”å›ç›¸åŒç»“æ„çš„jsonï¼Œè¿™æ ·å¯ä»¥è®©å‰ç«¯èƒ½å¯¹å“åº”è¿›è¡Œç»Ÿä¸€çš„å¤„ç†ã€‚è¦å®ç°è¿™ä¸ªåŠŸèƒ½æˆ‘ä»¬éœ€è¦çŸ¥é“SpringSecurityçš„å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚ â€‹ åœ¨SpringSecurityä¸­ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è®¤è¯æˆ–è€…æˆæƒçš„è¿‡ç¨‹ä¸­å‡ºç°äº†å¼‚å¸¸ä¼šè¢«ExceptionTranslationFilteræ•è·åˆ°ã€‚åœ¨ExceptionTranslationFilterä¸­ä¼šå»åˆ¤æ–­æ˜¯è®¤è¯å¤±è´¥è¿˜æ˜¯æˆæƒå¤±è´¥å‡ºç°çš„å¼‚å¸¸ã€‚ â€‹ å¦‚æœæ˜¯è®¤è¯è¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸ä¼šè¢«å°è£…æˆAuthenticationExceptionç„¶åè°ƒç”¨AuthenticationEntryPointå¯¹è±¡çš„æ–¹æ³•å»è¿›è¡Œå¼‚å¸¸å¤„ç†ã€‚ â€‹ å¦‚æœæ˜¯æˆæƒè¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸ä¼šè¢«å°è£…æˆAccessDeniedExceptionç„¶åè°ƒç”¨AccessDeniedHandlerå¯¹è±¡çš„æ–¹æ³•å»è¿›è¡Œå¼‚å¸¸å¤„ç†ã€‚ â€‹ æ‰€ä»¥å¦‚æœæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†ï¼Œæˆ‘ä»¬åªéœ€è¦è‡ªå®šä¹‰AuthenticationEntryPointå’ŒAccessDeniedHandlerç„¶åé…ç½®ç»™SpringSecurityå³å¯ã€‚ â‘ è‡ªå®šä¹‰å®ç°ç±» @Componentpublic class AccessDeniedHandlerImpl implements AccessDeniedHandler &#123; @Override public void handle(HttpServletRequest request, HttpServletResponse response, AccessDeniedException accessDeniedException) throws IOException, ServletException &#123; ResponseResult result = new ResponseResult(HttpStatus.FORBIDDEN.value(), &quot;æƒé™ä¸è¶³&quot;); String json = JSON.toJSONString(result); WebUtils.renderString(response,json); &#125;&#125; /** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@Componentpublic class AuthenticationEntryPointImpl implements AuthenticationEntryPoint &#123; @Override public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) throws IOException, ServletException &#123; ResponseResult result = new ResponseResult(HttpStatus.UNAUTHORIZED.value(), &quot;è®¤è¯å¤±è´¥è¯·é‡æ–°ç™»å½•&quot;); String json = JSON.toJSONString(result); WebUtils.renderString(response,json); &#125;&#125; â‘¡é…ç½®ç»™SpringSecurity â€‹ â€‹ å…ˆæ³¨å…¥å¯¹åº”çš„å¤„ç†å™¨ @Autowiredprivate AuthenticationEntryPoint authenticationEntryPoint;@Autowiredprivate AccessDeniedHandler accessDeniedHandler; â€‹ ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨HttpSecurityå¯¹è±¡çš„æ–¹æ³•å»é…ç½®ã€‚ http.exceptionHandling().authenticationEntryPoint(authenticationEntryPoint). accessDeniedHandler(accessDeniedHandler); 5. è·¨åŸŸâ€‹ æµè§ˆå™¨å‡ºäºå®‰å…¨çš„è€ƒè™‘ï¼Œä½¿ç”¨ XMLHttpRequestå¯¹è±¡å‘èµ· HTTPè¯·æ±‚æ—¶å¿…é¡»éµå®ˆåŒæºç­–ç•¥ï¼Œå¦åˆ™å°±æ˜¯è·¨åŸŸçš„HTTPè¯·æ±‚ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯è¢«ç¦æ­¢çš„ã€‚ åŒæºç­–ç•¥è¦æ±‚æºç›¸åŒæ‰èƒ½æ­£å¸¸è¿›è¡Œé€šä¿¡ï¼Œå³åè®®ã€åŸŸåã€ç«¯å£å·éƒ½å®Œå…¨ä¸€è‡´ã€‚ â€‹ å‰åç«¯åˆ†ç¦»é¡¹ç›®ï¼Œå‰ç«¯é¡¹ç›®å’Œåç«¯é¡¹ç›®ä¸€èˆ¬éƒ½ä¸æ˜¯åŒæºçš„ï¼Œæ‰€ä»¥è‚¯å®šä¼šå­˜åœ¨è·¨åŸŸè¯·æ±‚çš„é—®é¢˜ã€‚ â€‹ æ‰€ä»¥æˆ‘ä»¬å°±è¦å¤„ç†ä¸€ä¸‹ï¼Œè®©å‰ç«¯èƒ½è¿›è¡Œè·¨åŸŸè¯·æ±‚ã€‚ â‘ å…ˆå¯¹SpringBooté…ç½®ï¼Œè¿è¡Œè·¨åŸŸè¯·æ±‚ @Configurationpublic class CorsConfig implements WebMvcConfigurer &#123; @Override public void addCorsMappings(CorsRegistry registry) &#123; // è®¾ç½®å…è®¸è·¨åŸŸçš„è·¯å¾„ registry.addMapping(&quot;/**&quot;) // è®¾ç½®å…è®¸è·¨åŸŸè¯·æ±‚çš„åŸŸå .allowedOriginPatterns(&quot;*&quot;) // æ˜¯å¦å…è®¸cookie .allowCredentials(true) // è®¾ç½®å…è®¸çš„è¯·æ±‚æ–¹å¼ .allowedMethods(&quot;GET&quot;, &quot;POST&quot;, &quot;DELETE&quot;, &quot;PUT&quot;) // è®¾ç½®å…è®¸çš„headerå±æ€§ .allowedHeaders(&quot;*&quot;) // è·¨åŸŸå…è®¸æ—¶é—´ .maxAge(3600); &#125;&#125; â‘¡å¼€å¯SpringSecurityçš„è·¨åŸŸè®¿é—® ç”±äºæˆ‘ä»¬çš„èµ„æºéƒ½ä¼šæ”¶åˆ°SpringSecurityçš„ä¿æŠ¤ï¼Œæ‰€ä»¥æƒ³è¦è·¨åŸŸè®¿é—®è¿˜è¦è®©SpringSecurityè¿è¡Œè·¨åŸŸè®¿é—®ã€‚ @Overrideprotected void configure(HttpSecurity http) throws Exception &#123; http //å…³é—­csrf .csrf().disable() //ä¸é€šè¿‡Sessionè·å–SecurityContext .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS) .and() .authorizeRequests() // å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—® .antMatchers(&quot;/user/login&quot;).anonymous() // é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯ .anyRequest().authenticated(); //æ·»åŠ è¿‡æ»¤å™¨ http.addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class); //é…ç½®å¼‚å¸¸å¤„ç†å™¨ http.exceptionHandling() //é…ç½®è®¤è¯å¤±è´¥å¤„ç†å™¨ .authenticationEntryPoint(authenticationEntryPoint) .accessDeniedHandler(accessDeniedHandler); //å…è®¸è·¨åŸŸ http.cors();&#125; 6. é—ç•™å°é—®é¢˜å…¶å®ƒæƒé™æ ¡éªŒæ–¹æ³•â€‹ æˆ‘ä»¬å‰é¢éƒ½æ˜¯ä½¿ç”¨@PreAuthorizeæ³¨è§£ï¼Œç„¶ååœ¨åœ¨å…¶ä¸­ä½¿ç”¨çš„æ˜¯hasAuthorityæ–¹æ³•è¿›è¡Œæ ¡éªŒã€‚SpringSecurityè¿˜ä¸ºæˆ‘ä»¬æä¾›äº†å…¶å®ƒæ–¹æ³•ä¾‹å¦‚ï¼šhasAnyAuthorityï¼ŒhasRoleï¼ŒhasAnyRoleç­‰ã€‚ â€‹ â€‹ è¿™é‡Œæˆ‘ä»¬å…ˆä¸æ€¥ç€å»ä»‹ç»è¿™äº›æ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆå»ç†è§£hasAuthorityçš„åŸç†ï¼Œç„¶åå†å»å­¦ä¹ å…¶ä»–æ–¹æ³•ä½ å°±æ›´å®¹æ˜“ç†è§£ï¼Œè€Œä¸æ˜¯æ­»è®°ç¡¬èƒŒåŒºåˆ«ã€‚å¹¶ä¸”æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©å®šä¹‰æ ¡éªŒæ–¹æ³•ï¼Œå®ç°æˆ‘ä»¬è‡ªå·±çš„æ ¡éªŒé€»è¾‘ã€‚ â€‹ hasAuthorityæ–¹æ³•å®é™…æ˜¯æ‰§è¡Œåˆ°äº†SecurityExpressionRootçš„hasAuthorityï¼Œå¤§å®¶åªè¦æ–­ç‚¹è°ƒè¯•æ—¢å¯çŸ¥é“å®ƒå†…éƒ¨çš„æ ¡éªŒåŸç†ã€‚ â€‹ å®ƒå†…éƒ¨å…¶å®æ˜¯è°ƒç”¨authenticationçš„getAuthoritiesæ–¹æ³•è·å–ç”¨æˆ·çš„æƒé™åˆ—è¡¨ã€‚ç„¶ååˆ¤æ–­æˆ‘ä»¬å­˜å…¥çš„æ–¹æ³•å‚æ•°æ•°æ®åœ¨æƒé™åˆ—è¡¨ä¸­ã€‚ â€‹ hasAnyAuthorityæ–¹æ³•å¯ä»¥ä¼ å…¥å¤šä¸ªæƒé™ï¼Œåªæœ‰ç”¨æˆ·æœ‰å…¶ä¸­ä»»æ„ä¸€ä¸ªæƒé™éƒ½å¯ä»¥è®¿é—®å¯¹åº”èµ„æºã€‚ @PreAuthorize(&quot;hasAnyAuthority(&#x27;admin&#x27;,&#x27;test&#x27;,&#x27;system:dept:list&#x27;)&quot;)public String hello()&#123; return &quot;hello&quot;;&#125; â€‹ hasRoleè¦æ±‚æœ‰å¯¹åº”çš„è§’è‰²æ‰å¯ä»¥è®¿é—®ï¼Œä½†æ˜¯å®ƒå†…éƒ¨ä¼šæŠŠæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°æ‹¼æ¥ä¸Š ROLE_ åå†å»æ¯”è¾ƒã€‚æ‰€ä»¥è¿™ç§æƒ…å†µä¸‹è¦ç”¨ç”¨æˆ·å¯¹åº”çš„æƒé™ä¹Ÿè¦æœ‰ ROLE_ è¿™ä¸ªå‰ç¼€æ‰å¯ä»¥ã€‚ @PreAuthorize(&quot;hasRole(&#x27;system:dept:list&#x27;)&quot;)public String hello()&#123; return &quot;hello&quot;;&#125; â€‹ hasAnyRole æœ‰ä»»æ„çš„è§’è‰²å°±å¯ä»¥è®¿é—®ã€‚å®ƒå†…éƒ¨ä¹Ÿä¼šæŠŠæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°æ‹¼æ¥ä¸Š ROLE_ åå†å»æ¯”è¾ƒã€‚æ‰€ä»¥è¿™ç§æƒ…å†µä¸‹è¦ç”¨ç”¨æˆ·å¯¹åº”çš„æƒé™ä¹Ÿè¦æœ‰ ROLE_ è¿™ä¸ªå‰ç¼€æ‰å¯ä»¥ã€‚ @PreAuthorize(&quot;hasAnyRole(&#x27;admin&#x27;,&#x27;system:dept:list&#x27;)&quot;)public String hello()&#123; return &quot;hello&quot;;&#125; è‡ªå®šä¹‰æƒé™æ ¡éªŒæ–¹æ³•â€‹ æˆ‘ä»¬ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„æƒé™æ ¡éªŒæ–¹æ³•ï¼Œåœ¨@PreAuthorizeæ³¨è§£ä¸­ä½¿ç”¨æˆ‘ä»¬çš„æ–¹æ³•ã€‚ @Component(&quot;ex&quot;)public class SGExpressionRoot &#123; public boolean hasAuthority(String authority)&#123; //è·å–å½“å‰ç”¨æˆ·çš„æƒé™ Authentication authentication = SecurityContextHolder.getContext().getAuthentication(); LoginUser loginUser = (LoginUser) authentication.getPrincipal(); List&lt;String&gt; permissions = loginUser.getPermissions(); //åˆ¤æ–­ç”¨æˆ·æƒé™é›†åˆä¸­æ˜¯å¦å­˜åœ¨authority return permissions.contains(authority); &#125;&#125; â€‹ åœ¨SPELè¡¨è¾¾å¼ä¸­ä½¿ç”¨ @exç›¸å½“äºè·å–å®¹å™¨ä¸­beançš„åå­—æœªexçš„å¯¹è±¡ã€‚ç„¶åå†è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„hasAuthorityæ–¹æ³• @RequestMapping(&quot;/hello&quot;)@PreAuthorize(&quot;@ex.hasAuthority(&#x27;system:dept:list&#x27;)&quot;)public String hello()&#123; return &quot;hello&quot;;&#125; åŸºäºé…ç½®çš„æƒé™æ§åˆ¶â€‹ æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨é…ç½®ç±»ä¸­ä½¿ç”¨ä½¿ç”¨é…ç½®çš„æ–¹å¼å¯¹èµ„æºè¿›è¡Œæƒé™æ§åˆ¶ã€‚ @Overrideprotected void configure(HttpSecurity http) throws Exception &#123; http //å…³é—­csrf .csrf().disable() //ä¸é€šè¿‡Sessionè·å–SecurityContext .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS) .and() .authorizeRequests() // å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—® .antMatchers(&quot;/user/login&quot;).anonymous() .antMatchers(&quot;/testCors&quot;).hasAuthority(&quot;system:dept:list222&quot;) // é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯ .anyRequest().authenticated(); //æ·»åŠ è¿‡æ»¤å™¨ http.addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class); //é…ç½®å¼‚å¸¸å¤„ç†å™¨ http.exceptionHandling() //é…ç½®è®¤è¯å¤±è´¥å¤„ç†å™¨ .authenticationEntryPoint(authenticationEntryPoint) .accessDeniedHandler(accessDeniedHandler); //å…è®¸è·¨åŸŸ http.cors();&#125; CSRFâ€‹ CSRFæ˜¯æŒ‡è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCross-site request forgeryï¼‰ï¼Œæ˜¯webå¸¸è§çš„æ”»å‡»ä¹‹ä¸€ã€‚ â€‹ https://blog.csdn.net/freeking101/article/details/86537087 â€‹ SpringSecurityå»é˜²æ­¢CSRFæ”»å‡»çš„æ–¹å¼å°±æ˜¯é€šè¿‡csrf_tokenã€‚åç«¯ä¼šç”Ÿæˆä¸€ä¸ªcsrf_tokenï¼Œå‰ç«¯å‘èµ·è¯·æ±‚çš„æ—¶å€™éœ€è¦æºå¸¦è¿™ä¸ªcsrf_token,åç«¯ä¼šæœ‰è¿‡æ»¤å™¨è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœæ²¡æœ‰æºå¸¦æˆ–è€…æ˜¯ä¼ªé€ çš„å°±ä¸å…è®¸è®¿é—®ã€‚ â€‹ æˆ‘ä»¬å¯ä»¥å‘ç°CSRFæ”»å‡»ä¾é çš„æ˜¯cookieä¸­æ‰€æºå¸¦çš„è®¤è¯ä¿¡æ¯ã€‚ä½†æ˜¯åœ¨å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ä¸­æˆ‘ä»¬çš„è®¤è¯ä¿¡æ¯å…¶å®æ˜¯tokenï¼Œè€Œtokenå¹¶ä¸æ˜¯å­˜å‚¨ä¸­cookieä¸­ï¼Œå¹¶ä¸”éœ€è¦å‰ç«¯ä»£ç å»æŠŠtokenè®¾ç½®åˆ°è¯·æ±‚å¤´ä¸­æ‰å¯ä»¥ï¼Œæ‰€ä»¥CSRFæ”»å‡»ä¹Ÿå°±ä¸ç”¨æ‹…å¿ƒäº†ã€‚ è®¤è¯æˆåŠŸå¤„ç†å™¨â€‹ å®é™…ä¸Šåœ¨UsernamePasswordAuthenticationFilterè¿›è¡Œç™»å½•è®¤è¯çš„æ—¶å€™ï¼Œå¦‚æœç™»å½•æˆåŠŸäº†æ˜¯ä¼šè°ƒç”¨AuthenticationSuccessHandlerçš„æ–¹æ³•è¿›è¡Œè®¤è¯æˆåŠŸåçš„å¤„ç†çš„ã€‚AuthenticationSuccessHandlerå°±æ˜¯ç™»å½•æˆåŠŸå¤„ç†å™¨ã€‚ â€‹ æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å»è‡ªå®šä¹‰æˆåŠŸå¤„ç†å™¨è¿›è¡ŒæˆåŠŸåçš„ç›¸åº”å¤„ç†ã€‚ @Componentpublic class SGSuccessHandler implements AuthenticationSuccessHandler &#123; @Override public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException &#123; System.out.println(&quot;è®¤è¯æˆåŠŸäº†&quot;); &#125;&#125; @Configurationpublic class SecurityConfig extends WebSecurityConfigurerAdapter &#123; @Autowired private AuthenticationSuccessHandler successHandler; @Override protected void configure(HttpSecurity http) throws Exception &#123; http.formLogin().successHandler(successHandler); http.authorizeRequests().anyRequest().authenticated(); &#125;&#125; è®¤è¯å¤±è´¥å¤„ç†å™¨â€‹ å®é™…ä¸Šåœ¨UsernamePasswordAuthenticationFilterè¿›è¡Œç™»å½•è®¤è¯çš„æ—¶å€™ï¼Œå¦‚æœè®¤è¯å¤±è´¥äº†æ˜¯ä¼šè°ƒç”¨AuthenticationFailureHandlerçš„æ–¹æ³•è¿›è¡Œè®¤è¯å¤±è´¥åçš„å¤„ç†çš„ã€‚AuthenticationFailureHandlerå°±æ˜¯ç™»å½•å¤±è´¥å¤„ç†å™¨ã€‚ â€‹ æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å»è‡ªå®šä¹‰å¤±è´¥å¤„ç†å™¨è¿›è¡Œå¤±è´¥åçš„ç›¸åº”å¤„ç†ã€‚ @Componentpublic class SGFailureHandler implements AuthenticationFailureHandler &#123; @Override public void onAuthenticationFailure(HttpServletRequest request, HttpServletResponse response, AuthenticationException exception) throws IOException, ServletException &#123; System.out.println(&quot;è®¤è¯å¤±è´¥äº†&quot;); &#125;&#125; @Configurationpublic class SecurityConfig extends WebSecurityConfigurerAdapter &#123; @Autowired private AuthenticationSuccessHandler successHandler; @Autowired private AuthenticationFailureHandler failureHandler; @Override protected void configure(HttpSecurity http) throws Exception &#123; http.formLogin()// é…ç½®è®¤è¯æˆåŠŸå¤„ç†å™¨ .successHandler(successHandler)// é…ç½®è®¤è¯å¤±è´¥å¤„ç†å™¨ .failureHandler(failureHandler); http.authorizeRequests().anyRequest().authenticated(); &#125;&#125; ç™»å‡ºæˆåŠŸå¤„ç†å™¨@Componentpublic class SGLogoutSuccessHandler implements LogoutSuccessHandler &#123; @Override public void onLogoutSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException &#123; System.out.println(&quot;æ³¨é”€æˆåŠŸ&quot;); &#125;&#125; @Configurationpublic class SecurityConfig extends WebSecurityConfigurerAdapter &#123; @Autowired private AuthenticationSuccessHandler successHandler; @Autowired private AuthenticationFailureHandler failureHandler; @Autowired private LogoutSuccessHandler logoutSuccessHandler; @Override protected void configure(HttpSecurity http) throws Exception &#123; http.formLogin()// é…ç½®è®¤è¯æˆåŠŸå¤„ç†å™¨ .successHandler(successHandler)// é…ç½®è®¤è¯å¤±è´¥å¤„ç†å™¨ .failureHandler(failureHandler); http.logout() //é…ç½®æ³¨é”€æˆåŠŸå¤„ç†å™¨ .logoutSuccessHandler(logoutSuccessHandler); http.authorizeRequests().anyRequest().authenticated(); &#125;&#125; å…¶ä»–è®¤è¯æ–¹æ¡ˆç•…æƒ³7. æºç è®²è§£â€‹ æŠ•ç¥¨è¿‡50æ›´æ–°æºç è®²è§£"},{"title":"","date":"2023-04-13T08:07:24.870Z","updated":"2023-04-13T08:07:24.852Z","comments":true,"path":"notes/elasticsearch.html","permalink":"https://aqu.iyunmc.cn/notes/elasticsearch","excerpt":"","text":"elasticsearchä»€ä¹ˆæ˜¯elasticsearchï¼Ÿ ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æœç´¢å¼•æ“ï¼Œå¯ä»¥ç”¨æ¥å®ç°æœç´¢ã€æ—¥å¿—ç»Ÿè®¡ã€åˆ†æã€ç³»ç»Ÿç›‘æ§ç­‰åŠŸèƒ½ ä»€ä¹ˆæ˜¯elastic stackï¼ˆELKï¼‰ï¼Ÿ æ˜¯ä»¥elasticsearchä¸ºæ ¸å¿ƒçš„æŠ€æœ¯æ ˆï¼ŒåŒ…æ‹¬beatsã€Logstashã€kibanaã€elasticsearch ä»€ä¹ˆæ˜¯Luceneï¼Ÿ æ˜¯Apacheçš„å¼€æºæœç´¢å¼•æ“ç±»åº“ï¼Œæä¾›äº†æœç´¢å¼•æ“çš„æ ¸å¿ƒAPI æ­£å‘ç´¢å¼•å’Œå€’æ’ç´¢å¼•ä»€ä¹ˆæ˜¯æ–‡æ¡£å’Œè¯æ¡ï¼Ÿ æ¯ä¸€æ¡æ•°æ®å°±æ˜¯ä¸€ä¸ªæ–‡æ¡£ å¯¹æ–‡æ¡£ä¸­çš„å†…å®¹åˆ†è¯ï¼Œå¾—åˆ°çš„è¯è¯­å°±æ˜¯è¯æ¡ ä»€ä¹ˆæ˜¯æ­£å‘ç´¢å¼•ï¼Ÿ åŸºäºæ–‡æ¡£idåˆ›å»ºç´¢å¼•ï¼ŒæŸ¥è¯¢è¯æ¡æ—¶å¿…é¡»å…ˆæ‰¾åˆ°æ–‡æ¡£ï¼Œè€Œååˆ¤æ–­æ˜¯å¦åŒ…å«è¯æ¡ ä»€ä¹ˆæ˜¯å€’æ’ç´¢å¼•ï¼Ÿ å¯¹æ–‡æ¡£å†…å®¹åˆ†è¯ï¼Œå¯¹è¯æ¡åˆ›å»ºç´¢å¼•ï¼Œå¹¶è®°å½•è¯æ¡æ‰€åœ¨æ–‡æ¡£çš„ä¿¡æ¯ æŸ¥è¯¢æ—¶å…ˆæ ¹æ®è¯æ¡æŸ¥è¯¢åˆ°æ–‡æ¡£idï¼Œè€Œåè·å–åˆ°æ–‡æ¡£ elasticsearchä¸æ•°æ®åº“çš„å…³ç³» æ•°æ®åº“è´Ÿè´£äº‹åŠ¡ç±»å‹æ“ä½œ elasticsearchè´Ÿè´£æµ·é‡æ•°æ®çš„æœç´¢ã€fen&#39;xi"},{"title":"","date":"2023-06-04T12:03:46.840Z","updated":"2023-06-04T12:03:46.840Z","comments":true,"path":"notes/å®‰è£…elasticsearch.html","permalink":"https://aqu.iyunmc.cn/notes/%E5%AE%89%E8%A3%85elasticsearch","excerpt":"","text":"å®‰è£…elasticsearch1.éƒ¨ç½²å•ç‚¹es1.1.åˆ›å»ºç½‘ç»œå› ä¸ºæˆ‘ä»¬è¿˜éœ€è¦éƒ¨ç½²kibanaå®¹å™¨ï¼Œå› æ­¤éœ€è¦è®©eså’Œkibanaå®¹å™¨äº’è”ã€‚è¿™é‡Œå…ˆåˆ›å»ºä¸€ä¸ªç½‘ç»œï¼š docker network create es-net 1.2.åŠ è½½é•œåƒè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨elasticsearchçš„7.12.1ç‰ˆæœ¬çš„é•œåƒï¼Œè¿™ä¸ªé•œåƒä½“ç§¯éå¸¸å¤§ï¼Œæ¥è¿‘1Gã€‚ä¸å»ºè®®å¤§å®¶è‡ªå·±pullã€‚ è¯¾å‰èµ„æ–™æä¾›äº†é•œåƒçš„taråŒ…ï¼š å¤§å®¶å°†å…¶ä¸Šä¼ åˆ°è™šæ‹Ÿæœºä¸­ï¼Œç„¶åè¿è¡Œå‘½ä»¤åŠ è½½å³å¯ï¼š # å¯¼å…¥æ•°æ®docker load -i es.tar åŒç†è¿˜æœ‰kibanaçš„taråŒ…ä¹Ÿéœ€è¦è¿™æ ·åšã€‚ 1.3.è¿è¡Œè¿è¡Œdockerå‘½ä»¤ï¼Œéƒ¨ç½²å•ç‚¹esï¼š docker run -d \\ --name es \\ -e &quot;ES_JAVA_OPTS=-Xms128m -Xmx256m&quot; \\ -e &quot;discovery.type=single-node&quot; \\ -v es-data:/usr/share/elasticsearch/data \\ -v es-plugins:/usr/share/elasticsearch/plugins \\ --privileged \\ --network es-net \\ -p 9200:9200 \\ -p 9300:9300 \\elasticsearch:7.12.1 å‘½ä»¤è§£é‡Šï¼š -e &quot;cluster.name=es-docker-cluster&quot;ï¼šè®¾ç½®é›†ç¾¤åç§° -e &quot;http.host=0.0.0.0&quot;ï¼šç›‘å¬çš„åœ°å€ï¼Œå¯ä»¥å¤–ç½‘è®¿é—® -e &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;ï¼šå†…å­˜å¤§å° -e &quot;discovery.type=single-node&quot;ï¼šéé›†ç¾¤æ¨¡å¼ -v es-data:/usr/share/elasticsearch/dataï¼šæŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®šesçš„æ•°æ®ç›®å½• -v es-logs:/usr/share/elasticsearch/logsï¼šæŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®šesçš„æ—¥å¿—ç›®å½• -v es-plugins:/usr/share/elasticsearch/pluginsï¼šæŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®šesçš„æ’ä»¶ç›®å½• --privilegedï¼šæˆäºˆé€»è¾‘å·è®¿é—®æƒ --network es-net ï¼šåŠ å…¥ä¸€ä¸ªåä¸ºes-netçš„ç½‘ç»œä¸­ -p 9200:9200ï¼šç«¯å£æ˜ å°„é…ç½® åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ï¼šhttp://192.168.150.101:9200 å³å¯çœ‹åˆ°elasticsearchçš„å“åº”ç»“æœï¼š 2.éƒ¨ç½²kibanakibanaå¯ä»¥ç»™æˆ‘ä»¬æä¾›ä¸€ä¸ªelasticsearchçš„å¯è§†åŒ–ç•Œé¢ï¼Œä¾¿äºæˆ‘ä»¬å­¦ä¹ ã€‚ 2.1.éƒ¨ç½²è¿è¡Œdockerå‘½ä»¤ï¼Œéƒ¨ç½²kibana docker run -d \\--name kibana \\-e ELASTICSEARCH_HOSTS=http://es:9200 \\--network=es-net \\-p 5601:5601 \\kibana:7.10.1 --network es-net ï¼šåŠ å…¥ä¸€ä¸ªåä¸ºes-netçš„ç½‘ç»œä¸­ï¼Œä¸elasticsearchåœ¨åŒä¸€ä¸ªç½‘ç»œä¸­ -e ELASTICSEARCH_HOSTS=http://es:9200&quot;ï¼šè®¾ç½®elasticsearchçš„åœ°å€ï¼Œå› ä¸ºkibanaå·²ç»ä¸elasticsearchåœ¨ä¸€ä¸ªç½‘ç»œï¼Œå› æ­¤å¯ä»¥ç”¨å®¹å™¨åç›´æ¥è®¿é—®elasticsearch -p 5601:5601ï¼šç«¯å£æ˜ å°„é…ç½® kibanaå¯åŠ¨ä¸€èˆ¬æ¯”è¾ƒæ…¢ï¼Œéœ€è¦å¤šç­‰å¾…ä¸€ä¼šï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤ï¼š docker logs -f kibana æŸ¥çœ‹è¿è¡Œæ—¥å¿—ï¼Œå½“æŸ¥çœ‹åˆ°ä¸‹é¢çš„æ—¥å¿—ï¼Œè¯´æ˜æˆåŠŸï¼š æ­¤æ—¶ï¼Œåœ¨æµè§ˆå™¨è¾“å…¥åœ°å€è®¿é—®ï¼šhttp://192.168.150.101:5601ï¼Œå³å¯çœ‹åˆ°ç»“æœ 2.2.DevToolskibanaä¸­æä¾›äº†ä¸€ä¸ªDevToolsç•Œé¢ï¼š è¿™ä¸ªç•Œé¢ä¸­å¯ä»¥ç¼–å†™DSLæ¥æ“ä½œelasticsearchã€‚å¹¶ä¸”å¯¹DSLè¯­å¥æœ‰è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ã€‚ 3.å®‰è£…IKåˆ†è¯å™¨3.1.åœ¨çº¿å®‰è£…ikæ’ä»¶ï¼ˆè¾ƒæ…¢ï¼‰# è¿›å…¥å®¹å™¨å†…éƒ¨docker exec -it elasticsearch /bin/bash# åœ¨çº¿ä¸‹è½½å¹¶å®‰è£…./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.12.1/elasticsearch-analysis-ik-7.12.1.zip#é€€å‡ºexit#é‡å¯å®¹å™¨docker restart elasticsearch 3.2.ç¦»çº¿å®‰è£…ikæ’ä»¶ï¼ˆæ¨èï¼‰1ï¼‰æŸ¥çœ‹æ•°æ®å·ç›®å½•å®‰è£…æ’ä»¶éœ€è¦çŸ¥é“elasticsearchçš„pluginsç›®å½•ä½ç½®ï¼Œè€Œæˆ‘ä»¬ç”¨äº†æ•°æ®å·æŒ‚è½½ï¼Œå› æ­¤éœ€è¦æŸ¥çœ‹elasticsearchçš„æ•°æ®å·ç›®å½•ï¼Œé€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹: docker volume inspect es-plugins æ˜¾ç¤ºç»“æœï¼š [ &#123; &quot;CreatedAt&quot;: &quot;2022-05-06T10:06:34+08:00&quot;, &quot;Driver&quot;: &quot;local&quot;, &quot;Labels&quot;: null, &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/es-plugins/_data&quot;, &quot;Name&quot;: &quot;es-plugins&quot;, &quot;Options&quot;: null, &quot;Scope&quot;: &quot;local&quot; &#125;] è¯´æ˜pluginsç›®å½•è¢«æŒ‚è½½åˆ°äº†ï¼š/var/lib/docker/volumes/es-plugins/_data è¿™ä¸ªç›®å½•ä¸­ã€‚ 2ï¼‰è§£å‹ç¼©åˆ†è¯å™¨å®‰è£…åŒ…ä¸‹é¢æˆ‘ä»¬éœ€è¦æŠŠè¯¾å‰èµ„æ–™ä¸­çš„ikåˆ†è¯å™¨è§£å‹ç¼©ï¼Œé‡å‘½åä¸ºik 3ï¼‰ä¸Šä¼ åˆ°eså®¹å™¨çš„æ’ä»¶æ•°æ®å·ä¸­ä¹Ÿå°±æ˜¯/var/lib/docker/volumes/es-plugins/_data ï¼š 4ï¼‰é‡å¯å®¹å™¨# 4ã€é‡å¯å®¹å™¨docker restart es # æŸ¥çœ‹esæ—¥å¿—docker logs -f es 5ï¼‰æµ‹è¯•ï¼šIKåˆ†è¯å™¨åŒ…å«ä¸¤ç§æ¨¡å¼ï¼š ik_smartï¼šæœ€å°‘åˆ‡åˆ† ik_max_wordï¼šæœ€ç»†åˆ‡åˆ† GET /_analyze&#123; &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;text&quot;: &quot;é»‘é©¬ç¨‹åºå‘˜å­¦ä¹ javaå¤ªæ£’äº†&quot;&#125; ç»“æœï¼š &#123; &quot;tokens&quot; : [ &#123; &quot;token&quot; : &quot;é»‘é©¬&quot;, &quot;start_offset&quot; : 0, &quot;end_offset&quot; : 2, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 0 &#125;, &#123; &quot;token&quot; : &quot;ç¨‹åºå‘˜&quot;, &quot;start_offset&quot; : 2, &quot;end_offset&quot; : 5, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 1 &#125;, &#123; &quot;token&quot; : &quot;ç¨‹åº&quot;, &quot;start_offset&quot; : 2, &quot;end_offset&quot; : 4, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 2 &#125;, &#123; &quot;token&quot; : &quot;å‘˜&quot;, &quot;start_offset&quot; : 4, &quot;end_offset&quot; : 5, &quot;type&quot; : &quot;CN_CHAR&quot;, &quot;position&quot; : 3 &#125;, &#123; &quot;token&quot; : &quot;å­¦ä¹ &quot;, &quot;start_offset&quot; : 5, &quot;end_offset&quot; : 7, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 4 &#125;, &#123; &quot;token&quot; : &quot;java&quot;, &quot;start_offset&quot; : 7, &quot;end_offset&quot; : 11, &quot;type&quot; : &quot;ENGLISH&quot;, &quot;position&quot; : 5 &#125;, &#123; &quot;token&quot; : &quot;å¤ªæ£’äº†&quot;, &quot;start_offset&quot; : 11, &quot;end_offset&quot; : 14, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 6 &#125;, &#123; &quot;token&quot; : &quot;å¤ªæ£’&quot;, &quot;start_offset&quot; : 11, &quot;end_offset&quot; : 13, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 7 &#125;, &#123; &quot;token&quot; : &quot;äº†&quot;, &quot;start_offset&quot; : 13, &quot;end_offset&quot; : 14, &quot;type&quot; : &quot;CN_CHAR&quot;, &quot;position&quot; : 8 &#125; ]&#125; 3.3 æ‰©å±•è¯è¯å…¸éšç€äº’è”ç½‘çš„å‘å±•ï¼Œâ€œé€ è¯è¿åŠ¨â€ä¹Ÿè¶Šå‘çš„é¢‘ç¹ã€‚å‡ºç°äº†å¾ˆå¤šæ–°çš„è¯è¯­ï¼Œåœ¨åŸæœ‰çš„è¯æ±‡åˆ—è¡¨ä¸­å¹¶ä¸å­˜åœ¨ã€‚æ¯”å¦‚ï¼šâ€œå¥¥åŠ›ç»™â€ï¼Œâ€œä¼ æ™ºæ’­å®¢â€ ç­‰ã€‚ æ‰€ä»¥æˆ‘ä»¬çš„è¯æ±‡ä¹Ÿéœ€è¦ä¸æ–­çš„æ›´æ–°ï¼ŒIKåˆ†è¯å™¨æä¾›äº†æ‰©å±•è¯æ±‡çš„åŠŸèƒ½ã€‚ 1ï¼‰æ‰“å¼€IKåˆ†è¯å™¨configç›®å½•ï¼š 2ï¼‰åœ¨IKAnalyzer.cfg.xmlé…ç½®æ–‡ä»¶å†…å®¹æ·»åŠ ï¼š &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE properties SYSTEM &quot;http://java.sun.com/dtd/properties.dtd&quot;&gt;&lt;properties&gt; &lt;comment&gt;IK Analyzer æ‰©å±•é…ç½®&lt;/comment&gt; &lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸ *** æ·»åŠ æ‰©å±•è¯å…¸--&gt; &lt;entry key=&quot;ext_dict&quot;&gt;ext.dic&lt;/entry&gt;&lt;/properties&gt; 3ï¼‰æ–°å»ºä¸€ä¸ª ext.dicï¼Œå¯ä»¥å‚è€ƒconfigç›®å½•ä¸‹å¤åˆ¶ä¸€ä¸ªé…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ ä¼ æ™ºæ’­å®¢å¥¥åŠ›ç»™ 4ï¼‰é‡å¯elasticsearch docker restart es# æŸ¥çœ‹ æ—¥å¿—docker logs -f elasticsearch æ—¥å¿—ä¸­å·²ç»æˆåŠŸåŠ è½½ext.dicé…ç½®æ–‡ä»¶ 5ï¼‰æµ‹è¯•æ•ˆæœï¼š GET /_analyze&#123; &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;text&quot;: &quot;ä¼ æ™ºæ’­å®¢Javaå°±ä¸šè¶…è¿‡90%,å¥¥åŠ›ç»™ï¼&quot;&#125; æ³¨æ„å½“å‰æ–‡ä»¶çš„ç¼–ç å¿…é¡»æ˜¯ UTF-8 æ ¼å¼ï¼Œä¸¥ç¦ä½¿ç”¨Windowsè®°äº‹æœ¬ç¼–è¾‘ 3.4 åœç”¨è¯è¯å…¸åœ¨äº’è”ç½‘é¡¹ç›®ä¸­ï¼Œåœ¨ç½‘ç»œé—´ä¼ è¾“çš„é€Ÿåº¦å¾ˆå¿«ï¼Œæ‰€ä»¥å¾ˆå¤šè¯­è¨€æ˜¯ä¸å…è®¸åœ¨ç½‘ç»œä¸Šä¼ é€’çš„ï¼Œå¦‚ï¼šå…³äºå®—æ•™ã€æ”¿æ²»ç­‰æ•æ„Ÿè¯è¯­ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨æœç´¢æ—¶ä¹Ÿåº”è¯¥å¿½ç•¥å½“å‰è¯æ±‡ã€‚ IKåˆ†è¯å™¨ä¹Ÿæä¾›äº†å¼ºå¤§çš„åœç”¨è¯åŠŸèƒ½ï¼Œè®©æˆ‘ä»¬åœ¨ç´¢å¼•æ—¶å°±ç›´æ¥å¿½ç•¥å½“å‰çš„åœç”¨è¯æ±‡è¡¨ä¸­çš„å†…å®¹ã€‚ 1ï¼‰IKAnalyzer.cfg.xmlé…ç½®æ–‡ä»¶å†…å®¹æ·»åŠ ï¼š &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE properties SYSTEM &quot;http://java.sun.com/dtd/properties.dtd&quot;&gt;&lt;properties&gt; &lt;comment&gt;IK Analyzer æ‰©å±•é…ç½®&lt;/comment&gt; &lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸--&gt; &lt;entry key=&quot;ext_dict&quot;&gt;ext.dic&lt;/entry&gt; &lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•åœæ­¢è¯å­—å…¸ *** æ·»åŠ åœç”¨è¯è¯å…¸--&gt; &lt;entry key=&quot;ext_stopwords&quot;&gt;stopword.dic&lt;/entry&gt;&lt;/properties&gt; 3ï¼‰åœ¨ stopword.dic æ·»åŠ åœç”¨è¯ ä¹ å¤§å¤§ 4ï¼‰é‡å¯elasticsearch # é‡å¯æœåŠ¡docker restart elasticsearchdocker restart kibana# æŸ¥çœ‹ æ—¥å¿—docker logs -f elasticsearch æ—¥å¿—ä¸­å·²ç»æˆåŠŸåŠ è½½stopword.dicé…ç½®æ–‡ä»¶ 5ï¼‰æµ‹è¯•æ•ˆæœï¼š GET /_analyze&#123; &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;text&quot;: &quot;ä¼ æ™ºæ’­å®¢Javaå°±ä¸šç‡è¶…è¿‡95%,ä¹ å¤§å¤§éƒ½ç‚¹èµ,å¥¥åŠ›ç»™ï¼&quot;&#125; æ³¨æ„å½“å‰æ–‡ä»¶çš„ç¼–ç å¿…é¡»æ˜¯ UTF-8 æ ¼å¼ï¼Œä¸¥ç¦ä½¿ç”¨Windowsè®°äº‹æœ¬ç¼–è¾‘ 4.éƒ¨ç½²esé›†ç¾¤éƒ¨ç½²esé›†ç¾¤å¯ä»¥ç›´æ¥ä½¿ç”¨docker-composeæ¥å®Œæˆï¼Œä¸è¿‡è¦æ±‚ä½ çš„Linuxè™šæ‹Ÿæœºè‡³å°‘æœ‰4Gçš„å†…å­˜ç©ºé—´ é¦–å…ˆç¼–å†™ä¸€ä¸ªdocker-composeæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š version: &#x27;2.2&#x27;services: es01: image: docker.elastic.co/elasticsearch/elasticsearch:7.12.1 container_name: es01 environment: - node.name=es01 - cluster.name=es-docker-cluster - discovery.seed_hosts=es02,es03 - cluster.initial_master_nodes=es01,es02,es03 - bootstrap.memory_lock=true - &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot; ulimits: memlock: soft: -1 hard: -1 volumes: - data01:/usr/share/elasticsearch/data ports: - 9200:9200 networks: - elastic es02: image: docker.elastic.co/elasticsearch/elasticsearch:7.12.1 container_name: es02 environment: - node.name=es02 - cluster.name=es-docker-cluster - discovery.seed_hosts=es01,es03 - cluster.initial_master_nodes=es01,es02,es03 - bootstrap.memory_lock=true - &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot; ulimits: memlock: soft: -1 hard: -1 volumes: - data02:/usr/share/elasticsearch/data networks: - elastic es03: image: docker.elastic.co/elasticsearch/elasticsearch:7.12.1 container_name: es03 environment: - node.name=es03 - cluster.name=es-docker-cluster - discovery.seed_hosts=es01,es02 - cluster.initial_master_nodes=es01,es02,es03 - bootstrap.memory_lock=true - &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot; ulimits: memlock: soft: -1 hard: -1 volumes: - data03:/usr/share/elasticsearch/data networks: - elasticvolumes: data01: driver: local data02: driver: local data03: driver: localnetworks: elastic: driver: bridge Run docker-compose to bring up the cluster: docker-compose up"},{"title":"","date":"2023-06-04T11:49:18.140Z","updated":"2023-06-04T11:49:18.140Z","comments":true,"path":"notes/index.html","permalink":"https://aqu.iyunmc.cn/notes/","excerpt":"","text":""},{"title":"","date":"2023-05-31T09:01:21.418Z","updated":"2023-05-31T09:00:14.119Z","comments":true,"path":"notes/ç½‘å…³çš„ä½œç”¨.html","permalink":"https://aqu.iyunmc.cn/notes/%E7%BD%91%E5%85%B3%E7%9A%84%E4%BD%9C%E7%94%A8","excerpt":"","text":"1. ç½‘å…³çš„ä½œç”¨ å¯¹ç”¨æˆ·è¯·æ±‚åšèº«ä»½è®¤è¯ã€æƒé™æ ¡éªŒ å°†ç”¨æˆ·è¯·æ±‚è·¯ç”±åˆ°å¾®æœåŠ¡ï¼Œå¹¶å®ç°è´Ÿè½½å‡è¡¡ å¯¹ç”¨æˆ·è¯·æ±‚åšé™æµ 2. æ­å»ºç½‘å…³æœåŠ¡ç½‘å…³æ­å»ºæ­¥éª¤ åˆ›å»ºé¡¹ç›®ï¼Œå¼•å…¥nacosæœåŠ¡å‘ç°å’Œgatewayä¾èµ– &lt;dependencies&gt; &lt;!-- nacosæœåŠ¡æ³¨å†Œå‘ç°ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- ç½‘å…³gatewayä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; é…ç½®application.ymlï¼ŒåŒ…æ‹¬æœåŠ¡åŸºæœ¬ä¿¡æ¯ã€nacosåœ°å€ã€è·¯ç”± application: name: gatewaycloud: nacos: server-addr: localhost:8848 gateway: routes: - id: user-service # è·¯ç”±è¡¨å¿…é¡»æ˜¯å”¯ä¸€çš„ uri: lb://userservice # è·¯ç”±çš„ç›®æ ‡åœ°å€ predicates: # è·¯ç”±æ–­è¨€ï¼Œåˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆè§„åˆ™ - Path=/user/** #è·¯å¾„æ–­è¨€ï¼Œåˆ¤æ–­è·¯å¾„æ˜¯å¦ä»¥/userå¼€å¤´ - id: order-service uri: lb://orderservice predicates: - Path=/order/** 3. è¿‡æ»¤å™¨å·¥å‚è¿‡æ»¤å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ å¯¹è·¯ç”±çš„è¯·æ±‚æˆ–å“åº”åšåŠ å·¥å¤„ç†ï¼Œæ¯”å¦‚æ·»åŠ è¯·æ±‚å¤´ é…ç½®åœ¨è·¯ç”±ä¸‹çš„è¿‡æ»¤å™¨åªå¯¹å½“å‰è·¯ç”±çš„è¯·æ±‚ç”Ÿæ•ˆ defaultFiltersçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ å¯¹æ‰€æœ‰è·¯ç”±éƒ½ç”Ÿæ•ˆçš„è¿‡æ»¤å™¨ 4. å…¨å±€è¿‡æ»¤å™¨å…¨å±€è¿‡æ»¤å™¨çš„ä½œç”¨ å¯¹æ‰€æœ‰è·¯ç”±éƒ½ç”Ÿæ•ˆçš„è¿‡æ»¤å™¨ï¼Œå¹¶ä¸”å¯ä»¥è‡ªå®šä¹‰å¤„ç†é€»è¾‘ å®ç°å…¨å±€è¿‡æ»¤å™¨çš„æ­¥éª¤ å®ç°GlobalFilteræ¥å£ æ·»åŠ @Orderæ³¨è§£æˆ–å®ç°Orderedæ¥å£ ç¼–å†™å¤„ç†é€»è¾‘ @Order(-1)@Componentpublic class AuthorizeFilter implements GlobalFilter &#123; @Override public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123; // 1.è·å–è¯·æ±‚å‚æ•° ServerHttpRequest request = exchange.getRequest(); MultiValueMap&lt;String, String&gt; queryParams = request.getQueryParams(); // 2.è·å–å‚æ•°ä¸­çš„authorizationå‚æ•° String auth = queryParams.getFirst(&quot;authorization&quot;); // 3.åˆ¤æ–­å‚æ•°å€¼æ˜¯å¦ç­‰äºadmin if (&quot;admin&quot;.equals(auth)) &#123; // 4.æ˜¯ï¼Œæ”¾è¡Œ return chain.filter(exchange); &#125; // 5.å¦ï¼Œæ‹¦æˆª // 5.1 è®¾ç½®çŠ¶æ€ç  exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED); // 5.2 æ‹¦æˆªè¯·æ±‚ return exchange.getResponse().setComplete(); &#125;&#125; 5. è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº æ¯ä¸€ä¸ªè¿‡æ»¤å™¨éƒ½å¿…é¡»æŒ‡å®šä¸€ä¸ªintç±»å‹çš„orderå€¼ï¼Œorderå€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œæ‰§è¡Œé¡ºåºè¶Šé å‰ã€‚ GlobalFilteré€šè¿‡å®ç°Orderedæ¥å£ï¼Œæˆ–è€…æ·»åŠ @Orderæ³¨è§£æ¥æŒ‡å®šorderå€¼ï¼Œç”±æˆ‘ä»¬è‡ªå·±æŒ‡å®š è·¯ç”±è¿‡æ»¤å™¨å’ŒdefaultFilterçš„orderç”±SpringæŒ‡å®šï¼Œé»˜è®¤æ˜¯æŒ‰ç…§ç”Ÿå‘½é¡ºåºä»1é€’å¢ å½“è¿‡æ»¤å™¨çš„orderå€¼ä¸€æ ·æ—¶ï¼Œä¼šæŒ‰ç…§defaultFilter &gt; è·¯ç”±è¿‡æ»¤å™¨ &gt; GlobalFilterçš„é¡ºåºæ‰§è¡Œ"},{"title":"","date":"2023-06-04T11:56:20.125Z","updated":"2023-06-04T11:56:20.125Z","comments":true,"path":"notes/é¢è¯•1.html","permalink":"https://aqu.iyunmc.cn/notes/%E9%9D%A2%E8%AF%951","excerpt":"","text":"RedisRedisçš„æ•°æ®æŒä¹…åŒ–ç­–ç•¥æœ‰å“ªäº›ï¼Ÿæˆ‘çœ‹ä½ åšçš„é¡¹ç›®ä¸­ï¼Œéƒ½ç”¨åˆ°äº†redisï¼Œä½ åœ¨é¡¹ç›®ä¸­ç»™ä½ é‚£äº›åœºæ™¯ä½¿ç”¨äº†Rediså‘¢ï¼Ÿå¦‚æœå‘ç”Ÿäº†ç¼“å­˜ç©¿é€ã€å‡»ç©¿ã€é›ªå´©å¦‚ä½•è§£å†³å‘¢ï¼Ÿç¼“å­˜ç©¿é€ï¼š æŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„æ•°æ®ï¼Œmysqlä¸­ä¹ŸæŸ¥è¯¢ä¸åˆ°æ•°æ®ä¹Ÿä¸ä¼šç›´æ¥å†™å…¥ç¼“å­˜ï¼Œå°±ä¼šå¯¼è‡´æ¯æ¬¡è¯·æ±‚éƒ½æŸ¥æ•°æ®åº“ è§£å†³æ–¹æ¡ˆï¼š æ–¹æ¡ˆä¸€ï¼šç¼“å­˜ç©ºæ•°æ®ï¼ŒæŸ¥è¯¢è¿”å›çš„æ•°æ®ä¸ºç©ºï¼Œä»æŠŠè¿™ä¸ªç©ºç»“æœè¿›è¡Œç¼“å­˜ï¼ˆæ¶ˆè€—å†…å­˜ï¼Œå¯èƒ½ä¼šå‘é€ä¸ä¸€è‡´çš„é—®é¢˜ï¼‰ æ–¹æ¡ˆäºŒï¼šå¸ƒéš†è¿‡æ»¤å™¨ï¼šå½“æ ¹æ®idæŸ¥è¯¢æ—¶ ç¼“å­˜å‡»ç©¿ï¼šç»™æŸä¸€ä¸ªkeyè®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œå½“keyè¿‡æœŸæ—¶ï¼Œæ°å¥½åœ¨è¿™ä¸ªæ—¶é—´ç‚¹å¯¹è¿™ä¸ªkeyæœ‰å¤§é‡çš„å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠDBå‹å® è§£å†³æ–¹æ¡ˆï¼š æ–¹æ¡ˆä¸€ï¼šäº’æ–¥é”ï¼Œå¼ºä¸€è‡´ï¼Œæ€§èƒ½å·® æ–¹æ¡ˆäºŒï¼šé€»è¾‘è¿‡æœŸï¼Œé«˜å¯ç”¨ï¼Œæ€§èƒ½ä¼˜ï¼Œä¸èƒ½ä¿è¯æ•°æ®ç»å¯¹ä¸€è‡´ ç¼“å­˜é›ªå´©ï¼šæŒ‡åœ¨åŒä¸€æ—¶æ®µå¤§é‡çš„ç¼“å­˜keyåŒæ—¶å¤±æ•ˆæˆ–è€…RedisæœåŠ¡å®•æœºï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚åˆ°è¾¾æ•°æ®åº“ï¼Œç»™DBå¸¦æ¥å·¨å¤§å‹åŠ› è§£å†³æ–¹æ¡ˆï¼š ç»™ä¸åŒçš„Keyçš„TTLæ·»åŠ éšæœºå€¼ åˆ©ç”¨Redisé›†ç¾¤æé«˜æœåŠ¡çš„å¯ç”¨æ€§ï¼ˆå“¨å…µæ¨¡å¼ã€é›†ç¾¤æ¨¡å¼ï¼‰ ç»™ç¼“å­˜ä¸šåŠ¡æ·»åŠ é™çº§é™æµç­–ç•¥ï¼ˆNginxã€SpringCloud Gatewayï¼‰ ç»™ä¸šåŠ¡æ·»åŠ å¤šçº§ç¼“å­˜ï¼ˆGuava&#x2F;Caffeineï¼‰ ä¼šè¢«é—®åˆ°çš„çŸ¥è¯†ç‚¹ï¼šRedisä½œä¸ºç¼“å­˜ï¼Œmysqlçš„æ•°æ®å¦‚ä½•ä¸redisè¿›è¡ŒåŒæ­¥å‘¢ï¼Ÿï¼ˆåŒå†™ä¸€è‡´æ€§ï¼‰ æˆ‘å½“æ—¶æ˜¯æŠŠé¢˜åº“è®ºå›çš„çƒ­ç‚¹æ•°æ®å­˜åˆ°äº†ç¼“å­˜å½“ä¸­ï¼Œè™½ç„¶æ˜¯çƒ­ç‚¹æ•°æ®ï¼Œä½†æ˜¯å®æ—¶è¦æ±‚æ€§å¹¶æ²¡æœ‰é‚£ä¹ˆé«˜ï¼Œæ‰€ä»¥æˆ‘å½“æ—¶é‡‡ç”¨çš„æ˜¯å¼‚æ­¥çš„æ–¹æ¡ˆåŒæ­¥çš„æ•°æ® è¿˜æœ‰å°±æ˜¯æŠ¢å·çš„åº“å­˜å†™å…¥åˆ°äº†ç¼“å­˜å½“ä¸­ï¼Œè¿™ä¸ªéœ€è¦å®æ—¶çš„è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œä¸ºäº†ä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œæˆ‘ä»¬å½“æ—¶é‡‡ç”¨çš„æ˜¯Redissonæä¾›çš„è¯»å†™é”æ¥ä¿è¯æ•°æ®çš„åŒæ­¥ é‚£ä½ ä»‹ç»ä¸€ä¸‹ä½ é¡¹ç›®å½“ä¸­å¼‚æ­¥çš„æ–¹æ¡ˆï¼ˆæ¥ä»‹ç»ä¸€ä¸‹redissonè¯»å†™é”çš„è¿™ç§æ–¹æ¡ˆï¼‰ å…è®¸å»¶æ—¶ä¸€è‡´çš„ä¸šåŠ¡ï¼Œé‡‡ç”¨å¼‚æ­¥é€šçŸ¥ ä½¿ç”¨MQä¸­é—´ä»¶ï¼Œæ›´æ–°æ•°æ®ä¹‹åï¼Œé€šçŸ¥ç¼“å­˜åˆ é™¤ åˆ©ç”¨canalä¸­é—´ä»¶ï¼Œä¸éœ€è¦ä¿®æ”¹ä¸šåŠ¡ä»£ç ï¼Œä¼ªè£…ä¸ºmysqlçš„ä¸€ä¸ªä»èŠ‚ç‚¹ï¼Œcanalé€šè¿‡è¯»å–binlogæ•°æ®æ›´æ–°ç¼“å­˜ å¼ºä¸€è‡´æ€§çš„ï¼Œé‡‡ç”¨Redissonæä¾›çš„è¯»å†™é” å…±äº«é”ï¼šè¯»é”readLockï¼ŒåŠ é”ä¹‹åï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥å…±äº«è¯»æ“ä½œ æ’ä»–é”ï¼šç‹¬å é”writeLockï¼Œæ·é”ä¹‹åï¼Œé˜»å¡å…¶ä»–çº¿ç¨‹è¯»å†™æ“ä½œ RedisæŒä¹…åŒ–redisä½œä¸ºç¼“å­˜ï¼Œæ•°æ®çš„æŒä¹…åŒ–æ˜¯å¦‚ä½•åšçš„ï¼ŸRedisæä¾›äº†ä¸¤ç§æ•°æ®æŒä¹…åŒ–çš„æ–¹å¼ï¼š RDBï¼ˆRedis Database ï¼‰ï¼šRDBæ˜¯ä¸€ä¸ªå¿«ç…§æ–‡ä»¶ï¼Œä»–æ˜¯æŠŠRediså†…å­˜å­˜å‚¨çš„æ•°æ®å†™åˆ°ç£ç›˜å½“ä¸­ï¼Œå½“rediså®ä¾‹å®•æœºæ¢å¤æ•°æ®æ—¶ï¼Œå¯ä»¥ä»rdbçš„å¿«ç…§æ–‡ä»¶ä¸­æ¢å¤æ•°æ®ã€‚ AOFï¼šAOFæ˜¯ä¸€ä¸ªè¿½åŠ æ–‡ä»¶ï¼Œå½“redisæ“ä½œå†™å‘½ä»¤çš„æ—¶å€™ï¼Œéƒ½ä¼šå­˜å‚¨åˆ°è¿™ä¸ªæ–‡ä»¶å½“ä¸­ï¼Œå½“rediså®ä¾‹å®•æœºæ¢å¤æ•°æ®çš„æ—¶å€™ä¼šä»è¿™ä¸ªæ–‡ä»¶ä¸­å†æ¬¡æ‰§è¡Œä¸€éå‘½ä»¤æ¥æ¢å¤æ•°æ®ã€‚ è¿™ä¸¤ç§æ–¹å¼ï¼Œå“ªç§æ¢å¤çš„æ¯”è¾ƒå¿«å‘¢ï¼Ÿ1RDBæ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåœ¨ä¿å­˜çš„æ—¶å€™ä½“ç§¯ä¹Ÿæ˜¯æ¯”è¾ƒå°çš„ï¼Œä»–ä¼šå°å¾—æ¯”è¾ƒå¿«ï¼Œä½†æ˜¯æœ‰å¯èƒ½ä¼šä¸¢å¤±æ•°æ®ï¼Œè€Œæˆ‘ä»¬é€šå¸¸åœ¨é¡¹ç›®ä¸­ä½¿ç”¨AOFæ¥æ¢å¤æ•°æ®ï¼Œè™½ç„¶AOFæ¢å¤çš„é€Ÿåº¦æ…¢ä¸€äº›ï¼Œä½†æ˜¯ä»–ä¸¢æ•°æ®çš„å¥‰å­è¦å°å¾ˆå¤šï¼Œåœ¨AOFæ–‡ä»¶ä¸­å¯ä»¥è®¾ç½®åˆ·ç›˜ç­–ç•¥ Redisæ•°æ®åˆ é™¤ç­–ç•¥æƒ°æ€§åˆ é™¤ï¼šè®¾ç½®è¯¥keyè¿‡æœŸæ—¶é—´åï¼Œæˆ‘ä»¬ä¸å»ç®¡ä»–ï¼Œå½“éœ€è¦è¯¥keyæ—¶ï¼Œæˆ‘ä»¬å†æ£€æŸ¥å…¶æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸï¼Œæˆ‘ä»¬å°±åˆ æ‰ä»–ï¼Œåä¹‹åˆ™è¿”å›è¯¥key ä¼˜ç‚¹ï¼šå¯¹cpuå‹å¥½ï¼Œåªä¼šåœ¨ä½¿ç”¨è¯¥keyæ—¶æ‰ä¼šè¿›è¡Œè¿‡æœŸæ£€æŸ¥ï¼Œå¯¹äºå¾ˆå¤šç”¨ä¸åˆ°çš„keyä¸ç”¨æµªè´¹æ—¶é—´è¿›è¡Œè¿‡æœŸæ£€æŸ¥ã€‚ ç¼ºç‚¹ï¼šå¯¹å†…å­˜ä¸å‹å¥½ï¼Œå¦‚æœä¸€ä¸ªkeyå·²ç»è¿‡æœŸï¼Œä½†æ˜¯ä¸€ç›´æ²¡æœ‰ä½¿ç”¨ï¼Œé‚£ä¹ˆè¯¥keyå°±ä¼šä¸€ç›´å­˜åœ¨å†…å­˜å½“ä¸­ï¼Œå†…å­˜æ°¸è¿œä¸ä¼šé‡Šæ”¾ å®šæœŸåˆ é™¤ï¼šæ¯éš”ä¸€æ®µæ—¶é—´ï¼Œå°±ä¼šå¯¹ä¸€äº›keyè¿›è¡Œæ£€æŸ¥ï¼Œåˆ é™¤é‡Œé¢è¿‡æœŸçš„keyï¼ˆä»ä¸€å®šæ•°é‡çš„æ•°æ®åº“ä¸­å–å‡ºä¸€å®šæ•°é‡çš„éšæœºkeyè¿›è¡Œæ£€æŸ¥ï¼Œå¹¶åˆ é™¤å…¶ä¸­çš„è¿‡æœŸkeyï¼‰ ä¼˜ç‚¹ï¼šå¯ä»¥é€šè¿‡é™åˆ¶åˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿å’Œé¢‘ç‡æ¥å‡å°‘åˆ é™¤æ“ä½œå¯¹cpuçš„å½±å“ï¼Œå¦å¤–å®šæœŸåˆ é™¤ï¼Œä¹Ÿèƒ½æœ‰æ•ˆé‡Šæ”¾è¿‡æœŸkeyå ç”¨çš„å†…å­˜ã€‚ ç¼ºç‚¹ï¼šéš¾ä»¥ç¡®å®šåˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿å’Œé¢‘ç‡ Redisæ•°æ®æ·˜æ±°ç­–ç•¥ LRUï¼ˆLeast Recently Usedï¼‰æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼Œç”¨å½“å‰çš„æ—¶é—´å‡å»æœ€åä¸€æ¬¡ä½¿ç”¨çš„æ—¶é—´ï¼Œå€¼è¶Šå¤§åˆ™æ·˜æ±°ä¼˜å…ˆçº§è¶Šé«˜ LFUï¼ˆLeast Frequently Usedï¼‰æœ€å°‘é¢‘ç‡ä½¿ç”¨ï¼Œä¼šç»Ÿè®¡æ¯ä¸ªkeyçš„è®¿é—®é¢‘ç‡ï¼Œå€¼è¶Šå°æ·˜æ±°ä¼˜å…ˆçº§è¶Šé«˜ ä¼šè¢«é—®åˆ°çš„çŸ¥è¯†ç‚¹ï¼šæ•°æ®åº“ä¸­æœ‰1000ä¸‡æ•°æ®ï¼Œè€ŒRedisåªèƒ½ç¼“å­˜20wæ•°æ®ï¼Œå¦‚ä½•ä¿è¯Redisä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®ï¼Ÿä½¿ç”¨allkeys-lruï¼ˆæŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ï¼‰æ·˜æ±°ç­–ç•¥ï¼Œç•™ä¸‹æ¥çš„éƒ½æ˜¯ç»å¸¸è®¿é—®çš„çƒ­ç‚¹æ•°æ® Redisçš„å†…å­˜ç”¨å®Œäº†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿä¸»è¦çœ‹æ•°æ®æ·˜æ±°ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿå¦‚æœæ˜¯é»˜è®¤çš„é…ç½®ï¼ˆnoevictionï¼‰å°±ä¼šç›´æ¥æŠ¥é”™ é¢è¯•å®˜ä½ å¥½ ä»Šå¹´xxå²"},{"title":"","date":"2023-06-06T14:16:10.675Z","updated":"2023-06-06T14:16:10.675Z","comments":true,"path":"notes/Kafka.html","permalink":"https://aqu.iyunmc.cn/notes/Kafka","excerpt":"","text":"1. Kafkaç®€ä»‹1.1 æ¶ˆæ¯é˜Ÿåˆ— æ¶ˆæ¯é˜Ÿåˆ— -- ç”¨äºå­˜æ”¾æ¶ˆæ¯çš„ç»„ä»¶ ç¨‹åºå‘˜å¯ä»¥å°†æ¶ˆæ¯æ”¾å…¥åˆ°é˜Ÿåˆ—å½“ä¸­ï¼Œä¹Ÿå¯ä»¥ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ å¾ˆå¤šæ—¶å€™æ¶ˆæ¯é˜Ÿåˆ—ä¸æ˜¯ä¸€ä¸ªæ°¸ä¹…æ€§çš„å­˜å‚¨ï¼Œæ˜¯ä½œä¸ºä¸´æ—¶å­˜å‚¨å­˜åœ¨çš„ï¼ˆè®¾å®šä¸€ä¸ªæœŸé™ï¼šè®¾ç½®æ¶ˆæ¯åœ¨MQä¸­ä¿å­˜10å¤©ï¼‰ æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶ï¼šæ¶ˆæ¯é˜Ÿåˆ—çš„ç»„ä»¶ï¼Œä¾‹å¦‚ï¼šKafkaã€Active MQã€RabbitMQã€RocketMQã€ 1.2 Kafkaçš„åº”ç”¨åœºæ™¯ å¼‚æ­¥å¤„ç† å¯ä»¥å°†ä¸€äº›æ¯”è¾ƒè€—æ—¶çš„æ“ä½œæ”¾åœ¨å…¶ä»–ç³»ç»Ÿä¸­ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å°†éœ€è¦è¿›è¡Œå¤„ç†çš„æ¶ˆæ¯è¿›è¡Œå­˜å‚¨ï¼Œå…¶ä»–ç³»ç»Ÿå¯ä»¥æ¶ˆè´¹æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ•°æ® æ¯”è¾ƒå¸¸è§çš„ï¼šå‘é€çŸ­ä¿¡éªŒè¯ç ã€å‘é€é‚®ç®±! ç³»ç»Ÿè§£è€¦ åŸå…ˆä¸€ä¸ªå¾®æœåŠ¡æ˜¯é€šè¿‡æ¥å£ï¼ˆHTTPï¼‰è°ƒç”¨å¦ä¸€ä¸ªå¾®æœåŠ¡ï¼Œè¿™æ—¶å€™è€¦åˆå¾ˆé‡è¦ï¼Œåªè¦æ¥å£å‘ç”Ÿå˜æ³•å°±ä¼šå¯¼è‡´ç³»ç»Ÿä¸å¯ç”¨ ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å°†ç³»ç»Ÿè¿›è¡Œè§£è€¦åˆï¼Œç°åœ¨ç¬¬ä¸€ä¸ªå¾®æœåŠ¡å¯ä»¥å°†æ¶ˆæ¯æ”¾å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¦ä¸€ä¸ªå¾®æœåŠ¡å¯ä»¥ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­æŠŠæ¶ˆæ¯å–å‡ºæ¥å¤„ç†ï¼Œè¿›è¡Œç³»ç»Ÿè€¦åˆ æµé‡å‰Šå³° å› ä¸ºæ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä½å»¶è¿Ÿã€é«˜å¯é ã€é«˜ååçš„ï¼Œå¯ä»¥åº”å¯¹æµ·é‡çš„å¹¶å‘ æ—¥å¿—å¤„ç† å¯ä»¥ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ä½œä¸ºä¸´æ—¶å­˜å‚¨ï¼Œæˆ–è€…ä¸€ç§é€šä¿¡ç®¡é“ 1.3 Kafkaçš„åº”ç”¨åœºæ™¯ ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…æ¨¡å‹ ç”Ÿäº§è€…è´Ÿè´£å°†æ¶ˆæ¯ç”Ÿäº§åˆ°MQä¸­ æ¶ˆè´¹è€…è´Ÿè´£ä»MQä¸­è·å–æ¶ˆæ¯ ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ˜¯è§£è€¦çš„ï¼Œå¯èƒ½æ˜¯ç”Ÿäº§è€…ä¸€ä¸ªç¨‹åºã€æ¶ˆè´¹è€…æ˜¯å¦å¤–ä¸€ä¸ªç¨‹åº æ¶ˆæ¯é˜Ÿåˆ—çš„æ¨¡å¼ ç‚¹å¯¹ç‚¹ï¼šä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ä¸€ä¸ªæ¶ˆæ¯ å‘å¸ƒè®¢é˜…ï¼šå¤šä¸ªæ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹ä¸€ä¸ªæ¶ˆæ¯ 2. ç¯å¢ƒæ­å»º2.1 æ­å»ºKafkaé›†ç¾¤2.1.1 ä¸‹è½½kafkaä¸¤ç§æ–¹å¼ï¼ˆ1ï¼‰æ‰‹åŠ¨ä¸‹è½½ ä¸‹è½½åœ°å€ï¼šApache Kafka ï¼ˆ2ï¼‰ä¹Ÿå¯ä»¥ç”¨å‘½ä»¤ä¸‹è½½ï¼ˆç›´æ¥ä¸‹è½½åˆ°æœåŠ¡å™¨å“¦ï¼ï¼‰ï¼š â€‹ å°†å®‰è£…åŒ…ä¸‹è½½åˆ°&#x2F;opt&#x2F;monitor&#x2F;kafkaæ–‡ä»¶å¤¹ä¸‹é¢â€‹ ä¸‹è½½å‘½ä»¤ï¼šâ€‹ wget http://mirrors.hust.edu.cn/apache/kafka/2.0.0/kafka_2.12-2.0.0.tgzâ€‹ æ‰‹åŠ¨ä¸‹è½½ç§»åŠ¨åˆ°&#x2F;opt&#x2F;monitor&#x2F;kafkaç›®å½•ä¸‹ä¹Ÿå¯ 2.1.2 è§£å‹Kafkatar -xvzf kafka_2.12-2.5.1.tgz -C ../server/ 2.1.3 ä¿®æ”¹server.propertiesæ–‡ä»¶ 2.1.4 é…ç½®KAFKA_HOMEç¯å¢ƒå˜é‡vim /etc/profileexport KAFKA_HOME=/export/server/kafka_2.12-2.4.1export PATH=:$PATH:$&#123;KAFKA_HOME&#125;åˆ†å‘åˆ°å„ä¸ªèŠ‚ç‚¹scp /etc/profile node2.itcast.cn:$PWDscp /etc/profile node3.itcast.cn:$PWDæ¯ä¸ªèŠ‚ç‚¹åŠ è½½ç¯å¢ƒå˜é‡source /etc/profile 2.1.5 å¯åŠ¨æœåŠ¡å™¨# å¯åŠ¨ZooKeepernohup bin/zookeeper-server-start.sh config/zookeeper.properties &amp;# å¯åŠ¨Kafkacd /export/server/kafka_2.12-2.4.1nohup bin/kafka-server-start.sh config/server.properties &amp;# æµ‹è¯•Kafkaé›†ç¾¤æ˜¯å¦å¯åŠ¨æˆåŠŸbin/kafka-topics.sh --bootstrap-server 8.130.95.129:9092 --list 2.2 ç›®å½•ç»“æ„åˆ†æ ç›®å½•åç§° è¯´æ˜ bin Kafkaçš„æ‰€æœ‰æ‰§è¡Œè„šæœ¬éƒ½åœ¨è¿™é‡Œã€‚ä¾‹å¦‚ï¼šå¯åŠ¨KafkaæœåŠ¡å™¨ã€åˆ›å»ºTopicã€ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ç¨‹åºç­‰ç­‰ config Kafkaçš„æ‰€æœ‰é…ç½®æ–‡ä»¶ libs è¿è¡ŒKafkaæ‰€éœ€è¦çš„æ‰€æœ‰JARåŒ… logs Kafkaçš„æ‰€æœ‰æ—¥å¿—æ–‡ä»¶ï¼Œå¦‚æœKafkaå‡ºç°ä¸€äº›é—®é¢˜ï¼Œéœ€è¦åˆ°è¯¥ç›®å½•ä¸­å»æŸ¥çœ‹å¼‚å¸¸ä¿¡æ¯ site-docs Kafkaçš„ç½‘ç«™å¸®åŠ©æ–‡ä»¶ 2.3 Kafkaä¸€é”®å¯åŠ¨&#x2F;å…³é—­è„šæœ¬ä¸ºäº†æ–¹ä¾¿å°†æ¥è¿›è¡Œä¸€é”®å¯åŠ¨ã€å…³é—­Kafkaï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªshellè„šæœ¬æ¥æ“ä½œã€‚å°†æ¥åªè¦æ‰§è¡Œä¸€æ¬¡è¯¥è„šæœ¬å°±å¯ä»¥å¿«é€Ÿå¯åŠ¨&#x2F;å…³é—­Kafkaã€‚ åœ¨èŠ‚ç‚¹1ä¸­åˆ›å»º &#x2F;export&#x2F;onekey ç›®å½• cd &#x2F;export&#x2F;onekey å‡†å¤‡slaveé…ç½®æ–‡ä»¶ï¼Œç”¨äºä¿å­˜è¦å¯åŠ¨å“ªå‡ ä¸ªèŠ‚ç‚¹ä¸Šçš„kafka 8.130.95.129node2.itcast.cnnode3.itcast.cn ç¼–å†™start-kafka.shè„šæœ¬ vim start-kafka.shcat /export/onekey/slave | while read linedo&#123; echo $line ssh $line &quot;source /etc/profile;export JMX_PORT=9988;nohup $&#123;KAFKA_HOME&#125;/bin/kafka-server-start.sh $&#123;KAFKA_HOME&#125;/config/server.properties &gt;/dev/nul* 2&gt;&amp;1 &amp; &quot;&#125;&amp;waitdone ç¼–å†™stop-kafka.shè„šæœ¬ vim stop-kafka.shcat /export/onekey/slave | while read linedo&#123; echo $line ssh $line &quot;source /etc/profile;jps |grep Kafka |cut -d&#x27; &#x27; -f1 |xargs kill -s 9&quot;&#125;&amp;waitdone ç»™start-kafka.shã€stop-kafka.shé…ç½®æ‰§è¡Œæƒé™ chmod u+x start-kafka.shchmod u+x stop-kafka.sh æ‰§è¡Œä¸€é”®å¯åŠ¨ã€ä¸€é”®å…³é—­ ./start-kafka.sh./stop-kafka.sh 3. åˆ›å»ºtopic3.1 åˆ›å»ºåˆ›å»ºä¸€ä¸ªtopicï¼ˆä¸»é¢˜ï¼‰ã€‚Kafkaä¸­æ‰€æœ‰çš„æ¶ˆæ¯éƒ½æ˜¯ä¿å­˜åœ¨ä¸»é¢˜ä¸­ï¼Œè¦ç”Ÿäº§æ¶ˆæ¯åˆ°Kafkaï¼Œé¦–å…ˆå¿…é¡»è¦æœ‰ä¸€ä¸ªç¡®å®šçš„ä¸»é¢˜ã€‚ # åˆ›å»ºåä¸ºtestçš„ä¸»é¢˜bin/kafka-topics.sh --create --bootstrap-server 8.130.95.129:9092 --topic test# æŸ¥çœ‹ç›®å‰Kafkaä¸­çš„ä¸»é¢˜bin/kafka-topics.sh --list --bootstrap-server 8.130.95.129:9092 3.2 ç”Ÿäº§æ¶ˆæ¯åˆ°Kafkaä½¿ç”¨Kafkaå†…ç½®çš„æµ‹è¯•ç¨‹åºï¼Œç”Ÿäº§ä¸€äº›æ¶ˆæ¯åˆ°Kafkaçš„testä¸»é¢˜ä¸­ã€‚ bin/kafka-console-producer.sh --broker-list 8.130.95.129:9092 --topic test 3.3 ä»Kafkaæ¶ˆè´¹æ¶ˆæ¯ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æ¶ˆè´¹ test ä¸»é¢˜ä¸­çš„æ¶ˆæ¯ã€‚ bin/kafka-console-consumer.sh --bootstrap-server 8.130.95.129:9092 --topic test --from-beginning 4. Kafkaé›†ç¾¤æ­å»º Kafkaé›†ç¾¤æ˜¯å¿…é¡»è¦æœ‰ZooKeeperçš„ æ³¨æ„ï¼š æ¯ä¸€ä¸ªKafkaçš„èŠ‚ç‚¹éƒ½éœ€è¦ä¿®æ”¹broker.idï¼ˆæ¯ä¸ªç»“ç‚¹çš„æ ‡è¯†ä¸èƒ½é‡å¤ï¼‰ log.diræ•°æ®å­˜å‚¨ç›®å½•éœ€è¦é…ç½® 4.1 Kafkaçš„ç”Ÿäº§è€…&#x2F;æ¶ˆè´¹è€…&#x2F;å·¥å…· å®‰è£…Kafkaé›†ç¾¤ï¼Œå¯ä»¥æµ‹è¯•ä¸€ä¸‹ åˆ›å»ºä¸€ä¸ªtopicä¸»é¢˜ï¼ˆæ¶ˆæ¯éƒ½æ˜¯å­˜æ”¾åœ¨topicä¸­ï¼Œç±»ä¼¼mysqlå»ºè¡¨çš„è¿‡ç¨‹ï¼‰ åŸºäºKafkaçš„å†…ç½®æµ‹è¯•ç”Ÿäº§è€…è„šæœ¬æ¥è¯»å–æ ‡å‡†è¾“å…¥ï¼ˆé”®ç›˜è¾“å…¥ï¼‰çš„æ•°æ®ï¼Œå¹¶æ”¾å…¥åˆ°topicä¸­ åŸºäºKafkaçš„å†…ç½®æµ‹è¯•æ¶ˆè´¹è€…è„šæœ¬æ¥æ¶ˆè´¹topicä¸­çš„æ•°æ® Kafka Tool æµè§ˆKafkaé›†ç¾¤èŠ‚ç‚¹ã€å¤šå°‘ä¸ªtopicã€å¤šå°‘ä¸ªåˆ†åŒº åˆ›å»ºtopic&#x2F;åˆ é™¤topic æµè§ˆZooKeeperä¸­çš„æ•°æ® 4.2 Kafkaçš„åŸºå‡†æµ‹è¯•å·¥å…· Kafkaä¸­æä¾›äº†å†…ç½®çš„æ€§èƒ½æµ‹è¯•å·¥å…· ç”Ÿäº§è€…ï¼šæµ‹è¯•ç”Ÿäº§æ¯ç§’ä¼ è¾“çš„æ•°æ®æ¡ï¼ˆå¤šå°‘æ¡æ•°æ®ã€å¤šå°‘Mçš„æ•°æ®ï¼‰ æ¶ˆè´¹è€…ï¼šæµ‹è¯•æ¶ˆè´¹æ¯æ¡æ‹‰å»çš„æ•°æ®é‡ å¯¹æ¯”ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼šæ¶ˆè´¹è€…çš„é€Ÿåº¦æ›´å¿«"}],"posts":[{"title":"","slug":"blog/header","date":"2023-05-31T01:21:31.556Z","updated":"2023-06-04T12:57:25.074Z","comments":true,"path":"blog/header/","link":"","permalink":"https://aqu.iyunmc.cn/blog/header/","excerpt":"","text":"","categories":[],"tags":[]},{"title":"Redisé¢è¯•å¿…å¤‡","slug":"blog/é¢è¯•1","date":"2023-05-20T11:50:00.000Z","updated":"2023-06-05T08:11:45.059Z","comments":true,"path":"blog/é¢è¯•1/","link":"","permalink":"https://aqu.iyunmc.cn/blog/%E9%9D%A2%E8%AF%951/","excerpt":"RedisRedisçš„æ•°æ®æŒä¹…åŒ–ç­–ç•¥æœ‰å“ªäº›ï¼Ÿæˆ‘çœ‹ä½ åšçš„é¡¹ç›®ä¸­ï¼Œéƒ½ç”¨åˆ°äº†redisï¼Œä½ åœ¨é¡¹ç›®ä¸­ç»™ä½ é‚£äº›åœºæ™¯ä½¿ç”¨äº†Rediså‘¢ï¼Ÿ","text":"RedisRedisçš„æ•°æ®æŒä¹…åŒ–ç­–ç•¥æœ‰å“ªäº›ï¼Ÿæˆ‘çœ‹ä½ åšçš„é¡¹ç›®ä¸­ï¼Œéƒ½ç”¨åˆ°äº†redisï¼Œä½ åœ¨é¡¹ç›®ä¸­ç»™ä½ é‚£äº›åœºæ™¯ä½¿ç”¨äº†Rediså‘¢ï¼Ÿ å¦‚æœå‘ç”Ÿäº†ç¼“å­˜ç©¿é€ã€å‡»ç©¿ã€é›ªå´©å¦‚ä½•è§£å†³å‘¢ï¼Ÿç¼“å­˜ç©¿é€ï¼š æŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„æ•°æ®ï¼Œmysqlä¸­ä¹ŸæŸ¥è¯¢ä¸åˆ°æ•°æ®ä¹Ÿä¸ä¼šç›´æ¥å†™å…¥ç¼“å­˜ï¼Œå°±ä¼šå¯¼è‡´æ¯æ¬¡è¯·æ±‚éƒ½æŸ¥æ•°æ®åº“ è§£å†³æ–¹æ¡ˆï¼š æ–¹æ¡ˆä¸€ï¼šç¼“å­˜ç©ºæ•°æ®ï¼ŒæŸ¥è¯¢è¿”å›çš„æ•°æ®ä¸ºç©ºï¼Œä»æŠŠè¿™ä¸ªç©ºç»“æœè¿›è¡Œç¼“å­˜ï¼ˆæ¶ˆè€—å†…å­˜ï¼Œå¯èƒ½ä¼šå‘é€ä¸ä¸€è‡´çš„é—®é¢˜ï¼‰ æ–¹æ¡ˆäºŒï¼šå¸ƒéš†è¿‡æ»¤å™¨ï¼šå½“æ ¹æ®idæŸ¥è¯¢æ—¶ ç¼“å­˜å‡»ç©¿ï¼šç»™æŸä¸€ä¸ªkeyè®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œå½“keyè¿‡æœŸæ—¶ï¼Œæ°å¥½åœ¨è¿™ä¸ªæ—¶é—´ç‚¹å¯¹è¿™ä¸ªkeyæœ‰å¤§é‡çš„å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠDBå‹å® è§£å†³æ–¹æ¡ˆï¼š æ–¹æ¡ˆä¸€ï¼šäº’æ–¥é”ï¼Œå¼ºä¸€è‡´ï¼Œæ€§èƒ½å·® æ–¹æ¡ˆäºŒï¼šé€»è¾‘è¿‡æœŸï¼Œé«˜å¯ç”¨ï¼Œæ€§èƒ½ä¼˜ï¼Œä¸èƒ½ä¿è¯æ•°æ®ç»å¯¹ä¸€è‡´ ç¼“å­˜é›ªå´©ï¼šæŒ‡åœ¨åŒä¸€æ—¶æ®µå¤§é‡çš„ç¼“å­˜keyåŒæ—¶å¤±æ•ˆæˆ–è€…RedisæœåŠ¡å®•æœºï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚åˆ°è¾¾æ•°æ®åº“ï¼Œç»™DBå¸¦æ¥å·¨å¤§å‹åŠ› è§£å†³æ–¹æ¡ˆï¼š ç»™ä¸åŒçš„Keyçš„TTLæ·»åŠ éšæœºå€¼ åˆ©ç”¨Redisé›†ç¾¤æé«˜æœåŠ¡çš„å¯ç”¨æ€§ï¼ˆå“¨å…µæ¨¡å¼ã€é›†ç¾¤æ¨¡å¼ï¼‰ ç»™ç¼“å­˜ä¸šåŠ¡æ·»åŠ é™çº§é™æµç­–ç•¥ï¼ˆNginxã€SpringCloud Gatewayï¼‰ ç»™ä¸šåŠ¡æ·»åŠ å¤šçº§ç¼“å­˜ï¼ˆGuava&#x2F;Caffeineï¼‰ ä¼šè¢«é—®åˆ°çš„çŸ¥è¯†ç‚¹ï¼šRedisä½œä¸ºç¼“å­˜ï¼Œmysqlçš„æ•°æ®å¦‚ä½•ä¸redisè¿›è¡ŒåŒæ­¥å‘¢ï¼Ÿï¼ˆåŒå†™ä¸€è‡´æ€§ï¼‰ æˆ‘å½“æ—¶æ˜¯æŠŠé¢˜åº“è®ºå›çš„çƒ­ç‚¹æ•°æ®å­˜åˆ°äº†ç¼“å­˜å½“ä¸­ï¼Œè™½ç„¶æ˜¯çƒ­ç‚¹æ•°æ®ï¼Œä½†æ˜¯å®æ—¶è¦æ±‚æ€§å¹¶æ²¡æœ‰é‚£ä¹ˆé«˜ï¼Œæ‰€ä»¥æˆ‘å½“æ—¶é‡‡ç”¨çš„æ˜¯å¼‚æ­¥çš„æ–¹æ¡ˆåŒæ­¥çš„æ•°æ® è¿˜æœ‰å°±æ˜¯æŠ¢å·çš„åº“å­˜å†™å…¥åˆ°äº†ç¼“å­˜å½“ä¸­ï¼Œè¿™ä¸ªéœ€è¦å®æ—¶çš„è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œä¸ºäº†ä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œæˆ‘ä»¬å½“æ—¶é‡‡ç”¨çš„æ˜¯Redissonæä¾›çš„è¯»å†™é”æ¥ä¿è¯æ•°æ®çš„åŒæ­¥ é‚£ä½ ä»‹ç»ä¸€ä¸‹ä½ é¡¹ç›®å½“ä¸­å¼‚æ­¥çš„æ–¹æ¡ˆï¼ˆæ¥ä»‹ç»ä¸€ä¸‹redissonè¯»å†™é”çš„è¿™ç§æ–¹æ¡ˆï¼‰ å…è®¸å»¶æ—¶ä¸€è‡´çš„ä¸šåŠ¡ï¼Œé‡‡ç”¨å¼‚æ­¥é€šçŸ¥ ä½¿ç”¨MQä¸­é—´ä»¶ï¼Œæ›´æ–°æ•°æ®ä¹‹åï¼Œé€šçŸ¥ç¼“å­˜åˆ é™¤ åˆ©ç”¨canalä¸­é—´ä»¶ï¼Œä¸éœ€è¦ä¿®æ”¹ä¸šåŠ¡ä»£ç ï¼Œä¼ªè£…ä¸ºmysqlçš„ä¸€ä¸ªä»èŠ‚ç‚¹ï¼Œcanalé€šè¿‡è¯»å–binlogæ•°æ®æ›´æ–°ç¼“å­˜ å¼ºä¸€è‡´æ€§çš„ï¼Œé‡‡ç”¨Redissonæä¾›çš„è¯»å†™é” å…±äº«é”ï¼šè¯»é”readLockï¼ŒåŠ é”ä¹‹åï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥å…±äº«è¯»æ“ä½œ æ’ä»–é”ï¼šç‹¬å é”writeLockï¼Œæ·é”ä¹‹åï¼Œé˜»å¡å…¶ä»–çº¿ç¨‹è¯»å†™æ“ä½œ RedisæŒä¹…åŒ–redisä½œä¸ºç¼“å­˜ï¼Œæ•°æ®çš„æŒä¹…åŒ–æ˜¯å¦‚ä½•åšçš„ï¼ŸRedisæä¾›äº†ä¸¤ç§æ•°æ®æŒä¹…åŒ–çš„æ–¹å¼ï¼š RDBï¼ˆRedis Database ï¼‰ï¼šRDBæ˜¯ä¸€ä¸ªå¿«ç…§æ–‡ä»¶ï¼Œä»–æ˜¯æŠŠRediså†…å­˜å­˜å‚¨çš„æ•°æ®å†™åˆ°ç£ç›˜å½“ä¸­ï¼Œå½“rediså®ä¾‹å®•æœºæ¢å¤æ•°æ®æ—¶ï¼Œå¯ä»¥ä»rdbçš„å¿«ç…§æ–‡ä»¶ä¸­æ¢å¤æ•°æ®ã€‚ AOFï¼šAOFæ˜¯ä¸€ä¸ªè¿½åŠ æ–‡ä»¶ï¼Œå½“redisæ“ä½œå†™å‘½ä»¤çš„æ—¶å€™ï¼Œéƒ½ä¼šå­˜å‚¨åˆ°è¿™ä¸ªæ–‡ä»¶å½“ä¸­ï¼Œå½“rediså®ä¾‹å®•æœºæ¢å¤æ•°æ®çš„æ—¶å€™ä¼šä»è¿™ä¸ªæ–‡ä»¶ä¸­å†æ¬¡æ‰§è¡Œä¸€éå‘½ä»¤æ¥æ¢å¤æ•°æ®ã€‚ è¿™ä¸¤ç§æ–¹å¼ï¼Œå“ªç§æ¢å¤çš„æ¯”è¾ƒå¿«å‘¢ï¼Ÿ1RDBæ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåœ¨ä¿å­˜çš„æ—¶å€™ä½“ç§¯ä¹Ÿæ˜¯æ¯”è¾ƒå°çš„ï¼Œä»–ä¼šå°å¾—æ¯”è¾ƒå¿«ï¼Œä½†æ˜¯æœ‰å¯èƒ½ä¼šä¸¢å¤±æ•°æ®ï¼Œè€Œæˆ‘ä»¬é€šå¸¸åœ¨é¡¹ç›®ä¸­ä½¿ç”¨AOFæ¥æ¢å¤æ•°æ®ï¼Œè™½ç„¶AOFæ¢å¤çš„é€Ÿåº¦æ…¢ä¸€äº›ï¼Œä½†æ˜¯ä»–ä¸¢æ•°æ®çš„å¥‰å­è¦å°å¾ˆå¤šï¼Œåœ¨AOFæ–‡ä»¶ä¸­å¯ä»¥è®¾ç½®åˆ·ç›˜ç­–ç•¥ Redisæ•°æ®åˆ é™¤ç­–ç•¥æƒ°æ€§åˆ é™¤ï¼šè®¾ç½®è¯¥keyè¿‡æœŸæ—¶é—´åï¼Œæˆ‘ä»¬ä¸å»ç®¡ä»–ï¼Œå½“éœ€è¦è¯¥keyæ—¶ï¼Œæˆ‘ä»¬å†æ£€æŸ¥å…¶æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸï¼Œæˆ‘ä»¬å°±åˆ æ‰ä»–ï¼Œåä¹‹åˆ™è¿”å›è¯¥key ä¼˜ç‚¹ï¼šå¯¹cpuå‹å¥½ï¼Œåªä¼šåœ¨ä½¿ç”¨è¯¥keyæ—¶æ‰ä¼šè¿›è¡Œè¿‡æœŸæ£€æŸ¥ï¼Œå¯¹äºå¾ˆå¤šç”¨ä¸åˆ°çš„keyä¸ç”¨æµªè´¹æ—¶é—´è¿›è¡Œè¿‡æœŸæ£€æŸ¥ã€‚ ç¼ºç‚¹ï¼šå¯¹å†…å­˜ä¸å‹å¥½ï¼Œå¦‚æœä¸€ä¸ªkeyå·²ç»è¿‡æœŸï¼Œä½†æ˜¯ä¸€ç›´æ²¡æœ‰ä½¿ç”¨ï¼Œé‚£ä¹ˆè¯¥keyå°±ä¼šä¸€ç›´å­˜åœ¨å†…å­˜å½“ä¸­ï¼Œå†…å­˜æ°¸è¿œä¸ä¼šé‡Šæ”¾ å®šæœŸåˆ é™¤ï¼šæ¯éš”ä¸€æ®µæ—¶é—´ï¼Œå°±ä¼šå¯¹ä¸€äº›keyè¿›è¡Œæ£€æŸ¥ï¼Œåˆ é™¤é‡Œé¢è¿‡æœŸçš„keyï¼ˆä»ä¸€å®šæ•°é‡çš„æ•°æ®åº“ä¸­å–å‡ºä¸€å®šæ•°é‡çš„éšæœºkeyè¿›è¡Œæ£€æŸ¥ï¼Œå¹¶åˆ é™¤å…¶ä¸­çš„è¿‡æœŸkeyï¼‰ ä¼˜ç‚¹ï¼šå¯ä»¥é€šè¿‡é™åˆ¶åˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿å’Œé¢‘ç‡æ¥å‡å°‘åˆ é™¤æ“ä½œå¯¹cpuçš„å½±å“ï¼Œå¦å¤–å®šæœŸåˆ é™¤ï¼Œä¹Ÿèƒ½æœ‰æ•ˆé‡Šæ”¾è¿‡æœŸkeyå ç”¨çš„å†…å­˜ã€‚ ç¼ºç‚¹ï¼šéš¾ä»¥ç¡®å®šåˆ é™¤æ“ä½œæ‰§è¡Œçš„æ—¶é•¿å’Œé¢‘ç‡ Redisæ•°æ®æ·˜æ±°ç­–ç•¥ LRUï¼ˆLeast Recently Usedï¼‰æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼Œç”¨å½“å‰çš„æ—¶é—´å‡å»æœ€åä¸€æ¬¡ä½¿ç”¨çš„æ—¶é—´ï¼Œå€¼è¶Šå¤§åˆ™æ·˜æ±°ä¼˜å…ˆçº§è¶Šé«˜ LFUï¼ˆLeast Frequently Usedï¼‰æœ€å°‘é¢‘ç‡ä½¿ç”¨ï¼Œä¼šç»Ÿè®¡æ¯ä¸ªkeyçš„è®¿é—®é¢‘ç‡ï¼Œå€¼è¶Šå°æ·˜æ±°ä¼˜å…ˆçº§è¶Šé«˜ ä¼šè¢«é—®åˆ°çš„çŸ¥è¯†ç‚¹ï¼šæ•°æ®åº“ä¸­æœ‰1000ä¸‡æ•°æ®ï¼Œè€ŒRedisåªèƒ½ç¼“å­˜20wæ•°æ®ï¼Œå¦‚ä½•ä¿è¯Redisä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®ï¼Ÿä½¿ç”¨allkeys-lruï¼ˆæŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ï¼‰æ·˜æ±°ç­–ç•¥ï¼Œç•™ä¸‹æ¥çš„éƒ½æ˜¯ç»å¸¸è®¿é—®çš„çƒ­ç‚¹æ•°æ® Redisçš„å†…å­˜ç”¨å®Œäº†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿä¸»è¦çœ‹æ•°æ®æ·˜æ±°ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿå¦‚æœæ˜¯é»˜è®¤çš„é…ç½®ï¼ˆnoevictionï¼‰å°±ä¼šç›´æ¥æŠ¥é”™ é¢è¯•å®˜ä½ å¥½ ä»Šå¹´xxå²","categories":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://aqu.iyunmc.cn/categories/%E9%9D%A2%E8%AF%95/"}],"tags":[{"name":"Redis","slug":"redis","permalink":"https://aqu.iyunmc.cn/tags/redis/"}]},{"title":"ç½‘å…³GateWay","slug":"blog/ç½‘å…³çš„ä½œç”¨","date":"2023-04-07T11:50:00.000Z","updated":"2023-06-04T12:59:07.553Z","comments":true,"path":"blog/ç½‘å…³çš„ä½œç”¨/","link":"","permalink":"https://aqu.iyunmc.cn/blog/%E7%BD%91%E5%85%B3%E7%9A%84%E4%BD%9C%E7%94%A8/","excerpt":"1. ç½‘å…³çš„ä½œç”¨ å¯¹ç”¨æˆ·è¯·æ±‚åšèº«ä»½è®¤è¯ã€æƒé™æ ¡éªŒ å°†ç”¨æˆ·è¯·æ±‚è·¯ç”±åˆ°å¾®æœåŠ¡ï¼Œå¹¶å®ç°è´Ÿè½½å‡è¡¡ å¯¹ç”¨æˆ·è¯·æ±‚åšé™æµ 2. æ­å»ºç½‘å…³æœåŠ¡","text":"1. ç½‘å…³çš„ä½œç”¨ å¯¹ç”¨æˆ·è¯·æ±‚åšèº«ä»½è®¤è¯ã€æƒé™æ ¡éªŒ å°†ç”¨æˆ·è¯·æ±‚è·¯ç”±åˆ°å¾®æœåŠ¡ï¼Œå¹¶å®ç°è´Ÿè½½å‡è¡¡ å¯¹ç”¨æˆ·è¯·æ±‚åšé™æµ 2. æ­å»ºç½‘å…³æœåŠ¡ ç½‘å…³æ­å»ºæ­¥éª¤ åˆ›å»ºé¡¹ç›®ï¼Œå¼•å…¥nacosæœåŠ¡å‘ç°å’Œgatewayä¾èµ– &lt;dependencies&gt; &lt;!-- nacosæœåŠ¡æ³¨å†Œå‘ç°ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- ç½‘å…³gatewayä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; é…ç½®application.ymlï¼ŒåŒ…æ‹¬æœåŠ¡åŸºæœ¬ä¿¡æ¯ã€nacosåœ°å€ã€è·¯ç”± application: name: gatewaycloud: nacos: server-addr: localhost:8848 gateway: routes: - id: user-service # è·¯ç”±è¡¨å¿…é¡»æ˜¯å”¯ä¸€çš„ uri: lb://userservice # è·¯ç”±çš„ç›®æ ‡åœ°å€ predicates: # è·¯ç”±æ–­è¨€ï¼Œåˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆè§„åˆ™ - Path=/user/** #è·¯å¾„æ–­è¨€ï¼Œåˆ¤æ–­è·¯å¾„æ˜¯å¦ä»¥/userå¼€å¤´ - id: order-service uri: lb://orderservice predicates: - Path=/order/** 3. è¿‡æ»¤å™¨å·¥å‚è¿‡æ»¤å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ å¯¹è·¯ç”±çš„è¯·æ±‚æˆ–å“åº”åšåŠ å·¥å¤„ç†ï¼Œæ¯”å¦‚æ·»åŠ è¯·æ±‚å¤´ é…ç½®åœ¨è·¯ç”±ä¸‹çš„è¿‡æ»¤å™¨åªå¯¹å½“å‰è·¯ç”±çš„è¯·æ±‚ç”Ÿæ•ˆ defaultFiltersçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ å¯¹æ‰€æœ‰è·¯ç”±éƒ½ç”Ÿæ•ˆçš„è¿‡æ»¤å™¨ 4. å…¨å±€è¿‡æ»¤å™¨å…¨å±€è¿‡æ»¤å™¨çš„ä½œç”¨ å¯¹æ‰€æœ‰è·¯ç”±éƒ½ç”Ÿæ•ˆçš„è¿‡æ»¤å™¨ï¼Œå¹¶ä¸”å¯ä»¥è‡ªå®šä¹‰å¤„ç†é€»è¾‘ å®ç°å…¨å±€è¿‡æ»¤å™¨çš„æ­¥éª¤ å®ç°GlobalFilteræ¥å£ æ·»åŠ @Orderæ³¨è§£æˆ–å®ç°Orderedæ¥å£ ç¼–å†™å¤„ç†é€»è¾‘ @Order(-1)@Componentpublic class AuthorizeFilter implements GlobalFilter &#123; @Override public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123; // 1.è·å–è¯·æ±‚å‚æ•° ServerHttpRequest request = exchange.getRequest(); MultiValueMap&lt;String, String&gt; queryParams = request.getQueryParams(); // 2.è·å–å‚æ•°ä¸­çš„authorizationå‚æ•° String auth = queryParams.getFirst(&quot;authorization&quot;); // 3.åˆ¤æ–­å‚æ•°å€¼æ˜¯å¦ç­‰äºadmin if (&quot;admin&quot;.equals(auth)) &#123; // 4.æ˜¯ï¼Œæ”¾è¡Œ return chain.filter(exchange); &#125; // 5.å¦ï¼Œæ‹¦æˆª // 5.1 è®¾ç½®çŠ¶æ€ç  exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED); // 5.2 æ‹¦æˆªè¯·æ±‚ return exchange.getResponse().setComplete(); &#125;&#125; 5. è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº æ¯ä¸€ä¸ªè¿‡æ»¤å™¨éƒ½å¿…é¡»æŒ‡å®šä¸€ä¸ªintç±»å‹çš„orderå€¼ï¼Œorderå€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œæ‰§è¡Œé¡ºåºè¶Šé å‰ã€‚ GlobalFilteré€šè¿‡å®ç°Orderedæ¥å£ï¼Œæˆ–è€…æ·»åŠ @Orderæ³¨è§£æ¥æŒ‡å®šorderå€¼ï¼Œç”±æˆ‘ä»¬è‡ªå·±æŒ‡å®š è·¯ç”±è¿‡æ»¤å™¨å’ŒdefaultFilterçš„orderç”±SpringæŒ‡å®šï¼Œé»˜è®¤æ˜¯æŒ‰ç…§ç”Ÿå‘½é¡ºåºä»1é€’å¢ å½“è¿‡æ»¤å™¨çš„orderå€¼ä¸€æ ·æ—¶ï¼Œä¼šæŒ‰ç…§defaultFilter &gt; è·¯ç”±è¿‡æ»¤å™¨ &gt; GlobalFilterçš„é¡ºåºæ‰§è¡Œ","categories":[{"name":"æ•™ç¨‹","slug":"æ•™ç¨‹","permalink":"https://aqu.iyunmc.cn/categories/%E6%95%99%E7%A8%8B/"}],"tags":[{"name":"Java","slug":"java","permalink":"https://aqu.iyunmc.cn/tags/java/"}]},{"title":"ã€ŒDockerã€åŸºæœ¬å‘½ä»¤","slug":"blog/Docker","date":"2023-03-25T08:43:21.000Z","updated":"2023-06-04T12:38:49.093Z","comments":true,"path":"blog/Docker/","link":"","permalink":"https://aqu.iyunmc.cn/blog/Docker/","excerpt":"","text":"DockerDockeræ˜¯ä¸€ä¸ªå¿«é€Ÿäº¤ä»˜åº”ç”¨ã€è¿è¡Œåº”ç”¨çš„æŠ€æœ¯ å¯ä»¥å°†ç¨‹åºæœºå™¨ä¾èµ–ã€è¿è¡Œç¯å¢ƒä¸€èµ·æ‰“åŒ…ä¸ºä¸€ä¸ªé•œåƒï¼Œå¯ä»¥è¿ç§»åˆ°ä»»æ„Linuxæ“ä½œç³»ç»Ÿ è¿è¡Œæ—¶åˆ©ç”¨æ²™ç®±æœºåˆ¶å½¢æˆéš”ç¦»å®¹å™¨ï¼Œå„ä¸ªåº”ç”¨äº’ä¸å¹²æ‰° å¯åŠ¨ã€ç§»é™¤éƒ½å¯ä»¥é€šè¿‡ä¸€è¡Œå‘½ä»¤å®Œæˆï¼Œæ–¹ä¾¿å¿«æ· é•œåƒï¼šå°†åº”ç”¨åŠå…¶ä¾èµ–ã€ç¯å¢ƒã€é…ç½®æ‰“åŒ…åœ¨ä¸€èµ· å®¹å™¨ï¼šé•œåƒè¿è¡Œèµ·æ¥å°±æ˜¯å®¹å™¨ï¼Œä¸€ä¸ªé•œåƒå¯ä»¥è¿è¡Œå¤šä¸ªå®¹å™¨ Dockerç»“æ„ï¼šæœåŠ¡ç«¯ï¼šæ¥å—å‘½ä»¤æˆ–è¿œç¨‹è¯·æ±‚ï¼Œæ“ä½œé•œåƒæˆ–å®¹å™¨ å®¢æˆ·ç«¯ï¼šå‘é€å‘½ä»¤æˆ–è€…è¯·æ±‚åˆ°DockeræœåŠ¡ç«¯ DockeråŸºæœ¬æ“ä½œ-é•œåƒ1.åŸºæœ¬æ“ä½œdocker images æŸ¥çœ‹é•œåƒ docker rmi åˆ é™¤æŒ‡å®šé•œåƒ docker pull æ‹‰å–é•œåƒ docker push æ¨é€é•œåƒ docker save ä¿å­˜é•œåƒtar docker load åŠ è½½taré•œåƒ docker ps æŸ¥çœ‹æ‰€æœ‰è¿è¡Œçš„å®¹å™¨åŠçŠ¶æ€ docker rm åˆ é™¤å®¹å™¨ï¼ˆä¸èƒ½åˆ é™¤è¿è¡Œä¸­çš„å®¹å™¨ï¼Œé™¤éæ·»åŠ  -f å‚æ•°ï¼‰ docker logs æŸ¥çœ‹å®¹å™¨è¿è¡Œæ—¥å¿— docker exec -it [å®¹å™¨å] [è¦æ‰§è¡Œçš„å‘½ä»¤] è¿›å…¥å®¹å™¨æ‰§è¡Œå‘½ä»¤ 2.å®¹å™¨å‘½ä»¤â‘ .åˆ›å»ºè¿è¡Œä¸€ä¸ªNginxå®¹å™¨æ­¥éª¤ä¸€ï¼šå»docker hubæŸ¥çœ‹Nginxçš„å®¹å™¨è¿è¡Œå‘½ä»¤ docker run --name containerName -p 80:80 -d nginx å‘½ä»¤è§£è¯»ï¼š docker runï¼šåˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªå®¹å™¨ --nameï¼šç»™å®¹å™¨èµ·ä¸€ä¸ªåå­—ï¼Œæ¯”å¦‚å«åšng -pï¼šå°†å®¿ä¸»æœºç«¯å£ä¸å®¹å™¨ç«¯å£æ˜ å°„ï¼Œå†’å·å·¦ä¾§æ˜¯å®¿ä¸»æœºç«¯å£ï¼Œå³ä¾§æ˜¯å®¹å™¨ç«¯å£ -dï¼šåå°è¿è¡Œå®¹å™¨ nginxï¼šé•œåƒåç§°ï¼Œä¾‹å¦‚nginx docker runå‘½ä»¤çš„å¸¸è§å‚æ•° --nameï¼šæŒ‡å®šå®¹å™¨åç§° -pï¼šæŒ‡å®šç«¯å£æ˜ å°„ -dï¼šè®©å®¹å™¨åå°è¿è¡Œ æŸ¥çœ‹å®¹å™¨æ—¥å¿—çš„å‘½ä»¤docker logs æ·»åŠ  -f å‚æ•°å¯ä»¥æŒç»­æŸ¥çœ‹æ—¥å¿— æŸ¥çœ‹å®¹å™¨çŠ¶æ€docker ps 2.1 è¿›å…¥Nginxå®¹å™¨ï¼Œä¿®æ”¹HTMLæ–‡ä»¶å†…å®¹ï¼Œæ·»åŠ â€œInoæ¬¢è¿ä½ â€æ­¥éª¤ä¸€ï¼šè¿›å…¥å®¹å™¨docker exec -it mn bash å‘½ä»¤è§£è¯»ï¼š docker execï¼šè¿›å…¥å®¹å™¨å†…éƒ¨ï¼Œæ‰§è¡Œä¸€ä¸ªå‘½ä»¤ -itï¼šç»™å½“å‰è¿›å…¥çš„å®¹å™¨åˆ›å»ºä¸€ä¸ªæ ‡å‡†è¾“å…¥ã€è¾“å‡ºç»ˆç«¯ï¼Œå…è®¸æˆ‘ä»¬ä¸å®¹å™¨äº¤äº’ mnï¼šè¦è¿›å…¥çš„å®¹å™¨çš„åç§° bashï¼šè¿›å…¥å®¹å™¨åæ‰§è¡Œçš„å‘½ä»¤ï¼Œbashæ˜¯ä¸€ä¸ªlinuxç»ˆç«¯äº¤äº’å‘½ä»¤ â‘¡.æ“ä½œæ•°æ®å·æ•°æ®å·çš„ä½œç”¨ï¼š å°†å®¹å™¨ä¸æ•°æ®åˆ†ç¦»ï¼Œè§£è€¦åˆï¼Œæ–¹ä¾¿æ“ä½œå®¹å™¨å†…æ•°æ®ï¼Œä¿è¯æ•°æ®å®‰å…¨ docker volume [COMMAND] docker volumeå‘½ä»¤æ˜¯æ•°æ®å·æ“ä½œï¼Œæ ¹æ®å‘½ä»¤åè·Ÿéšçš„commandæ¥ç¡®å®šä¸‹ä¸€æ­¥çš„æ“ä½œï¼š create åˆ›å»ºä¸€ä¸ªvolume inspect æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªvolumeçš„ä¿¡æ¯ ls åˆ—å‡ºæ‰€æœ‰çš„volume prune åˆ é™¤æœªä½¿ç”¨çš„volume rm åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šçš„volume åˆ›å»ºæ•°æ®å· docker volume craete html 2.æŸ¥çœ‹æ‰€æœ‰æ•°æ® docker volume ls 3.æŸ¥çœ‹æ•°æ®å·è¯¦ç»†ä¿¡æ¯å· docker volume inspect html 2.2 åˆ©ç”¨æ•°æ®å·æ“ä½œnginxå®¹å™¨â‘  åˆ›å»ºå®¹å™¨å¹¶æŒ‚è½½æ•°æ®å·åˆ°å®¹å™¨å†…çš„HTMLç›®å½• docker run --name mn -v html:/usr/share/nginx/html -p 80:80 -d nginx â‘¡ è¿›å…¥htmlæ•°æ®å·æ‰€åœ¨ä½ç½®ï¼Œå¹¶ä¿®æ”¹HTMLå†…å®¹ # æŸ¥çœ‹htmlæ•°æ®å·çš„ä½ç½®docker volume inspect html# è¿›å…¥è¯¥ç›®å½•cd /var/lib/docker/volumes/html/_data# ä¿®æ”¹æ–‡ä»¶vi index.html 2.3 åˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªMySQLå®¹å™¨ï¼Œå°†å®¿ä¸»æœºç›®å½•ç›´æ¥æŒ‚è½½åˆ°å®¹å™¨æç¤º:ç›®å½•æŒ‚è½½ä¸æ•°æ®å·æŒ‚è½½çš„è¯­æ³•æ˜¯ç±»ä¼¼çš„: -v[å®¿ä¸»æœºç›®å½•]:[å®¹å™¨å†…ç›®å½•] -v[å®¿ä¸»æœºæ–‡ä»¶]:[å®¹å™¨å†…æ–‡ä»¶] å®ç°æ€è·¯å¦‚ä¸‹: 1ï¼åœ¨å°†è¯¾å‰èµ„æ–™ä¸­çš„mysql.taræ–‡ä»¶ä¸Šä¼ åˆ°è™šæ‹Ÿæœºï¼Œé€šè¿‡loadå‘½ä»¤åŠ è½½ä¸ºé•œåƒ 2ï¼åˆ›å»ºç›®å½•&#x2F;tmp&#x2F;myql&#x2F;data 3ï¼åˆ›å»ºç›®å½•&#x2F;tmp&#x2F;myql&#x2F;confï¼Œå°†è¯¾å‰èµ„æ–™æä¾›çš„hmy.cnfæ–‡ä»¶ä¸Šä¼ åˆ°&#x2F;tmp&#x2F;myql&#x2F;conf 4ï¼å»DockerHubæŸ¥é˜…èµ„æ–™ï¼Œåˆ›å»ºå¹¶è¿è¡ŒMySQLå®¹å™¨ï¼Œè¦æ±‚: æŒ‚è½½&#x2F;tmp&#x2F;myql&#x2F;dataåˆ°mysqlå®¹å™¨å†…æ•°æ®å­˜å‚¨ç›®å½• æŒ‚è½½&#x2F;tmp&#x2F;myql&#x2F;conf&#x2F;hmy.cnfåˆ°mysqlå®¹å™¨çš„é…ç½®æ–‡ä»¶ è®¾ç½®MySQLå¯†ç  docker run --name mysql -e MYSQL_ROOT_PASSWORD=adg153 -p 3307:3306 -v /tmp/mysql/conf/hmy.cnf:/etc/mysql/conf.d/hmy.cnf -v /tmp/mysql/data:/var/lib/mysql -d mysql:5.7.25 è‡ªå®šä¹‰é•œåƒ - é•œåƒç»“æ„ç«Ÿåƒæ˜¯åˆ†å±‚ç»“æ„ï¼Œæ¯ä¸€å±‚æˆä¸ºä¸€ä¸ªLayerï¼ˆå±‚ï¼‰ BaseImageå±‚ï¼šåŒ…å«åŸºæœ¬çš„ç³»ç»Ÿå‡½æ•°åº“ã€ç¯å¢ƒå˜é‡ã€æ–‡ä»¶ç³»ç»Ÿ Entrypointï¼šå…¥å£ï¼Œæ˜¯é•œåƒä¸­åº”ç”¨å¯åŠ¨çš„å‘½ä»¤ï¼ˆsystemctl start mysql.serviceï¼‰ å…¶ä»–ï¼šåœ¨BaseImageåŸºç¡€ä¸Šæ·»åŠ ä¾èµ–ã€å®‰è£…ç¨‹åºã€å®Œæˆæ•´ä¸ªåº”ç”¨çš„å®‰è£…å’Œé…ç½® 2.CentOS7å®‰è£…DockerCompose2.1.ä¸‹è½½Linuxä¸‹éœ€è¦é€šè¿‡å‘½ä»¤ä¸‹è½½ï¼š # å®‰è£…curl -L https://github.com/docker/compose/releases/download/1.23.1/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose å¦‚æœä¸‹è½½é€Ÿåº¦è¾ƒæ…¢ï¼Œæˆ–è€…ä¸‹è½½å¤±è´¥ï¼Œå¯ä»¥ä½¿ç”¨è¯¾å‰èµ„æ–™æä¾›çš„docker-composeæ–‡ä»¶ï¼š ä¸Šä¼ åˆ°/usr/local/bin/ç›®å½•ä¹Ÿå¯ä»¥ã€‚ 2.2.ä¿®æ”¹æ–‡ä»¶æƒé™ä¿®æ”¹æ–‡ä»¶æƒé™ï¼š # ä¿®æ”¹æƒé™chmod +x /usr/local/bin/docker-compose 2.3.Baseè‡ªåŠ¨è¡¥å…¨å‘½ä»¤ï¼š# è¡¥å…¨å‘½ä»¤curl -L https://raw.githubusercontent.com/docker/compose/1.29.1/contrib/completion/bash/docker-compose &gt; /etc/bash_completion.d/docker-compose å¦‚æœè¿™é‡Œå‡ºç°é”™è¯¯ï¼Œéœ€è¦ä¿®æ”¹è‡ªå·±çš„hostsæ–‡ä»¶ï¼š echo &quot;199.232.68.133 raw.githubusercontent.com&quot; &gt;&gt; /etc/hosts 3.Dockeré•œåƒä»“åº“æ­å»ºé•œåƒä»“åº“å¯ä»¥åŸºäºDockerå®˜æ–¹æä¾›çš„DockerRegistryæ¥å®ç°ã€‚ å®˜ç½‘åœ°å€ï¼šhttps://hub.docker.com/_/registry 3.1.ç®€åŒ–ç‰ˆé•œåƒä»“åº“Dockerå®˜æ–¹çš„Docker Registryæ˜¯ä¸€ä¸ªåŸºç¡€ç‰ˆæœ¬çš„Dockeré•œåƒä»“åº“ï¼Œå…·å¤‡ä»“åº“ç®¡ç†çš„å®Œæ•´åŠŸèƒ½ï¼Œä½†æ˜¯æ²¡æœ‰å›¾å½¢åŒ–ç•Œé¢ã€‚ æ­å»ºæ–¹å¼æ¯”è¾ƒç®€å•ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š docker run -d \\ --restart=always \\ --name registry \\ -p 5000:5000 \\ -v registry-data:/var/lib/registry \\ registry å‘½ä»¤ä¸­æŒ‚è½½äº†ä¸€ä¸ªæ•°æ®å·registry-dataåˆ°å®¹å™¨å†…çš„&#x2F;var&#x2F;lib&#x2F;registry ç›®å½•ï¼Œè¿™æ˜¯ç§æœ‰é•œåƒåº“å­˜æ”¾æ•°æ®çš„ç›®å½•ã€‚ è®¿é—®http://YourIp:5000/v2/_catalog å¯ä»¥æŸ¥çœ‹å½“å‰ç§æœ‰é•œåƒæœåŠ¡ä¸­åŒ…å«çš„é•œåƒ 3.2.å¸¦æœ‰å›¾å½¢åŒ–ç•Œé¢ç‰ˆæœ¬ä½¿ç”¨DockerComposeéƒ¨ç½²å¸¦æœ‰å›¾è±¡ç•Œé¢çš„DockerRegistryï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š version: &#x27;3.0&#x27;services: registry: image: registry volumes: - ./registry-data:/var/lib/registry ui: image: joxit/docker-registry-ui:static ports: - 8080:80 environment: - REGISTRY_TITLE=ä¼ æ™ºæ•™è‚²ç§æœ‰ä»“åº“ - REGISTRY_URL=http://registry:5000 depends_on: - registry 3.3.é…ç½®Dockerä¿¡ä»»åœ°å€æˆ‘ä»¬çš„ç§æœé‡‡ç”¨çš„æ˜¯httpåè®®ï¼Œé»˜è®¤ä¸è¢«Dockerä¿¡ä»»ï¼Œæ‰€ä»¥éœ€è¦åšä¸€ä¸ªé…ç½®ï¼š # æ‰“å¼€è¦ä¿®æ”¹çš„æ–‡ä»¶vi /etc/docker/daemon.json# æ·»åŠ å†…å®¹ï¼š&quot;insecure-registries&quot;:[&quot;http://192.168.150.101:8080&quot;]# é‡åŠ è½½systemctl daemon-reload# é‡å¯dockersystemctl restart docker","categories":[{"name":"æ•™ç¨‹","slug":"æ•™ç¨‹","permalink":"https://aqu.iyunmc.cn/categories/%E6%95%99%E7%A8%8B/"}],"tags":[{"name":"Linux","slug":"linux","permalink":"https://aqu.iyunmc.cn/tags/linux/"}]},{"title":"å®‰è£…Elasticsearch","slug":"blog/å®‰è£…elasticsearch","date":"2023-03-20T11:50:00.000Z","updated":"2023-06-04T12:42:28.843Z","comments":true,"path":"blog/å®‰è£…elasticsearch/","link":"","permalink":"https://aqu.iyunmc.cn/blog/%E5%AE%89%E8%A3%85elasticsearch/","excerpt":"","text":"å®‰è£…elasticsearch1.éƒ¨ç½²å•ç‚¹es1.1.åˆ›å»ºç½‘ç»œå› ä¸ºæˆ‘ä»¬è¿˜éœ€è¦éƒ¨ç½²kibanaå®¹å™¨ï¼Œå› æ­¤éœ€è¦è®©eså’Œkibanaå®¹å™¨äº’è”ã€‚è¿™é‡Œå…ˆåˆ›å»ºä¸€ä¸ªç½‘ç»œï¼š docker network create es-net 1.2.åŠ è½½é•œåƒè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨elasticsearchçš„7.12.1ç‰ˆæœ¬çš„é•œåƒï¼Œè¿™ä¸ªé•œåƒä½“ç§¯éå¸¸å¤§ï¼Œæ¥è¿‘1Gã€‚ä¸å»ºè®®å¤§å®¶è‡ªå·±pullã€‚ è¯¾å‰èµ„æ–™æä¾›äº†é•œåƒçš„taråŒ…ï¼š å¤§å®¶å°†å…¶ä¸Šä¼ åˆ°è™šæ‹Ÿæœºä¸­ï¼Œç„¶åè¿è¡Œå‘½ä»¤åŠ è½½å³å¯ï¼š # å¯¼å…¥æ•°æ®docker load -i es.tar åŒç†è¿˜æœ‰kibanaçš„taråŒ…ä¹Ÿéœ€è¦è¿™æ ·åšã€‚ 1.3.è¿è¡Œè¿è¡Œdockerå‘½ä»¤ï¼Œéƒ¨ç½²å•ç‚¹esï¼š docker run -d \\ --name es \\ -e &quot;ES_JAVA_OPTS=-Xms128m -Xmx256m&quot; \\ -e &quot;discovery.type=single-node&quot; \\ -v es-data:/usr/share/elasticsearch/data \\ -v es-plugins:/usr/share/elasticsearch/plugins \\ --privileged \\ --network es-net \\ -p 9200:9200 \\ -p 9300:9300 \\elasticsearch:7.12.1 å‘½ä»¤è§£é‡Šï¼š -e &quot;cluster.name=es-docker-cluster&quot;ï¼šè®¾ç½®é›†ç¾¤åç§° -e &quot;http.host=0.0.0.0&quot;ï¼šç›‘å¬çš„åœ°å€ï¼Œå¯ä»¥å¤–ç½‘è®¿é—® -e &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;ï¼šå†…å­˜å¤§å° -e &quot;discovery.type=single-node&quot;ï¼šéé›†ç¾¤æ¨¡å¼ -v es-data:/usr/share/elasticsearch/dataï¼šæŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®šesçš„æ•°æ®ç›®å½• -v es-logs:/usr/share/elasticsearch/logsï¼šæŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®šesçš„æ—¥å¿—ç›®å½• -v es-plugins:/usr/share/elasticsearch/pluginsï¼šæŒ‚è½½é€»è¾‘å·ï¼Œç»‘å®šesçš„æ’ä»¶ç›®å½• --privilegedï¼šæˆäºˆé€»è¾‘å·è®¿é—®æƒ --network es-net ï¼šåŠ å…¥ä¸€ä¸ªåä¸ºes-netçš„ç½‘ç»œä¸­ -p 9200:9200ï¼šç«¯å£æ˜ å°„é…ç½® åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ï¼šhttp://192.168.150.101:9200 å³å¯çœ‹åˆ°elasticsearchçš„å“åº”ç»“æœï¼š 2.éƒ¨ç½²kibanakibanaå¯ä»¥ç»™æˆ‘ä»¬æä¾›ä¸€ä¸ªelasticsearchçš„å¯è§†åŒ–ç•Œé¢ï¼Œä¾¿äºæˆ‘ä»¬å­¦ä¹ ã€‚ 2.1.éƒ¨ç½²è¿è¡Œdockerå‘½ä»¤ï¼Œéƒ¨ç½²kibana docker run -d \\--name kibana \\-e ELASTICSEARCH_HOSTS=http://es:9200 \\--network=es-net \\-p 5601:5601 \\kibana:7.10.1 --network es-net ï¼šåŠ å…¥ä¸€ä¸ªåä¸ºes-netçš„ç½‘ç»œä¸­ï¼Œä¸elasticsearchåœ¨åŒä¸€ä¸ªç½‘ç»œä¸­ -e ELASTICSEARCH_HOSTS=http://es:9200&quot;ï¼šè®¾ç½®elasticsearchçš„åœ°å€ï¼Œå› ä¸ºkibanaå·²ç»ä¸elasticsearchåœ¨ä¸€ä¸ªç½‘ç»œï¼Œå› æ­¤å¯ä»¥ç”¨å®¹å™¨åç›´æ¥è®¿é—®elasticsearch -p 5601:5601ï¼šç«¯å£æ˜ å°„é…ç½® kibanaå¯åŠ¨ä¸€èˆ¬æ¯”è¾ƒæ…¢ï¼Œéœ€è¦å¤šç­‰å¾…ä¸€ä¼šï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤ï¼š docker logs -f kibana æŸ¥çœ‹è¿è¡Œæ—¥å¿—ï¼Œå½“æŸ¥çœ‹åˆ°ä¸‹é¢çš„æ—¥å¿—ï¼Œè¯´æ˜æˆåŠŸï¼š æ­¤æ—¶ï¼Œåœ¨æµè§ˆå™¨è¾“å…¥åœ°å€è®¿é—®ï¼šhttp://192.168.150.101:5601ï¼Œå³å¯çœ‹åˆ°ç»“æœ 2.2.DevToolskibanaä¸­æä¾›äº†ä¸€ä¸ªDevToolsç•Œé¢ï¼š è¿™ä¸ªç•Œé¢ä¸­å¯ä»¥ç¼–å†™DSLæ¥æ“ä½œelasticsearchã€‚å¹¶ä¸”å¯¹DSLè¯­å¥æœ‰è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ã€‚ 3.å®‰è£…IKåˆ†è¯å™¨3.1.åœ¨çº¿å®‰è£…ikæ’ä»¶ï¼ˆè¾ƒæ…¢ï¼‰# è¿›å…¥å®¹å™¨å†…éƒ¨docker exec -it elasticsearch /bin/bash# åœ¨çº¿ä¸‹è½½å¹¶å®‰è£…./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.12.1/elasticsearch-analysis-ik-7.12.1.zip#é€€å‡ºexit#é‡å¯å®¹å™¨docker restart elasticsearch 3.2.ç¦»çº¿å®‰è£…ikæ’ä»¶ï¼ˆæ¨èï¼‰1ï¼‰æŸ¥çœ‹æ•°æ®å·ç›®å½•å®‰è£…æ’ä»¶éœ€è¦çŸ¥é“elasticsearchçš„pluginsç›®å½•ä½ç½®ï¼Œè€Œæˆ‘ä»¬ç”¨äº†æ•°æ®å·æŒ‚è½½ï¼Œå› æ­¤éœ€è¦æŸ¥çœ‹elasticsearchçš„æ•°æ®å·ç›®å½•ï¼Œé€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹: docker volume inspect es-plugins æ˜¾ç¤ºç»“æœï¼š [ &#123; &quot;CreatedAt&quot;: &quot;2022-05-06T10:06:34+08:00&quot;, &quot;Driver&quot;: &quot;local&quot;, &quot;Labels&quot;: null, &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/es-plugins/_data&quot;, &quot;Name&quot;: &quot;es-plugins&quot;, &quot;Options&quot;: null, &quot;Scope&quot;: &quot;local&quot; &#125;] è¯´æ˜pluginsç›®å½•è¢«æŒ‚è½½åˆ°äº†ï¼š/var/lib/docker/volumes/es-plugins/_data è¿™ä¸ªç›®å½•ä¸­ã€‚ 2ï¼‰è§£å‹ç¼©åˆ†è¯å™¨å®‰è£…åŒ…ä¸‹é¢æˆ‘ä»¬éœ€è¦æŠŠè¯¾å‰èµ„æ–™ä¸­çš„ikåˆ†è¯å™¨è§£å‹ç¼©ï¼Œé‡å‘½åä¸ºik 3ï¼‰ä¸Šä¼ åˆ°eså®¹å™¨çš„æ’ä»¶æ•°æ®å·ä¸­ä¹Ÿå°±æ˜¯/var/lib/docker/volumes/es-plugins/_data ï¼š 4ï¼‰é‡å¯å®¹å™¨# 4ã€é‡å¯å®¹å™¨docker restart es # æŸ¥çœ‹esæ—¥å¿—docker logs -f es 5ï¼‰æµ‹è¯•ï¼šIKåˆ†è¯å™¨åŒ…å«ä¸¤ç§æ¨¡å¼ï¼š ik_smartï¼šæœ€å°‘åˆ‡åˆ† ik_max_wordï¼šæœ€ç»†åˆ‡åˆ† GET /_analyze&#123; &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;text&quot;: &quot;é»‘é©¬ç¨‹åºå‘˜å­¦ä¹ javaå¤ªæ£’äº†&quot;&#125; ç»“æœï¼š &#123; &quot;tokens&quot; : [ &#123; &quot;token&quot; : &quot;é»‘é©¬&quot;, &quot;start_offset&quot; : 0, &quot;end_offset&quot; : 2, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 0 &#125;, &#123; &quot;token&quot; : &quot;ç¨‹åºå‘˜&quot;, &quot;start_offset&quot; : 2, &quot;end_offset&quot; : 5, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 1 &#125;, &#123; &quot;token&quot; : &quot;ç¨‹åº&quot;, &quot;start_offset&quot; : 2, &quot;end_offset&quot; : 4, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 2 &#125;, &#123; &quot;token&quot; : &quot;å‘˜&quot;, &quot;start_offset&quot; : 4, &quot;end_offset&quot; : 5, &quot;type&quot; : &quot;CN_CHAR&quot;, &quot;position&quot; : 3 &#125;, &#123; &quot;token&quot; : &quot;å­¦ä¹ &quot;, &quot;start_offset&quot; : 5, &quot;end_offset&quot; : 7, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 4 &#125;, &#123; &quot;token&quot; : &quot;java&quot;, &quot;start_offset&quot; : 7, &quot;end_offset&quot; : 11, &quot;type&quot; : &quot;ENGLISH&quot;, &quot;position&quot; : 5 &#125;, &#123; &quot;token&quot; : &quot;å¤ªæ£’äº†&quot;, &quot;start_offset&quot; : 11, &quot;end_offset&quot; : 14, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 6 &#125;, &#123; &quot;token&quot; : &quot;å¤ªæ£’&quot;, &quot;start_offset&quot; : 11, &quot;end_offset&quot; : 13, &quot;type&quot; : &quot;CN_WORD&quot;, &quot;position&quot; : 7 &#125;, &#123; &quot;token&quot; : &quot;äº†&quot;, &quot;start_offset&quot; : 13, &quot;end_offset&quot; : 14, &quot;type&quot; : &quot;CN_CHAR&quot;, &quot;position&quot; : 8 &#125; ]&#125; 3.3 æ‰©å±•è¯è¯å…¸éšç€äº’è”ç½‘çš„å‘å±•ï¼Œâ€œé€ è¯è¿åŠ¨â€ä¹Ÿè¶Šå‘çš„é¢‘ç¹ã€‚å‡ºç°äº†å¾ˆå¤šæ–°çš„è¯è¯­ï¼Œåœ¨åŸæœ‰çš„è¯æ±‡åˆ—è¡¨ä¸­å¹¶ä¸å­˜åœ¨ã€‚æ¯”å¦‚ï¼šâ€œå¥¥åŠ›ç»™â€ï¼Œâ€œä¼ æ™ºæ’­å®¢â€ ç­‰ã€‚ æ‰€ä»¥æˆ‘ä»¬çš„è¯æ±‡ä¹Ÿéœ€è¦ä¸æ–­çš„æ›´æ–°ï¼ŒIKåˆ†è¯å™¨æä¾›äº†æ‰©å±•è¯æ±‡çš„åŠŸèƒ½ã€‚ 1ï¼‰æ‰“å¼€IKåˆ†è¯å™¨configç›®å½•ï¼š 2ï¼‰åœ¨IKAnalyzer.cfg.xmlé…ç½®æ–‡ä»¶å†…å®¹æ·»åŠ ï¼š &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE properties SYSTEM &quot;http://java.sun.com/dtd/properties.dtd&quot;&gt;&lt;properties&gt; &lt;comment&gt;IK Analyzer æ‰©å±•é…ç½®&lt;/comment&gt; &lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸ *** æ·»åŠ æ‰©å±•è¯å…¸--&gt; &lt;entry key=&quot;ext_dict&quot;&gt;ext.dic&lt;/entry&gt;&lt;/properties&gt; 3ï¼‰æ–°å»ºä¸€ä¸ª ext.dicï¼Œå¯ä»¥å‚è€ƒconfigç›®å½•ä¸‹å¤åˆ¶ä¸€ä¸ªé…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ ä¼ æ™ºæ’­å®¢å¥¥åŠ›ç»™ 4ï¼‰é‡å¯elasticsearch docker restart es# æŸ¥çœ‹ æ—¥å¿—docker logs -f elasticsearch æ—¥å¿—ä¸­å·²ç»æˆåŠŸåŠ è½½ext.dicé…ç½®æ–‡ä»¶ 5ï¼‰æµ‹è¯•æ•ˆæœï¼š GET /_analyze&#123; &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;text&quot;: &quot;ä¼ æ™ºæ’­å®¢Javaå°±ä¸šè¶…è¿‡90%,å¥¥åŠ›ç»™ï¼&quot;&#125; æ³¨æ„å½“å‰æ–‡ä»¶çš„ç¼–ç å¿…é¡»æ˜¯ UTF-8 æ ¼å¼ï¼Œä¸¥ç¦ä½¿ç”¨Windowsè®°äº‹æœ¬ç¼–è¾‘ 3.4 åœç”¨è¯è¯å…¸åœ¨äº’è”ç½‘é¡¹ç›®ä¸­ï¼Œåœ¨ç½‘ç»œé—´ä¼ è¾“çš„é€Ÿåº¦å¾ˆå¿«ï¼Œæ‰€ä»¥å¾ˆå¤šè¯­è¨€æ˜¯ä¸å…è®¸åœ¨ç½‘ç»œä¸Šä¼ é€’çš„ï¼Œå¦‚ï¼šå…³äºå®—æ•™ã€æ”¿æ²»ç­‰æ•æ„Ÿè¯è¯­ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨æœç´¢æ—¶ä¹Ÿåº”è¯¥å¿½ç•¥å½“å‰è¯æ±‡ã€‚ IKåˆ†è¯å™¨ä¹Ÿæä¾›äº†å¼ºå¤§çš„åœç”¨è¯åŠŸèƒ½ï¼Œè®©æˆ‘ä»¬åœ¨ç´¢å¼•æ—¶å°±ç›´æ¥å¿½ç•¥å½“å‰çš„åœç”¨è¯æ±‡è¡¨ä¸­çš„å†…å®¹ã€‚ 1ï¼‰IKAnalyzer.cfg.xmlé…ç½®æ–‡ä»¶å†…å®¹æ·»åŠ ï¼š &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE properties SYSTEM &quot;http://java.sun.com/dtd/properties.dtd&quot;&gt;&lt;properties&gt; &lt;comment&gt;IK Analyzer æ‰©å±•é…ç½®&lt;/comment&gt; &lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸--&gt; &lt;entry key=&quot;ext_dict&quot;&gt;ext.dic&lt;/entry&gt; &lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•åœæ­¢è¯å­—å…¸ *** æ·»åŠ åœç”¨è¯è¯å…¸--&gt; &lt;entry key=&quot;ext_stopwords&quot;&gt;stopword.dic&lt;/entry&gt;&lt;/properties&gt; 3ï¼‰åœ¨ stopword.dic æ·»åŠ åœç”¨è¯ ä¹ å¤§å¤§ 4ï¼‰é‡å¯elasticsearch # é‡å¯æœåŠ¡docker restart elasticsearchdocker restart kibana# æŸ¥çœ‹ æ—¥å¿—docker logs -f elasticsearch æ—¥å¿—ä¸­å·²ç»æˆåŠŸåŠ è½½stopword.dicé…ç½®æ–‡ä»¶ 5ï¼‰æµ‹è¯•æ•ˆæœï¼š GET /_analyze&#123; &quot;analyzer&quot;: &quot;ik_max_word&quot;, &quot;text&quot;: &quot;ä¼ æ™ºæ’­å®¢Javaå°±ä¸šç‡è¶…è¿‡95%,ä¹ å¤§å¤§éƒ½ç‚¹èµ,å¥¥åŠ›ç»™ï¼&quot;&#125; æ³¨æ„å½“å‰æ–‡ä»¶çš„ç¼–ç å¿…é¡»æ˜¯ UTF-8 æ ¼å¼ï¼Œä¸¥ç¦ä½¿ç”¨Windowsè®°äº‹æœ¬ç¼–è¾‘ 4.éƒ¨ç½²esé›†ç¾¤éƒ¨ç½²esé›†ç¾¤å¯ä»¥ç›´æ¥ä½¿ç”¨docker-composeæ¥å®Œæˆï¼Œä¸è¿‡è¦æ±‚ä½ çš„Linuxè™šæ‹Ÿæœºè‡³å°‘æœ‰4Gçš„å†…å­˜ç©ºé—´ é¦–å…ˆç¼–å†™ä¸€ä¸ªdocker-composeæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š version: &#x27;2.2&#x27;services: es01: image: docker.elastic.co/elasticsearch/elasticsearch:7.12.1 container_name: es01 environment: - node.name=es01 - cluster.name=es-docker-cluster - discovery.seed_hosts=es02,es03 - cluster.initial_master_nodes=es01,es02,es03 - bootstrap.memory_lock=true - &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot; ulimits: memlock: soft: -1 hard: -1 volumes: - data01:/usr/share/elasticsearch/data ports: - 9200:9200 networks: - elastic es02: image: docker.elastic.co/elasticsearch/elasticsearch:7.12.1 container_name: es02 environment: - node.name=es02 - cluster.name=es-docker-cluster - discovery.seed_hosts=es01,es03 - cluster.initial_master_nodes=es01,es02,es03 - bootstrap.memory_lock=true - &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot; ulimits: memlock: soft: -1 hard: -1 volumes: - data02:/usr/share/elasticsearch/data networks: - elastic es03: image: docker.elastic.co/elasticsearch/elasticsearch:7.12.1 container_name: es03 environment: - node.name=es03 - cluster.name=es-docker-cluster - discovery.seed_hosts=es01,es02 - cluster.initial_master_nodes=es01,es02,es03 - bootstrap.memory_lock=true - &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot; ulimits: memlock: soft: -1 hard: -1 volumes: - data03:/usr/share/elasticsearch/data networks: - elasticvolumes: data01: driver: local data02: driver: local data03: driver: localnetworks: elastic: driver: bridge Run docker-compose to bring up the cluster: docker-compose up","categories":[{"name":"æ•™ç¨‹","slug":"æ•™ç¨‹","permalink":"https://aqu.iyunmc.cn/categories/%E6%95%99%E7%A8%8B/"}],"tags":[{"name":"Linux","slug":"linux","permalink":"https://aqu.iyunmc.cn/tags/linux/"}]},{"title":"Ribbonè´Ÿè½½å‡è¡¡","slug":"blog/Ribbonè´Ÿè½½å‡è¡¡","date":"2023-03-12T16:00:00.000Z","updated":"2023-06-05T07:36:25.911Z","comments":true,"path":"blog/Ribbonè´Ÿè½½å‡è¡¡/","link":"","permalink":"https://aqu.iyunmc.cn/blog/Ribbon%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/","excerpt":"1. Ribbonè´Ÿè½½å‡è¡¡è§„åˆ™","text":"1. Ribbonè´Ÿè½½å‡è¡¡è§„åˆ™ è§„åˆ™æ¥å£æ˜¯IRule é»˜è®¤å®ç°æ˜¯ZoneAvoidanceRuleï¼Œæ ¹æ®zoneé€‰æ‹©æœåŠ¡åˆ—è¡¨ï¼Œç„¶åè½®è¯¢ 2. è´Ÿè½½å‡è¡¡è‡ªå®šä¹‰æ–¹å¼ ä»£ç æ–¹å¼ï¼šé…ç½®çµæ´»ï¼Œä½†ä¿®æ”¹æ—¶éœ€è¦é‡æ–°æ‰“åŒ…å‘å¸ƒ é…ç½®æ–¹å¼ï¼šç›´è§‚ï¼Œæ–¹ä¾¿ï¼Œæ— éœ€é‡æ–°æ‰“åŒ…å‘å¸ƒï¼Œä½†æ˜¯æ— æ³•åšå…¨å±€é…ç½® 3. é¥¥é¥¿åŠ è½½ å¼€å¯é¥¥é¥¿åŠ è½½ æŒ‡å®šé¥¥é¥¿åŠ è½½çš„å¾®æœåŠ¡åç§° spring: cloud: nacos: server-addr: localhost:8848 # nacos æœåŠ¡åœ°å€ discovery: cluster-name: SH # é›†ç¾¤åç§° NacosæœåŠ¡åˆ†çº§æ¨¡å‹1. NacosæœåŠ¡åˆ†çº§å­˜å‚¨æ¨¡å‹ ä¸€çº§æ˜¯æœåŠ¡ï¼Œä¾‹å¦‚userservice äºŒçº§æ˜¯é›†ç¾¤ï¼Œä¾‹å¦‚æ­å·æˆ–ä¸Šæµ· ä¸‰çº§æ˜¯å®ä¾‹ï¼Œä¾‹å¦‚æ­å·æœºæˆ¿çš„æŸå°éƒ¨ç½²äº†userserviceçš„æœåŠ¡å™¨ 2. å¦‚ä½•è®¾ç½®å®ä¾‹çš„é›†ç¾¤å±æ€§ä¿®æ”¹application.ymlæ–‡ä»¶ï¼Œæ·»åŠ spring.cloud.nacos.discovery.cluster-nameå±æ€§å³å¯ Nacosè´Ÿè½½å‡è¡¡ç­–ç•¥1. NacosRuleè´Ÿè½½å‡è¡¡ç­–ç•¥ ä¼˜å…ˆé€‰æ‹©åŒé›†ç¾¤æœåŠ¡å®ä¾‹åˆ—è¡¨ æœ¬åœ°é›†ç¾¤æ‰¾ä¸åˆ°æä¾›è€…ï¼Œæ‰å»æ‰¾å…¶ä»–é›†ç¾¤å¯»æ‰¾ï¼Œå¹¶ä¸”ä¼šæŠ¥è­¦å‘Š ç¡®å®šäº†å¯ç”¨å®ä¾‹åˆ—è¡¨åï¼Œå†é‡‡ç”¨éšæœºè´Ÿè½½å‡è¡¡æŒ‘é€‰å®ä¾‹ Nacosæ³¨å†Œä¸­å¿ƒ - åŠ æƒè´Ÿè½½å‡è¡¡1. å®ä¾‹çš„æƒé‡æ§åˆ¶ Nacosæ§åˆ¶å°å¯ä»¥è®¾ç½®åŠ¿å®ä¾‹çš„æƒé‡å€¼ï¼Œ0~1 åŒé›†ç¾¤å†…çš„å¤šä¸ªå®ä¾‹ï¼Œæƒé‡è¶Šé«˜è¢«è®¿é—®çš„é¢‘ç‡è¶Šé«˜ æƒé‡è®¾ç½®ä¸º0åˆ™å®Œå…¨ä¸ä¼šè¢«è®¿é—®","categories":[{"name":"æ•™ç¨‹","slug":"æ•™ç¨‹","permalink":"https://aqu.iyunmc.cn/categories/%E6%95%99%E7%A8%8B/"}],"tags":[{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"https://aqu.iyunmc.cn/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/"}]},{"title":"RabbitMqä»å…¥é—¨åˆ°ç²¾é€š","slug":"blog/RabbitMqä»å…¥é—¨åˆ°ç²¾é€š","date":"2023-03-07T11:50:00.000Z","updated":"2023-06-04T12:22:00.190Z","comments":true,"path":"blog/RabbitMqä»å…¥é—¨åˆ°ç²¾é€š/","link":"","permalink":"https://aqu.iyunmc.cn/blog/RabbitMq%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/","excerpt":"ä»€ä¹ˆæ˜¯æ¶ˆæ¯ä¸­é—´ä»¶ï¼Ÿ æ¶ˆæ¯ä¸­é—´ä»¶åŸºäºé˜Ÿåˆ—æ¨¡å‹å®ç°å¼‚æ­¥&#x2F;åŒæ­¥ä¼ è¾“æ•°æ® ä½œç”¨ï¼šå¯ä»¥å®ç°æ”¯æ’‘é«˜å¹¶å‘ã€å¼‚æ­¥è§£è€¦ã€æµé‡å‰Šå³°ã€é™ä½è€¦åˆåº¦ã€‚ ä¼ ç»Ÿçš„httpè¯·æ±‚å­˜åœ¨é‚£äº›ç¼ºç‚¹","text":"ä»€ä¹ˆæ˜¯æ¶ˆæ¯ä¸­é—´ä»¶ï¼Ÿ æ¶ˆæ¯ä¸­é—´ä»¶åŸºäºé˜Ÿåˆ—æ¨¡å‹å®ç°å¼‚æ­¥&#x2F;åŒæ­¥ä¼ è¾“æ•°æ® ä½œç”¨ï¼šå¯ä»¥å®ç°æ”¯æ’‘é«˜å¹¶å‘ã€å¼‚æ­¥è§£è€¦ã€æµé‡å‰Šå³°ã€é™ä½è€¦åˆåº¦ã€‚ ä¼ ç»Ÿçš„httpè¯·æ±‚å­˜åœ¨é‚£äº›ç¼ºç‚¹ Httpè¯·æ±‚åŸºäºè¯·æ±‚ä¸å“åº”çš„æ¨¡å‹ï¼Œåœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å‘é€å¤§é‡çš„è¯·æ±‚è¾¾åˆ°æœåŠ¡å™¨ç«¯æœ‰å¯èƒ½ä¼šå¯¼è‡´æˆ‘ä»¬æœåŠ¡å™¨ç«¯å¤„ç†è¯·æ±‚å †ç§¯ã€‚ TomcatæœåŠ¡å™¨å¤„ç†æ¯ä¸ªè¯·æ±‚éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„çº¿ç¨‹ï¼Œå¦‚æœè¶…è¿‡æœ€å¤§çº¿ç¨‹æ•°ä¼šå°†è¯¥è¯·æ±‚ç¼“å­˜åˆ°é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœè¯·æ±‚å †ç§¯è¿‡å¤šçš„æƒ…å†µä¸‹ï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´tomcatæœåŠ¡å™¨å´©æºƒçš„é—®é¢˜ã€‚ æ‰€ä»¥ä¸€èˆ¬éƒ½ä¼šåœ¨nginxå…¥å£å®ç°é™æµï¼Œæ•´åˆæœåŠ¡ä¿æŠ¤æ¡†æ¶ã€‚ httpè¯·æ±‚å¤„ç†ä¸šåŠ¡é€»è¾‘å¦‚æœæ¯”è¾ƒè€—æ—¶çš„æƒ…å†µä¸‹ï¼Œå®¹æ˜“é€ æˆå®¢æˆ·ç«¯ä¸€ç›´ç­‰å¾…ï¼Œé˜»å¡ç­‰å¾…è¿‡ç¨‹ä¸­ä¼šå¯¼è‡´å®¢æˆ·ç«¯è¶…æ—¶å‘ç”Ÿé‡è¯•ç­–ç•¥ï¼Œæœ‰å¯èƒ½ä¼šå¼•å‘å¹‚ç­‰æ€§é—®é¢˜ã€‚ æ³¨æ„äº‹é¡¹ï¼šæ¥å£æ˜¯ä¸ºhttpåè®®çš„æƒ…å†µä¸‹ï¼Œæœ€å¥½ä¸è¦å¤„ç†æ¯”è¾ƒè€—æ—¶çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€—æ—¶çš„ä¸šåŠ¡é€»è¾‘åº”è¯¥å•ç‹¬äº¤ç»™å¤šçº¿ç¨‹æˆ–è€…æ˜¯mqå¤„ç†ã€‚ Mqåº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ å¼‚æ­¥å‘é€çŸ­ä¿¡ å¼‚æ­¥å‘é€æ–°äººä¼˜æƒ åˆ¸ å¤„ç†ä¸€äº›æ¯”è¾ƒè€—æ—¶çš„æ“ä½œ ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨mqå¯ä»¥å®ç°æ”¯æ’‘é«˜å¹¶å‘ã€å¼‚æ­¥è§£è€¦ã€æµé‡å‰Šå³°ã€é™ä½è€¦åˆåº¦ã€‚ Mqä¸å¤šçº¿ç¨‹ä¹‹é—´åŒºåˆ« MQå¯ä»¥å®ç°å¼‚æ­¥&#x2F;è§£è€¦&#x2F;æµé‡å‰Šå³°é—®é¢˜ï¼› å¤šçº¿ç¨‹ä¹Ÿå¯ä»¥å®ç°å¼‚æ­¥ï¼Œä½†æ˜¯æ¶ˆè€—åˆ°cpuèµ„æºï¼Œæ²¡æœ‰å®ç°è§£è€¦ã€‚ Mqæ¶ˆæ¯ä¸­é—´ä»¶åè¯ Producer ç”Ÿäº§è€…ï¼šæŠ•é€’æ¶ˆæ¯åˆ°MQæœåŠ¡å™¨ç«¯ï¼› Consumer æ¶ˆè´¹è€…ï¼šä»MQæœåŠ¡å™¨ç«¯è·å–æ¶ˆæ¯å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼› Broker MQæœåŠ¡å™¨ç«¯ Topic ä¸»é¢˜ï¼šåˆ†ç±»ä¸šåŠ¡é€»è¾‘å‘é€çŸ­ä¿¡ä¸»é¢˜ã€å‘é€ä¼˜æƒ åˆ¸ä¸»é¢˜ Queue å­˜æ”¾æ¶ˆæ¯æ¨¡å‹ é˜Ÿåˆ— å…ˆè¿›å…ˆå‡º åè¿›åå‡ºåŸåˆ™ æ•°ç»„&#x2F;é“¾è¡¨ Message ç”Ÿäº§è€…æŠ•é€’æ¶ˆæ¯æŠ¥æ–‡ï¼šjson ä¸»æµmqåŒºåˆ«å¯¹æ¯” ç‰¹æ€§ ActiveMQ RabbitMQ RocketMQ Kafka å¼€å‘è¯­è¨€ java erlang java scala å•æœºååé‡ ä¸‡çº§ ä¸‡çº§ 10ä¸‡çº§ 10ä¸‡çº§ æ—¶æ•ˆæ€§ msçº§ usçº§ msçº§ msçº§ä»¥å†… å¯ç”¨æ€§ é«˜(ä¸»ä»æ¶æ„) é«˜(ä¸»ä»æ¶æ„) éå¸¸é«˜(åˆ†å¸ƒå¼æ¶æ„) éå¸¸é«˜(åˆ†å¸ƒå¼æ¶æ„) åŠŸèƒ½ç‰¹æ€§ æˆç†Ÿçš„äº§å“ï¼Œåœ¨å¾ˆå¤šå…¬å¸å¾—åˆ°åº”ç”¨ï¼›æœ‰è¾ƒå¤šçš„æ–‡æ¡£ï¼›å„ç§åè®®æ”¯æŒè¾ƒå¥½ åŸºäºerlangå¼€å‘ï¼Œæ‰€ä»¥å¹¶å‘èƒ½åŠ›å¾ˆå¼ºï¼Œæ€§èƒ½æå…¶å¥½ï¼Œå»¶æ—¶å¾ˆä½ç®¡ç†ç•Œé¢è¾ƒä¸°å¯Œ MQåŠŸèƒ½æ¯”è¾ƒå®Œå¤‡ï¼Œæ‰©å±•æ€§ä½³ åªæ”¯æŒä¸»è¦çš„MQåŠŸèƒ½ï¼Œåƒä¸€äº›æ¶ˆæ¯æŸ¥è¯¢ï¼Œæ¶ˆæ¯å›æº¯ç­‰åŠŸèƒ½æ²¡æœ‰æä¾›ï¼Œæ¯•ç«Ÿæ˜¯ä¸ºå¤§æ•°æ®å‡†å¤‡çš„ï¼Œåœ¨å¤§æ•°æ®é¢†åŸŸåº”ç”¨å¹¿ åŸºäºå¤šçº¿ç¨‹é˜Ÿåˆ—ç®€å•å®ç°mqimport com.alibaba.fastjson.JSONObject;import java.util.concurrent.LinkedBlockingDeque;public class STThreadMQ &#123; private static LinkedBlockingDeque&lt;JSONObject&gt; msgs = new LinkedBlockingDeque&lt;&gt;(); public static void main(String[] args) &#123; //ç”Ÿäº§çº¿ç¨‹ Thread producerThread = new Thread(new Runnable() &#123; @Override public void run() &#123; try &#123; while (true)&#123; Thread.sleep(1000); JSONObject data = new JSONObject(); data.put(&quot;userId&quot;,&quot;1234&quot;); //å­˜å…¥æ¶ˆæ¯ msgs.offer(data); System.out.println(Thread.currentThread().getName()+ &quot;,&quot; +data); &#125; &#125;catch (Exception e)&#123; &#125; &#125; &#125;,&quot;ç”Ÿäº§è€…&quot;); producerThread.start(); //æ¶ˆè´¹çº¿ç¨‹ Thread ConsumerThread = new Thread(new Runnable() &#123; @Override public void run() &#123; try &#123; while (true)&#123; JSONObject data = msgs.poll(); if (data != null)&#123; System.out.println(Thread.currentThread().getName()+ &quot;,&quot; +data); &#125; &#125; &#125;catch (Exception e)&#123; &#125; &#125; &#125;,&quot;æ¶ˆè´¹è€…&quot;); ConsumerThread.start(); &#125;&#125; ç”Ÿäº§è€…æŠ•é€’æ¶ˆæ¯ç»™MQæœåŠ¡å™¨ç«¯ï¼ŒMQæœåŠ¡å™¨ç«¯éœ€è¦ç¼“å­˜è¯¥æ¶ˆæ¯ å¦‚æœmqæœåŠ¡å™¨ç«¯å®•æœºä¹‹åï¼Œæ¶ˆæ¯å¦‚ä½•ä¿è¯ä¸ä¸¢å¤± æŒä¹…åŒ–æœºåˆ¶ å¦‚æœmqæ¥æ”¶åˆ°ç”Ÿäº§è€…æŠ•é€’æ¶ˆæ¯ï¼Œå¦‚æœæ¶ˆè´¹è€…ä¸åœ¨çš„æƒ…å†µä¸‹ï¼Œè¯¥æ¶ˆæ¯æ˜¯å¦ä¼šä¸¢å¤±ï¼Ÿ ä¸ä¼šä¸¢å¤±ï¼Œæ¶ˆæ¯ç¡®è®¤æœºåˆ¶ å¿…é¡»è¦æ¶ˆè´¹è€…æ¶ˆè´¹è¯¥æ¶ˆæ¯æˆåŠŸä¹‹åï¼Œå†é€šçŸ¥ç»™mqæœåŠ¡å™¨ç«¯åˆ é™¤è¯¥æ¶ˆæ¯ã€‚ MqæœåŠ¡å™¨ç«¯å°†è¯¥æ¶ˆæ¯æ¨é€æ¶ˆè´¹è€…ï¼š æ¶ˆè´¹è€…å·²ç»å’ŒmqæœåŠ¡å™¨ä¿æŒé•¿è¿æ¥ã€‚ æ¶ˆè´¹è€…ä¸»åŠ¨æ‹‰å–æ¶ˆæ¯ï¼š æ¶ˆè´¹è€…ç¬¬ä¸€æ¬¡åˆšå¯åŠ¨çš„æ—¶å€™ Mqå¦‚ä½•å®ç°æŠ—é«˜å¹¶å‘æ€æƒ³ Mqæ¶ˆè´¹è€…æ ¹æ®è‡ªèº«èƒ½åŠ›æƒ…å†µ ï¼Œæ‹‰å–mqæœåŠ¡å™¨ç«¯æ¶ˆæ¯æ¶ˆè´¹ é»˜è®¤çš„æƒ…å†µä¸‹æ˜¯å–å‡ºä¸€æ¡æ¶ˆæ¯ ç¼ºç‚¹ï¼šå­˜åœ¨å»¶è¿Ÿçš„é—®é¢˜ éœ€è¦è€ƒè™‘mqæ¶ˆè´¹è€…æé«˜é€Ÿç‡çš„é—®é¢˜ å¦‚ä½•æ¶ˆè´¹è€…æé«˜é€Ÿç‡ï¼šæ¶ˆè´¹è€…å®ç°é›†ç¾¤ã€æ¶ˆè´¹è€…æ‰¹é‡è·å–æ¶ˆæ¯å³å¯ RabbitMQRabbitMQåŸºæœ¬ä»‹ç»RabbitMQæ˜¯å®ç°äº†é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼ˆAMQPï¼‰çš„å¼€æºæ¶ˆæ¯ä»£ç†è½¯ä»¶ï¼ˆäº¦ç§°é¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶ï¼‰ï¼ŒRabbitMQæœåŠ¡å™¨æ˜¯ç”¨Erlangè¯­è¨€ç¼–å†™çš„ã€‚ RabitMQå®˜æ–¹ç½‘ç«™: https://www.rabbitmq.com/ 1.ç‚¹å¯¹ç‚¹(ç®€å•)çš„é˜Ÿåˆ— 2.å·¥ä½œ(å…¬å¹³æ€§)é˜Ÿåˆ—æ¨¡å¼ 3.å‘å¸ƒè®¢é˜…æ¨¡å¼ 4.è·¯ç”±æ¨¡å¼Routing 5.é€šé…ç¬¦æ¨¡å¼Topics 6.RPC https://www.rabbitmq.com/getstarted.html RabbitMQç¯å¢ƒçš„åŸºæœ¬å®‰è£… 1.ä¸‹è½½å¹¶å®‰è£…erlang,ä¸‹è½½åœ°å€ï¼šhttp://www.erlang.org/download 2.é…ç½®erlangç¯å¢ƒå˜é‡ä¿¡æ¯ æ–°å¢ç¯å¢ƒå˜é‡ERLANG_HOME&#x3D;erlangçš„å®‰è£…åœ°å€ å°†%ERLANG_HOME%\\binåŠ å…¥åˆ°pathä¸­ 3.ä¸‹è½½å¹¶å®‰è£…RabbitMQï¼Œä¸‹è½½åœ°å€ï¼šhttp://www.rabbitmq.com/download.html **æ³¨æ„: RabbitMQ å®ƒä¾èµ–äºErlang,éœ€è¦å…ˆå®‰è£…Erlangã€‚ https://www.rabbitmq.com/install-windows.html ** å¯åŠ¨Rabbitmqå¸¸è§é—®é¢˜å¦‚æœrabbitmq å¯åŠ¨æˆåŠŸæ— æ³•è®¿é—® ç®¡ç†å¹³å°é¡µé¢ è¿›å…¥åˆ°F:\\path\\rabbitmq\\rabbitmq\\rabbitmq_server-3.6.9\\sbin&gt; æ‰§è¡Œ rabbitmq-plugins enable rabbitmq_management rabbitmqctl start_app Rabbitmqç®¡ç†å¹³å°ä¸­å¿ƒRabbitMQ ç®¡ç†å¹³å°åœ°å€ http://127.0.0.1:15672 é»˜è®¤è´¦å·:guest&#x2F;guest ç”¨æˆ·å¯ä»¥è‡ªå·±åˆ›å»ºæ–°çš„è´¦å· Virtual Hosts: åƒmysqlæœ‰æ•°æ®åº“çš„æ¦‚å¿µå¹¶ä¸”å¯ä»¥æŒ‡å®šç”¨æˆ·å¯¹åº“å’Œè¡¨ç­‰æ“ä½œçš„æƒé™ã€‚é‚£RabbitMQå‘¢ï¼Ÿ RabbitMQä¹Ÿæœ‰ç±»ä¼¼çš„æƒé™ç®¡ç†ã€‚åœ¨RabbitMQä¸­å¯ä»¥è™šæ‹Ÿæ¶ˆæ¯æœåŠ¡å™¨VirtualHostï¼Œæ¯ä¸ªVirtualHostç›¸å½“æœˆä¸€ä¸ªç›¸å¯¹ç‹¬ç«‹çš„RabbitMQæœåŠ¡å™¨ï¼Œæ¯ä¸ªVirtualHostä¹‹é—´æ˜¯ç›¸äº’éš”ç¦»çš„ã€‚exchangeã€queueã€messageä¸èƒ½äº’é€š é»˜è®¤çš„ç«¯å£15672ï¼šrabbitmqç®¡ç†å¹³å°ç«¯å£å· é»˜è®¤çš„ç«¯å£5672ï¼š rabbitmqæ¶ˆæ¯ä¸­é—´å†…éƒ¨é€šè®¯çš„ç«¯å£ é»˜è®¤çš„ç«¯å£å·25672 rabbitmqé›†ç¾¤çš„ç«¯å£å· RabbitMQå¸¸è§åè¯&#x2F;Virtual Hosts---åˆ†ç±» &#x2F;é˜Ÿåˆ— å­˜æ”¾æˆ‘ä»¬æ¶ˆæ¯ Exchange åˆ†æ´¾æˆ‘ä»¬æ¶ˆæ¯åœ¨é‚£ä¸ªé˜Ÿåˆ—å­˜æ”¾èµ·æ¥ ç±»ä¼¼äºnginx 15672---rabbitmqæ§åˆ¶å°ç®¡ç†å¹³å° httpåè®® 25672---rabbitmq é›†ç¾¤é€šä¿¡ç«¯å£å· Amqp 5672---rabbitmqå†…éƒ¨é€šä¿¡çš„ä¸€ä¸ªç«¯å£å· å¿«é€Ÿå…¥é—¨RabbitMQç®€å•é˜Ÿåˆ—é¦–å…ˆéœ€è¦å†RabbitMQå¹³å°åˆ›å»ºVirtual Hosts å’Œé˜Ÿåˆ—ã€‚ &#x2F;meiteVirtualHosts ----è®¢å•é˜Ÿåˆ— ----æ”¯ä»˜é˜Ÿåˆ— åœ¨RabbitMQå¹³å°åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼š åœ¨ç¼–å†™ç”Ÿäº§è€…ä»£ç  import com.rabbitmq.client.Channel;import com.rabbitmq.client.Connection;import java.io.IOException;import java.util.concurrent.TimeoutException;public class Producer &#123; private static final String QUEUE_NAME = &quot;mayikt--queue&quot;; public static void main(String[] args) throws IOException, TimeoutException &#123; //1.åˆ›å»ºè¿æ¥ Connection connection = RabbitMQConnection.getConnection(); //2.åˆ›å»ºé€šé“ Channel channel = connection.createChannel(); String msg = &quot;æ¯ç‰¹æ•™è‚²666&quot;; channel.basicPublish(null,QUEUE_NAME,null,msg.getBytes()); //å…³é—­é€šé“å’Œè¿æ¥ channel.close(); connection.close(); &#125;&#125; åœ¨ç¼–å†™æ¶ˆè´¹è€…ä»£ç  import com.rabbitmq.client.*;import java.io.IOException;import java.util.concurrent.TimeoutException;public class Consumer &#123; private static final String QUEUE_NAME = &quot;mayikt--queue&quot;; public static void main(String[] args) throws IOException, TimeoutException &#123; //1.åˆ›å»ºè¿æ¥ Connection connection = RabbitMQConnection.getConnection(); //2.è®¾ç½®é€šé“ Channel channel = connection.createChannel(); DefaultConsumer defaultConsumer = new DefaultConsumer(channel)&#123; @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,byte[] body)throws IOException&#123; String msg = new String(body,&quot;UTF-8&quot;); System.out.println(&quot;æ¶ˆè´¹è€…è·å–æ¶ˆæ¯:&quot; + msg); &#125; &#125;; //3.ç›‘å¬é˜Ÿåˆ— //autoAck true:è‡ªåŠ¨ç­¾æ”¶ //autoAck false: channel.basicConsume(QUEUE_NAME,true,defaultConsumer); &#125;&#125; è¿æ¥ä»£ç  import com.rabbitmq.client.Connection;import com.rabbitmq.client.ConnectionFactory;import java.io.IOException;import java.util.concurrent.TimeoutException;public class RabbitMQConnection &#123; //è·å–è¿æ¥ public static Connection getConnection() throws IOException, TimeoutException &#123; ConnectionFactory connectionFactory = new ConnectionFactory(); //1.è®¾ç½®è¿æ¥VirtualHost connectionFactory.setVirtualHost(&quot;/meiteVirtualHosts&quot;); //2.è®¾ç½®è´¦å·å’Œå¯†ç  connectionFactory.setUsername(&quot;guest&quot;); connectionFactory.setPassword(&quot;guest&quot;); //3.mqè¿æ¥ä¿¡æ¯åœ°å€ connectionFactory.setHost(&quot;127.0.0.1&quot;); connectionFactory.setPort(5672); return connectionFactory.newConnection(); &#125;&#125; RabbitMQå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±Mqå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼š ç”Ÿäº§è€…è§’è‰² ç¡®ä¿ç”Ÿäº§è€…æŠ•é€’æ¶ˆæ¯åˆ°MQæœåŠ¡å™¨ç«¯æˆåŠŸã€‚ Ack æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ åŒæ­¥æˆ–è€…å¼‚æ­¥çš„å½¢å¼ æ–¹å¼1ï¼šConfirms æ–¹å¼2ï¼šäº‹åŠ¡æ¶ˆæ¯ æ¶ˆè´¹è€…æ¨¡å¼ åœ¨rabbitmqæƒ…å†µä¸‹ï¼š å¿…é¡»è¦å°†æ¶ˆæ¯æ¶ˆè´¹æˆåŠŸä¹‹åï¼Œæ‰ä¼šå°†è¯¥æ¶ˆæ¯ä»mqæœåŠ¡å™¨ç«¯ä¸­ç§»é™¤ã€‚ åœ¨kafkaä¸­çš„æƒ…å†µä¸‹ï¼š ä¸ç®¡æ˜¯æ¶ˆè´¹æˆåŠŸè¿˜æ˜¯æ¶ˆè´¹å¤±è´¥ï¼Œè¯¥æ¶ˆæ¯éƒ½ä¸ä¼šç«‹å³ä»mqæœåŠ¡å™¨ç«¯ç§»é™¤ã€‚ RabitMQå·¥ä½œé˜Ÿåˆ—é»˜è®¤çš„ä¼ ç»Ÿé˜Ÿåˆ—æ˜¯ä¸ºå‡æ‘Šæ¶ˆè´¹ï¼Œå­˜åœ¨ä¸å…¬å¹³æ€§ï¼›å¦‚æœæ¯ä¸ªæ¶ˆè´¹è€…é€Ÿåº¦ä¸ä¸€æ ·çš„æƒ…å†µä¸‹ï¼Œå‡æ‘Šæ¶ˆè´¹æ˜¯ä¸å…¬å¹³çš„ï¼Œåº”è¯¥æ˜¯èƒ½è€…å¤šåŠ³ã€‚ åœ¨é€šé“ä¸­åªéœ€è¦è®¾ç½®basicQosä¸º1å³å¯ï¼Œè¡¨ç¤ºMQæœåŠ¡å™¨æ¯æ¬¡åªä¼šç»™æ¶ˆè´¹è€…æ¨é€1æ¡æ¶ˆæ¯å¿…é¡»æ‰‹åŠ¨ackç¡®è®¤ä¹‹åæ‰ä¼šç»§ç»­å‘é€ã€‚channel.basicQos(1); import com.rabbitmq.client.*;import com.st.mq.RabbitMQConnection;import java.io.IOException;import java.util.concurrent.TimeoutException;public class Consumer02 &#123; private static final String QUEUE_NAME = &quot;mayikt-queue&quot;; public static void main(String[] args) throws IOException, TimeoutException, IOException, TimeoutException &#123; // 1.åˆ›å»ºè¿æ¥ Connection connection = RabbitMQConnection.getConnection(); // 2.è®¾ç½®é€šé“ Channel channel = connection.createChannel(); //æŒ‡å®šæˆ‘ä»¬æ¶ˆè´¹è€…æ¯æ¬¡æ‰¹é‡è·å–æ¶ˆæ¯ channel.basicQos(1); DefaultConsumer defaultConsumer = new DefaultConsumer(channel) &#123; @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException &#123; try &#123; Thread.sleep(100); &#125;catch (Exception e)&#123; &#125; String msg = new String(body, &quot;UTF-8&quot;); System.out.println(&quot;æ¶ˆè´¹è€…è·å–æ¶ˆæ¯:&quot; + msg); //æ¶ˆè´¹è€…å®Œæˆï¼Œåˆ é™¤æ¶ˆæ¯ channel.basicAck(envelope.getDeliveryTag(),false); &#125; &#125;; // 3.ç›‘å¬é˜Ÿåˆ— channel.basicConsume(QUEUE_NAME, false, defaultConsumer); &#125;&#125; import com.rabbitmq.client.*;import com.st.mq.RabbitMQConnection;import java.io.IOException;import java.util.concurrent.TimeoutException;public class Consumer01 &#123; private static final String QUEUE_NAME = &quot;mayikt-queue&quot;; public static void main(String[] args) throws IOException, TimeoutException, IOException, TimeoutException &#123; // 1.åˆ›å»ºè¿æ¥ Connection connection = RabbitMQConnection.getConnection(); // 2.è®¾ç½®é€šé“ Channel channel = connection.createChannel(); //æŒ‡å®šæˆ‘ä»¬æ¶ˆè´¹è€…æ¯æ¬¡æ‰¹é‡è·å–æ¶ˆæ¯ channel.basicQos(2); DefaultConsumer defaultConsumer = new DefaultConsumer(channel) &#123; @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException &#123; String msg = new String(body, &quot;UTF-8&quot;); System.out.println(&quot;æ¶ˆè´¹è€…è·å–æ¶ˆæ¯:&quot; + msg); //æ¶ˆè´¹è€…å®Œæˆ åˆ é™¤æ¶ˆæ¯ channel.basicAck(envelope.getDeliveryTag(),false); &#125; &#125;; // 3.ç›‘å¬é˜Ÿåˆ— channel.basicConsume(QUEUE_NAME, false, defaultConsumer); &#125;&#125; RabbitMQäº¤æ¢æœºç±»å‹Direct exchangeï¼ˆç›´è¿äº¤æ¢æœºï¼‰ Fanout exchangeï¼ˆæ‰‡å‹äº¤æ¢æœºï¼‰ Topic exchangeï¼ˆä¸»é¢˜äº¤æ¢æœºï¼‰ Headers exchangeï¼ˆå¤´äº¤æ¢æœºï¼‰ &#x2F;Virtual Hosts---åŒºåˆ†ä¸åŒçš„å›¢é˜Ÿ ----é˜Ÿåˆ— å­˜æ”¾æ¶ˆæ¯ ----äº¤æ¢æœº è·¯ç”±æ¶ˆæ¯å­˜æ”¾åœ¨é‚£ä¸ªé˜Ÿåˆ—ä¸­ ç±»ä¼¼äºnginx ---è·¯ç”±key åˆ†å‘è§„åˆ™ RabbitMQ Fanout å‘å¸ƒè®¢é˜…ç”Ÿäº§è€…å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œç»è¿‡äº¤æ¢æœºè½¬å‘åˆ°å¤šä¸ªä¸åŒçš„é˜Ÿåˆ—ï¼Œå¤šä¸ªä¸åŒçš„é˜Ÿåˆ—å°±å¤šä¸ªä¸åŒçš„æ¶ˆè´¹è€…ã€‚ åŸç†ï¼š éœ€è¦åˆ›å»ºä¸¤ä¸ªé˜Ÿåˆ— ï¼Œæ¯ä¸ªé˜Ÿåˆ—å¯¹åº”ä¸€ä¸ªæ¶ˆè´¹è€…ï¼› é˜Ÿåˆ—éœ€è¦ç»‘å®šæˆ‘ä»¬äº¤æ¢æœº ç”Ÿäº§è€…æŠ•é€’æ¶ˆæ¯åˆ°äº¤æ¢æœºä¸­ï¼Œäº¤æ¢æœºåœ¨å°†æ¶ˆæ¯åˆ†é…ç»™ä¸¤ä¸ªé˜Ÿåˆ—ä¸­éƒ½å­˜æ”¾èµ·æ¥ï¼› æ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­è·å–è¿™ä¸ªæ¶ˆæ¯ã€‚ ç”Ÿäº§è€…ä»£ç import com.mayikt.rabbitmq.RabbitMQConnection;import com.rabbitmq.client.Channel;import com.rabbitmq.client.Connection;import java.io.IOException;import java.util.concurrent.TimeoutException;public class ProducerFanout &#123; /** * å®šä¹‰äº¤æ¢æœºçš„åç§° */ private static final String EXCHANGE_NAME = &quot;fanout_exchange&quot;; public static void main(String[] args) throws IOException, TimeoutException &#123; // åˆ›å»ºConnection Connection connection = RabbitMQConnection.getConnection(); // åˆ›å»ºChannel Channel channel = connection.createChannel(); // é€šé“å…³è”äº¤æ¢æœº channel.exchangeDeclare(EXCHANGE_NAME, &quot;fanout&quot;, true); String msg = &quot;æ¯ç‰¹æ•™è‚²6666&quot;; channel.basicPublish(EXCHANGE_NAME, &quot;&quot;, null, msg.getBytes()); channel.close(); connection.close(); &#125;&#125; æ¶ˆè´¹è€…ä»£ç é‚®ä»¶æ¶ˆè´¹è€…import com.mayikt.rabbitmq.RabbitMQConnection;import com.rabbitmq.client.*;import java.io.IOException;import java.util.concurrent.TimeoutException;public class MailConsumer &#123; /** * å®šä¹‰é‚®ä»¶é˜Ÿåˆ— */ private static final String QUEUE_NAME = &quot;fanout_email_queue&quot;; /** * å®šä¹‰äº¤æ¢æœºçš„åç§° */ private static final String EXCHANGE_NAME = &quot;fanout_exchange&quot;; public static void main(String[] args) throws IOException, TimeoutException &#123; System.out.println(&quot;é‚®ä»¶æ¶ˆè´¹è€…...&quot;); // åˆ›å»ºæˆ‘ä»¬çš„è¿æ¥ Connection connection = RabbitMQConnection.getConnection(); // åˆ›å»ºæˆ‘ä»¬é€šé“ final Channel channel = connection.createChannel(); // å…³è”é˜Ÿåˆ—æ¶ˆè´¹è€…å…³è”é˜Ÿåˆ— channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, &quot;&quot;); DefaultConsumer defaultConsumer = new DefaultConsumer(channel) &#123; @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException &#123; String msg = new String(body, &quot;UTF-8&quot;); System.out.println(&quot;é‚®ä»¶æ¶ˆè´¹è€…è·å–æ¶ˆæ¯:&quot; + msg); &#125; &#125;; // å¼€å§‹ç›‘å¬æ¶ˆæ¯ è‡ªåŠ¨ç­¾æ”¶ channel.basicConsume(QUEUE_NAME, true, defaultConsumer); &#125;&#125; çŸ­ä¿¡æ¶ˆè´¹è€…public class SmsConsumer &#123; /** * å®šä¹‰çŸ­ä¿¡é˜Ÿåˆ— */ private static final String QUEUE_NAME = &quot;fanout_email_sms&quot;; /** * å®šä¹‰äº¤æ¢æœºçš„åç§° */ private static final String EXCHANGE_NAME = &quot;fanout_exchange&quot;; public static void main(String[] args) throws IOException, TimeoutException &#123; System.out.println(&quot;çŸ­ä¿¡æ¶ˆè´¹è€…...&quot;); // åˆ›å»ºæˆ‘ä»¬çš„è¿æ¥ Connection connection = RabbitMQConnection.getConnection(); // åˆ›å»ºæˆ‘ä»¬é€šé“ final Channel channel = connection.createChannel(); // å…³è”é˜Ÿåˆ—æ¶ˆè´¹è€…å…³è”é˜Ÿåˆ— channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, &quot;&quot;); DefaultConsumer defaultConsumer = new DefaultConsumer(channel) &#123; @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException &#123; String msg = new String(body, &quot;UTF-8&quot;); System.out.println(&quot;çŸ­ä¿¡æ¶ˆè´¹è€…è·å–æ¶ˆæ¯:&quot; + msg); &#125; &#125;; // å¼€å§‹ç›‘å¬æ¶ˆæ¯ è‡ªåŠ¨ç­¾æ”¶ channel.basicConsume(QUEUE_NAME, true, defaultConsumer); &#125;&#125; Directè·¯ç”±æ¨¡å¼å½“äº¤æ¢æœºç±»å‹ä¸ºdirectç±»å‹æ—¶ï¼Œæ ¹æ®é˜Ÿåˆ—ç»‘å®šçš„è·¯ç”±å»ºè½¬å‘åˆ°å…·ä½“çš„é˜Ÿåˆ—ä¸­å­˜æ”¾æ¶ˆæ¯ Topicä¸»é¢˜æ¨¡å¼å½“äº¤æ¢æœºç±»å‹ä¸ºtopicç±»å‹æ—¶ï¼Œæ ¹æ®é˜Ÿåˆ—ç»‘å®šçš„è·¯ç”±å»ºæ¨¡ç³Šè½¬å‘åˆ°å…·ä½“çš„é˜Ÿåˆ—ä¸­å­˜æ”¾ã€‚ #å·è¡¨ç¤ºæ”¯æŒåŒ¹é…å¤šä¸ªè¯ï¼› *å·è¡¨ç¤ºåªèƒ½åŒ¹é…ä¸€ä¸ªè¯ SpringBootæ•´åˆRabbitMQMavenä¾èµ–&lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.0.0.RELEASE&lt;/version&gt;&lt;/parent&gt;&lt;dependencies&gt; &lt;!-- springboot-webç»„ä»¶ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- æ·»åŠ springbootå¯¹amqpçš„æ”¯æŒ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--fastjson --&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.49&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; é…ç½®ç±»ï¼šimport org.springframework.amqp.core.Binding;import org.springframework.amqp.core.BindingBuilder;import org.springframework.amqp.core.FanoutExchange;import org.springframework.amqp.core.Queue;import org.springframework.context.annotation.Bean;import org.springframework.stereotype.Component;/** * @ClassName RabbitMQConfig * @Author song * @Version V1.0 **/@Componentpublic class RabbitMQConfig &#123; /** * å®šä¹‰äº¤æ¢æœº */ private String EXCHANGE_SPRINGBOOT_NAME = &quot;/mayikt_ex&quot;; /** * çŸ­ä¿¡é˜Ÿåˆ— */ private String FANOUT_SMS_QUEUE = &quot;fanout_sms_queue&quot;; /** * é‚®ä»¶é˜Ÿåˆ— */ private String FANOUT_EMAIL_QUEUE = &quot;fanout_email_queue&quot;; /** * é…ç½®smsQueue * * @return */ @Bean public Queue smsQueue() &#123; return new Queue(FANOUT_SMS_QUEUE); &#125; /** * é…ç½®emailQueue * * @return */ @Bean public Queue emailQueue() &#123; return new Queue(FANOUT_EMAIL_QUEUE); &#125; /** * é…ç½®fanoutExchange * * @return */ @Bean public FanoutExchange fanoutExchange() &#123; return new FanoutExchange(EXCHANGE_SPRINGBOOT_NAME); &#125; // ç»‘å®šäº¤æ¢æœº sms @Bean public Binding bindingSmsFanoutExchange(Queue smsQueue, FanoutExchange fanoutExchange) &#123; return BindingBuilder.bind(smsQueue).to(fanoutExchange); &#125; // ç»‘å®šäº¤æ¢æœº email @Bean public Binding bindingEmailFanoutExchange(Queue emailQueue, FanoutExchange fanoutExchange) &#123; return BindingBuilder.bind(emailQueue).to(fanoutExchange); &#125;&#125; é…ç½®æ–‡ä»¶application.ymlspring: rabbitmq: ####è¿æ¥åœ°å€ host: 127.0.0.1 ####ç«¯å£å· port: 5672 ####è´¦å· username: guest ####å¯†ç  password: guest ### åœ°å€ virtual-host: /meiteVirtualHosts ç”Ÿäº§è€…import org.springframework.amqp.core.AmqpTemplate;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;/** * @ClassName FanoutProducer * @Author song * @Version V1.0 **/@RestControllerpublic class FanoutProducer &#123; @Autowired private AmqpTemplate amqpTemplate; /** * å‘é€æ¶ˆæ¯ * * @return */ @RequestMapping(&quot;/sendMsg&quot;) public String sendMsg(String msg) &#123; /** * 1.äº¤æ¢æœºåç§° * 2.è·¯ç”±keyåç§° * 3.å‘é€å†…å®¹ */ amqpTemplate.convertAndSend(&quot;/mayikt_ex&quot;, &quot;&quot;, msg); return &quot;success&quot;; &#125;&#125; æ¶ˆè´¹è€…import lombok.extern.slf4j.Slf4j;import org.springframework.amqp.rabbit.annotation.RabbitHandler;import org.springframework.amqp.rabbit.annotation.RabbitListener;import org.springframework.stereotype.Component;/** * @ClassName FanoutEmailConsumer * @Author èš‚èšè¯¾å ‚ä½™èƒœå†› QQ644064779 www.mayikt.com * @Version V1.0 **/@Slf4j@Component@RabbitListener(queues = &quot;fanout_email_queue&quot;)public class FanoutEmailConsumer &#123; @RabbitHandler public void process(String msg) &#123; log.info(&quot;&gt;&gt;é‚®ä»¶æ¶ˆè´¹è€…æ¶ˆæ¯msg:&#123;&#125;&lt;&lt;&quot;, msg); &#125;&#125; import lombok.extern.slf4j.Slf4j;import org.springframework.amqp.rabbit.annotation.RabbitHandler;import org.springframework.amqp.rabbit.annotation.RabbitListener;import org.springframework.stereotype.Component;/** * @ClassName fanout_sms_queue * @Author èš‚èšè¯¾å ‚ä½™èƒœå†› QQ644064779 www.mayikt.com * @Version V1.0 **/@Slf4j@Component@RabbitListener(queues = &quot;fanout_sms_queue&quot;)public class FanoutSmsConsumer &#123; @RabbitHandler public void process(String msg) &#123; log.info(&quot;&gt;&gt;çŸ­ä¿¡æ¶ˆè´¹è€…æ¶ˆæ¯msg:&#123;&#125;&lt;&lt;&quot;, msg); &#125;&#125; ç”Ÿäº§è€…å¦‚ä½•è·å–æ¶ˆè´¹ç»“æœ1. æ ¹æ®ä¸šåŠ¡æ¥å®š æ¶ˆè´¹è€…æ¶ˆè´¹æˆåŠŸç»“æœï¼š 1.èƒ½å¤Ÿåœ¨æ•°æ®åº“ä¸­æ’å…¥ä¸€æ¡æ•°æ® 2.Rocketmq è‡ªå¸¦å…¨å±€æ¶ˆæ¯idï¼Œèƒ½å¤Ÿæ ¹æ®è¯¥å…¨å±€æ¶ˆæ¯è·å–æ¶ˆè´¹ç»“æœ åŸç†ï¼š ç”Ÿäº§è€…æŠ•é€’æ¶ˆæ¯åˆ°mqæœåŠ¡å™¨ï¼ŒmqæœåŠ¡å™¨ç«¯åœ¨è¿™æ—¶å€™è¿”å›ä¸€ä¸ªå…¨å±€çš„æ¶ˆæ¯idï¼Œ å½“æˆ‘ä»¬æ¶ˆè´¹è€…æ¶ˆè´¹è¯¥æ¶ˆæ¯æˆåŠŸä¹‹åï¼Œæ¶ˆè´¹è€…ä¼šç»™æˆ‘ä»¬mqæœåŠ¡å™¨ç«¯å‘é€é€šçŸ¥æ ‡è®°è¯¥æ¶ˆæ¯æ¶ˆè´¹æˆåŠŸã€‚ ç”Ÿäº§è€…è·å–åˆ°è¯¥æ¶ˆæ¯å…¨å±€idï¼Œæ¯éš”2sæ—¶é—´è°ƒç”¨mqæœåŠ¡å™¨ç«¯æ¥å£æŸ¥è¯¢è¯¥æ¶ˆæ¯æ˜¯å¦æœ‰è¢«æ¶ˆè´¹æˆåŠŸã€‚ å¼‚æ­¥è¿”å›ä¸€ä¸ªå…¨å±€idï¼Œå‰ç«¯ä½¿ç”¨ajaxå®šæ—¶ä¸»åŠ¨æŸ¥è¯¢ï¼› åœ¨rocketmqä¸­ï¼Œè‡ªå¸¦æ ¹æ®æ¶ˆæ¯idæŸ¥è¯¢æ˜¯å¦æ¶ˆè´¹æˆåŠŸ RabbitMQæ­»ä¿¡é˜Ÿåˆ—æ­»ä¿¡é˜Ÿåˆ—äº§ç”Ÿçš„èƒŒæ™¯RabbitMQæ­»ä¿¡é˜Ÿåˆ—ä¿—ç§°ï¼Œå¤‡èƒé˜Ÿåˆ—ï¼›æ¶ˆæ¯ä¸­é—´ä»¶å› ä¸ºæŸç§åŸå› æ‹’æ”¶è¯¥æ¶ˆæ¯åï¼Œå¯ä»¥è½¬ç§»åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­å­˜æ”¾ï¼Œæ­»ä¿¡é˜Ÿåˆ—ä¹Ÿå¯ä»¥æœ‰äº¤æ¢æœºå’Œè·¯ç”±keyç­‰ã€‚ äº§ç”Ÿæ­»ä¿¡é˜Ÿåˆ—çš„åŸå›  æ¶ˆæ¯æŠ•é€’åˆ°MQä¸­å­˜æ”¾ æ¶ˆæ¯å·²ç»è¿‡æœŸ æ¶ˆè´¹è€…æ²¡æœ‰åŠæ—¶çš„è·å–åˆ°æˆ‘ä»¬æ¶ˆæ¯ï¼Œæ¶ˆæ¯å¦‚æœå­˜æ”¾åˆ°mqæœåŠ¡å™¨ä¸­è¿‡æœŸä¹‹åï¼Œä¼šè½¬ç§»åˆ°å¤‡èƒæ­»ä¿¡é˜Ÿåˆ—å­˜æ”¾ã€‚ é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§çš„é•¿åº¦ ï¼ˆé˜Ÿåˆ—å®¹å™¨å·²ç»æ»¡äº†ï¼‰ æ¶ˆè´¹è€…æ¶ˆè´¹å¤šæ¬¡æ¶ˆæ¯å¤±è´¥ï¼Œå°±ä¼šè½¬ç§»å­˜æ”¾åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­ æ­»ä¿¡é˜Ÿåˆ—çš„æ¶æ„åŸç†æ­»ä¿¡é˜Ÿåˆ—å’Œæ™®é€šé˜Ÿåˆ—åŒºåˆ«ä¸æ˜¯å¾ˆå¤§ æ™®é€šä¸æ­»ä¿¡é˜Ÿåˆ—éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„äº¤æ¢æœºå’Œè·¯ç”±keyã€é˜Ÿåˆ—å’Œæ¶ˆè´¹è€…ã€‚ åŒºåˆ«ï¼š ç”Ÿäº§è€…æŠ•é€’æ¶ˆæ¯å…ˆæŠ•é€’åˆ°æˆ‘ä»¬æ™®é€šäº¤æ¢æœºä¸­ï¼Œæ™®é€šäº¤æ¢æœºåœ¨å°†è¯¥æ¶ˆæ¯æŠ•åˆ°æ™®é€šé˜Ÿåˆ—ä¸­ç¼“å­˜èµ·æ¥ï¼Œæ™®é€šé˜Ÿåˆ—å¯¹åº”æœ‰è‡ªå·±ç‹¬ç«‹æ™®é€šæ¶ˆè´¹è€…ã€‚ å¦‚æœç”Ÿäº§è€…æŠ•é€’æ¶ˆæ¯åˆ°æ™®é€šé˜Ÿåˆ—ä¸­ï¼Œæ™®é€šé˜Ÿåˆ—å‘ç°è¯¥æ¶ˆæ¯ä¸€ç›´æ²¡æœ‰è¢«æ¶ˆè´¹è€…æ¶ˆè´¹çš„æƒ…å†µä¸‹ï¼Œåœ¨è¿™æ—¶å€™ä¼šå°†è¯¥æ¶ˆæ¯è½¬ç§»åˆ°æ­»ä¿¡ï¼ˆå¤‡èƒï¼‰äº¤æ¢æœºä¸­ï¼Œæ­»ä¿¡ï¼ˆå¤‡èƒï¼‰äº¤æ¢æœºå¯¹åº”æœ‰è‡ªå·±ç‹¬ç«‹çš„ æ­»ä¿¡ï¼ˆå¤‡èƒï¼‰é˜Ÿåˆ— å¯¹åº”ç‹¬ç«‹æ­»ä¿¡ï¼ˆå¤‡èƒï¼‰æ¶ˆè´¹è€…ã€‚ æ­»ä¿¡é˜Ÿåˆ—åº”ç”¨åœºæ™¯ 30åˆ†é’Ÿè®¢å•è¶…æ—¶è®¾è®¡ A. Redisè¿‡æœŸkey B. æ­»ä¿¡å»¶è¿Ÿé˜Ÿåˆ—å®ç°ï¼š é‡‡ç”¨æ­»ä¿¡é˜Ÿåˆ—ï¼Œåˆ›å»ºä¸€ä¸ªæ™®é€šé˜Ÿåˆ—æ²¡æœ‰å¯¹åº”çš„æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯ï¼Œåœ¨30åˆ†é’Ÿè¿‡åå°±ä¼šå°†è¯¥æ¶ˆæ¯è½¬ç§»åˆ°æ­»ä¿¡å¤‡èƒæ¶ˆè´¹è€…å®ç°æ¶ˆè´¹ã€‚ å¤‡èƒæ­»ä¿¡æ¶ˆè´¹è€…ä¼šæ ¹æ®è¯¥è®¢å•å·ç æŸ¥è¯¢æ˜¯å¦å·²ç»æ”¯ä»˜è¿‡ï¼Œå¦‚æœæ²¡æœ‰æ”¯ä»˜çš„æƒ…å†µä¸‹åˆ™ä¼šå¼€å§‹å›æ»šåº“å­˜æ“ä½œã€‚ RabbitMQæ¶ˆæ¯å¹‚ç­‰é—®é¢˜RabbitMQæ¶ˆæ¯è‡ªåŠ¨é‡è¯•æœºåˆ¶ å½“æˆ‘ä»¬æ¶ˆè´¹è€…å¤„ç†æ‰§è¡Œæˆ‘ä»¬ä¸šåŠ¡ä»£ç çš„æ—¶å€™ï¼Œå¦‚æœæŠ›å‡ºå¼‚å¸¸çš„æƒ…å†µä¸‹ åœ¨è¿™æ—¶å€™mqä¼šè‡ªåŠ¨è§¦å‘é‡è¯•æœºåˆ¶ï¼Œé»˜è®¤çš„æƒ…å†µä¸‹rabbitmqæ˜¯æ— é™æ¬¡æ•°çš„é‡è¯•ã€‚éœ€è¦äººä¸ºæŒ‡å®šé‡è¯•æ¬¡æ•°é™åˆ¶é—®é¢˜ åœ¨ä»€ä¹ˆæƒ…å†µä¸‹æ¶ˆè´¹è€…éœ€è¦å®ç°é‡è¯•ç­–ç•¥ï¼Ÿ A. æ¶ˆè´¹è€…è·å–æ¶ˆæ¯åï¼Œè°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£ï¼Œä½†æ˜¯è°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£å¤±è´¥å‘¢ï¼Ÿæ˜¯å¦éœ€è¦é‡è¯•ï¼Ÿ è¯¥æƒ…å†µä¸‹éœ€è¦å®ç°é‡è¯•ç­–ç•¥ï¼Œç½‘ç»œå»¶è¿Ÿåªæ˜¯æš‚æ—¶è°ƒç”¨ä¸é€šï¼Œé‡è¯•å¤šæ¬¡æœ‰å¯èƒ½ä¼šè°ƒç”¨é€šã€‚ B. æ¶ˆè´¹è€…è·å–æ¶ˆæ¯åï¼Œå› ä¸ºä»£ç é—®é¢˜æŠ›å‡ºæ•°æ®å¼‚å¸¸ï¼Œæ˜¯å¦éœ€è¦é‡è¯•ï¼Ÿ è¯¥æƒ…å†µä¸‹æ˜¯ä¸éœ€è¦å®ç°é‡è¯•ç­–ç•¥ï¼Œå°±ç®—é‡è¯•å¤šæ¬¡ï¼Œæœ€ç»ˆè¿˜æ˜¯å¤±è´¥çš„ã€‚ å¯ä»¥å°†æ—¥å¿—å­˜æ”¾èµ·æ¥ï¼ŒåæœŸé€šè¿‡å®šæ—¶ä»»åŠ¡æˆ–è€…äººå·¥è¡¥å¿å½¢å¼ã€‚ å¦‚æœæ˜¯é‡è¯•å¤šæ¬¡è¿˜æ˜¯å¤±è´¥æ¶ˆæ¯ï¼Œéœ€è¦é‡æ–°å‘å¸ƒæ¶ˆè´¹è€…ç‰ˆæœ¬å®ç°æ¶ˆè´¹ å¯ä»¥ä½¿ç”¨æ­»ä¿¡é˜Ÿåˆ— Mqåœ¨é‡è¯•çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰å¯èƒ½ä¼šå¼•å‘æ¶ˆè´¹è€…é‡å¤æ¶ˆè´¹çš„é—®é¢˜ã€‚ Mqæ¶ˆè´¹è€…éœ€è¦è§£å†³ å¹‚ç­‰æ€§é—®é¢˜ å¹‚ç­‰æ€§ ä¿è¯æ•°æ®å”¯ä¸€ æ–¹å¼1ï¼š ç”Ÿäº§è€…åœ¨æŠ•é€’æ¶ˆæ¯çš„æ—¶å€™ï¼Œç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€idï¼Œæ”¾åœ¨æˆ‘ä»¬æ¶ˆæ¯ä¸­ã€‚ Msg id&#x3D;123456 Msg id&#x3D;123456 Msg id&#x3D;123456 æ¶ˆè´¹è€…è·å–åˆ°æˆ‘ä»¬è¯¥æ¶ˆæ¯ï¼Œå¯ä»¥æ ¹æ®è¯¥å…¨å±€å”¯ä¸€idå®ç°å»é‡å¤ã€‚ å…¨å±€å”¯ä¸€id æ ¹æ®ä¸šåŠ¡æ¥å®šçš„ è®¢å•å·ç ä½œä¸ºå…¨å±€çš„id å®é™…ä¸Šè¿˜æ˜¯éœ€è¦å†dbå±‚é¢è§£å†³æ•°æ®é˜²é‡å¤ã€‚ ä¸šåŠ¡é€»è¾‘æ˜¯åœ¨åšinsertæ“ä½œ ä½¿ç”¨å”¯ä¸€ä¸»é”®çº¦æŸ ä¸šåŠ¡é€»è¾‘æ˜¯åœ¨åšupdateæ“ä½œ ä½¿ç”¨ä¹è§‚é” å½“æ¶ˆè´¹è€…ä¸šåŠ¡é€»è¾‘ä»£ç ä¸­ï¼ŒæŠ›å‡ºå¼‚å¸¸è‡ªåŠ¨å®ç°é‡è¯• ï¼ˆé»˜è®¤æ˜¯æ— æ•°æ¬¡é‡è¯•ï¼‰ åº”è¯¥å¯¹RabbitMQé‡è¯•æ¬¡æ•°å®ç°é™åˆ¶ï¼Œæ¯”å¦‚æœ€å¤šé‡è¯•5æ¬¡ï¼Œæ¯æ¬¡é—´éš”3sï¼›é‡è¯•å¤šæ¬¡è¿˜æ˜¯å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œå­˜æ”¾åˆ°æ­»ä¿¡é˜Ÿåˆ—æˆ–è€…å­˜æ”¾åˆ°æ•°æ®åº“è¡¨ä¸­è®°å½•åæœŸäººå·¥è¡¥å¿ å¦‚ä½•åˆç†é€‰æ‹©æ¶ˆæ¯é‡è¯•æ€»ç»“ï¼šå¦‚æœæ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯æ—¶ï¼Œå› ä¸ºä»£ç åŸå› æŠ›å‡ºå¼‚å¸¸æ˜¯éœ€è¦ä»æ–°å‘å¸ƒç‰ˆæœ¬æ‰èƒ½è§£å†³çš„ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦é‡è¯•ï¼Œé‡è¯•ä¹Ÿè§£å†³ä¸äº†è¯¥é—®é¢˜çš„ã€‚å­˜æ”¾åˆ°æ­»ä¿¡é˜Ÿåˆ—æˆ–è€…æ˜¯æ•°æ®åº“è¡¨è®°å½•ã€åæœŸäººå·¥å®ç°è¡¥å¿ã€‚ Rabbitmqå¦‚ä½•å¼€å¯é‡è¯•ç­–ç•¥spring: rabbitmq: ####è¿æ¥åœ°å€ host: 127.0.0.1 ####ç«¯å£å· port: 5672 ####è´¦å· username: guest ####å¯†ç  password: guest ### åœ°å€ virtual-host: /meite_rabbitmq listener: simple: retry: ####å¼€å¯æ¶ˆè´¹è€…ï¼ˆç¨‹åºå‡ºç°å¼‚å¸¸çš„æƒ…å†µä¸‹ä¼šï¼‰è¿›è¡Œé‡è¯• enabled: true ####æœ€å¤§é‡è¯•æ¬¡æ•° max-attempts: 5 ####é‡è¯•é—´éš”æ¬¡æ•° initial-interval: 3000 æ¶ˆè´¹è€…é‡è¯•è¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•é¿å…å¹‚ç­‰æ€§é—®é¢˜é‡è¯•çš„è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†é¿å…ä¸šåŠ¡é€»è¾‘é‡å¤æ‰§è¡Œï¼Œå»ºè®®æå‰å…¨å±€idæå‰æŸ¥è¯¢ï¼Œå¦‚æœå­˜åœ¨ çš„æƒ…å†µä¸‹ï¼Œå°±æ— éœ€å†ç»§ç»­åšè¯¥æµç¨‹ã€‚ é‡è¯•çš„æ¬¡æ•°æœ€å¥½æœ‰ä¸€å®šé—´éš”æ¬¡æ•°ï¼Œåœ¨æ•°æ®åº“åº•å±‚å±‚é¢ä¿è¯æ•°æ®å”¯ä¸€æ€§ï¼Œæ¯”å¦‚åŠ ä¸Šå”¯ä¸€idã€‚ SpringBootå¼€å¯æ¶ˆæ¯ç¡®è®¤æœºåˆ¶é…ç½®æ–‡ä»¶æ–°å¢ spring: rabbitmq: ####è¿æ¥åœ°å€ host: 127.0.0.1 ####ç«¯å£å· port: 5672 ####è´¦å· username: guest ####å¯†ç  password: guest ### åœ°å€ virtual-host: /meiteVirtualHosts listener: simple: retry: ####å¼€å¯æ¶ˆè´¹è€…ï¼ˆç¨‹åºå‡ºç°å¼‚å¸¸çš„æƒ…å†µä¸‹ä¼šï¼‰è¿›è¡Œé‡è¯• enabled: true ####æœ€å¤§é‡è¯•æ¬¡æ•° max-attempts: 5 ####é‡è¯•é—´éš”æ¬¡æ•° initial-interval: 3000 acknowledge-mode: manual datasource: url: jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=UTF-8 username: root password: root driver-class-name: com.mysql.jdbc.Driver æ¶ˆè´¹è€…ackä»£ç  @Slf4j@Component@RabbitListener(queues = &quot;fanout_order_queue&quot;)public class FanoutOrderConsumer &#123; @Autowired private OrderManager orderManager; @Autowired private OrderMapper orderMapper; @RabbitHandler public void process(OrderEntity orderEntity, Message message, Channel channel) throws IOException &#123;// try &#123; log.info(&quot;&gt;&gt;orderEntity:&#123;&#125;&lt;&lt;&quot;, orderEntity.toString()); String orderId = orderEntity.getOrderId(); if (StringUtils.isEmpty(orderId)) &#123; log.error(&quot;&gt;&gt;orderId is null&lt;&lt;&quot;); return; &#125; OrderEntity dbOrderEntity = orderMapper.getOrder(orderId); if (dbOrderEntity != null) &#123; log.info(&quot;&gt;&gt;è¯¥è®¢å•å·²ç»è¢«æ¶ˆè´¹è¿‡ï¼Œæ— éœ€é‡å¤æ¶ˆè´¹!&lt;&lt;&quot;); // æ— éœ€ç»§ç»­é‡è¯• channel.basicAck(message.getMessageProperties().getDeliveryTag(), false); return; &#125; int result = orderManager.addOrder(orderEntity); log.info(&quot;&gt;&gt;æ’å…¥æ•°æ®åº“ä¸­æ•°æ®æˆåŠŸ&lt;&lt;&quot;); if (result &gt;= 0) &#123; // å¼€å¯æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ channel.basicAck(message.getMessageProperties().getDeliveryTag(), false); &#125;// int i = 1 / 0;// &#125; catch (Exception e) &#123;// // å°†å¤±è´¥çš„æ¶ˆæ¯è®°å½•ä¸‹æ¥ï¼ŒåæœŸé‡‡ç”¨äººå·¥è¡¥å¿çš„å½¢å¼// &#125; &#125;&#125;","categories":[{"name":"Java","slug":"java","permalink":"https://aqu.iyunmc.cn/categories/java/"}],"tags":[{"name":"Java","slug":"java","permalink":"https://aqu.iyunmc.cn/tags/java/"}]},{"title":"SpringAMQP","slug":"blog/SpringAMQP","date":"2023-03-05T16:00:00.000Z","updated":"2023-06-05T07:36:14.941Z","comments":true,"path":"blog/SpringAMQP/","link":"","permalink":"https://aqu.iyunmc.cn/blog/SpringAMQP/","excerpt":"1.åŒæ­¥è°ƒç”¨çš„ä¼˜ç‚¹ æ—¶æ•ˆæ€§è¾ƒå¼ºï¼Œå¯ä»¥ç«‹å³å¾—åˆ°ç»“æœ 2.åŒæ­¥è°ƒç”¨çš„é—®é¢˜","text":"1.åŒæ­¥è°ƒç”¨çš„ä¼˜ç‚¹ æ—¶æ•ˆæ€§è¾ƒå¼ºï¼Œå¯ä»¥ç«‹å³å¾—åˆ°ç»“æœ 2.åŒæ­¥è°ƒç”¨çš„é—®é¢˜ è€¦åˆåº¦é«˜ æ€§èƒ½å’Œååèƒ½åŠ›ä¸‹é™ æœ‰é¢å¤–çš„èµ„æºæ¶ˆè€— æœ‰çº§è”å¤±è´¥é—®é¢˜ 3.å¼‚æ­¥é€šä¿¡çš„ä¼˜ç‚¹ è€¦åˆåº¦ä½ ååé‡æå‡ æ•…éšœéš”ç¦» æµé‡å‰Šå³° 4.å¼‚æ­¥é€šä¿¡çš„ç¼ºç‚¹ ä¾èµ–äºBrokerçš„å¯é æ€§ã€å®‰å…¨æ€§ã€ååèƒ½åŠ› æ¶æ„å¤æ‚äº†ï¼Œä¸šåŠ¡æ²¡æœ‰æ˜æ˜¾çš„æµç¨‹çº¿ï¼Œä¸å¥½è¿½è¸ªç®¡ç† ä»€ä¹ˆæ˜¯MQMQï¼ˆMessageQueueï¼‰ï¼Œä¸­æ–‡æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå­—é¢æ¥çœ‹å°±æ˜¯å­˜æ”¾æ¶ˆæ¯çš„é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯äº‹ä»¶é©±åŠ¨æ¶æ„ä¸­çš„Broker RabbitMQå…¥é—¨RabbitMQä¸­çš„å‡ ä¸ªæ¦‚å¿µ channelï¼šæ“ä½œMQçš„å·¥å…· exchangeï¼šè·¯ç”±æ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­ queueï¼šç¼“å­˜æ¶ˆæ¯ virtual hostï¼šè™šæ‹Ÿä¸»æœºï¼Œæ˜¯å¯¹queueã€exchangeç­‰èµ„æºçš„é€»è¾‘åˆ†ç»„ HelloWorldæ¡ˆä¾‹å®˜æ–¹çš„HelloWorldæ˜¯åŸºäºæœ€åŸºç¡€çš„æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å‹æ¥å®ç°çš„ï¼ŒåªåŒ…æ‹¬ä¸‰ä¸ªè§’è‰²ï¼š publisherï¼šæ¶ˆæ¯å‘å¸ƒè¿™ï¼Œå°†æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—queue queueï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè´Ÿè´£æ¥æ”¶å¹¶ç¼“å­˜æ¶ˆæ¯ consumerï¼šè®¢é˜…é˜Ÿåˆ—ï¼Œå¤„ç†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ åŸºæœ¬æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯å‘é€æµç¨‹ å»ºç«‹connection åˆ›å»ºchannel åˆ©ç”¨channelå£°æ˜é˜Ÿåˆ— åˆ©ç”¨channelå‘é˜Ÿåˆ—å‘é€æ¶ˆæ¯ åŸºæœ¬æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯æ¥æ”¶æµç¨‹ å»ºç«‹connection åˆ›å»ºchannel åˆ©ç”¨channelå£°æ˜é˜Ÿåˆ— å®šä¹‰consumerçš„æ¶ˆè´¹è¡Œä¸ºhandleDelivery() åˆ©ç”¨channelå°†æ¶ˆè´¹è€…ä¸é˜Ÿåˆ—ç»‘å®š SpringAMQPä»€ä¹ˆæ˜¯SpringAMQPAMQPï¼ˆAdvanced Message Queuing Protocolï¼‰ æ˜¯ç”¨äºåœ¨åº”ç”¨ç¨‹åºæˆ–ä¹‹é—´ä¼ é€’ä¸šåŠ¡æ¶ˆæ¯çš„å¼€æ”¾æ ‡å‡† è¯¥åè®®ä¸è¯­è¨€å’Œå¹³å°æ— å…³ï¼Œæ›´ç¬¦åˆå¾®æœåŠ¡ä¸­ç‹¬ç«‹æ€§çš„è¦æ±‚ã€‚ SpringAMQPæ˜¯åŸºäºAMQPåè®®å®šä¹‰çš„ä¸€å¥—APIè§„èŒƒï¼Œæä¾›äº†æ¨¡æ¿æ¥å‘é€å’Œæ¥å—æ¶ˆæ¯ã€‚åŒ…å«ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­spring-amqpæ˜¯åŸºç¡€æŠ½è±¡ï¼Œspring-rabbitæ˜¯åº•å±‚çš„é»˜è®¤å®ç°ã€‚ SpringAMQPå¦‚ä½•æ¥æ”¶æ¶ˆæ¯ï¼Ÿ å¼•å…¥amqpçš„starterä¾èµ– é…ç½®RabbitMQåœ°å€ å®šä¹‰ç±»ï¼Œæ·»åŠ @Componentæ³¨è§£ ç±»ä¸­å£°æ˜æ–¹æ³•ï¼Œæ·»åŠ @RabbitListeneræ³¨è§£ï¼Œæ–¹æ³•å‚æ•°å°±æ˜¯æ¶ˆæ¯ æ³¨æ„ï¼šæ¶ˆæ¯ä¸€æ—¦æ¶ˆè´¹å°±ä¼šä»é˜Ÿåˆ—ä¸­åˆ é™¤ï¼ŒRabbitMQæ²¡æœ‰æ¶ˆæ¯å›æº¯åŠŸèƒ½ å‘å¸ƒï¼ˆPublishï¼‰ã€è®¢é˜…ï¼ˆSubscribeï¼‰å‘å¸ƒè®¢é˜…æ¨¡å¼ä¸ä¹‹å‰æ¡ˆä¾‹çš„åŒºåˆ«å°±æ˜¯å…è®¸å°†åŒæ„æ¶ˆæ¯å‘é€ç»™å¤šä¸ªæ¶ˆè´¹è€…ã€‚å®ç°æ–¹å¼æ˜¯åŠ å…¥äº†exchangeï¼ˆäº¤æ¢æœºï¼‰ å¸¸è§çš„exchangeç±»å‹åŒ…æ‹¬ï¼š Fanoutï¼šå¹¿æ’­ Directï¼šè·¯ç”± Topicï¼šè¯é¢˜ æ³¨æ„ï¼šexchangeè´Ÿè´£æ¶ˆæ¯è·¯ç”±ï¼Œè€Œä¸æ˜¯å­˜å‚¨ï¼Œè·¯ç”±å¤±è´¥åˆ™æ¶ˆæ¯ä¸¢å¤± SpringAMQP - FanoutExchangeFanoutExchangeäº¤æ¢æœºçš„ä½œç”¨ æ¥å—publisherå‘é€çš„æ¶ˆæ¯ å°†æ¶ˆæ¯æŒ‰ç…§è§„åˆ™è·¯ç”±åˆ°ç»‘å®šçš„é˜Ÿåˆ— ä¸èƒ½ç¼“å­˜æ¶ˆæ¯ï¼Œè·¯ç”±å¤±è´¥ï¼Œæ¶ˆæ¯ä¼šä¸¢å¤± FanoutExchangeçš„ä¼šå°†æ¶ˆæ¯è·¯ç”±åˆ°æ¯ä¸ªç»‘å®šçš„é˜Ÿåˆ— DirectExchangeDirectäº¤æ¢æœºä¸Fanoutäº¤æ¢æœºçš„å·®å¼‚ Fanoutäº¤æ¢æœºå°†æ¶ˆæ¯è·¯ç”±ç»™æ¯ä¸€ä¸ªä¸ä¹‹ç»‘å®šçš„é˜Ÿåˆ— Directäº¤æ¢æœºæ ¹æ®RoutingKeyåˆ¤æ–­è·¯ç”±ç»™å“ªä¸ªé˜Ÿåˆ— å¦‚æœå¤šä¸ªé˜Ÿåˆ—å…·æœ‰ç›¸åŒçš„RoutingKeyï¼Œåˆ™ä¸FanoutåŠŸèƒ½ç±»ä¼¼ åŸºäº@RabbitListeneræ³¨è§£å£°æ˜é˜Ÿåˆ—å’Œäº¤æ¢æœºæœ‰å“ªäº›å¸¸è§æ³¨è§£ @Queue @Exchange SpringAMQP - æ¶ˆæ¯è½¬æ¢å™¨Springçš„å¯¹æ¶ˆæ¯å¯¹è±¡çš„å¤„ç†æ—¶ç”±org.springframework.amqp.support.converter.MessageConverteræ¥å¤„ç†çš„ã€‚è€Œé»˜è®¤å®ç°æ˜¯SimpleMessageConverterï¼ŒåŸºäºJDKçš„ObjectOutputStreamå®Œæˆåºåˆ—åŒ–ã€‚ å¦‚æœè¦ä¿®æ”¹åªéœ€è¦å®šä¹‰ä¸€ä¸ªMessageConverterç±»å‹çš„Beanå³å¯ã€‚æ¨èç”¨JSONæ–¹å¼åºåˆ—åŒ–ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š åœ¨publisheræœåŠ¡å¼•å…¥ä¾èµ– &lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.dataformat&lt;/groupId&gt; &lt;artifactId&gt;jackson-dataformat-xml&lt;/artifactId&gt; &lt;version&gt;2.9.10&gt; &lt;/dependency&gt; - åœ¨publisheræœåŠ¡å£°æ˜MessageConverterï¼š- ``` @Bean public MessageConverter jsonMessageConverter()&#123; return new Jackson2JsonMessageConverter(); &#125; SpringAMQPä¸­æ¶ˆæ¯çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–å¦‚ä½•å®ç° åˆ©ç”¨MessageConverterå®ç°çš„ï¼Œé»˜è®¤æ˜¯JDKçš„åºåˆ—åŒ– æ³¨æ„å‘é€æ–¹å’Œæ¥æ”¶æ–¹å¿…é¡»ä½¿ç”¨ç›¸åŒçš„MessageConverter","categories":[{"name":"æ•™ç¨‹","slug":"æ•™ç¨‹","permalink":"https://aqu.iyunmc.cn/categories/%E6%95%99%E7%A8%8B/"}],"tags":[{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"https://aqu.iyunmc.cn/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/"}]},{"title":"Redis","slug":"blog/Redis","date":"2022-10-10T16:00:00.000Z","updated":"2023-06-05T07:35:59.442Z","comments":true,"path":"blog/Redis/","link":"","permalink":"https://aqu.iyunmc.cn/blog/Redis/","excerpt":"è®¤è¯†NoSQL","text":"è®¤è¯†NoSQL SQLï¼š ç»“æ„åŒ–ï¼ˆStructuredï¼‰ å…³è”çš„ï¼ˆRelationalï¼‰ SQLæŸ¥è¯¢ ACID Aï¼ˆAtomicityï¼‰ï¼šåŸå­æ€§ Cï¼ˆConsistencyï¼‰ï¼šä¸€è‡´æ€§ Iï¼ˆIsolationï¼‰ï¼šéš”ç¦»æ€§ Dï¼ˆDurabilityï¼‰ï¼šæŒä¹…æ€§ Atomicityï¼ˆåŸå­æ€§ï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡ï¼ˆtransactionï¼‰ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«æ¢å¤ï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚ Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ï¼šåœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä»¥åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åã€‚è¿™è¡¨ç¤ºå†™å…¥çš„èµ„æ–™å¿…é¡»å®Œå…¨ç¬¦åˆæ‰€æœ‰çš„é¢„è®¾è§„åˆ™ï¼Œè¿™åŒ…å«èµ„æ–™çš„ç²¾ç¡®åº¦ã€ä¸²è”æ€§ä»¥åŠåç»­æ•°æ®åº“å¯ä»¥è‡ªå‘æ€§åœ°å®Œæˆé¢„å®šçš„å·¥ä½œã€‚ Isolationï¼ˆéš”ç¦»æ€§ï¼‰ï¼šæ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹å…¶æ•°æ®è¿›è¡Œè¯»å†™å’Œä¿®æ”¹çš„èƒ½åŠ›ï¼Œéš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ç”±äºäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚äº‹åŠ¡éš”ç¦»åˆ†ä¸ºä¸åŒçº§åˆ«ï¼ŒåŒ…æ‹¬è¯»æœªæäº¤ï¼ˆRead uncommittedï¼‰ã€è¯»æäº¤ï¼ˆread committedï¼‰ã€å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰å’Œä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ã€‚ Durabilityï¼ˆæŒä¹…æ€§ï¼‰ï¼šäº‹åŠ¡å¤„ç†ç»“æŸåï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚ [1] NoSQLï¼š éç»“æ„åŒ– æ— å…³è”çš„ éSQL BASE ç¼“å­˜ç©¿é€ï¼šç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢ä¸€æ¡æ•°æ®åº“å’Œç¼“å­˜éƒ½æ²¡æœ‰çš„ä¸€æ¡æ•°æ®ï¼Œå°±ä¼š ä¸€ç›´æŸ¥è¯¢æ•°æ®åº“ï¼Œå¯¹æ•°æ®åº“çš„è®¿é—®å‹åŠ›å°±ä¼šå¢å¤§ã€‚ å¸¸è§çš„2ç§è§£å†³æ–¹æ¡ˆï¼š ç¼“å­˜ç©ºå¯¹è±¡ ä¼˜ç‚¹ï¼šç®€å•å®ç°ï¼Œç»´æŠ¤æ–¹ä¾¿ ç¼ºç‚¹ï¼š é¢å¤–çš„å†…å­˜æ¶ˆè€— å¯èƒ½é€ æˆçŸ­æœŸçš„ä¸ä¸€è‡´ å¸ƒéš†è¿‡æ»¤ ä¼˜ç‚¹ï¼šå†…å­˜å ç”¨è¾ƒå°‘ï¼Œæ²¡æœ‰å¤šä½™çš„key ç¼ºç‚¹ï¼š å®ç°å¤æ‚ å­˜åœ¨è¯¯åˆ¤å¯èƒ½ å¢å¼ºidçš„å¤æ‚åº¦ï¼Œé¿å…è¢«çŒœæµ‹idè§„å¾‹ åšå¥½æ•°æ®çš„åŸºç¡€æ ¼å¼æ ¡éªŒ åŠ å¼ºç”¨æˆ·æƒé™æ ¡éªŒ åšå¥½çƒ­ç‚¹å‚æ•°çš„é™æµ ç¼“å­˜ç©¿é€ï¼šç¼“å­˜é›ªå´©æ˜¯æŒ‡åœ¨åŒä¸€æ—¶æ®µå¤§é‡çš„ç¼“å­˜keyåŒæ—¶å¤±æ•ˆæˆ–è€…RedisæœåŠ¡å®•æœºï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚åˆ°è¾¾æ•°æ®åº“ï¼Œå¸¦æ¥å·¨å¤§å‹åŠ› è§£å†³æ–¹æ¡ˆï¼š ç»™ä¸åŒçš„Keyçš„TTLæ·»åŠ éšæœºå€¼ åˆ©ç”¨Redisé›†ç¾¤æé«˜æœåŠ¡çš„å¯ç”¨æ€§ ç»™ç¼“å­˜ä¸šåŠ¡æ·»åŠ é™çº§é™æµç­–ç•¥ ç»™ä¸šåŠ¡æ·»åŠ å¤šçº§ç¼“å­˜ ç¼“å­˜å‡»ç©¿ï¼šç¼“å­˜å‡»ç©¿é—®é¢˜ä¹Ÿå«çƒ­ç‚¹Keyé—®é¢˜ï¼Œå°±æ˜¯ä¸€ä¸ªè¢«é«˜å¹¶å‘è®¿é—®å¹¶ä¸”ç¼“å­˜é‡å»ºä¸šåŠ¡è¾ƒå¤æ‚çš„keyçªç„¶å¤±æ•ˆäº†ï¼Œæ— æ•°çš„è¯·æ±‚è®¿é—®ä¼šåœ¨ç¬é—´ç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§çš„å†²å‡» è§£å†³æ–¹æ¡ˆï¼š äº’æ–¥é” é€»è¾‘è¿‡æœŸ è§£å†³æ–¹æ¡ˆ ä¼˜ç‚¹ ç¼ºç‚¹ äº’æ–¥é” æ²¡æœ‰é¢å¤–çš„å†…å­˜æ¶ˆè€—ä¿è¯ä¸€è‡´æ€§å®ç°ç®€å• å¿åŸéœ€è¦ç­‰å¾…ï¼Œæ€§èƒ½å—å½±å“å¯èƒ½æœ‰æ­»é”é£é™© é€»è¾‘è¿‡æœŸ çº¿ç¨‹æ— éœ€ç­‰å¾…ï¼Œæ€§èƒ½è¾ƒå¥½ ä¸ä¿è¯ä¸€è‡´æ€§æœ‰é¢å¤–å†…å­˜æ¶ˆè€—å®ç°å¤æ‚ å…¨å±€å”¯ä¸€IDç”Ÿæˆç­–ç•¥ï¼š UUIDUUIDæ˜¯æŒ‡åœ¨ä¸€å°æœºå™¨åœ¨åŒä¸€æ—¶é—´ä¸­ç”Ÿæˆçš„æ•°å­—åœ¨æ‰€æœ‰æœºå™¨ä¸­éƒ½æ˜¯å”¯ä¸€çš„ã€‚æŒ‰ç…§å¼€æ”¾è½¯ä»¶åŸºé‡‘ä¼š(OSF)åˆ¶å®šçš„æ ‡å‡†è®¡ç®—ï¼Œç”¨åˆ°äº†ä»¥å¤ªç½‘å¡åœ°å€ã€çº³ç§’çº§æ—¶é—´ã€èŠ¯ç‰‡IDç å’Œè®¸å¤šå¯èƒ½çš„æ•°å­—ã€‚ xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx (8-4-4-4-12) ä¼˜ç‚¹ï¼š ç®€å•ï¼Œä»£ç æ–¹ä¾¿ ç”ŸæˆIDæ€§èƒ½éå¸¸å¥½ï¼ŒåŸºæœ¬ä¸ä¼šæœ‰æ€§èƒ½é—®é¢˜ï¼Œæœ¬åœ°ç”Ÿæˆï¼Œæ²¡æœ‰ç½‘ç»œæ¶ˆè€— å…¨çƒå”¯ä¸€ï¼Œåœ¨é‡è§æ•°æ®è¿ç§»ï¼Œç³»ç»Ÿæ•°æ®åˆå¹¶ï¼Œæˆ–è€…æ•°æ®åº“å˜æ›´ç­‰æƒ…å†µä¸‹ï¼Œå¯ä»¥ä»å®¹åº”å¯¹ ç¼ºç‚¹ï¼š æ²¡æœ‰æ’åºï¼Œæ— æ³•ä¿è¯è¶‹åŠ¿é€’å¢ UUIDå¾€å¾€æ˜¯ä½¿ç”¨å­—ç¬¦ä¸²å­˜å‚¨ï¼ŒæŸ¥è¯¢çš„æ•ˆç‡æ¯”è¾ƒä½ å­˜å‚¨ç©ºé—´æ¯”è¾ƒå¤§ï¼ŒUUIDå¤ªé•¿ï¼Œ16å­—èŠ‚128ä½ï¼Œé€šå¸¸ä»¥36é•¿åº¦çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå¾ˆå¤šåœºæ™¯ä¸é€‚ç”¨ï¼Œå¦‚æœæ˜¯æµ·é‡æ•°æ®åº“ï¼Œå°±éœ€è¦è€ƒè™‘å­˜å‚¨é‡çš„é—®é¢˜ ä¿¡æ¯ä¸å®‰å…¨ï¼ŒåŸºäºMACåœ°å€ç”ŸæˆUUIDçš„ç®—æ³•å¯èƒ½ä¼šé€ æˆMACåœ°å€æ³„éœ²ï¼Œè¿™ä¸ªæ¼æ´æ›¾è¢«ç”¨äºå¯»æ‰¾æ¢…ä¸½èç—…æ¯’çš„åˆ¶ä½œè€…ä½ç½® ä¼ è¾“æ•°æ®é‡å¤§ï¼Œå¹¶ä¸”ä¸å¯è¯» Redisè‡ªå¢ ä¼˜ç‚¹ï¼š ä¸ä¾èµ–äºæ•°æ®åº“ï¼Œçµæ´»æ–¹ä¾¿ï¼Œä¸”æ€§èƒ½ä¼˜äºæ•°æ®åº“ æ•°å­—IDå¤©ç„¶æ’åºï¼Œå¯¹åˆ†é¡µæˆ–è€…éœ€è¦æ’åºçš„ç»“æœå¾ˆæœ‰å¸®åŠ© ç¼ºç‚¹ï¼š å¦‚æœç³»ç»Ÿä¸­æ²¡æœ‰Redisï¼Œè¿˜éœ€è¦å¼•å…¥æ–°çš„ç»„ä»¶ï¼Œå¢åŠ ç³»ç»Ÿå¤æ‚åº¦ éœ€è¦ç¼–ç å’Œé…ç½®çš„å·¥ä½œé‡æ¯”è¾ƒå¤§ Redisæ˜¯å•çº¿ç¨‹çš„ï¼Œè‹¥é€ æˆé˜»å¡ï¼Œåˆ™ä¼šå¼•å‘é«˜å¹¶å‘é—®é¢˜ï¼Œéœ€è¦å¤„ç†å¥½é›†ç¾¤ä¸ä¸»ä»å…³ç³» snowflakeç®—æ³•snowflakeæ˜¯Twitterå¼€æºçš„åˆ†å¸ƒå¼IDç”Ÿæˆç®—æ³•ï¼Œç»“æœæ˜¯ä¸€ä¸ªlongå‹çš„IDã€‚ç”Ÿæˆçš„æ˜¯ä¸€ä¸ª64ä½çš„äºŒè¿›åˆ¶æ­£æ•´æ•°ï¼Œç„¶åè½¬æ¢æˆ10è¿›åˆ¶çš„æ•°ã€‚64ä½äºŒè¿›åˆ¶æ•°ç”±å¦‚ä¸‹éƒ¨åˆ†ç»„æˆï¼š * SnowFlakeçš„ç»“æ„å¦‚ä¸‹(æ¯éƒ¨åˆ†ç”¨-åˆ†å¼€):* 0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000* (1-10-10-10-10-10-1-5-5-12) (1-41-10-12) ä¼˜ç‚¹ ç®€å•é«˜æ•ˆï¼Œç”Ÿæˆé€Ÿåº¦å¿« æ—¶é—´æˆ³åœ¨é«˜ä½ï¼Œè‡ªå¢åºåˆ—åœ¨ä½ä½ï¼Œæ•´ä¸ªIDæ˜¯è¶‹åŠ¿é€’å¢çš„ï¼ŒæŒ‰ç…§æ—¶é—´æœ‰åºé€’å¢ çµæ´»åº¦é«˜ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œè°ƒæ•´bitä½çš„åˆ’åˆ†ï¼Œæ»¡è¶³ä¸åŒçš„éœ€æ±‚ ç¼ºç‚¹ ä¾èµ–æœºå™¨çš„æ—¶é’Ÿï¼Œå¦‚æœæœåŠ¡å™¨æ—¶é’Ÿå›æ‹¨ï¼Œä¼šå¯¼è‡´é‡å¤IDç”Ÿæˆ åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸Šï¼Œæ¯ä¸ªæœåŠ¡å™¨çš„æ—¶é’Ÿä¸å¯èƒ½å®Œå…¨åŒæ­¥ï¼Œæœ‰æ—¶ä¼šå‡ºç°ä¸æ˜¯å…¨å±€é€’å¢çš„æƒ…å†µ æ•°æ®åº“è‡ªå¢ ä¼˜ç‚¹ï¼š ç®€å•ï¼Œä»£ç æ–¹ä¾¿ï¼Œæ€§èƒ½å¯ä»¥æ¥å— æ•°å­—IDå¤©ç„¶æ’åºï¼Œå¯¹åˆ†é¡µæˆ–è€…éœ€è¦æ’åºçš„ç»“æœå¾ˆæœ‰å¸®åŠ© ç¼ºç‚¹ï¼š ä¸åŒæ•°æ®åº“è¯­æ³•å’Œå®ç°ä¸åŒï¼Œæ•°æ®åº“è¿ç§»çš„æ—¶å€™æˆ–å¤šæ•°æ®åº“ç‰ˆæœ¬æ”¯æŒçš„æ—¶å€™éœ€è¦å¤„ç† åœ¨å•ä¸ªæ•°æ®åº“æˆ–è¯»å†™åˆ†ç¦»æˆ–ä¸€ä¸»å¤šä»çš„æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸€ä¸ªä¸»åº“å¯ä»¥ç”Ÿæˆã€‚æœ‰å•ç‚¹æ•…éšœçš„é£é™© åœ¨æ€§èƒ½è¾¾ä¸åˆ°è¦æ±‚çš„æƒ…å†µä¸‹ï¼Œæ¯”è¾ƒéš¾äºæ‰©å±• å¦‚æœé‡è§å¤šä¸ªç³»ç»Ÿéœ€è¦åˆå¹¶æˆ–è€…æ¶‰åŠåˆ°æ•°æ®è¿ç§»ä¼šç›¸å½“ç—›è‹¦ åˆ†è¡¨åˆ†åº“çš„æ—¶å€™ä¼šæœ‰éº»çƒ¦","categories":[{"name":"æ•™ç¨‹","slug":"æ•™ç¨‹","permalink":"https://aqu.iyunmc.cn/categories/%E6%95%99%E7%A8%8B/"}],"tags":[{"name":"Redis","slug":"redis","permalink":"https://aqu.iyunmc.cn/tags/redis/"}]},{"title":"SpringSecurityä»å…¥é—¨åˆ°ç²¾é€š","slug":"blog/SpringSecurityä»å…¥é—¨åˆ°ç²¾é€š","date":"2022-06-08T16:00:00.000Z","updated":"2023-06-05T07:34:31.395Z","comments":true,"path":"blog/SpringSecurityä»å…¥é—¨åˆ°ç²¾é€š/","link":"","permalink":"https://aqu.iyunmc.cn/blog/SpringSecurity%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/","excerpt":"","text":"è¯¾ç¨‹ä»‹ç» 0. ç®€ä»‹â€‹ Spring Security æ˜¯ Spring å®¶æ—ä¸­çš„ä¸€ä¸ªå®‰å…¨ç®¡ç†æ¡†æ¶ã€‚ç›¸æ¯”ä¸å¦å¤–ä¸€ä¸ªå®‰å…¨æ¡†æ¶Shiroï¼Œå®ƒæä¾›äº†æ›´ä¸°å¯Œçš„åŠŸèƒ½ï¼Œç¤¾åŒºèµ„æºä¹Ÿæ¯”Shiroä¸°å¯Œã€‚ â€‹ ä¸€èˆ¬æ¥è¯´ä¸­å¤§å‹çš„é¡¹ç›®éƒ½æ˜¯ä½¿ç”¨SpringSecurity æ¥åšå®‰å…¨æ¡†æ¶ã€‚å°é¡¹ç›®æœ‰Shiroçš„æ¯”è¾ƒå¤šï¼Œå› ä¸ºç›¸æ¯”ä¸SpringSecurityï¼ŒShiroçš„ä¸Šæ‰‹æ›´åŠ çš„ç®€å•ã€‚ â€‹ ä¸€èˆ¬Webåº”ç”¨çš„éœ€è¦è¿›è¡Œè®¤è¯å’Œæˆæƒã€‚ â€‹ è®¤è¯ï¼šéªŒè¯å½“å‰è®¿é—®ç³»ç»Ÿçš„æ˜¯ä¸æ˜¯æœ¬ç³»ç»Ÿçš„ç”¨æˆ·ï¼Œå¹¶ä¸”è¦ç¡®è®¤å…·ä½“æ˜¯å“ªä¸ªç”¨æˆ· â€‹ æˆæƒï¼šç»è¿‡è®¤è¯ååˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è¿›è¡ŒæŸä¸ªæ“ä½œ â€‹ è€Œè®¤è¯å’Œæˆæƒä¹Ÿæ˜¯SpringSecurityä½œä¸ºå®‰å…¨æ¡†æ¶çš„æ ¸å¿ƒåŠŸèƒ½ã€‚ 1. å¿«é€Ÿå…¥é—¨1.1 å‡†å¤‡å·¥ä½œâ€‹ æˆ‘ä»¬å…ˆè¦æ­å»ºä¸€ä¸ªç®€å•çš„SpringBootå·¥ç¨‹ â‘  è®¾ç½®çˆ¶å·¥ç¨‹ æ·»åŠ ä¾èµ– &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.5.0&lt;/version&gt;&lt;/parent&gt;&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt;&lt;/dependencies&gt; â‘¡ åˆ›å»ºå¯åŠ¨ç±» @SpringBootApplicationpublic class SecurityApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(SecurityApplication.class,args); &#125;&#125; â‘¢ åˆ›å»ºController import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;@RestControllerpublic class HelloController &#123; @RequestMapping(&quot;/hello&quot;) public String hello()&#123; return &quot;hello&quot;; &#125;&#125; 1.2 å¼•å…¥SpringSecurityâ€‹ åœ¨SpringBooté¡¹ç›®ä¸­ä½¿ç”¨SpringSecurityæˆ‘ä»¬åªéœ€è¦å¼•å…¥ä¾èµ–å³å¯å®ç°å…¥é—¨æ¡ˆä¾‹ã€‚ &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;&lt;/dependency&gt; â€‹ å¼•å…¥ä¾èµ–åæˆ‘ä»¬åœ¨å°è¯•å»è®¿é—®ä¹‹å‰çš„æ¥å£å°±ä¼šè‡ªåŠ¨è·³è½¬åˆ°ä¸€ä¸ªSpringSecurityçš„é»˜è®¤ç™»é™†é¡µé¢ï¼Œé»˜è®¤ç”¨æˆ·åæ˜¯user,å¯†ç ä¼šè¾“å‡ºåœ¨æ§åˆ¶å°ã€‚ â€‹ å¿…é¡»ç™»é™†ä¹‹åæ‰èƒ½å¯¹æ¥å£è¿›è¡Œè®¿é—®ã€‚ 2. è®¤è¯2.1 ç™»é™†æ ¡éªŒæµç¨‹ 2.2 åŸç†åˆæ¢â€‹ æƒ³è¦çŸ¥é“å¦‚ä½•å®ç°è‡ªå·±çš„ç™»é™†æµç¨‹å°±å¿…é¡»è¦å…ˆçŸ¥é“å…¥é—¨æ¡ˆä¾‹ä¸­SpringSecurityçš„æµç¨‹ã€‚ 2.2.1 SpringSecurityå®Œæ•´æµç¨‹â€‹ SpringSecurityçš„åŸç†å…¶å®å°±æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ï¼Œå†…éƒ¨åŒ…å«äº†æä¾›å„ç§åŠŸèƒ½çš„è¿‡æ»¤å™¨ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹å…¥é—¨æ¡ˆä¾‹ä¸­çš„è¿‡æ»¤å™¨ã€‚ â€‹ å›¾ä¸­åªå±•ç¤ºäº†æ ¸å¿ƒè¿‡æ»¤å™¨ï¼Œå…¶å®ƒçš„éæ ¸å¿ƒè¿‡æ»¤å™¨å¹¶æ²¡æœ‰åœ¨å›¾ä¸­å±•ç¤ºã€‚ UsernamePasswordAuthenticationFilter:è´Ÿè´£å¤„ç†æˆ‘ä»¬åœ¨ç™»é™†é¡µé¢å¡«å†™äº†ç”¨æˆ·åå¯†ç åçš„ç™»é™†è¯·æ±‚ã€‚å…¥é—¨æ¡ˆä¾‹çš„è®¤è¯å·¥ä½œä¸»è¦æœ‰å®ƒè´Ÿè´£ã€‚ ExceptionTranslationFilterï¼šå¤„ç†è¿‡æ»¤å™¨é“¾ä¸­æŠ›å‡ºçš„ä»»ä½•AccessDeniedExceptionå’ŒAuthenticationException ã€‚ FilterSecurityInterceptorï¼šè´Ÿè´£æƒé™æ ¡éªŒçš„è¿‡æ»¤å™¨ã€‚ â€‹ â€‹ æˆ‘ä»¬å¯ä»¥é€šè¿‡DebugæŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­SpringSecurityè¿‡æ»¤å™¨é“¾ä¸­æœ‰å“ªäº›è¿‡æ»¤å™¨åŠå®ƒä»¬çš„é¡ºåºã€‚ 2.2.2 è®¤è¯æµç¨‹è¯¦è§£ æ¦‚å¿µé€ŸæŸ¥: Authenticationæ¥å£: å®ƒçš„å®ç°ç±»ï¼Œè¡¨ç¤ºå½“å‰è®¿é—®ç³»ç»Ÿçš„ç”¨æˆ·ï¼Œå°è£…äº†ç”¨æˆ·ç›¸å…³ä¿¡æ¯ã€‚ AuthenticationManageræ¥å£ï¼šå®šä¹‰äº†è®¤è¯Authenticationçš„æ–¹æ³• UserDetailsServiceæ¥å£ï¼šåŠ è½½ç”¨æˆ·ç‰¹å®šæ•°æ®çš„æ ¸å¿ƒæ¥å£ã€‚é‡Œé¢å®šä¹‰äº†ä¸€ä¸ªæ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯çš„æ–¹æ³•ã€‚ UserDetailsæ¥å£ï¼šæä¾›æ ¸å¿ƒç”¨æˆ·ä¿¡æ¯ã€‚é€šè¿‡UserDetailsServiceæ ¹æ®ç”¨æˆ·åè·å–å¤„ç†çš„ç”¨æˆ·ä¿¡æ¯è¦å°è£…æˆUserDetailså¯¹è±¡è¿”å›ã€‚ç„¶åå°†è¿™äº›ä¿¡æ¯å°è£…åˆ°Authenticationå¯¹è±¡ä¸­ã€‚ 2.3 è§£å†³é—®é¢˜2.3.1 æ€è·¯åˆ†æç™»å½• â€‹ â‘ è‡ªå®šä¹‰ç™»å½•æ¥å£ â€‹ è°ƒç”¨ProviderManagerçš„æ–¹æ³•è¿›è¡Œè®¤è¯ å¦‚æœè®¤è¯é€šè¿‡ç”Ÿæˆjwt â€‹ æŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥redisä¸­ â€‹ â‘¡è‡ªå®šä¹‰UserDetailsService â€‹ åœ¨è¿™ä¸ªå®ç°ç±»ä¸­å»æŸ¥è¯¢æ•°æ®åº“ æ ¡éªŒï¼š â€‹ â‘ å®šä¹‰Jwtè®¤è¯è¿‡æ»¤å™¨ â€‹ è·å–token â€‹ è§£ætokenè·å–å…¶ä¸­çš„userid â€‹ ä»redisä¸­è·å–ç”¨æˆ·ä¿¡æ¯ â€‹ å­˜å…¥SecurityContextHolder 2.3.2 å‡†å¤‡å·¥ä½œâ‘ æ·»åŠ ä¾èµ– &lt;!--redisä¾èµ–--&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!--fastjsonä¾èµ–--&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.33&lt;/version&gt;&lt;/dependency&gt;&lt;!--jwtä¾èµ–--&gt;&lt;dependency&gt; &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt; &lt;artifactId&gt;jjwt&lt;/artifactId&gt; &lt;version&gt;0.9.0&lt;/version&gt;&lt;/dependency&gt; â‘¡ æ·»åŠ Redisç›¸å…³é…ç½® import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.serializer.SerializerFeature;import com.fasterxml.jackson.databind.JavaType;import com.fasterxml.jackson.databind.ObjectMapper;import com.fasterxml.jackson.databind.type.TypeFactory;import org.springframework.data.redis.serializer.RedisSerializer;import org.springframework.data.redis.serializer.SerializationException;import com.alibaba.fastjson.parser.ParserConfig;import org.springframework.util.Assert;import java.nio.charset.Charset;/** * Redisä½¿ç”¨FastJsonåºåˆ—åŒ– * * @author sg */public class FastJsonRedisSerializer&lt;T&gt; implements RedisSerializer&lt;T&gt;&#123; public static final Charset DEFAULT_CHARSET = Charset.forName(&quot;UTF-8&quot;); private Class&lt;T&gt; clazz; static &#123; ParserConfig.getGlobalInstance().setAutoTypeSupport(true); &#125; public FastJsonRedisSerializer(Class&lt;T&gt; clazz) &#123; super(); this.clazz = clazz; &#125; @Override public byte[] serialize(T t) throws SerializationException &#123; if (t == null) &#123; return new byte[0]; &#125; return JSON.toJSONString(t, SerializerFeature.WriteClassName).getBytes(DEFAULT_CHARSET); &#125; @Override public T deserialize(byte[] bytes) throws SerializationException &#123; if (bytes == null || bytes.length &lt;= 0) &#123; return null; &#125; String str = new String(bytes, DEFAULT_CHARSET); return JSON.parseObject(str, clazz); &#125; protected JavaType getJavaType(Class&lt;?&gt; clazz) &#123; return TypeFactory.defaultInstance().constructType(clazz); &#125;&#125; import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.data.redis.connection.RedisConnectionFactory;import org.springframework.data.redis.core.RedisTemplate;import org.springframework.data.redis.serializer.StringRedisSerializer;@Configurationpublic class RedisConfig &#123; @Bean @SuppressWarnings(value = &#123; &quot;unchecked&quot;, &quot;rawtypes&quot; &#125;) public RedisTemplate&lt;Object, Object&gt; redisTemplate(RedisConnectionFactory connectionFactory) &#123; RedisTemplate&lt;Object, Object&gt; template = new RedisTemplate&lt;&gt;(); template.setConnectionFactory(connectionFactory); FastJsonRedisSerializer serializer = new FastJsonRedisSerializer(Object.class); // ä½¿ç”¨StringRedisSerializeræ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–redisçš„keyå€¼ template.setKeySerializer(new StringRedisSerializer()); template.setValueSerializer(serializer); // Hashçš„keyä¹Ÿé‡‡ç”¨StringRedisSerializerçš„åºåˆ—åŒ–æ–¹å¼ template.setHashKeySerializer(new StringRedisSerializer()); template.setHashValueSerializer(serializer); template.afterPropertiesSet(); return template; &#125;&#125; â‘¢ å“åº”ç±» import com.fasterxml.jackson.annotation.JsonInclude;/** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@JsonInclude(JsonInclude.Include.NON_NULL)public class ResponseResult&lt;T&gt; &#123; /** * çŠ¶æ€ç  */ private Integer code; /** * æç¤ºä¿¡æ¯ï¼Œå¦‚æœæœ‰é”™è¯¯æ—¶ï¼Œå‰ç«¯å¯ä»¥è·å–è¯¥å­—æ®µè¿›è¡Œæç¤º */ private String msg; /** * æŸ¥è¯¢åˆ°çš„ç»“æœæ•°æ®ï¼Œ */ private T data; public ResponseResult(Integer code, String msg) &#123; this.code = code; this.msg = msg; &#125; public ResponseResult(Integer code, T data) &#123; this.code = code; this.data = data; &#125; public Integer getCode() &#123; return code; &#125; public void setCode(Integer code) &#123; this.code = code; &#125; public String getMsg() &#123; return msg; &#125; public void setMsg(String msg) &#123; this.msg = msg; &#125; public T getData() &#123; return data; &#125; public void setData(T data) &#123; this.data = data; &#125; public ResponseResult(Integer code, String msg, T data) &#123; this.code = code; this.msg = msg; this.data = data; &#125;&#125; â‘£å·¥å…·ç±» import io.jsonwebtoken.Claims;import io.jsonwebtoken.JwtBuilder;import io.jsonwebtoken.Jwts;import io.jsonwebtoken.SignatureAlgorithm;import javax.crypto.SecretKey;import javax.crypto.spec.SecretKeySpec;import java.util.Base64;import java.util.Date;import java.util.UUID;/** * JWTå·¥å…·ç±» */public class JwtUtil &#123; //æœ‰æ•ˆæœŸä¸º public static final Long JWT_TTL = 60 * 60 *1000L;// 60 * 60 *1000 ä¸€ä¸ªå°æ—¶ //è®¾ç½®ç§˜é’¥æ˜æ–‡ public static final String JWT_KEY = &quot;sangeng&quot;; public static String getUUID()&#123; String token = UUID.randomUUID().toString().replaceAll(&quot;-&quot;, &quot;&quot;); return token; &#125; /** * ç”Ÿæˆjtw * @param subject tokenä¸­è¦å­˜æ”¾çš„æ•°æ®ï¼ˆjsonæ ¼å¼ï¼‰ * @return */ public static String createJWT(String subject) &#123; JwtBuilder builder = getJwtBuilder(subject, null, getUUID());// è®¾ç½®è¿‡æœŸæ—¶é—´ return builder.compact(); &#125; /** * ç”Ÿæˆjtw * @param subject tokenä¸­è¦å­˜æ”¾çš„æ•°æ®ï¼ˆjsonæ ¼å¼ï¼‰ * @param ttlMillis tokenè¶…æ—¶æ—¶é—´ * @return */ public static String createJWT(String subject, Long ttlMillis) &#123; JwtBuilder builder = getJwtBuilder(subject, ttlMillis, getUUID());// è®¾ç½®è¿‡æœŸæ—¶é—´ return builder.compact(); &#125; private static JwtBuilder getJwtBuilder(String subject, Long ttlMillis, String uuid) &#123; SignatureAlgorithm signatureAlgorithm = SignatureAlgorithm.HS256; SecretKey secretKey = generalKey(); long nowMillis = System.currentTimeMillis(); Date now = new Date(nowMillis); if(ttlMillis==null)&#123; ttlMillis=JwtUtil.JWT_TTL; &#125; long expMillis = nowMillis + ttlMillis; Date expDate = new Date(expMillis); return Jwts.builder() .setId(uuid) //å”¯ä¸€çš„ID .setSubject(subject) // ä¸»é¢˜ å¯ä»¥æ˜¯JSONæ•°æ® .setIssuer(&quot;sg&quot;) // ç­¾å‘è€… .setIssuedAt(now) // ç­¾å‘æ—¶é—´ .signWith(signatureAlgorithm, secretKey) //ä½¿ç”¨HS256å¯¹ç§°åŠ å¯†ç®—æ³•ç­¾å, ç¬¬äºŒä¸ªå‚æ•°ä¸ºç§˜é’¥ .setExpiration(expDate); &#125; /** * åˆ›å»ºtoken * @param id * @param subject * @param ttlMillis * @return */ public static String createJWT(String id, String subject, Long ttlMillis) &#123; JwtBuilder builder = getJwtBuilder(subject, ttlMillis, id);// è®¾ç½®è¿‡æœŸæ—¶é—´ return builder.compact(); &#125; public static void main(String[] args) throws Exception &#123; String token = &quot;eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJjYWM2ZDVhZi1mNjVlLTQ0MDAtYjcxMi0zYWEwOGIyOTIwYjQiLCJzdWIiOiJzZyIsImlzcyI6InNnIiwiaWF0IjoxNjM4MTA2NzEyLCJleHAiOjE2MzgxMTAzMTJ9.JVsSbkP94wuczb4QryQbAke3ysBDIL5ou8fWsbt_ebg&quot;; Claims claims = parseJWT(token); System.out.println(claims); &#125; /** * ç”ŸæˆåŠ å¯†åçš„ç§˜é’¥ secretKey * @return */ public static SecretKey generalKey() &#123; byte[] encodedKey = Base64.getDecoder().decode(JwtUtil.JWT_KEY); SecretKey key = new SecretKeySpec(encodedKey, 0, encodedKey.length, &quot;AES&quot;); return key; &#125; /** * è§£æ * * @param jwt * @return * @throws Exception */ public static Claims parseJWT(String jwt) throws Exception &#123; SecretKey secretKey = generalKey(); return Jwts.parser() .setSigningKey(secretKey) .parseClaimsJws(jwt) .getBody(); &#125;&#125; import java.util.*;import java.util.concurrent.TimeUnit;@SuppressWarnings(value = &#123; &quot;unchecked&quot;, &quot;rawtypes&quot; &#125;)@Componentpublic class RedisCache&#123; @Autowired public RedisTemplate redisTemplate; /** * ç¼“å­˜åŸºæœ¬çš„å¯¹è±¡ï¼ŒIntegerã€Stringã€å®ä½“ç±»ç­‰ * * @param key ç¼“å­˜çš„é”®å€¼ * @param value ç¼“å­˜çš„å€¼ */ public &lt;T&gt; void setCacheObject(final String key, final T value) &#123; redisTemplate.opsForValue().set(key, value); &#125; /** * ç¼“å­˜åŸºæœ¬çš„å¯¹è±¡ï¼ŒIntegerã€Stringã€å®ä½“ç±»ç­‰ * * @param key ç¼“å­˜çš„é”®å€¼ * @param value ç¼“å­˜çš„å€¼ * @param timeout æ—¶é—´ * @param timeUnit æ—¶é—´é¢—ç²’åº¦ */ public &lt;T&gt; void setCacheObject(final String key, final T value, final Integer timeout, final TimeUnit timeUnit) &#123; redisTemplate.opsForValue().set(key, value, timeout, timeUnit); &#125; /** * è®¾ç½®æœ‰æ•ˆæ—¶é—´ * * @param key Redisé”® * @param timeout è¶…æ—¶æ—¶é—´ * @return true=è®¾ç½®æˆåŠŸï¼›false=è®¾ç½®å¤±è´¥ */ public boolean expire(final String key, final long timeout) &#123; return expire(key, timeout, TimeUnit.SECONDS); &#125; /** * è®¾ç½®æœ‰æ•ˆæ—¶é—´ * * @param key Redisé”® * @param timeout è¶…æ—¶æ—¶é—´ * @param unit æ—¶é—´å•ä½ * @return true=è®¾ç½®æˆåŠŸï¼›false=è®¾ç½®å¤±è´¥ */ public boolean expire(final String key, final long timeout, final TimeUnit unit) &#123; return redisTemplate.expire(key, timeout, unit); &#125; /** * è·å¾—ç¼“å­˜çš„åŸºæœ¬å¯¹è±¡ã€‚ * * @param key ç¼“å­˜é”®å€¼ * @return ç¼“å­˜é”®å€¼å¯¹åº”çš„æ•°æ® */ public &lt;T&gt; T getCacheObject(final String key) &#123; ValueOperations&lt;String, T&gt; operation = redisTemplate.opsForValue(); return operation.get(key); &#125; /** * åˆ é™¤å•ä¸ªå¯¹è±¡ * * @param key */ public boolean deleteObject(final String key) &#123; return redisTemplate.delete(key); &#125; /** * åˆ é™¤é›†åˆå¯¹è±¡ * * @param collection å¤šä¸ªå¯¹è±¡ * @return */ public long deleteObject(final Collection collection) &#123; return redisTemplate.delete(collection); &#125; /** * ç¼“å­˜Listæ•°æ® * * @param key ç¼“å­˜çš„é”®å€¼ * @param dataList å¾…ç¼“å­˜çš„Listæ•°æ® * @return ç¼“å­˜çš„å¯¹è±¡ */ public &lt;T&gt; long setCacheList(final String key, final List&lt;T&gt; dataList) &#123; Long count = redisTemplate.opsForList().rightPushAll(key, dataList); return count == null ? 0 : count; &#125; /** * è·å¾—ç¼“å­˜çš„listå¯¹è±¡ * * @param key ç¼“å­˜çš„é”®å€¼ * @return ç¼“å­˜é”®å€¼å¯¹åº”çš„æ•°æ® */ public &lt;T&gt; List&lt;T&gt; getCacheList(final String key) &#123; return redisTemplate.opsForList().range(key, 0, -1); &#125; /** * ç¼“å­˜Set * * @param key ç¼“å­˜é”®å€¼ * @param dataSet ç¼“å­˜çš„æ•°æ® * @return ç¼“å­˜æ•°æ®çš„å¯¹è±¡ */ public &lt;T&gt; BoundSetOperations&lt;String, T&gt; setCacheSet(final String key, final Set&lt;T&gt; dataSet) &#123; BoundSetOperations&lt;String, T&gt; setOperation = redisTemplate.boundSetOps(key); Iterator&lt;T&gt; it = dataSet.iterator(); while (it.hasNext()) &#123; setOperation.add(it.next()); &#125; return setOperation; &#125; /** * è·å¾—ç¼“å­˜çš„set * * @param key * @return */ public &lt;T&gt; Set&lt;T&gt; getCacheSet(final String key) &#123; return redisTemplate.opsForSet().members(key); &#125; /** * ç¼“å­˜Map * * @param key * @param dataMap */ public &lt;T&gt; void setCacheMap(final String key, final Map&lt;String, T&gt; dataMap) &#123; if (dataMap != null) &#123; redisTemplate.opsForHash().putAll(key, dataMap); &#125; &#125; /** * è·å¾—ç¼“å­˜çš„Map * * @param key * @return */ public &lt;T&gt; Map&lt;String, T&gt; getCacheMap(final String key) &#123; return redisTemplate.opsForHash().entries(key); &#125; /** * å¾€Hashä¸­å­˜å…¥æ•°æ® * * @param key Redisé”® * @param hKey Hashé”® * @param value å€¼ */ public &lt;T&gt; void setCacheMapValue(final String key, final String hKey, final T value) &#123; redisTemplate.opsForHash().put(key, hKey, value); &#125; /** * è·å–Hashä¸­çš„æ•°æ® * * @param key Redisé”® * @param hKey Hashé”® * @return Hashä¸­çš„å¯¹è±¡ */ public &lt;T&gt; T getCacheMapValue(final String key, final String hKey) &#123; HashOperations&lt;String, String, T&gt; opsForHash = redisTemplate.opsForHash(); return opsForHash.get(key, hKey); &#125; /** * åˆ é™¤Hashä¸­çš„æ•°æ® * * @param key * @param hkey */ public void delCacheMapValue(final String key, final String hkey) &#123; HashOperations hashOperations = redisTemplate.opsForHash(); hashOperations.delete(key, hkey); &#125; /** * è·å–å¤šä¸ªHashä¸­çš„æ•°æ® * * @param key Redisé”® * @param hKeys Hashé”®é›†åˆ * @return Hashå¯¹è±¡é›†åˆ */ public &lt;T&gt; List&lt;T&gt; getMultiCacheMapValue(final String key, final Collection&lt;Object&gt; hKeys) &#123; return redisTemplate.opsForHash().multiGet(key, hKeys); &#125; /** * è·å¾—ç¼“å­˜çš„åŸºæœ¬å¯¹è±¡åˆ—è¡¨ * * @param pattern å­—ç¬¦ä¸²å‰ç¼€ * @return å¯¹è±¡åˆ—è¡¨ */ public Collection&lt;String&gt; keys(final String pattern) &#123; return redisTemplate.keys(pattern); &#125;&#125; import javax.servlet.http.HttpServletResponse;import java.io.IOException;public class WebUtils&#123; /** * å°†å­—ç¬¦ä¸²æ¸²æŸ“åˆ°å®¢æˆ·ç«¯ * * @param response æ¸²æŸ“å¯¹è±¡ * @param string å¾…æ¸²æŸ“çš„å­—ç¬¦ä¸² * @return null */ public static String renderString(HttpServletResponse response, String string) &#123; try &#123; response.setStatus(200); response.setContentType(&quot;application/json&quot;); response.setCharacterEncoding(&quot;utf-8&quot;); response.getWriter().print(string); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; return null; &#125;&#125; â‘¤å®ä½“ç±» import java.io.Serializable;import java.util.Date;/** * ç”¨æˆ·è¡¨(User)å®ä½“ç±» * * @author ä¸‰æ›´ */@Data@AllArgsConstructor@NoArgsConstructorpublic class User implements Serializable &#123; private static final long serialVersionUID = -40356785423868312L; /** * ä¸»é”® */ private Long id; /** * ç”¨æˆ·å */ private String userName; /** * æ˜µç§° */ private String nickName; /** * å¯†ç  */ private String password; /** * è´¦å·çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰ */ private String status; /** * é‚®ç®± */ private String email; /** * æ‰‹æœºå· */ private String phonenumber; /** * ç”¨æˆ·æ€§åˆ«ï¼ˆ0ç”·ï¼Œ1å¥³ï¼Œ2æœªçŸ¥ï¼‰ */ private String sex; /** * å¤´åƒ */ private String avatar; /** * ç”¨æˆ·ç±»å‹ï¼ˆ0ç®¡ç†å‘˜ï¼Œ1æ™®é€šç”¨æˆ·ï¼‰ */ private String userType; /** * åˆ›å»ºäººçš„ç”¨æˆ·id */ private Long createBy; /** * åˆ›å»ºæ—¶é—´ */ private Date createTime; /** * æ›´æ–°äºº */ private Long updateBy; /** * æ›´æ–°æ—¶é—´ */ private Date updateTime; /** * åˆ é™¤æ ‡å¿—ï¼ˆ0ä»£è¡¨æœªåˆ é™¤ï¼Œ1ä»£è¡¨å·²åˆ é™¤ï¼‰ */ private Integer delFlag;&#125; 2.3.3 å®ç°2.3.3.1 æ•°æ®åº“æ ¡éªŒç”¨æˆ·â€‹ ä»ä¹‹å‰çš„åˆ†ææˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªUserDetailsService,è®©SpringSecurityä½¿ç”¨æˆ‘ä»¬çš„UserDetailsServiceã€‚æˆ‘ä»¬è‡ªå·±çš„UserDetailsServiceå¯ä»¥ä»æ•°æ®åº“ä¸­æŸ¥è¯¢ç”¨æˆ·åå’Œå¯†ç ã€‚ å‡†å¤‡å·¥ä½œâ€‹ æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªç”¨æˆ·è¡¨ï¼Œ å»ºè¡¨è¯­å¥å¦‚ä¸‹ï¼š CREATE TABLE `sys_user` ( `id` BIGINT(20) NOT NULL AUTO_INCREMENT COMMENT &#x27;ä¸»é”®&#x27;, `user_name` VARCHAR(64) NOT NULL DEFAULT &#x27;NULL&#x27; COMMENT &#x27;ç”¨æˆ·å&#x27;, `nick_name` VARCHAR(64) NOT NULL DEFAULT &#x27;NULL&#x27; COMMENT &#x27;æ˜µç§°&#x27;, `password` VARCHAR(64) NOT NULL DEFAULT &#x27;NULL&#x27; COMMENT &#x27;å¯†ç &#x27;, `status` CHAR(1) DEFAULT &#x27;0&#x27; COMMENT &#x27;è´¦å·çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰&#x27;, `email` VARCHAR(64) DEFAULT NULL COMMENT &#x27;é‚®ç®±&#x27;, `phonenumber` VARCHAR(32) DEFAULT NULL COMMENT &#x27;æ‰‹æœºå·&#x27;, `sex` CHAR(1) DEFAULT NULL COMMENT &#x27;ç”¨æˆ·æ€§åˆ«ï¼ˆ0ç”·ï¼Œ1å¥³ï¼Œ2æœªçŸ¥ï¼‰&#x27;, `avatar` VARCHAR(128) DEFAULT NULL COMMENT &#x27;å¤´åƒ&#x27;, `user_type` CHAR(1) NOT NULL DEFAULT &#x27;1&#x27; COMMENT &#x27;ç”¨æˆ·ç±»å‹ï¼ˆ0ç®¡ç†å‘˜ï¼Œ1æ™®é€šç”¨æˆ·ï¼‰&#x27;, `create_by` BIGINT(20) DEFAULT NULL COMMENT &#x27;åˆ›å»ºäººçš„ç”¨æˆ·id&#x27;, `create_time` DATETIME DEFAULT NULL COMMENT &#x27;åˆ›å»ºæ—¶é—´&#x27;, `update_by` BIGINT(20) DEFAULT NULL COMMENT &#x27;æ›´æ–°äºº&#x27;, `update_time` DATETIME DEFAULT NULL COMMENT &#x27;æ›´æ–°æ—¶é—´&#x27;, `del_flag` INT(11) DEFAULT &#x27;0&#x27; COMMENT &#x27;åˆ é™¤æ ‡å¿—ï¼ˆ0ä»£è¡¨æœªåˆ é™¤ï¼Œ1ä»£è¡¨å·²åˆ é™¤ï¼‰&#x27;, PRIMARY KEY (`id`)) ENGINE=INNODB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;ç”¨æˆ·è¡¨&#x27; â€‹ å¼•å…¥MybatisPulså’Œmysqlé©±åŠ¨çš„ä¾èµ– &lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.4.3&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;&lt;/dependency&gt; â€‹ é…ç½®æ•°æ®åº“ä¿¡æ¯ spring: datasource: url: jdbc:mysql://localhost:3306/sg_security?characterEncoding=utf-8&amp;serverTimezone=UTC username: root password: root driver-class-name: com.mysql.cj.jdbc.Driver â€‹ å®šä¹‰Mapperæ¥å£ public interface UserMapper extends BaseMapper&lt;User&gt; &#123;&#125; â€‹ ä¿®æ”¹Userå®ä½“ç±» ç±»åä¸ŠåŠ @TableName(value = &quot;sys_user&quot;) ,idå­—æ®µä¸ŠåŠ  @TableId â€‹ é…ç½®Mapperæ‰«æ @SpringBootApplication@MapperScan(&quot;com.sangeng.mapper&quot;)public class SimpleSecurityApplication &#123; public static void main(String[] args) &#123; ConfigurableApplicationContext run = SpringApplication.run(SimpleSecurityApplication.class); System.out.println(run); &#125;&#125; â€‹ æ·»åŠ junitä¾èµ– &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;&lt;/dependency&gt; â€‹ æµ‹è¯•MPæ˜¯å¦èƒ½æ­£å¸¸ä½¿ç”¨ /** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@SpringBootTestpublic class MapperTest &#123; @Autowired private UserMapper userMapper; @Test public void testUserMapper()&#123; List&lt;User&gt; users = userMapper.selectList(null); System.out.println(users); &#125;&#125; æ ¸å¿ƒä»£ç å®ç°åˆ›å»ºä¸€ä¸ªç±»å®ç°UserDetailsServiceæ¥å£ï¼Œé‡å†™å…¶ä¸­çš„æ–¹æ³•ã€‚æ›´åŠ ç”¨æˆ·åä»æ•°æ®åº“ä¸­æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ /** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@Servicepublic class UserDetailsServiceImpl implements UserDetailsService &#123; @Autowired private UserMapper userMapper; @Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException &#123; //æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ LambdaQueryWrapper&lt;User&gt; wrapper = new LambdaQueryWrapper&lt;&gt;(); wrapper.eq(User::getUserName,username); User user = userMapper.selectOne(wrapper); //å¦‚æœæŸ¥è¯¢ä¸åˆ°æ•°æ®å°±é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ¥ç»™å‡ºæç¤º if(Objects.isNull(user))&#123; throw new RuntimeException(&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;); &#125; //TODO æ ¹æ®ç”¨æˆ·æŸ¥è¯¢æƒé™ä¿¡æ¯ æ·»åŠ åˆ°LoginUserä¸­ //å°è£…æˆUserDetailså¯¹è±¡è¿”å› return new LoginUser(user); &#125;&#125; å› ä¸ºUserDetailsServiceæ–¹æ³•çš„è¿”å›å€¼æ˜¯UserDetailsç±»å‹ï¼Œæ‰€ä»¥éœ€è¦å®šä¹‰ä¸€ä¸ªç±»ï¼Œå®ç°è¯¥æ¥å£ï¼ŒæŠŠç”¨æˆ·ä¿¡æ¯å°è£…åœ¨å…¶ä¸­ã€‚ /** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@Data@NoArgsConstructor@AllArgsConstructorpublic class LoginUser implements UserDetails &#123; private User user; @Override public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123; return null; &#125; @Override public String getPassword() &#123; return user.getPassword(); &#125; @Override public String getUsername() &#123; return user.getUserName(); &#125; @Override public boolean isAccountNonExpired() &#123; return true; &#125; @Override public boolean isAccountNonLocked() &#123; return true; &#125; @Override public boolean isCredentialsNonExpired() &#123; return true; &#125; @Override public boolean isEnabled() &#123; return true; &#125;&#125; æ³¨æ„ï¼šå¦‚æœè¦æµ‹è¯•ï¼Œéœ€è¦å¾€ç”¨æˆ·è¡¨ä¸­å†™å…¥ç”¨æˆ·æ•°æ®ï¼Œå¹¶ä¸”å¦‚æœä½ æƒ³è®©ç”¨æˆ·çš„å¯†ç æ˜¯æ˜æ–‡å­˜å‚¨ï¼Œéœ€è¦åœ¨å¯†ç å‰åŠ {noop}ã€‚ä¾‹å¦‚ è¿™æ ·ç™»é™†çš„æ—¶å€™å°±å¯ä»¥ç”¨sgä½œä¸ºç”¨æˆ·åï¼Œ1234ä½œä¸ºå¯†ç æ¥ç™»é™†äº†ã€‚ 2.3.3.2 å¯†ç åŠ å¯†å­˜å‚¨â€‹ å®é™…é¡¹ç›®ä¸­æˆ‘ä»¬ä¸ä¼šæŠŠå¯†ç æ˜æ–‡å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚ â€‹ é»˜è®¤ä½¿ç”¨çš„PasswordEncoderè¦æ±‚æ•°æ®åº“ä¸­çš„å¯†ç æ ¼å¼ä¸ºï¼š{id}password ã€‚å®ƒä¼šæ ¹æ®idå»åˆ¤æ–­å¯†ç çš„åŠ å¯†æ–¹å¼ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šé‡‡ç”¨è¿™ç§æ–¹å¼ã€‚æ‰€ä»¥å°±éœ€è¦æ›¿æ¢PasswordEncoderã€‚ â€‹ æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨SpringSecurityä¸ºæˆ‘ä»¬æä¾›çš„BCryptPasswordEncoderã€‚ â€‹ æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨æŠŠBCryptPasswordEncoderå¯¹è±¡æ³¨å…¥Springå®¹å™¨ä¸­ï¼ŒSpringSecurityå°±ä¼šä½¿ç”¨è¯¥PasswordEncoderæ¥è¿›è¡Œå¯†ç æ ¡éªŒã€‚ â€‹ æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªSpringSecurityçš„é…ç½®ç±»ï¼ŒSpringSecurityè¦æ±‚è¿™ä¸ªé…ç½®ç±»è¦ç»§æ‰¿WebSecurityConfigurerAdapterã€‚ /** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@Configurationpublic class SecurityConfig extends WebSecurityConfigurerAdapter &#123; @Bean public PasswordEncoder passwordEncoder()&#123; return new BCryptPasswordEncoder(); &#125;&#125; 2.3.3.3 ç™»é™†æ¥å£â€‹ æ¥ä¸‹æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ç™»é™†æ¥å£ï¼Œç„¶åè®©SpringSecurityå¯¹è¿™ä¸ªæ¥å£æ”¾è¡Œ,è®©ç”¨æˆ·è®¿é—®è¿™ä¸ªæ¥å£çš„æ—¶å€™ä¸ç”¨ç™»å½•ä¹Ÿèƒ½è®¿é—®ã€‚ â€‹ åœ¨æ¥å£ä¸­æˆ‘ä»¬é€šè¿‡AuthenticationManagerçš„authenticateæ–¹æ³•æ¥è¿›è¡Œç”¨æˆ·è®¤è¯,æ‰€ä»¥éœ€è¦åœ¨SecurityConfigä¸­é…ç½®æŠŠAuthenticationManageræ³¨å…¥å®¹å™¨ã€‚ â€‹ è®¤è¯æˆåŠŸçš„è¯è¦ç”Ÿæˆä¸€ä¸ªjwtï¼Œæ”¾å…¥å“åº”ä¸­è¿”å›ã€‚å¹¶ä¸”ä¸ºäº†è®©ç”¨æˆ·ä¸‹å›è¯·æ±‚æ—¶èƒ½é€šè¿‡jwtè¯†åˆ«å‡ºå…·ä½“çš„æ˜¯å“ªä¸ªç”¨æˆ·ï¼Œæˆ‘ä»¬éœ€è¦æŠŠç”¨æˆ·ä¿¡æ¯å­˜å…¥redisï¼Œå¯ä»¥æŠŠç”¨æˆ·idä½œä¸ºkeyã€‚ @RestControllerpublic class LoginController &#123; @Autowired private LoginServcie loginServcie; @PostMapping(&quot;/user/login&quot;) public ResponseResult login(@RequestBody User user)&#123; return loginServcie.login(user); &#125;&#125; /** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@Configurationpublic class SecurityConfig extends WebSecurityConfigurerAdapter &#123; @Bean public PasswordEncoder passwordEncoder()&#123; return new BCryptPasswordEncoder(); &#125; @Override protected void configure(HttpSecurity http) throws Exception &#123; http //å…³é—­csrf .csrf().disable() //ä¸é€šè¿‡Sessionè·å–SecurityContext .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS) .and() .authorizeRequests() // å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—® .antMatchers(&quot;/user/login&quot;).anonymous() // é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯ .anyRequest().authenticated(); &#125; @Bean @Override public AuthenticationManager authenticationManagerBean() throws Exception &#123; return super.authenticationManagerBean(); &#125;&#125; â€‹ @Servicepublic class LoginServiceImpl implements LoginServcie &#123; @Autowired private AuthenticationManager authenticationManager; @Autowired private RedisCache redisCache; @Override public ResponseResult login(User user) &#123; UsernamePasswordAuthenticationToken authenticationToken = new UsernamePasswordAuthenticationToken(user.getUserName(),user.getPassword()); Authentication authenticate = authenticationManager.authenticate(authenticationToken); if(Objects.isNull(authenticate))&#123; throw new RuntimeException(&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;); &#125; //ä½¿ç”¨useridç”Ÿæˆtoken LoginUser loginUser = (LoginUser) authenticate.getPrincipal(); String userId = loginUser.getUser().getId().toString(); String jwt = JwtUtil.createJWT(userId); //authenticateå­˜å…¥redis redisCache.setCacheObject(&quot;login:&quot;+userId,loginUser); //æŠŠtokenå“åº”ç»™å‰ç«¯ HashMap&lt;String,String&gt; map = new HashMap&lt;&gt;(); map.put(&quot;token&quot;,jwt); return new ResponseResult(200,&quot;ç™»é™†æˆåŠŸ&quot;,map); &#125;&#125; 2.3.3.4 è®¤è¯è¿‡æ»¤å™¨â€‹ æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œè¿™ä¸ªè¿‡æ»¤å™¨ä¼šå»è·å–è¯·æ±‚å¤´ä¸­çš„tokenï¼Œå¯¹tokenè¿›è¡Œè§£æå–å‡ºå…¶ä¸­çš„useridã€‚ â€‹ ä½¿ç”¨useridå»redisä¸­è·å–å¯¹åº”çš„LoginUserå¯¹è±¡ã€‚ â€‹ ç„¶åå°è£…Authenticationå¯¹è±¡å­˜å…¥SecurityContextHolder @Componentpublic class JwtAuthenticationTokenFilter extends OncePerRequestFilter &#123; @Autowired private RedisCache redisCache; @Override protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException &#123; //è·å–token String token = request.getHeader(&quot;token&quot;); if (!StringUtils.hasText(token)) &#123; //æ”¾è¡Œ filterChain.doFilter(request, response); return; &#125; //è§£ætoken String userid; try &#123; Claims claims = JwtUtil.parseJWT(token); userid = claims.getSubject(); &#125; catch (Exception e) &#123; e.printStackTrace(); throw new RuntimeException(&quot;tokenéæ³•&quot;); &#125; //ä»redisä¸­è·å–ç”¨æˆ·ä¿¡æ¯ String redisKey = &quot;login:&quot; + userid; LoginUser loginUser = redisCache.getCacheObject(redisKey); if(Objects.isNull(loginUser))&#123; throw new RuntimeException(&quot;ç”¨æˆ·æœªç™»å½•&quot;); &#125; //å­˜å…¥SecurityContextHolder //TODO è·å–æƒé™ä¿¡æ¯å°è£…åˆ°Authenticationä¸­ UsernamePasswordAuthenticationToken authenticationToken = new UsernamePasswordAuthenticationToken(loginUser,null,null); SecurityContextHolder.getContext().setAuthentication(authenticationToken); //æ”¾è¡Œ filterChain.doFilter(request, response); &#125;&#125; /** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@Configurationpublic class SecurityConfig extends WebSecurityConfigurerAdapter &#123; @Bean public PasswordEncoder passwordEncoder()&#123; return new BCryptPasswordEncoder(); &#125; @Autowired JwtAuthenticationTokenFilter jwtAuthenticationTokenFilter; @Override protected void configure(HttpSecurity http) throws Exception &#123; http //å…³é—­csrf .csrf().disable() //ä¸é€šè¿‡Sessionè·å–SecurityContext .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS) .and() .authorizeRequests() // å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—® .antMatchers(&quot;/user/login&quot;).anonymous() // é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯ .anyRequest().authenticated(); //æŠŠtokenæ ¡éªŒè¿‡æ»¤å™¨æ·»åŠ åˆ°è¿‡æ»¤å™¨é“¾ä¸­ http.addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class); &#125; @Bean @Override public AuthenticationManager authenticationManagerBean() throws Exception &#123; return super.authenticationManagerBean(); &#125;&#125; 2.3.3.5 é€€å‡ºç™»é™†â€‹ æˆ‘ä»¬åªéœ€è¦å®šä¹‰ä¸€ä¸ªç™»é™†æ¥å£ï¼Œç„¶åè·å–SecurityContextHolderä¸­çš„è®¤è¯ä¿¡æ¯ï¼Œåˆ é™¤redisä¸­å¯¹åº”çš„æ•°æ®å³å¯ã€‚ /** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@Servicepublic class LoginServiceImpl implements LoginServcie &#123; @Autowired private AuthenticationManager authenticationManager; @Autowired private RedisCache redisCache; @Override public ResponseResult login(User user) &#123; UsernamePasswordAuthenticationToken authenticationToken = new UsernamePasswordAuthenticationToken(user.getUserName(),user.getPassword()); Authentication authenticate = authenticationManager.authenticate(authenticationToken); if(Objects.isNull(authenticate))&#123; throw new RuntimeException(&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;); &#125; //ä½¿ç”¨useridç”Ÿæˆtoken LoginUser loginUser = (LoginUser) authenticate.getPrincipal(); String userId = loginUser.getUser().getId().toString(); String jwt = JwtUtil.createJWT(userId); //authenticateå­˜å…¥redis redisCache.setCacheObject(&quot;login:&quot;+userId,loginUser); //æŠŠtokenå“åº”ç»™å‰ç«¯ HashMap&lt;String,String&gt; map = new HashMap&lt;&gt;(); map.put(&quot;token&quot;,jwt); return new ResponseResult(200,&quot;ç™»é™†æˆåŠŸ&quot;,map); &#125; @Override public ResponseResult logout() &#123; Authentication authentication = SecurityContextHolder.getContext().getAuthentication(); LoginUser loginUser = (LoginUser) authentication.getPrincipal(); Long userid = loginUser.getUser().getId(); redisCache.deleteObject(&quot;login:&quot;+userid); return new ResponseResult(200,&quot;é€€å‡ºæˆåŠŸ&quot;); &#125;&#125; 3. æˆæƒ3.0 æƒé™ç³»ç»Ÿçš„ä½œç”¨â€‹ ä¾‹å¦‚ä¸€ä¸ªå­¦æ ¡å›¾ä¹¦é¦†çš„ç®¡ç†ç³»ç»Ÿï¼Œå¦‚æœæ˜¯æ™®é€šå­¦ç”Ÿç™»å½•å°±èƒ½çœ‹åˆ°å€Ÿä¹¦è¿˜ä¹¦ç›¸å…³çš„åŠŸèƒ½ï¼Œä¸å¯èƒ½è®©ä»–çœ‹åˆ°å¹¶ä¸”å»ä½¿ç”¨æ·»åŠ ä¹¦ç±ä¿¡æ¯ï¼Œåˆ é™¤ä¹¦ç±ä¿¡æ¯ç­‰åŠŸèƒ½ã€‚ä½†æ˜¯å¦‚æœæ˜¯ä¸€ä¸ªå›¾ä¹¦é¦†ç®¡ç†å‘˜çš„è´¦å·ç™»å½•äº†ï¼Œåº”è¯¥å°±èƒ½çœ‹åˆ°å¹¶ä½¿ç”¨æ·»åŠ ä¹¦ç±ä¿¡æ¯ï¼Œåˆ é™¤ä¹¦ç±ä¿¡æ¯ç­‰åŠŸèƒ½ã€‚ â€‹ æ€»ç»“èµ·æ¥å°±æ˜¯ä¸åŒçš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨ä¸åŒçš„åŠŸèƒ½ã€‚è¿™å°±æ˜¯æƒé™ç³»ç»Ÿè¦å»å®ç°çš„æ•ˆæœã€‚ â€‹ æˆ‘ä»¬ä¸èƒ½åªä¾èµ–å‰ç«¯å»åˆ¤æ–­ç”¨æˆ·çš„æƒé™æ¥é€‰æ‹©æ˜¾ç¤ºå“ªäº›èœå•å“ªäº›æŒ‰é’®ã€‚å› ä¸ºå¦‚æœåªæ˜¯è¿™æ ·ï¼Œå¦‚æœæœ‰äººçŸ¥é“äº†å¯¹åº”åŠŸèƒ½çš„æ¥å£åœ°å€å°±å¯ä»¥ä¸é€šè¿‡å‰ç«¯ï¼Œç›´æ¥å»å‘é€è¯·æ±‚æ¥å®ç°ç›¸å…³åŠŸèƒ½æ“ä½œã€‚ â€‹ æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦åœ¨åå°è¿›è¡Œç”¨æˆ·æƒé™çš„åˆ¤æ–­ï¼Œåˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰ç›¸åº”çš„æƒé™ï¼Œå¿…é¡»å…·æœ‰æ‰€éœ€æƒé™æ‰èƒ½è¿›è¡Œç›¸åº”çš„æ“ä½œã€‚ â€‹ 3.1 æˆæƒåŸºæœ¬æµç¨‹â€‹ åœ¨SpringSecurityä¸­ï¼Œä¼šä½¿ç”¨é»˜è®¤çš„FilterSecurityInterceptoræ¥è¿›è¡Œæƒé™æ ¡éªŒã€‚åœ¨FilterSecurityInterceptorä¸­ä¼šä»SecurityContextHolderè·å–å…¶ä¸­çš„Authenticationï¼Œç„¶åè·å–å…¶ä¸­çš„æƒé™ä¿¡æ¯ã€‚å½“å‰ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰è®¿é—®å½“å‰èµ„æºæ‰€éœ€çš„æƒé™ã€‚ â€‹ æ‰€ä»¥æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­åªéœ€è¦æŠŠå½“å‰ç™»å½•ç”¨æˆ·çš„æƒé™ä¿¡æ¯ä¹Ÿå­˜å…¥Authenticationã€‚ â€‹ ç„¶åè®¾ç½®æˆ‘ä»¬çš„èµ„æºæ‰€éœ€è¦çš„æƒé™å³å¯ã€‚ 3.2 æˆæƒå®ç°3.2.1 é™åˆ¶è®¿é—®èµ„æºæ‰€éœ€æƒé™â€‹ SpringSecurityä¸ºæˆ‘ä»¬æä¾›äº†åŸºäºæ³¨è§£çš„æƒé™æ§åˆ¶æ–¹æ¡ˆï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬é¡¹ç›®ä¸­ä¸»è¦é‡‡ç”¨çš„æ–¹å¼ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ³¨è§£å»æŒ‡å®šè®¿é—®å¯¹åº”çš„èµ„æºæ‰€éœ€çš„æƒé™ã€‚ â€‹ ä½†æ˜¯è¦ä½¿ç”¨å®ƒæˆ‘ä»¬éœ€è¦å…ˆå¼€å¯ç›¸å…³é…ç½®ã€‚ @EnableGlobalMethodSecurity(prePostEnabled = true) â€‹ ç„¶åå°±å¯ä»¥ä½¿ç”¨å¯¹åº”çš„æ³¨è§£ã€‚@PreAuthorize @RestControllerpublic class HelloController &#123; @RequestMapping(&quot;/hello&quot;) @PreAuthorize(&quot;hasAuthority(&#x27;test&#x27;)&quot;) public String hello()&#123; return &quot;hello&quot;; &#125;&#125; 3.2.2 å°è£…æƒé™ä¿¡æ¯â€‹ æˆ‘ä»¬å‰é¢åœ¨å†™UserDetailsServiceImplçš„æ—¶å€™è¯´è¿‡ï¼Œåœ¨æŸ¥è¯¢å‡ºç”¨æˆ·åè¿˜è¦è·å–å¯¹åº”çš„æƒé™ä¿¡æ¯ï¼Œå°è£…åˆ°UserDetailsä¸­è¿”å›ã€‚ â€‹ æˆ‘ä»¬å…ˆç›´æ¥æŠŠæƒé™ä¿¡æ¯å†™æ­»å°è£…åˆ°UserDetailsä¸­è¿›è¡Œæµ‹è¯•ã€‚ â€‹ æˆ‘ä»¬ä¹‹å‰å®šä¹‰äº†UserDetailsçš„å®ç°ç±»LoginUserï¼Œæƒ³è¦è®©å…¶èƒ½å°è£…æƒé™ä¿¡æ¯å°±è¦å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚ package com.sangeng.domain;import com.alibaba.fastjson.annotation.JSONField;import lombok.AllArgsConstructor;import lombok.Data;import lombok.NoArgsConstructor;import org.springframework.security.core.GrantedAuthority;import org.springframework.security.core.authority.SimpleGrantedAuthority;import org.springframework.security.core.userdetails.UserDetails;import java.util.Collection;import java.util.List;import java.util.stream.Collectors;/** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@Data@NoArgsConstructorpublic class LoginUser implements UserDetails &#123; private User user; //å­˜å‚¨æƒé™ä¿¡æ¯ private List&lt;String&gt; permissions; public LoginUser(User user,List&lt;String&gt; permissions) &#123; this.user = user; this.permissions = permissions; &#125; //å­˜å‚¨SpringSecurityæ‰€éœ€è¦çš„æƒé™ä¿¡æ¯çš„é›†åˆ @JSONField(serialize = false) private List&lt;GrantedAuthority&gt; authorities; @Override public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123; if(authorities!=null)&#123; return authorities; &#125; //æŠŠpermissionsä¸­å­—ç¬¦ä¸²ç±»å‹çš„æƒé™ä¿¡æ¯è½¬æ¢æˆGrantedAuthorityå¯¹è±¡å­˜å…¥authoritiesä¸­ authorities = permissions.stream(). map(SimpleGrantedAuthority::new) .collect(Collectors.toList()); return authorities; &#125; @Override public String getPassword() &#123; return user.getPassword(); &#125; @Override public String getUsername() &#123; return user.getUserName(); &#125; @Override public boolean isAccountNonExpired() &#123; return true; &#125; @Override public boolean isAccountNonLocked() &#123; return true; &#125; @Override public boolean isCredentialsNonExpired() &#123; return true; &#125; @Override public boolean isEnabled() &#123; return true; &#125;&#125; â€‹ LoginUserä¿®æ”¹å®Œåæˆ‘ä»¬å°±å¯ä»¥åœ¨UserDetailsServiceImplä¸­å»æŠŠæƒé™ä¿¡æ¯å°è£…åˆ°LoginUserä¸­äº†ã€‚æˆ‘ä»¬å†™æ­»æƒé™è¿›è¡Œæµ‹è¯•ï¼Œåé¢æˆ‘ä»¬å†ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æƒé™ä¿¡æ¯ã€‚ package com.sangeng.service.impl;import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;import com.baomidou.mybatisplus.extension.conditions.query.LambdaQueryChainWrapper;import com.sangeng.domain.LoginUser;import com.sangeng.domain.User;import com.sangeng.mapper.UserMapper;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.security.core.userdetails.UserDetails;import org.springframework.security.core.userdetails.UserDetailsService;import org.springframework.security.core.userdetails.UsernameNotFoundException;import org.springframework.stereotype.Service;import java.util.ArrayList;import java.util.Arrays;import java.util.List;import java.util.Objects;/** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@Servicepublic class UserDetailsServiceImpl implements UserDetailsService &#123; @Autowired private UserMapper userMapper; @Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException &#123; LambdaQueryWrapper&lt;User&gt; wrapper = new LambdaQueryWrapper&lt;&gt;(); wrapper.eq(User::getUserName,username); User user = userMapper.selectOne(wrapper); if(Objects.isNull(user))&#123; throw new RuntimeException(&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;); &#125; //TODO æ ¹æ®ç”¨æˆ·æŸ¥è¯¢æƒé™ä¿¡æ¯ æ·»åŠ åˆ°LoginUserä¸­ List&lt;String&gt; list = new ArrayList&lt;&gt;(Arrays.asList(&quot;test&quot;)); return new LoginUser(user,list); &#125;&#125; 3.2.3 ä»æ•°æ®åº“æŸ¥è¯¢æƒé™ä¿¡æ¯3.2.3.1 RBACæƒé™æ¨¡å‹â€‹ RBACæƒé™æ¨¡å‹ï¼ˆRole-Based Access Controlï¼‰å³ï¼šåŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ã€‚è¿™æ˜¯ç›®å‰æœ€å¸¸è¢«å¼€å‘è€…ä½¿ç”¨ä¹Ÿæ˜¯ç›¸å¯¹æ˜“ç”¨ã€é€šç”¨æƒé™æ¨¡å‹ã€‚ â€‹ 3.2.3.2 å‡†å¤‡å·¥ä½œCREATE DATABASE /*!32312 IF NOT EXISTS*/`sg_security` /*!40100 DEFAULT CHARACTER SET utf8mb4 */;USE `sg_security`;/*Table structure for table `sys_menu` */DROP TABLE IF EXISTS `sys_menu`;CREATE TABLE `sys_menu` ( `id` bigint(20) NOT NULL AUTO_INCREMENT, `menu_name` varchar(64) NOT NULL DEFAULT &#x27;NULL&#x27; COMMENT &#x27;èœå•å&#x27;, `path` varchar(200) DEFAULT NULL COMMENT &#x27;è·¯ç”±åœ°å€&#x27;, `component` varchar(255) DEFAULT NULL COMMENT &#x27;ç»„ä»¶è·¯å¾„&#x27;, `visible` char(1) DEFAULT &#x27;0&#x27; COMMENT &#x27;èœå•çŠ¶æ€ï¼ˆ0æ˜¾ç¤º 1éšè—ï¼‰&#x27;, `status` char(1) DEFAULT &#x27;0&#x27; COMMENT &#x27;èœå•çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰&#x27;, `perms` varchar(100) DEFAULT NULL COMMENT &#x27;æƒé™æ ‡è¯†&#x27;, `icon` varchar(100) DEFAULT &#x27;#&#x27; COMMENT &#x27;èœå•å›¾æ ‡&#x27;, `create_by` bigint(20) DEFAULT NULL, `create_time` datetime DEFAULT NULL, `update_by` bigint(20) DEFAULT NULL, `update_time` datetime DEFAULT NULL, `del_flag` int(11) DEFAULT &#x27;0&#x27; COMMENT &#x27;æ˜¯å¦åˆ é™¤ï¼ˆ0æœªåˆ é™¤ 1å·²åˆ é™¤ï¼‰&#x27;, `remark` varchar(500) DEFAULT NULL COMMENT &#x27;å¤‡æ³¨&#x27;, PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;èœå•è¡¨&#x27;;/*Table structure for table `sys_role` */DROP TABLE IF EXISTS `sys_role`;CREATE TABLE `sys_role` ( `id` bigint(20) NOT NULL AUTO_INCREMENT, `name` varchar(128) DEFAULT NULL, `role_key` varchar(100) DEFAULT NULL COMMENT &#x27;è§’è‰²æƒé™å­—ç¬¦ä¸²&#x27;, `status` char(1) DEFAULT &#x27;0&#x27; COMMENT &#x27;è§’è‰²çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰&#x27;, `del_flag` int(1) DEFAULT &#x27;0&#x27; COMMENT &#x27;del_flag&#x27;, `create_by` bigint(200) DEFAULT NULL, `create_time` datetime DEFAULT NULL, `update_by` bigint(200) DEFAULT NULL, `update_time` datetime DEFAULT NULL, `remark` varchar(500) DEFAULT NULL COMMENT &#x27;å¤‡æ³¨&#x27;, PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;è§’è‰²è¡¨&#x27;;/*Table structure for table `sys_role_menu` */DROP TABLE IF EXISTS `sys_role_menu`;CREATE TABLE `sys_role_menu` ( `role_id` bigint(200) NOT NULL AUTO_INCREMENT COMMENT &#x27;è§’è‰²ID&#x27;, `menu_id` bigint(200) NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;èœå•id&#x27;, PRIMARY KEY (`role_id`,`menu_id`)) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4;/*Table structure for table `sys_user` */DROP TABLE IF EXISTS `sys_user`;CREATE TABLE `sys_user` ( `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#x27;ä¸»é”®&#x27;, `user_name` varchar(64) NOT NULL DEFAULT &#x27;NULL&#x27; COMMENT &#x27;ç”¨æˆ·å&#x27;, `nick_name` varchar(64) NOT NULL DEFAULT &#x27;NULL&#x27; COMMENT &#x27;æ˜µç§°&#x27;, `password` varchar(64) NOT NULL DEFAULT &#x27;NULL&#x27; COMMENT &#x27;å¯†ç &#x27;, `status` char(1) DEFAULT &#x27;0&#x27; COMMENT &#x27;è´¦å·çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰&#x27;, `email` varchar(64) DEFAULT NULL COMMENT &#x27;é‚®ç®±&#x27;, `phonenumber` varchar(32) DEFAULT NULL COMMENT &#x27;æ‰‹æœºå·&#x27;, `sex` char(1) DEFAULT NULL COMMENT &#x27;ç”¨æˆ·æ€§åˆ«ï¼ˆ0ç”·ï¼Œ1å¥³ï¼Œ2æœªçŸ¥ï¼‰&#x27;, `avatar` varchar(128) DEFAULT NULL COMMENT &#x27;å¤´åƒ&#x27;, `user_type` char(1) NOT NULL DEFAULT &#x27;1&#x27; COMMENT &#x27;ç”¨æˆ·ç±»å‹ï¼ˆ0ç®¡ç†å‘˜ï¼Œ1æ™®é€šç”¨æˆ·ï¼‰&#x27;, `create_by` bigint(20) DEFAULT NULL COMMENT &#x27;åˆ›å»ºäººçš„ç”¨æˆ·id&#x27;, `create_time` datetime DEFAULT NULL COMMENT &#x27;åˆ›å»ºæ—¶é—´&#x27;, `update_by` bigint(20) DEFAULT NULL COMMENT &#x27;æ›´æ–°äºº&#x27;, `update_time` datetime DEFAULT NULL COMMENT &#x27;æ›´æ–°æ—¶é—´&#x27;, `del_flag` int(11) DEFAULT &#x27;0&#x27; COMMENT &#x27;åˆ é™¤æ ‡å¿—ï¼ˆ0ä»£è¡¨æœªåˆ é™¤ï¼Œ1ä»£è¡¨å·²åˆ é™¤ï¼‰&#x27;, PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;ç”¨æˆ·è¡¨&#x27;;/*Table structure for table `sys_user_role` */DROP TABLE IF EXISTS `sys_user_role`;CREATE TABLE `sys_user_role` ( `user_id` bigint(200) NOT NULL AUTO_INCREMENT COMMENT &#x27;ç”¨æˆ·id&#x27;, `role_id` bigint(200) NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;è§’è‰²id&#x27;, PRIMARY KEY (`user_id`,`role_id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; SELECT DISTINCT m.`perms`FROM sys_user_role ur LEFT JOIN `sys_role` r ON ur.`role_id` = r.`id` LEFT JOIN `sys_role_menu` rm ON ur.`role_id` = rm.`role_id` LEFT JOIN `sys_menu` m ON m.`id` = rm.`menu_id`WHERE user_id = 2 AND r.`status` = 0 AND m.`status` = 0 package com.sangeng.domain;import com.baomidou.mybatisplus.annotation.TableId;import com.baomidou.mybatisplus.annotation.TableName;import com.fasterxml.jackson.annotation.JsonInclude;import lombok.AllArgsConstructor;import lombok.Data;import lombok.NoArgsConstructor;import java.io.Serializable;import java.util.Date;/** * èœå•è¡¨(Menu)å®ä½“ç±» * * @author makejava * @since 2021-11-24 15:30:08 */@TableName(value=&quot;sys_menu&quot;)@Data@AllArgsConstructor@NoArgsConstructor@JsonInclude(JsonInclude.Include.NON_NULL)public class Menu implements Serializable &#123; private static final long serialVersionUID = -54979041104113736L; @TableId private Long id; /** * èœå•å */ private String menuName; /** * è·¯ç”±åœ°å€ */ private String path; /** * ç»„ä»¶è·¯å¾„ */ private String component; /** * èœå•çŠ¶æ€ï¼ˆ0æ˜¾ç¤º 1éšè—ï¼‰ */ private String visible; /** * èœå•çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰ */ private String status; /** * æƒé™æ ‡è¯† */ private String perms; /** * èœå•å›¾æ ‡ */ private String icon; private Long createBy; private Date createTime; private Long updateBy; private Date updateTime; /** * æ˜¯å¦åˆ é™¤ï¼ˆ0æœªåˆ é™¤ 1å·²åˆ é™¤ï¼‰ */ private Integer delFlag; /** * å¤‡æ³¨ */ private String remark;&#125; 3.2.3.3 ä»£ç å®ç°â€‹ æˆ‘ä»¬åªéœ€è¦æ ¹æ®ç”¨æˆ·idå»æŸ¥è¯¢åˆ°å…¶æ‰€å¯¹åº”çš„æƒé™ä¿¡æ¯å³å¯ã€‚ â€‹ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆå®šä¹‰ä¸ªmapperï¼Œå…¶ä¸­æä¾›ä¸€ä¸ªæ–¹æ³•å¯ä»¥æ ¹æ®useridæŸ¥è¯¢æƒé™ä¿¡æ¯ã€‚ import com.baomidou.mybatisplus.core.mapper.BaseMapper;import com.sangeng.domain.Menu;import java.util.List;/** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */public interface MenuMapper extends BaseMapper&lt;Menu&gt; &#123; List&lt;String&gt; selectPermsByUserId(Long id);&#125; â€‹ å°¤å…¶æ˜¯è‡ªå®šä¹‰æ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦åˆ›å»ºå¯¹åº”çš„mapperæ–‡ä»¶ï¼Œå®šä¹‰å¯¹åº”çš„sqlè¯­å¥ &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot; &gt;&lt;mapper namespace=&quot;com.sangeng.mapper.MenuMapper&quot;&gt; &lt;select id=&quot;selectPermsByUserId&quot; resultType=&quot;java.lang.String&quot;&gt; SELECT DISTINCT m.`perms` FROM sys_user_role ur LEFT JOIN `sys_role` r ON ur.`role_id` = r.`id` LEFT JOIN `sys_role_menu` rm ON ur.`role_id` = rm.`role_id` LEFT JOIN `sys_menu` m ON m.`id` = rm.`menu_id` WHERE user_id = #&#123;userid&#125; AND r.`status` = 0 AND m.`status` = 0 &lt;/select&gt;&lt;/mapper&gt; â€‹ åœ¨application.ymlä¸­é…ç½®mapperXMLæ–‡ä»¶çš„ä½ç½® spring: datasource: url: jdbc:mysql://localhost:3306/sg_security?characterEncoding=utf-8&amp;serverTimezone=UTC username: root password: root driver-class-name: com.mysql.cj.jdbc.Driver redis: host: localhost port: 6379mybatis-plus: mapper-locations: classpath*:/mapper/**/*.xml â€‹ ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨UserDetailsServiceImplä¸­å»è°ƒç”¨è¯¥mapperçš„æ–¹æ³•æŸ¥è¯¢æƒé™ä¿¡æ¯å°è£…åˆ°LoginUserå¯¹è±¡ä¸­å³å¯ã€‚ /** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@Servicepublic class UserDetailsServiceImpl implements UserDetailsService &#123; @Autowired private UserMapper userMapper; @Autowired private MenuMapper menuMapper; @Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException &#123; LambdaQueryWrapper&lt;User&gt; wrapper = new LambdaQueryWrapper&lt;&gt;(); wrapper.eq(User::getUserName,username); User user = userMapper.selectOne(wrapper); if(Objects.isNull(user))&#123; throw new RuntimeException(&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;); &#125; List&lt;String&gt; permissionKeyList = menuMapper.selectPermsByUserId(user.getId());// //æµ‹è¯•å†™æ³•// List&lt;String&gt; list = new ArrayList&lt;&gt;(Arrays.asList(&quot;test&quot;)); return new LoginUser(user,permissionKeyList); &#125;&#125; 4. è‡ªå®šä¹‰å¤±è´¥å¤„ç†â€‹ æˆ‘ä»¬è¿˜å¸Œæœ›åœ¨è®¤è¯å¤±è´¥æˆ–è€…æ˜¯æˆæƒå¤±è´¥çš„æƒ…å†µä¸‹ä¹Ÿèƒ½å’Œæˆ‘ä»¬çš„æ¥å£ä¸€æ ·è¿”å›ç›¸åŒç»“æ„çš„jsonï¼Œè¿™æ ·å¯ä»¥è®©å‰ç«¯èƒ½å¯¹å“åº”è¿›è¡Œç»Ÿä¸€çš„å¤„ç†ã€‚è¦å®ç°è¿™ä¸ªåŠŸèƒ½æˆ‘ä»¬éœ€è¦çŸ¥é“SpringSecurityçš„å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚ â€‹ åœ¨SpringSecurityä¸­ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è®¤è¯æˆ–è€…æˆæƒçš„è¿‡ç¨‹ä¸­å‡ºç°äº†å¼‚å¸¸ä¼šè¢«ExceptionTranslationFilteræ•è·åˆ°ã€‚åœ¨ExceptionTranslationFilterä¸­ä¼šå»åˆ¤æ–­æ˜¯è®¤è¯å¤±è´¥è¿˜æ˜¯æˆæƒå¤±è´¥å‡ºç°çš„å¼‚å¸¸ã€‚ â€‹ å¦‚æœæ˜¯è®¤è¯è¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸ä¼šè¢«å°è£…æˆAuthenticationExceptionç„¶åè°ƒç”¨AuthenticationEntryPointå¯¹è±¡çš„æ–¹æ³•å»è¿›è¡Œå¼‚å¸¸å¤„ç†ã€‚ â€‹ å¦‚æœæ˜¯æˆæƒè¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸ä¼šè¢«å°è£…æˆAccessDeniedExceptionç„¶åè°ƒç”¨AccessDeniedHandlerå¯¹è±¡çš„æ–¹æ³•å»è¿›è¡Œå¼‚å¸¸å¤„ç†ã€‚ â€‹ æ‰€ä»¥å¦‚æœæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†ï¼Œæˆ‘ä»¬åªéœ€è¦è‡ªå®šä¹‰AuthenticationEntryPointå’ŒAccessDeniedHandlerç„¶åé…ç½®ç»™SpringSecurityå³å¯ã€‚ â‘ è‡ªå®šä¹‰å®ç°ç±» @Componentpublic class AccessDeniedHandlerImpl implements AccessDeniedHandler &#123; @Override public void handle(HttpServletRequest request, HttpServletResponse response, AccessDeniedException accessDeniedException) throws IOException, ServletException &#123; ResponseResult result = new ResponseResult(HttpStatus.FORBIDDEN.value(), &quot;æƒé™ä¸è¶³&quot;); String json = JSON.toJSONString(result); WebUtils.renderString(response,json); &#125;&#125; /** * @Author ä¸‰æ›´ Bç«™ï¼š https://space.bilibili.com/663528522 */@Componentpublic class AuthenticationEntryPointImpl implements AuthenticationEntryPoint &#123; @Override public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) throws IOException, ServletException &#123; ResponseResult result = new ResponseResult(HttpStatus.UNAUTHORIZED.value(), &quot;è®¤è¯å¤±è´¥è¯·é‡æ–°ç™»å½•&quot;); String json = JSON.toJSONString(result); WebUtils.renderString(response,json); &#125;&#125; â‘¡é…ç½®ç»™SpringSecurity â€‹ â€‹ å…ˆæ³¨å…¥å¯¹åº”çš„å¤„ç†å™¨ @Autowiredprivate AuthenticationEntryPoint authenticationEntryPoint;@Autowiredprivate AccessDeniedHandler accessDeniedHandler; â€‹ ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨HttpSecurityå¯¹è±¡çš„æ–¹æ³•å»é…ç½®ã€‚ http.exceptionHandling().authenticationEntryPoint(authenticationEntryPoint). accessDeniedHandler(accessDeniedHandler); 5. è·¨åŸŸâ€‹ æµè§ˆå™¨å‡ºäºå®‰å…¨çš„è€ƒè™‘ï¼Œä½¿ç”¨ XMLHttpRequestå¯¹è±¡å‘èµ· HTTPè¯·æ±‚æ—¶å¿…é¡»éµå®ˆåŒæºç­–ç•¥ï¼Œå¦åˆ™å°±æ˜¯è·¨åŸŸçš„HTTPè¯·æ±‚ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯è¢«ç¦æ­¢çš„ã€‚ åŒæºç­–ç•¥è¦æ±‚æºç›¸åŒæ‰èƒ½æ­£å¸¸è¿›è¡Œé€šä¿¡ï¼Œå³åè®®ã€åŸŸåã€ç«¯å£å·éƒ½å®Œå…¨ä¸€è‡´ã€‚ â€‹ å‰åç«¯åˆ†ç¦»é¡¹ç›®ï¼Œå‰ç«¯é¡¹ç›®å’Œåç«¯é¡¹ç›®ä¸€èˆ¬éƒ½ä¸æ˜¯åŒæºçš„ï¼Œæ‰€ä»¥è‚¯å®šä¼šå­˜åœ¨è·¨åŸŸè¯·æ±‚çš„é—®é¢˜ã€‚ â€‹ æ‰€ä»¥æˆ‘ä»¬å°±è¦å¤„ç†ä¸€ä¸‹ï¼Œè®©å‰ç«¯èƒ½è¿›è¡Œè·¨åŸŸè¯·æ±‚ã€‚ â‘ å…ˆå¯¹SpringBooté…ç½®ï¼Œè¿è¡Œè·¨åŸŸè¯·æ±‚ @Configurationpublic class CorsConfig implements WebMvcConfigurer &#123; @Override public void addCorsMappings(CorsRegistry registry) &#123; // è®¾ç½®å…è®¸è·¨åŸŸçš„è·¯å¾„ registry.addMapping(&quot;/**&quot;) // è®¾ç½®å…è®¸è·¨åŸŸè¯·æ±‚çš„åŸŸå .allowedOriginPatterns(&quot;*&quot;) // æ˜¯å¦å…è®¸cookie .allowCredentials(true) // è®¾ç½®å…è®¸çš„è¯·æ±‚æ–¹å¼ .allowedMethods(&quot;GET&quot;, &quot;POST&quot;, &quot;DELETE&quot;, &quot;PUT&quot;) // è®¾ç½®å…è®¸çš„headerå±æ€§ .allowedHeaders(&quot;*&quot;) // è·¨åŸŸå…è®¸æ—¶é—´ .maxAge(3600); &#125;&#125; â‘¡å¼€å¯SpringSecurityçš„è·¨åŸŸè®¿é—® ç”±äºæˆ‘ä»¬çš„èµ„æºéƒ½ä¼šæ”¶åˆ°SpringSecurityçš„ä¿æŠ¤ï¼Œæ‰€ä»¥æƒ³è¦è·¨åŸŸè®¿é—®è¿˜è¦è®©SpringSecurityè¿è¡Œè·¨åŸŸè®¿é—®ã€‚ @Overrideprotected void configure(HttpSecurity http) throws Exception &#123; http //å…³é—­csrf .csrf().disable() //ä¸é€šè¿‡Sessionè·å–SecurityContext .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS) .and() .authorizeRequests() // å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—® .antMatchers(&quot;/user/login&quot;).anonymous() // é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯ .anyRequest().authenticated(); //æ·»åŠ è¿‡æ»¤å™¨ http.addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class); //é…ç½®å¼‚å¸¸å¤„ç†å™¨ http.exceptionHandling() //é…ç½®è®¤è¯å¤±è´¥å¤„ç†å™¨ .authenticationEntryPoint(authenticationEntryPoint) .accessDeniedHandler(accessDeniedHandler); //å…è®¸è·¨åŸŸ http.cors();&#125; 6. é—ç•™å°é—®é¢˜å…¶å®ƒæƒé™æ ¡éªŒæ–¹æ³•â€‹ æˆ‘ä»¬å‰é¢éƒ½æ˜¯ä½¿ç”¨@PreAuthorizeæ³¨è§£ï¼Œç„¶ååœ¨åœ¨å…¶ä¸­ä½¿ç”¨çš„æ˜¯hasAuthorityæ–¹æ³•è¿›è¡Œæ ¡éªŒã€‚SpringSecurityè¿˜ä¸ºæˆ‘ä»¬æä¾›äº†å…¶å®ƒæ–¹æ³•ä¾‹å¦‚ï¼šhasAnyAuthorityï¼ŒhasRoleï¼ŒhasAnyRoleç­‰ã€‚ â€‹ â€‹ è¿™é‡Œæˆ‘ä»¬å…ˆä¸æ€¥ç€å»ä»‹ç»è¿™äº›æ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆå»ç†è§£hasAuthorityçš„åŸç†ï¼Œç„¶åå†å»å­¦ä¹ å…¶ä»–æ–¹æ³•ä½ å°±æ›´å®¹æ˜“ç†è§£ï¼Œè€Œä¸æ˜¯æ­»è®°ç¡¬èƒŒåŒºåˆ«ã€‚å¹¶ä¸”æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©å®šä¹‰æ ¡éªŒæ–¹æ³•ï¼Œå®ç°æˆ‘ä»¬è‡ªå·±çš„æ ¡éªŒé€»è¾‘ã€‚ â€‹ hasAuthorityæ–¹æ³•å®é™…æ˜¯æ‰§è¡Œåˆ°äº†SecurityExpressionRootçš„hasAuthorityï¼Œå¤§å®¶åªè¦æ–­ç‚¹è°ƒè¯•æ—¢å¯çŸ¥é“å®ƒå†…éƒ¨çš„æ ¡éªŒåŸç†ã€‚ â€‹ å®ƒå†…éƒ¨å…¶å®æ˜¯è°ƒç”¨authenticationçš„getAuthoritiesæ–¹æ³•è·å–ç”¨æˆ·çš„æƒé™åˆ—è¡¨ã€‚ç„¶ååˆ¤æ–­æˆ‘ä»¬å­˜å…¥çš„æ–¹æ³•å‚æ•°æ•°æ®åœ¨æƒé™åˆ—è¡¨ä¸­ã€‚ â€‹ hasAnyAuthorityæ–¹æ³•å¯ä»¥ä¼ å…¥å¤šä¸ªæƒé™ï¼Œåªæœ‰ç”¨æˆ·æœ‰å…¶ä¸­ä»»æ„ä¸€ä¸ªæƒé™éƒ½å¯ä»¥è®¿é—®å¯¹åº”èµ„æºã€‚ @PreAuthorize(&quot;hasAnyAuthority(&#x27;admin&#x27;,&#x27;test&#x27;,&#x27;system:dept:list&#x27;)&quot;)public String hello()&#123; return &quot;hello&quot;;&#125; â€‹ hasRoleè¦æ±‚æœ‰å¯¹åº”çš„è§’è‰²æ‰å¯ä»¥è®¿é—®ï¼Œä½†æ˜¯å®ƒå†…éƒ¨ä¼šæŠŠæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°æ‹¼æ¥ä¸Š ROLE_ åå†å»æ¯”è¾ƒã€‚æ‰€ä»¥è¿™ç§æƒ…å†µä¸‹è¦ç”¨ç”¨æˆ·å¯¹åº”çš„æƒé™ä¹Ÿè¦æœ‰ ROLE_ è¿™ä¸ªå‰ç¼€æ‰å¯ä»¥ã€‚ @PreAuthorize(&quot;hasRole(&#x27;system:dept:list&#x27;)&quot;)public String hello()&#123; return &quot;hello&quot;;&#125; â€‹ hasAnyRole æœ‰ä»»æ„çš„è§’è‰²å°±å¯ä»¥è®¿é—®ã€‚å®ƒå†…éƒ¨ä¹Ÿä¼šæŠŠæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°æ‹¼æ¥ä¸Š ROLE_ åå†å»æ¯”è¾ƒã€‚æ‰€ä»¥è¿™ç§æƒ…å†µä¸‹è¦ç”¨ç”¨æˆ·å¯¹åº”çš„æƒé™ä¹Ÿè¦æœ‰ ROLE_ è¿™ä¸ªå‰ç¼€æ‰å¯ä»¥ã€‚ @PreAuthorize(&quot;hasAnyRole(&#x27;admin&#x27;,&#x27;system:dept:list&#x27;)&quot;)public String hello()&#123; return &quot;hello&quot;;&#125; è‡ªå®šä¹‰æƒé™æ ¡éªŒæ–¹æ³•â€‹ æˆ‘ä»¬ä¹Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„æƒé™æ ¡éªŒæ–¹æ³•ï¼Œåœ¨@PreAuthorizeæ³¨è§£ä¸­ä½¿ç”¨æˆ‘ä»¬çš„æ–¹æ³•ã€‚ @Component(&quot;ex&quot;)public class SGExpressionRoot &#123; public boolean hasAuthority(String authority)&#123; //è·å–å½“å‰ç”¨æˆ·çš„æƒé™ Authentication authentication = SecurityContextHolder.getContext().getAuthentication(); LoginUser loginUser = (LoginUser) authentication.getPrincipal(); List&lt;String&gt; permissions = loginUser.getPermissions(); //åˆ¤æ–­ç”¨æˆ·æƒé™é›†åˆä¸­æ˜¯å¦å­˜åœ¨authority return permissions.contains(authority); &#125;&#125; â€‹ åœ¨SPELè¡¨è¾¾å¼ä¸­ä½¿ç”¨ @exç›¸å½“äºè·å–å®¹å™¨ä¸­beançš„åå­—æœªexçš„å¯¹è±¡ã€‚ç„¶åå†è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„hasAuthorityæ–¹æ³• @RequestMapping(&quot;/hello&quot;)@PreAuthorize(&quot;@ex.hasAuthority(&#x27;system:dept:list&#x27;)&quot;)public String hello()&#123; return &quot;hello&quot;;&#125; åŸºäºé…ç½®çš„æƒé™æ§åˆ¶â€‹ æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨é…ç½®ç±»ä¸­ä½¿ç”¨ä½¿ç”¨é…ç½®çš„æ–¹å¼å¯¹èµ„æºè¿›è¡Œæƒé™æ§åˆ¶ã€‚ @Overrideprotected void configure(HttpSecurity http) throws Exception &#123; http //å…³é—­csrf .csrf().disable() //ä¸é€šè¿‡Sessionè·å–SecurityContext .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS) .and() .authorizeRequests() // å¯¹äºç™»å½•æ¥å£ å…è®¸åŒ¿åè®¿é—® .antMatchers(&quot;/user/login&quot;).anonymous() .antMatchers(&quot;/testCors&quot;).hasAuthority(&quot;system:dept:list222&quot;) // é™¤ä¸Šé¢å¤–çš„æ‰€æœ‰è¯·æ±‚å…¨éƒ¨éœ€è¦é‰´æƒè®¤è¯ .anyRequest().authenticated(); //æ·»åŠ è¿‡æ»¤å™¨ http.addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class); //é…ç½®å¼‚å¸¸å¤„ç†å™¨ http.exceptionHandling() //é…ç½®è®¤è¯å¤±è´¥å¤„ç†å™¨ .authenticationEntryPoint(authenticationEntryPoint) .accessDeniedHandler(accessDeniedHandler); //å…è®¸è·¨åŸŸ http.cors();&#125; CSRFâ€‹ CSRFæ˜¯æŒ‡è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCross-site request forgeryï¼‰ï¼Œæ˜¯webå¸¸è§çš„æ”»å‡»ä¹‹ä¸€ã€‚ â€‹ https://blog.csdn.net/freeking101/article/details/86537087 â€‹ SpringSecurityå»é˜²æ­¢CSRFæ”»å‡»çš„æ–¹å¼å°±æ˜¯é€šè¿‡csrf_tokenã€‚åç«¯ä¼šç”Ÿæˆä¸€ä¸ªcsrf_tokenï¼Œå‰ç«¯å‘èµ·è¯·æ±‚çš„æ—¶å€™éœ€è¦æºå¸¦è¿™ä¸ªcsrf_token,åç«¯ä¼šæœ‰è¿‡æ»¤å™¨è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœæ²¡æœ‰æºå¸¦æˆ–è€…æ˜¯ä¼ªé€ çš„å°±ä¸å…è®¸è®¿é—®ã€‚ â€‹ æˆ‘ä»¬å¯ä»¥å‘ç°CSRFæ”»å‡»ä¾é çš„æ˜¯cookieä¸­æ‰€æºå¸¦çš„è®¤è¯ä¿¡æ¯ã€‚ä½†æ˜¯åœ¨å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ä¸­æˆ‘ä»¬çš„è®¤è¯ä¿¡æ¯å…¶å®æ˜¯tokenï¼Œè€Œtokenå¹¶ä¸æ˜¯å­˜å‚¨ä¸­cookieä¸­ï¼Œå¹¶ä¸”éœ€è¦å‰ç«¯ä»£ç å»æŠŠtokenè®¾ç½®åˆ°è¯·æ±‚å¤´ä¸­æ‰å¯ä»¥ï¼Œæ‰€ä»¥CSRFæ”»å‡»ä¹Ÿå°±ä¸ç”¨æ‹…å¿ƒäº†ã€‚ è®¤è¯æˆåŠŸå¤„ç†å™¨â€‹ å®é™…ä¸Šåœ¨UsernamePasswordAuthenticationFilterè¿›è¡Œç™»å½•è®¤è¯çš„æ—¶å€™ï¼Œå¦‚æœç™»å½•æˆåŠŸäº†æ˜¯ä¼šè°ƒç”¨AuthenticationSuccessHandlerçš„æ–¹æ³•è¿›è¡Œè®¤è¯æˆåŠŸåçš„å¤„ç†çš„ã€‚AuthenticationSuccessHandlerå°±æ˜¯ç™»å½•æˆåŠŸå¤„ç†å™¨ã€‚ â€‹ æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å»è‡ªå®šä¹‰æˆåŠŸå¤„ç†å™¨è¿›è¡ŒæˆåŠŸåçš„ç›¸åº”å¤„ç†ã€‚ @Componentpublic class SGSuccessHandler implements AuthenticationSuccessHandler &#123; @Override public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException &#123; System.out.println(&quot;è®¤è¯æˆåŠŸäº†&quot;); &#125;&#125; @Configurationpublic class SecurityConfig extends WebSecurityConfigurerAdapter &#123; @Autowired private AuthenticationSuccessHandler successHandler; @Override protected void configure(HttpSecurity http) throws Exception &#123; http.formLogin().successHandler(successHandler); http.authorizeRequests().anyRequest().authenticated(); &#125;&#125; è®¤è¯å¤±è´¥å¤„ç†å™¨â€‹ å®é™…ä¸Šåœ¨UsernamePasswordAuthenticationFilterè¿›è¡Œç™»å½•è®¤è¯çš„æ—¶å€™ï¼Œå¦‚æœè®¤è¯å¤±è´¥äº†æ˜¯ä¼šè°ƒç”¨AuthenticationFailureHandlerçš„æ–¹æ³•è¿›è¡Œè®¤è¯å¤±è´¥åçš„å¤„ç†çš„ã€‚AuthenticationFailureHandlerå°±æ˜¯ç™»å½•å¤±è´¥å¤„ç†å™¨ã€‚ â€‹ æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å»è‡ªå®šä¹‰å¤±è´¥å¤„ç†å™¨è¿›è¡Œå¤±è´¥åçš„ç›¸åº”å¤„ç†ã€‚ @Componentpublic class SGFailureHandler implements AuthenticationFailureHandler &#123; @Override public void onAuthenticationFailure(HttpServletRequest request, HttpServletResponse response, AuthenticationException exception) throws IOException, ServletException &#123; System.out.println(&quot;è®¤è¯å¤±è´¥äº†&quot;); &#125;&#125; @Configurationpublic class SecurityConfig extends WebSecurityConfigurerAdapter &#123; @Autowired private AuthenticationSuccessHandler successHandler; @Autowired private AuthenticationFailureHandler failureHandler; @Override protected void configure(HttpSecurity http) throws Exception &#123; http.formLogin()// é…ç½®è®¤è¯æˆåŠŸå¤„ç†å™¨ .successHandler(successHandler)// é…ç½®è®¤è¯å¤±è´¥å¤„ç†å™¨ .failureHandler(failureHandler); http.authorizeRequests().anyRequest().authenticated(); &#125;&#125; ç™»å‡ºæˆåŠŸå¤„ç†å™¨@Componentpublic class SGLogoutSuccessHandler implements LogoutSuccessHandler &#123; @Override public void onLogoutSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException &#123; System.out.println(&quot;æ³¨é”€æˆåŠŸ&quot;); &#125;&#125; @Configurationpublic class SecurityConfig extends WebSecurityConfigurerAdapter &#123; @Autowired private AuthenticationSuccessHandler successHandler; @Autowired private AuthenticationFailureHandler failureHandler; @Autowired private LogoutSuccessHandler logoutSuccessHandler; @Override protected void configure(HttpSecurity http) throws Exception &#123; http.formLogin()// é…ç½®è®¤è¯æˆåŠŸå¤„ç†å™¨ .successHandler(successHandler)// é…ç½®è®¤è¯å¤±è´¥å¤„ç†å™¨ .failureHandler(failureHandler); http.logout() //é…ç½®æ³¨é”€æˆåŠŸå¤„ç†å™¨ .logoutSuccessHandler(logoutSuccessHandler); http.authorizeRequests().anyRequest().authenticated(); &#125;&#125; å…¶ä»–è®¤è¯æ–¹æ¡ˆç•…æƒ³7. æºç è®²è§£â€‹ æŠ•ç¥¨è¿‡50æ›´æ–°æºç è®²è§£","categories":[{"name":"æ•™ç¨‹","slug":"æ•™ç¨‹","permalink":"https://aqu.iyunmc.cn/categories/%E6%95%99%E7%A8%8B/"}],"tags":[{"name":"Java","slug":"java","permalink":"https://aqu.iyunmc.cn/tags/java/"}]},{"title":"æµ‹è¯•ã€Œæ–‡ç« å†…é“¾æ¥ä½œæ–‡æœ¬çš„è¯æ— æ³•ç”Ÿæˆé™æ€æ–‡ä»¶ã€","slug":"blog/2020-03-06-test-url","date":"2020-03-05T16:00:00.000Z","updated":"2023-06-05T07:17:29.760Z","comments":true,"path":"blog/2020-03-06-test-url/","link":"","permalink":"https://aqu.iyunmc.cn/blog/2020-03-06-test-url/","excerpt":"","text":"https://volantis.js.org/v6/tag-plugins/#text5ã€æµ‹è¯•Tomcatæ˜¯å¦é…ç½®æˆåŠŸï¼šæ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥åœ¨åœ°å€æ ä¸­è¾“å…¥ï¼š http://localhost:8080 çš„è¿è¡Œç»“æœå¦‚ä¸‹å›¾å³ä¸ºå³ä¸ºé…ç½®æˆåŠŸï¼ï¼ˆå› ä¸ºTomcatå·²ç»åœ¨è¿è¡Œå†æ¬¡æ‰“å¼€ä¼šæŠ¥é”™ï¼‰ ç›¸å…³ Issueï¼š #164 ç»“è®ºï¼šå­˜åœ¨è¿™ç¯‡æ–‡ç« çš„æƒ…å†µä¸‹èƒ½å¤ŸæˆåŠŸ deploy ï¼Œè¯´æ˜è¿™ä¸æ˜¯ä¸»é¢˜çš„ BUGã€‚ markdwon è§£ææ’ä»¶ä¸º hexo-renderer-marked æ—¶æ­¤æ’ä»¶é»˜è®¤ä¼šè‡ªåŠ¨è¯†åˆ« URL ï¼Œä¸”åŸæ–‡é“¾æ¥å‰åæ²¡æœ‰ç©ºæ ¼ï¼Œæ‰€ä»¥é“¾æ¥å‰åå¢åŠ ä¸€ä¸ªç©ºæ ¼æˆ–è€…åœ¨æ ¹ç›®å½•é…ç½®æ–‡ä»¶ä¸­è®¾ç½® autolink: false éƒ½å¯ä»¥é¿å… deploy æŠ¥é”™ã€‚æ’ä»¶ï¼šhexo-renderer-marked https://cdn1.tianli0.top/gh/ino0613/Aquino@output/github-contribution-grid-snake.svg","categories":[{"name":"test","slug":"test","permalink":"https://aqu.iyunmc.cn/categories/test/"}],"tags":[]},{"title":"Code Highlight Style test","slug":"blog/code-highlight","date":"2019-07-25T08:43:00.000Z","updated":"2023-05-29T07:21:56.392Z","comments":true,"path":"blog/code-highlight/","link":"","permalink":"https://aqu.iyunmc.cn/blog/code-highlight/","excerpt":"Make sure all the code blocks highlighted correctly. All the code samples are come from the demo of https://highlightjs.org","text":"Make sure all the code blocks highlighted correctly. All the code samples are come from the demo of https://highlightjs.org Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry&#x27;s standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. #[derive(Debug)]pub enum State &#123; Start, Transient, Closed,&#125;impl From&lt;&amp;&#x27;a str&gt; for State &#123; fn from(s: &amp;&#x27;a str) -&gt; Self &#123; match s &#123; &quot;start&quot; =&gt; State::Start, &quot;closed&quot; =&gt; State::Closed, _ =&gt; unreachable!(), &#125; &#125;&#125; [ &#123; &quot;title&quot;: &quot;apples&quot;, &quot;count&quot;: [12000, 20000], &quot;description&quot;: &#123;&quot;text&quot;: &quot;...&quot;, &quot;sensitive&quot;: false&#125; &#125;, &#123; &quot;title&quot;: &quot;oranges&quot;, &quot;count&quot;: [17500, null], &quot;description&quot;: &#123;&quot;text&quot;: &quot;...&quot;, &quot;sensitive&quot;: false&#125; &#125;] class MyClass &#123; public static myValue: string; constructor(init: string) &#123; this.myValue = init; &#125;&#125;import fs = require(&quot;fs&quot;);module MyModule &#123; export interface MyInterface extends Other &#123; myProperty: any; &#125;&#125;declare magicNumber number;myArray.forEach(() =&gt; &#123; &#125;); // fat arrow syntax @requires_authorizationdef somefunc(param1=&#x27;&#x27;, param2=0): r&#x27;&#x27;&#x27;A docstring&#x27;&#x27;&#x27; if param1 &gt; param2: # interesting print &#x27;Gre\\&#x27;ater&#x27; return (param2 - param1 + 1 + 0b10l) or Noneclass SomeClass: pass&gt;&gt;&gt; message = &#x27;&#x27;&#x27;interpreter... prompt&#x27;&#x27;&#x27; &lt;!DOCTYPE html&gt;&lt;title&gt;Title&lt;/title&gt;&lt;style&gt;body &#123;width: 500px;&#125;&lt;/style&gt;&lt;script type=&quot;application/javascript&quot;&gt; function $init() &#123;return true;&#125;&lt;/script&gt;&lt;body&gt; &lt;p checked class=&quot;title&quot; id=&#x27;title&#x27;&gt;Title&lt;/p&gt; &lt;!-- here goes the rest of the page --&gt;&lt;/body&gt; function $initHighlight(block, cls) &#123; try &#123; if (cls.search(/\\bno\\-highlight\\b/) != -1) return process(block, true, 0x0F) + ` class=&quot;$&#123;cls&#125;&quot;`; &#125; catch (e) &#123; /* handle exception */ &#125; for (var i = 0 / 2; i &lt; classes.length; i++) &#123; if (checkCondition(classes[i]) === undefined) console.log(&#x27;undefined&#x27;); &#125; return ( &lt;div&gt; &lt;web-component&gt;&#123;block&#125;&lt;/web-component&gt; &lt;/div&gt; )&#125;export $initHighlight; #include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125; CREATE TABLE &quot;topic&quot; ( &quot;id&quot; serial NOT NULL PRIMARY KEY, &quot;forum_id&quot; integer NOT NULL, &quot;subject&quot; varchar(255) NOT NULL);ALTER TABLE &quot;topic&quot;ADD CONSTRAINT forum_id FOREIGN KEY (&quot;forum_id&quot;)REFERENCES &quot;forum&quot; (&quot;id&quot;);-- Initialsinsert into &quot;topic&quot; (&quot;forum_id&quot;, &quot;subject&quot;)values (2, &#x27;D&#x27;&#x27;artagnian&#x27;); #import &lt;UIKit/UIKit.h&gt;#import &quot;Dependency.h&quot;@protocol WorldDataSource@optional- (NSString *)worldName;@required- (BOOL)allowsToLive;@end// comment@property (nonatomic, readonly) NSString *title;- (IBAction) show;@end /** * @author John Smith &lt;john.smith@example.com&gt;*/package l2f.gameserver.model;public abstract class L2Char extends L2Object &#123; public static final Short ERROR = 0x0001; public void moveTo(int x, int y, int z) &#123; _ai = null; log(&quot;Should not be called&quot;); if (1 &gt; 5) &#123; // wtf!? return; &#125; &#125;&#125; import Foundation@objc class Person: Entity &#123; var name: String! var age: Int! init(name: String, age: Int) &#123; /* /* ... */ */ &#125; // Return a descriptive string for this person func description(offset: Int = 0) -&gt; String &#123; return &quot;\\(name) is \\(age + offset) years old&quot; &#125;&#125; @font-face &#123; font-family: Chunkfive; src: url(&#x27;Chunkfive.otf&#x27;);&#125;body, .usertext &#123; color: #F0F0F0; background: #600; font-family: Chunkfive, sans;&#125;@import url(print.css);@media print &#123; a[href^=http]::after &#123; content: attr(href) &#125;&#125; # The Greeter classclass Greeter def initialize(name) @name = name.capitalize end def salute puts &quot;Hello #&#123;@name&#125;!&quot; endendg = Greeter.new(&quot;world&quot;)g.salute # MakefileBUILDDIR = _buildEXTRAS ?= $(BUILDDIR)/extras.PHONY: main cleanmain: @echo &quot;Building main facility...&quot; build_main $(BUILDDIR)clean: rm -rf $(BUILDDIR)/* package mainimport &quot;fmt&quot;func main() &#123; ch := make(chan float64) ch &lt;- 1.0e10 // magic number x, ok := &lt;- ch defer fmt.Println(`exitting now\\`) go println(len(&quot;hello world!&quot;)) return&#125; #!/bin/bash###### CONFIGACCEPTED_HOSTS=&quot;/root/.hag_accepted.conf&quot;BE_VERBOSE=falseif [ &quot;$UID&quot; -ne 0 ]then echo &quot;Superuser rights required&quot; exit 2figenApacheConf()&#123; echo -e &quot;# Host $&#123;HOME_DIR&#125;$1/$2 :&quot;&#125; ; boilerplate[package]name = &quot;some_name&quot;authors = [&quot;Author&quot;]description = &quot;This is \\a description&quot;[[lib]]name = $&#123;NAME&#125;default = Trueauto = nocounter = 1_000 é•¿æ–‡æœ¬æµ‹è¯• #include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;#include &lt;iostream&gt;int main(int argc, char *argv[]) &#123; /* An annoying &quot;Hello World&quot; example */ for (auto i = 0; i &lt; 0xFFFF; i++) cout &lt;&lt; &quot;Hello, World!&quot; &lt;&lt; endl; char c = &#x27;\\n&#x27;; unordered_map &lt;string, vector&lt;string&gt; &gt; m; m[&quot;key&quot;] = &quot;\\\\\\\\&quot;; // this is an error return -2e3 + 12l;&#125;","categories":[],"tags":[]}],"categories":[{"name":"é¢è¯•","slug":"é¢è¯•","permalink":"https://aqu.iyunmc.cn/categories/%E9%9D%A2%E8%AF%95/"},{"name":"æ•™ç¨‹","slug":"æ•™ç¨‹","permalink":"https://aqu.iyunmc.cn/categories/%E6%95%99%E7%A8%8B/"},{"name":"Java","slug":"java","permalink":"https://aqu.iyunmc.cn/categories/java/"},{"name":"test","slug":"test","permalink":"https://aqu.iyunmc.cn/categories/test/"}],"tags":[{"name":"Redis","slug":"redis","permalink":"https://aqu.iyunmc.cn/tags/redis/"},{"name":"Java","slug":"java","permalink":"https://aqu.iyunmc.cn/tags/java/"},{"name":"Linux","slug":"linux","permalink":"https://aqu.iyunmc.cn/tags/linux/"},{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"https://aqu.iyunmc.cn/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/"}]}